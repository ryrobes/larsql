cascade_id: feedback_review
description: Professional feedback review application - review items one by one with
  approve/reject workflow
inputs_schema: {}
model: claude-sonnet-4-20250514
cells:
- name: generate_data
  tool: python_data
  inputs:
    code: "import random\nfrom datetime import datetime, timedelta\n\nfirst_names\
      \ = ['Sarah', 'James', 'Maria', 'David', 'Emily', 'Michael', 'Lisa', 'Robert',\
      \ 'Jennifer', 'William', 'Amanda', 'Christopher', 'Jessica', 'Daniel', 'Ashley',\
      \ 'Matthew', 'Nicole', 'Andrew', 'Stephanie', 'Joshua']\nlast_names = ['Chen',\
      \ 'Smith', 'Johnson', 'Williams', 'Brown', 'Garcia', 'Miller', 'Davis', 'Rodriguez',\
      \ 'Martinez', 'Anderson', 'Taylor', 'Thomas', 'Moore', 'Jackson', 'Martin',\
      \ 'Lee', 'Thompson', 'White', 'Harris']\ndepartments = ['Engineering', 'Sales',\
      \ 'Marketing', 'Operations', 'Finance', 'HR', 'Product', 'Support']\npriorities\
      \ = ['Critical', 'High', 'Medium', 'Low']\npriority_weights = [5, 15, 50, 30]\n\
      categories = ['Bug Report', 'Feature Request', 'Process Improvement', 'Resource\
      \ Request', 'Policy Change', 'Training Need']\n\ntitles = [\n    'Improve onboarding\
      \ documentation', 'Update deployment pipeline', 'Streamline approval workflow',\n\
      \    'Add dark mode to dashboard', 'Fix login timeout issues', 'Integrate Slack\
      \ notifications',\n    'Reduce meeting frequency', 'Upgrade development tools',\
      \ 'Standardize code review process',\n    'Implement automated testing', 'Enhance\
      \ security protocols', 'Optimize database queries',\n    'Create training materials',\
      \ 'Revise expense policy', 'Add export functionality',\n    'Improve error messages',\
      \ 'Update API documentation', 'Consolidate reporting tools',\n    'Implement\
      \ SSO login', 'Add batch processing', 'Revise PTO policy', 'Upgrade hardware',\n\
      \    'Create style guide', 'Add search functionality', 'Improve mobile experience'\n\
      ]\n\ndescriptions = [\n    'This would significantly improve team productivity\
      \ and reduce confusion.',\n    'Current process is causing delays and frustration\
      \ across multiple teams.',\n    'Several customers have requested this feature\
      \ in recent surveys.',\n    'This aligns with our Q1 objectives and strategic\
      \ goals.',\n    'Implementation would require minimal resources but yield high\
      \ impact.',\n    'Other companies in our space have already adopted this approach.',\n\
      \    'The current solution is outdated and no longer meets our needs.',\n  \
      \  'This change would reduce operational costs by an estimated 15%.',\n    'Team\
      \ morale would benefit significantly from this improvement.',\n    'Security\
      \ audit identified this as a priority item to address.'\n]\n\nresult = []\n\
      base_date = datetime.now()\n\nfor i in range(50):\n    submitted = base_date\
      \ - timedelta(days=random.randint(1, 30), hours=random.randint(0, 23))\n   \
      \ result.append({\n        'id': i + 1,\n        'title': random.choice(titles),\n\
      \        'submitter': f\"{random.choice(first_names)} {random.choice(last_names)}\"\
      ,\n        'department': random.choice(departments),\n        'priority': random.choices(priorities,\
      \ weights=priority_weights)[0],\n        'category': random.choice(categories),\n\
      \        'description': random.choice(descriptions),\n        'submitted_date':\
      \ submitted.strftime('%Y-%m-%d')\n    })"
  handoffs:
  - overview_grid
- name: overview_grid
  context:
    from:
    - generate_data
  hitl: "<div style=\"background:#000;color:#e2e8f0;font-family:'Inter',system-ui,sans-serif;padding:16px;min-height:100vh;\"\
    >\n  <div style=\"display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;border-bottom:1px\
    \ solid #333;padding-bottom:12px;\">\n    <div>\n      <h1 style=\"margin:0;font-size:18px;color:#fff;font-weight:600;\"\
    >Feedback Review Queue</h1>\n      <p style=\"margin:4px 0 0 0;font-size:12px;color:#64748b;\"\
    >{{ outputs.generate_data | length }} items pending review</p>\n    </div>\n \
    \   <div style=\"display:flex;gap:8px;align-items:center;\">\n      <span style=\"\
    font-size:11px;color:#64748b;\">Priority:</span>\n      <span style=\"background:#dc2626;color:#fff;padding:2px\
    \ 8px;border-radius:3px;font-size:10px;font-weight:600;\">Critical</span>\n  \
    \    <span style=\"background:#f97316;color:#fff;padding:2px 8px;border-radius:3px;font-size:10px;font-weight:600;\"\
    >High</span>\n      <span style=\"background:#eab308;color:#000;padding:2px 8px;border-radius:3px;font-size:10px;font-weight:600;\"\
    >Medium</span>\n      <span style=\"background:#64748b;color:#fff;padding:2px\
    \ 8px;border-radius:3px;font-size:10px;font-weight:600;\">Low</span>\n    </div>\n\
    \  </div>\n\n  <div id=\"feedbackGrid\" style=\"height:450px;width:100%;\"></div>\n\
    \n  <script>\n    (function() {\n      try {\n        const rowData = {% if outputs.generate_data\
    \ %}{{ outputs.generate_data | tojson | safe }}{% else %}[]{% endif %};\n    \
    \    console.log('Row data loaded:', rowData.length, 'items');\n        \n   \
    \     if (!rowData || rowData.length === 0) {\n          document.getElementById('feedbackGrid').innerHTML\
    \ = '<div style=\"padding:20px;color:#ef4444;\">No data loaded</div>';\n     \
    \     return;\n        }\n        \n        const gridOptions = {\n          theme:\
    \ agGrid.themeQuartz.withPart(agGrid.colorSchemeDark),\n          rowData: rowData,\n\
    \          columnDefs: [\n            { field: 'id', headerName: 'ID', width:\
    \ 70 },\n            { field: 'priority', headerName: 'Priority', width: 100,\n\
    \              cellStyle: params => {\n                const colors = { 'Critical':\
    \ '#dc2626', 'High': '#f97316', 'Medium': '#eab308', 'Low': '#64748b' };\n   \
    \             return { backgroundColor: colors[params.value] || '#333', color:\
    \ params.value === 'Medium' ? '#000' : '#fff', fontWeight: '600' };\n        \
    \      }\n            },\n            { field: 'title', headerName: 'Title', flex:\
    \ 2 },\n            { field: 'submitter', headerName: 'Submitter', flex: 1 },\n\
    \            { field: 'department', headerName: 'Dept', width: 110 },\n      \
    \      { field: 'category', headerName: 'Category', width: 140 },\n          \
    \  { field: 'submitted_date', headerName: 'Date', width: 100 }\n          ],\n\
    \          defaultColDef: { sortable: true, filter: true, resizable: true },\n\
    \          pagination: true,\n          paginationPageSize: 15\n        };\n \
    \       \n        const gridDiv = document.querySelector('#feedbackGrid');\n \
    \       agGrid.createGrid(gridDiv, gridOptions);\n        console.log('AG Grid\
    \ created successfully');\n      } catch(e) {\n        console.error('Grid error:',\
    \ e);\n        document.getElementById('feedbackGrid').innerHTML = '<div style=\"\
    padding:20px;color:#ef4444;\">Error: ' + e.message + '</div>';\n      }\n    })();\n\
    \  </script>\n\n  <form hx-post=\"/api/checkpoints/{{ checkpoint_id }}/respond\"\
    \ hx-ext=\"json-enc\" hx-swap=\"outerHTML\" style=\"margin-top:16px;display:flex;justify-content:space-between;align-items:center;border-top:1px\
    \ solid #333;padding-top:16px;\">\n    <div style=\"font-size:12px;color:#64748b;\"\
    >Review each item individually and approve or reject</div>\n    <button type=\"\
    submit\" name=\"response[action]\" value=\"start_review\" style=\"background:linear-gradient(135deg,#a78bfa\
    \ 0%,#8b5cf6 100%);color:#fff;border:none;padding:10px 24px;border-radius:4px;font-weight:600;cursor:pointer;font-size:13px;\"\
    >Start Review →</button>\n  </form>\n</div>"
  handoffs:
  - review_item
- name: review_item
  context:
    from:
    - generate_data
  hitl: "{% set current_idx = state.current_index | default(0) | int %}\n{% set total_items\
    \ = outputs.generate_data | length %}\n{% set current_item = outputs.generate_data[current_idx]\
    \ %}\n{% set is_last = current_idx >= total_items - 1 %}\n{% set decisions_so_far\
    \ = state.all_decisions | default('[]') %}\n\n<div style=\"background:#000;color:#e2e8f0;font-family:'Inter',system-ui,sans-serif;padding:16px;min-height:100vh;\"\
    >\n  <!-- Progress Bar -->\n  <div style=\"margin-bottom:16px;\">\n    <div style=\"\
    display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;\"\
    >\n      <span style=\"font-size:11px;color:#64748b;text-transform:uppercase;letter-spacing:1px;\"\
    >Review Progress</span>\n      <span style=\"font-size:13px;color:#fff;font-weight:600;\"\
    >{{ current_idx + 1 }} of {{ total_items }}</span>\n    </div>\n    <div style=\"\
    background:#1e293b;height:4px;border-radius:2px;overflow:hidden;\">\n      <div\
    \ style=\"background:linear-gradient(90deg,#a78bfa,#8b5cf6);height:100%;width:{{\
    \ ((current_idx + 1) / total_items * 100) | round }}%;transition:width 0.3s;\"\
    ></div>\n    </div>\n  </div>\n\n  <!-- Item Card -->\n  <div style=\"background:#0a0a0a;border:1px\
    \ solid #333;border-radius:6px;overflow:hidden;\">\n    <!-- Header -->\n    <div\
    \ style=\"display:flex;justify-content:space-between;align-items:center;padding:12px\
    \ 16px;border-bottom:1px solid #222;background:#111;\">\n      <div style=\"display:flex;align-items:center;gap:12px;\"\
    >\n        <span style=\"font-size:11px;color:#64748b;font-family:monospace;\"\
    >#{{ current_item.id }}</span>\n        <span style=\"{% if current_item.priority\
    \ == 'Critical' %}background:#dc2626;{% elif current_item.priority == 'High' %}background:#f97316;{%\
    \ elif current_item.priority == 'Medium' %}background:#eab308;color:#000;{% else\
    \ %}background:#64748b;{% endif %}color:{% if current_item.priority == 'Medium'\
    \ %}#000{% else %}#fff{% endif %};padding:2px 10px;border-radius:3px;font-size:10px;font-weight:700;text-transform:uppercase;\"\
    >{{ current_item.priority }}</span>\n        <span style=\"background:#1e293b;color:#94a3b8;padding:2px\
    \ 10px;border-radius:3px;font-size:10px;\">{{ current_item.category }}</span>\n\
    \      </div>\n      <span style=\"font-size:11px;color:#475569;\">{{ current_item.submitted_date\
    \ }}</span>\n    </div>\n    \n    <!-- Body -->\n    <div style=\"padding:20px;\"\
    >\n      <h2 style=\"margin:0 0 12px 0;font-size:18px;color:#fff;font-weight:600;\"\
    >{{ current_item.title }}</h2>\n      <p style=\"margin:0 0 16px 0;font-size:14px;color:#94a3b8;line-height:1.5;\"\
    >{{ current_item.description }}</p>\n      \n      <div style=\"display:grid;grid-template-columns:1fr\
    \ 1fr;gap:12px;padding-top:12px;border-top:1px solid #222;\">\n        <div>\n\
    \          <span style=\"font-size:10px;color:#64748b;text-transform:uppercase;letter-spacing:0.5px;\"\
    >Submitter</span>\n          <div style=\"font-size:13px;color:#fff;margin-top:2px;\"\
    >{{ current_item.submitter }}</div>\n        </div>\n        <div>\n         \
    \ <span style=\"font-size:10px;color:#64748b;text-transform:uppercase;letter-spacing:0.5px;\"\
    >Department</span>\n          <div style=\"font-size:13px;color:#fff;margin-top:2px;\"\
    >{{ current_item.department }}</div>\n        </div>\n      </div>\n    </div>\n\
    \  </div>\n\n  <!-- Action Buttons -->\n  <form hx-post=\"/api/checkpoints/{{\
    \ checkpoint_id }}/respond\" hx-ext=\"json-enc\" hx-swap=\"outerHTML\" id=\"review-form\"\
    \ style=\"margin-top:16px;\">\n    <input type=\"hidden\" name=\"response[current_index]\"\
    \ value=\"{{ current_idx + 1 }}\" />\n    <input type=\"hidden\" name=\"response[item_id]\"\
    \ value=\"{{ current_item.id }}\" />\n    <input type=\"hidden\" name=\"response[all_decisions]\"\
    \ id=\"all-decisions\" value=\"\" />\n    <input type=\"hidden\" name=\"response[decision]\"\
    \ id=\"current-decision\" value=\"\" />\n    <input type=\"hidden\" name=\"response[action]\"\
    \ id=\"action-value\" value=\"next\" />\n    \n    <div style=\"display:flex;gap:12px;\"\
    >\n      <button type=\"submit\" onclick=\"submitDecision('approve')\" style=\"\
    flex:1;background:#166534;color:#fff;border:1px solid #22c55e;padding:14px;border-radius:4px;font-weight:600;cursor:pointer;font-size:14px;display:flex;align-items:center;justify-content:center;gap:8px;\"\
    >\n        <span style=\"font-size:18px;\">✓</span> Approve\n        <span style=\"\
    font-size:11px;color:#86efac;margin-left:8px;\">[A]</span>\n      </button>\n\
    \      <button type=\"submit\" onclick=\"submitDecision('reject')\" style=\"flex:1;background:#991b1b;color:#fff;border:1px\
    \ solid #ef4444;padding:14px;border-radius:4px;font-weight:600;cursor:pointer;font-size:14px;display:flex;align-items:center;justify-content:center;gap:8px;\"\
    >\n        <span style=\"font-size:18px;\">✗</span> Reject\n        <span style=\"\
    font-size:11px;color:#fca5a5;margin-left:8px;\">[R]</span>\n      </button>\n\
    \    </div>\n  </form>\n\n  <div style=\"margin-top:12px;text-align:center;font-size:11px;color:#475569;\"\
    >Keyboard shortcuts: <kbd style=\"background:#1e293b;padding:2px 6px;border-radius:3px;\"\
    >A</kbd> Approve &nbsp; <kbd style=\"background:#1e293b;padding:2px 6px;border-radius:3px;\"\
    >R</kbd> Reject</div>\n</div>\n\n<script>\n  const existingDecisions = JSON.parse('{{\
    \ decisions_so_far | safe }}');\n  const isLast = {{ 'true' if is_last else 'false'\
    \ }};\n  const currentItemId = {{ current_item.id }};\n  \n  function submitDecision(decision)\
    \ {\n    existingDecisions.push({id: currentItemId, decision: decision});\n  \
    \  document.getElementById('all-decisions').value = JSON.stringify(existingDecisions);\n\
    \    document.getElementById('current-decision').value = decision;\n    document.getElementById('action-value').value\
    \ = isLast ? 'finish' : 'next';\n  }\n  \n  document.addEventListener('keydown',\
    \ function(e) {\n    if (e.key.toLowerCase() === 'a') {\n      submitDecision('approve');\n\
    \      document.getElementById('review-form').requestSubmit();\n    } else if\
    \ (e.key.toLowerCase() === 'r') {\n      submitDecision('reject');\n      document.getElementById('review-form').requestSubmit();\n\
    \    }\n  });\n</script>"
  handoffs:
  - review_item
  - summary
- name: summary
  context:
    from:
    - generate_data
  hitl: "{% set decisions = state.all_decisions | default('[]') %}\n{% set total =\
    \ outputs.generate_data | length %}\n\n<div style=\"background:#000;color:#e2e8f0;font-family:'Inter',system-ui,sans-serif;padding:16px;min-height:100vh;\"\
    >\n  <div style=\"text-align:center;margin-bottom:24px;\">\n    <div style=\"\
    font-size:32px;margin-bottom:8px;\">\U0001F389</div>\n    <h1 style=\"margin:0;font-size:22px;color:#fff;font-weight:600;\"\
    >Review Complete</h1>\n    <p style=\"margin:8px 0 0 0;font-size:13px;color:#64748b;\"\
    >All {{ total }} items have been processed</p>\n  </div>\n\n  <div style=\"display:grid;grid-template-columns:1fr\
    \ 1fr;gap:16px;margin-bottom:24px;\">\n    <div style=\"background:#0a0a0a;border:1px\
    \ solid #166534;border-radius:6px;padding:20px;text-align:center;\">\n      <div\
    \ style=\"font-size:11px;color:#22c55e;text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;\"\
    >Approved</div>\n      <div id=\"approved-count\" style=\"font-size:36px;font-weight:700;color:#22c55e;\"\
    >-</div>\n    </div>\n    <div style=\"background:#0a0a0a;border:1px solid #991b1b;border-radius:6px;padding:20px;text-align:center;\"\
    >\n      <div style=\"font-size:11px;color:#ef4444;text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;\"\
    >Rejected</div>\n      <div id=\"rejected-count\" style=\"font-size:36px;font-weight:700;color:#ef4444;\"\
    >-</div>\n    </div>\n  </div>\n\n  <div style=\"background:#0a0a0a;border:1px\
    \ solid #333;border-radius:6px;padding:16px;margin-bottom:24px;\">\n    <h3 style=\"\
    margin:0 0 12px 0;font-size:13px;color:#94a3b8;text-transform:uppercase;letter-spacing:1px;\"\
    >Distribution</h3>\n    <div id=\"chart\" style=\"height:280px;\"></div>\n  </div>\n\
    \n  <div style=\"background:#0a0a0a;border:1px solid #333;border-radius:6px;overflow:hidden;\"\
    >\n    <div style=\"padding:12px 16px;border-bottom:1px solid #222;background:#111;\"\
    >\n      <h3 style=\"margin:0;font-size:13px;color:#94a3b8;text-transform:uppercase;letter-spacing:1px;\"\
    >Decision Log</h3>\n    </div>\n    <div id=\"decision-log\" style=\"max-height:200px;overflow-y:auto;\"\
    ></div>\n  </div>\n\n  <form hx-post=\"/api/checkpoints/{{ checkpoint_id }}/respond\"\
    \ hx-ext=\"json-enc\" hx-swap=\"outerHTML\" style=\"margin-top:20px;text-align:center;\"\
    >\n    <button type=\"submit\" name=\"response[action]\" value=\"done\" style=\"\
    background:linear-gradient(135deg,#a78bfa 0%,#8b5cf6 100%);color:#fff;border:none;padding:12px\
    \ 32px;border-radius:4px;font-weight:600;cursor:pointer;font-size:14px;\">✓ Complete\
    \ Session</button>\n  </form>\n</div>\n\n<script>\n  const allItems = {{ outputs.generate_data\
    \ | tojson }};\n  const decisionsRaw = '{{ decisions | safe }}';\n  let decisions\
    \ = [];\n  try { decisions = JSON.parse(decisionsRaw); } catch(e) { decisions\
    \ = []; }\n  \n  const approved = decisions.filter(d => d.decision === 'approve').length;\n\
    \  const rejected = decisions.filter(d => d.decision === 'reject').length;\n \
    \ \n  document.getElementById('approved-count').textContent = approved;\n  document.getElementById('rejected-count').textContent\
    \ = rejected;\n  \n  // Plotly donut chart\n  Plotly.newPlot('chart', [{\n   \
    \ values: [approved, rejected],\n    labels: ['Approved', 'Rejected'],\n    type:\
    \ 'pie',\n    hole: 0.5,\n    marker: {\n      colors: ['#22c55e', '#ef4444']\n\
    \    },\n    textinfo: 'label+percent',\n    textfont: { color: '#fff', size:\
    \ 12 },\n    hoverinfo: 'label+value'\n  }], {\n    paper_bgcolor: 'transparent',\n\
    \    plot_bgcolor: '#000',\n    font: { color: '#cbd5e1', family: 'Inter, sans-serif',\
    \ size: 11 },\n    margin: { t: 10, r: 10, b: 10, l: 10 },\n    showlegend: false\n\
    \  }, { responsive: true, displayModeBar: false });\n  \n  // Decision log\n \
    \ const logHtml = decisions.map(d => {\n    const item = allItems.find(i => i.id\
    \ === d.id) || { title: 'Unknown', id: d.id };\n    const icon = d.decision ===\
    \ 'approve' ? '✓' : '✗';\n    const color = d.decision === 'approve' ? '#22c55e'\
    \ : '#ef4444';\n    return `<div style=\"padding:8px 16px;border-bottom:1px solid\
    \ #222;display:flex;justify-content:space-between;align-items:center;\">\n   \
    \   <span style=\"font-size:12px;color:#94a3b8;\">#${item.id} ${item.title}</span>\n\
    \      <span style=\"color:${color};font-weight:600;font-size:11px;\">${icon}\
    \ ${d.decision.toUpperCase()}</span>\n    </div>`;\n  }).join('');\n  document.getElementById('decision-log').innerHTML\
    \ = logHtml || '<div style=\"padding:16px;color:#64748b;text-align:center;\">No\
    \ decisions recorded</div>';\n</script>"
  handoffs: []
_calliope_metadata:
  created_at: '2025-12-29T23:05:14.671238'
  version: 1
  finalized_at: '2025-12-29T23:07:20.698474'
  status: ready
