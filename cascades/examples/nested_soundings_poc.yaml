cascade_id: nested_takes_poc
description: 'Proof of concept for nested takes - cascade-level takes containing

  phase-level takes with multi-model parallel execution and iterative reforge.


  Tests: Can we get better outputs by running the entire "parallel plans + evaluate"

  process twice, then picking the meta-winner?

  '
inputs_schema:
  challenge: The design/architecture challenge to solve
  constraints: Any constraints or requirements (optional)
takes:
  factor: 2
  mutate: true
  mutation_mode: approach
  evaluator_instructions: "You are the SECOND-TIER evaluator - the \"evaluator of\
    \ evaluators\".\n\nYou're seeing the winning solutions from TWO completely independent\n\
    planning runs, each of which already went through:\n- 10 parallel model attempts\n\
    - 3 rounds of iterative refinement\n- Internal evaluation and selection\n\nYour\
    \ job is to pick the ULTIMATE winner.\n\n## Evaluation Criteria\n\n1. **Solution\
    \ Quality** (40%)\n   - Correctness and feasibility\n   - Handles edge cases\n\
    \   - Follows best practices\n\n2. **Depth of Thought** (30%)\n   - Shows evidence\
    \ of iteration and refinement\n   - Addresses trade-offs explicitly\n   - Anticipates\
    \ implementation challenges\n\n3. **Clarity & Actionability** (30%)\n   - Could\
    \ someone implement this today?\n   - Clear structure and organization\n   - Concrete\
    \ next steps\n\n## Your Decision\n\nPick the winner OR if both are roughly equal\
    \ but have complementary\nstrengths, you may synthesize them into a merged superior\
    \ solution.\n\nFormat your response as:\n```\nWINNER: [0 or 1 or \"MERGED\"]\n\
    \nREASONING: [Your detailed reasoning]\n\n[If MERGED, provide the synthesized\
    \ solution]\n```\n"
cells:
- name: ideate_plans
  instructions: '## Design Challenge


    {{ input.challenge }}


    {% if input.constraints %}

    ## Constraints

    {{ input.constraints }}

    {% endif %}


    ---


    You are a senior architect tasked with creating a comprehensive plan

    to address this challenge. Your plan should be:


    1. **Concrete** - Specific enough to implement

    2. **Structured** - Clear phases or components

    3. **Justified** - Explain why each decision

    4. **Risk-aware** - Note potential issues and mitigations


    {% if is_take %}

    This is take {{ take_index }} of {{ take_factor }}.

    Be creative and explore a UNIQUE approach - don''t play it safe.

    {% endif %}


    ## Output Format


    ### Executive Summary

    [2-3 sentences on the core approach]


    ### Architecture Overview

    [High-level structure with components]


    ### Implementation Plan

    [Phased approach with concrete steps]


    ### Trade-offs & Risks

    [What we''re giving up, what could go wrong]


    ### Success Criteria

    [How we know this worked]

    '
  skills:
  - create_artifact
  takes:
    factor: 6
    models:
    - anthropic/claude-opus-4.5::high
    - openai/gpt-5.2::high
    - x-ai/grok-4::high
    model_strategy: round-robin
    mutate: true
    mutation_mode: approach
    evaluator_instructions: "You are the INNER evaluator - selecting the best plan\
      \ from 10 parallel attempts.\n\n## What You're Evaluating\n\nThese are 10 different\
      \ architectural plans for the same challenge,\ngenerated by different models\
      \ with different approaches.\n\n## Evaluation Criteria\n\n1. **Feasibility**\
      \ (25%) - Can this actually be built?\n2. **Completeness** (25%) - Does it address\
      \ all aspects?\n3. **Innovation** (25%) - Novel approaches or insights?\n4.\
      \ **Clarity** (25%) - Well-structured and understandable?\n\n## Selection Rules\n\
      \n- Pick ONE winner if there's a clear best\n- If top 2-3 are very close (within\
      \ ~5% quality), consider:\n  - Do they have complementary strengths?\n  - Could\
      \ merging improve the result?\n\n## Output Format\n\nIf selecting a winner:\n\
      ```\nWINNER: [index]\nCONFIDENCE: [high/medium/low]\nREASONING: [why this one\
      \ won]\n```\n\nIf merging (only for low confidence + complementary strengths):\n\
      ```\nWINNER: MERGED\nCONFIDENCE: low\nSOURCES: [indices of plans being merged]\n\
      MERGED_PLAN: [your synthesized superior plan]\n```\n"
    reforge:
      model: anthropic/claude-sonnet-4.5
      steps: 3
      factor_per_step: 2
      mutate: false
      honing_prompt: 'You are REFINING a plan that was selected as the best from 10
        alternatives.


        ## Your Mission


        Take this winning plan and make it BETTER. This is iteration {{ state._reforge_step
        | default(1) }} of 3.


        ## Refinement Focus Areas


        **Iteration 1:** Add concrete implementation details

        - Specific technologies, libraries, patterns

        - Code structure or pseudocode where helpful

        - Database schemas, API contracts, etc.


        **Iteration 2:** Harden against edge cases

        - Error handling strategies

        - Performance considerations

        - Security implications

        - Scalability concerns


        **Iteration 3:** Polish for actionability

        - Clear task breakdown

        - Dependency ordering

        - Time/effort rough estimates

        - Definition of done for each component


        ## Rules


        - Keep all the good parts of the original

        - ADD depth, don''t restructure unless necessary

        - Be specific - vague refinement is not refinement

        - If you find a flaw, fix it and note you fixed it

        '
      evaluator_override: 'Compare the refined versions. Pick the one that:

        1. Added the most useful concrete detail

        2. Maintained clarity despite added complexity

        3. Addressed the refinement focus areas effectively


        Brief reasoning, then pick a winner.

        '
  rules:
    max_turns: 1
- name: final_polish
  model: anthropic/claude-sonnet-4.5
  instructions: "## The Winning Plan\n\n{{ outputs.ideate_plans }}\n\n---\n\nYou are\
    \ doing a final polish pass on the winning plan.\n\nYour ONLY jobs:\n1. Fix any\
    \ formatting issues\n2. Ensure consistent terminology\n3. Add a \"Quick Start\"\
    \ section at the end with the first 3 things to do\n\nDo NOT change the substance.\
    \ This is cosmetic only.\n\nCreate the plan as an artifact when done please! \n\
    And when you make the artifact please make sure you tag it as the winner and perhaps\
    \ indicate that in the title briefly.\n"
  skills:
  - create_artifact
  context:
    from:
    - previous
  rules:
    max_turns: 1
