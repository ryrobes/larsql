cascade_id: semantic_aligns
internal: true
description: 'Narrative alignment scoring - returns 0.0-1.0 for how well text aligns
  with a narrative.

  Goes beyond simple topic matching to evaluate consistency, support, and thematic
  fit.

  '
inputs_schema:
  text: The text to evaluate
  narrative: The narrative/thesis to check alignment against
sql_function:
  name: semantic_aligns
  description: Returns 0.0-1.0 score for narrative alignment
  args:
  - name: text
    type: VARCHAR
  - name: narrative
    type: VARCHAR
  returns: DOUBLE
  shape: SCALAR
  operators:
  - '{{ text }} ALIGNS {{ narrative }}'
  - '{{ text }} ALIGNS WITH {{ narrative }}'
  cache: false
  test_cases:
  - sql: WITH t AS (SELECT 'We prioritize safety above all' AS msg) SELECT * FROM t WHERE msg ALIGNS WITH 'safety first'
    expect:
      type: contains
      value: safety
    description: ALIGNS WITH operator detects narrative alignment
cells:
- name: evaluate_alignment
  model: google/gemini-3-flash-preview
  instructions: "Rate how well this text aligns with the given narrative.\n\nTEXT:\n\
    {{ input.text }}\n\nNARRATIVE:\n{{ input.narrative }}\n\nConsider multiple dimensions:\n\
    - **Thematic alignment**: Does the text support the narrative's core themes?\n\
    - **Evidence quality**: Does it provide evidence for or against?\n- **Consistency**:\
    \ Does it contradict the narrative or support it?\n- **Relevance**: Is it about\
    \ the same domain/topic?\n\nScoring guide:\n- 0.0-0.2: Actively contradicts or\
    \ undermines the narrative\n- 0.2-0.4: Unrelated or weakly against\n- 0.4-0.6:\
    \ Neutral or mixed signals\n- 0.6-0.8: Supports the narrative, aligned messaging\n\
    - 0.8-1.0: Strongly validates the narrative, perfect alignment\n\nExamples:\n\
    - Narrative: \"SQL is becoming important for AI workflows\"\n  Text: \"We're using\
    \ SQL to query our LLM results\" → 0.85\n  Text: \"SQL is outdated for modern\
    \ applications\" → 0.1\n  Text: \"Python is great for data science\" → 0.3 (unrelated)\n\
    \n- Narrative: \"AI tools should be accessible to non-developers\"\n  Text: \"\
    Natural language interfaces democratize AI\" → 0.9\n  Text: \"You need a PhD to\
    \ use these tools\" → 0.05\n\nCRITICAL: Return ONLY a decimal number between 0.0\
    \ and 1.0.\nDo NOT include any explanation, reasoning, or other text.\nDo NOT\
    \ wrap in quotes or code blocks.\nJust the number: 0.85\n\nVERIFY THAT THE OUTPUT\
    \ IS ONLY A NUMBER!\n"
  rules:
    max_turns: 2
  output_schema:
    type: number
    minimum: 0.0
    maximum: 1.0
