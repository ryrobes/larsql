cascade_id: intent_dimension
internal: true
description: 'Communicative intent classifier for social media posts. Identifies what

  the author is trying to accomplish with their post.


  Default intents: Question, Statement, Opinion, Complaint, Praise,

  Announcement, Joke/Humor, Promotion, Request, Warning


  This is a DIMENSION-shaped function for use in GROUP BY clauses.

  '
inputs_schema:
  texts: JSON array of all text values to analyze
  intents: Optional comma-separated list of intent categories (uses defaults if not
    provided)
sql_function:
  name: intent
  description: 'Classify the communicative intent of text. What is the author trying
    to do?

    Optionally specify custom intent categories.

    '
  shape: DIMENSION
  mode: mapping
  args:
  - name: text
    type: VARCHAR
    role: dimension_source
  - name: intents
    type: VARCHAR
    default: null
    description: Optional comma-separated intent categories
  returns: VARCHAR
  cache: true
  test_cases:
  - sql: SELECT intent('How do I fix this error?')
    expect:
      type: regex
      pattern: .+
    description: Intent detected
cells:
- name: classify_intent
  model: google/gemini-2.5-flash-lite
  instructions: "Classify the communicative INTENT of these {{ input.texts | length\
    \ }} social media posts.\nWhat is each author trying to accomplish?\n\n{% if input.intents\
    \ %}\nUSE THESE INTENT CATEGORIES:\n{% for intent in input.intents.split(',')\
    \ %}\n- {{ intent | trim }}\n{% endfor %}\n{% else %}\nUSE THESE INTENT CATEGORIES:\n\
    - Question (asking for information or opinions)\n- Statement (sharing facts or\
    \ information)\n- Opinion (expressing a personal view or belief)\n- Complaint\
    \ (expressing dissatisfaction)\n- Praise (expressing appreciation or admiration)\n\
    - Announcement (declaring news or updates)\n- Humor (jokes, sarcasm, memes)\n\
    - Promotion (marketing, self-promotion, selling)\n- Request (asking for help or\
    \ action)\n- Engagement Bait (asking for likes/shares/follows)\n- Rant (venting\
    \ frustration at length)\n- Commentary (reacting to news/events)\n{% endif %}\n\
    \nPosts to classify (with index numbers):\n{% for v in input.texts %}\n[{{ loop.index0\
    \ }}] \"{{ v[:500] | replace('\"', '\\\\\"') }}\"\n{% endfor %}\n\nReturn a JSON\
    \ object mapping each post's INDEX NUMBER to its primary intent:\n\n{\n  \"mapping\"\
    : {\n    \"0\": \"Intent Category\",\n    \"1\": \"Intent Category\",\n    ...\n\
    \  }\n}\n\nRULES:\n- Use the INDEX NUMBER (0, 1, 2, ...) as keys\n- Assign the\
    \ PRIMARY/dominant intent (posts may have multiple, pick the main one)\n- Use\
    \ exact category names from the list above\n- Return ONLY the JSON object\n"
  rules:
    max_turns: 1
    max_attempts: 3
  output_schema:
    type: object
    properties:
      mapping:
        type: object
    required:
    - mapping
