# ABOUT / SCORE - Semantic relevance score
# Returns a 0.0-1.0 score for how well text matches the criterion
#
# SQL Usage:
#   SELECT * FROM docs WHERE observed ABOUT 'physical evidence found' > 0.6
#   SELECT title, semantic_score(observed, 'visual sighting') as relevance FROM docs
#
# Direct Function:
#   SELECT semantic_score(title, 'interesting discovery') FROM docs

cascade_id: semantic_score
internal: true 

description: |
  Semantic relevance scoring - returns 0.0-1.0 for how well text matches a criterion.
  Used for threshold-based filtering and relevance ranking.

inputs_schema:
  text: The text to evaluate
  criterion: The semantic criterion to score against

sql_function:
  name: semantic_score
  description: Returns 0.0-1.0 relevance score for text vs criterion
  args:
    - name: text
      type: VARCHAR
    - name: criterion
      type: VARCHAR
  returns: DOUBLE
  shape: SCALAR
  operators:
    - "{{ text }} ABOUT {{ criterion }}"
    - "{{ text }} RELEVANCE TO {{ criterion }}"
  cache: true

cells:
  - name: score
    model: google/gemini-2.5-flash-lite
    instructions: |
      Rate how well this text matches the semantic criterion on a scale from 0.0 to 1.0.

      TEXT: {{ input.text }}

      CRITERION: {{ input.criterion }}

      Scoring guide:
      - 0.0-0.2: No relation or contradicts the criterion
      - 0.2-0.4: Weak/tangential connection
      - 0.4-0.6: Moderate relevance, partial match
      - 0.6-0.8: Strong relevance, good match
      - 0.8-1.0: Excellent match, directly addresses criterion

      Respond with ONLY a decimal number between 0.0 and 1.0.
      No explanation, no other text.
    rules:
      max_turns: 1

    # output_schema:
    #   type: number
    #   minimum: 0.0
    #   maximum: 1.0
