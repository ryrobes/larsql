# SUMMARIZE_URLS - Extract and summarize URLs from text
# Detects URLs in text, fetches content via curl_text, and returns summary

cascade_id: semantic_summarize_urls

description: |
  Extracts URLs from text, fetches web content, and returns concise summary.
  Uses curl_text tool for reliable fetching with HTML text extraction.

inputs_schema:
  text: Text that may contain URLs

sql_function:
  name: semantic_summarize_urls
  description: Extracts URLs from text, fetches content, and returns summary
  args:
    - name: text
      type: VARCHAR
  returns: VARCHAR
  shape: SCALAR
  operators:
    - "SUMMARIZE_URLS({{ text }})"
    - "URL_SUMMARY({{ text }})"
  cache: true

cells:
  - name: process
    #model: google/gemini-2.5-flash-lite
    traits: [curl_text]

    instructions: |
      Extract any URL from the text, fetch it, and summarize.

      TEXT:
      {{ input.text }}

      STEPS:
      1. Check if text contains a URL (http://, https://, t.co)
      2. If NO URL: return empty string ""
      3. If URL found:
         - Extract the URL
         - Call curl_text("<url>") to fetch content
         - If curl_text returns ERROR: return empty string ""
         - Otherwise: summarize the fetched content in 2-3 sentences
         - Return ONLY the summary (no preamble)

      Be concise. Return just the summary or empty string.

    rules:
      max_turns: 2
