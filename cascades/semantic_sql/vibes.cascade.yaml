cascade_id: semantic_vibes
internal: true
description: 'Vibe extraction - extracts the overall vibes, moods, and energy from a text collection.

  Returns a simple JSON array of vibe descriptors capturing the feel and atmosphere.

  '
inputs_schema:
  texts: JSON array of texts to analyze
  num_vibes: Number of vibes to extract (default 5)
sql_function:
  name: semantic_vibes
  description: Extracts the vibes, moods, and energy from texts, returns JSON array of vibe descriptors
  args:
  - name: texts
    type: JSON
  - name: num_vibes
    type: INTEGER
    default: '5'
  returns: JSON
  shape: AGGREGATE
  context_arg: texts
  operators:
  - VIBES({{ texts }})
  - VIBES({{ texts }}, {{ num_vibes }})
  cache: true
  test_cases:
  - sql: |
      WITH test_data AS (
        SELECT * FROM (VALUES
          ('Just got promoted and bought my dream car!'),
          ('Beach vacation was absolutely perfect'),
          ('Celebrating with champagne tonight'),
          ('Life is good, no complaints here'),
          ('Everything is coming together beautifully')
        ) AS t(post)
      )
      SELECT VIBES(post, 3) FROM test_data
    expect:
      type: regex
      pattern: '\[.*\]'
    description: Extracts vibes from positive life update posts
cells:
- name: extract_vibes
  model: google/gemini-2.5-flash-lite
  instructions: 'Analyze these texts and identify the {{ input.num_vibes | default(5) }} dominant vibes.

    TEXTS:

    {{ input.texts }}


    Return ONLY a JSON array of vibe descriptors - short phrases that capture the mood, energy, and atmosphere.

    Do not wrap in markdown code fences or add any other formatting.


    Example output format:

    ["chill and relaxed", "chaotic energy", "main character vibes"]


    Rules:

    - Return ONLY the raw JSON array, no markdown formatting

    - Extract exactly {{ input.num_vibes | default(5) }} vibes

    - Vibes should capture mood, energy, tone, and atmosphere

    - Use contemporary, expressive language (vibes, energy, mood, aura, etc.)

    - Be creative and evocative - capture the *feel* not just the topic

    - Vibes can be playful: "unhinged", "chaotic good", "that 3am energy", "cozy autumn vibes"

    - Order vibes by how strongly they come through (strongest first)

    - Each vibe should be 2-5 words max

    '
  rules:
    max_turns: 1
  output_schema:
    type: array
    items:
      type: string
