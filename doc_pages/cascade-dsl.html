<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Cascade DSL Reference - RVBBIT Documentation</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cascadia+Code:ital,wght@0,200..700;1,200..700&family=Google+Sans+Code:ital,wght@0,300..800;1,300..800&family=Quicksand:wght@300..700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/docs.css">
</head>
<body>
  <div class="page">
    <header>
      <div class="container">
        <nav class="nav">
          <a href="index.html" class="brand"><span>RVBBIT</span></a>
          <div class="nav-links">
            <a href="index.html">Docs</a>
            <a href="https://github.com/rvbbit/rvbbit">GitHub</a>
          </div>
        </nav>
      </div>
    </header>

    <div class="container">
      <div class="docs-layout">
        <aside class="sidebar">
          <nav>
            <div class="sidebar-section">
              <h4 class="sidebar-title">Getting Started</h4>
              <ul class="sidebar-links">
                <li><a href="index.html">Overview</a></li>
                <li><a href="core-concepts.html">Core Concepts</a></li>
              </ul>
            </div>
            <div class="sidebar-section">
              <h4 class="sidebar-title">Cascade DSL</h4>
              <ul class="sidebar-links">
                <li><a href="cascade-dsl.html" class="active">DSL Reference</a></li>
                <li><a href="cell-types.html">Cell Types</a></li>
                <li><a href="validation.html">Validation (Wards)</a></li>
                <li><a href="context.html">Context Management</a></li>
              </ul>
            </div>
            <div class="sidebar-section">
              <h4 class="sidebar-title">Features</h4>
              <ul class="sidebar-links">
                <li><a href="semantic-sql.html">Semantic SQL</a></li>
                <li><a href="embedding.html">Vector Search & Embedding</a></li>
                <li><a href="candidates.html">Candidates & Evaluation</a></li>
                <li><a href="tools.html">Tools (Traits)</a></li>
                <li><a href="mcp.html">MCP Integration</a></li>
              </ul>
            </div>
          </nav>
        </aside>

        <main class="docs-content">
          <h1>Cascade DSL Reference</h1>
          <p class="lead">
            Complete reference for RVBBIT's cascade configuration DSL. All fields are derived
            from the actual Pydantic models in <code>cascade.py</code> (1,599 lines).
          </p>

          <div class="toc">
            <div class="toc-title">On This Page</div>
            <ul>
              <li><a href="#top-level">Top-Level Cascade</a></li>
              <li><a href="#cell-config">Cell Configuration</a></li>
              <li><a href="#rules">Rules & Execution</a></li>
              <li><a href="#candidates">Candidates</a></li>
              <li><a href="#wards">Wards (Validation)</a></li>
              <li><a href="#context">Context Management</a></li>
              <li><a href="#advanced">Advanced Features</a></li>
            </ul>
          </div>

          <h2 id="top-level">Top-Level Cascade Configuration</h2>

          <div class="code-block">
            <div class="code-block-header"><span class="code-block-lang">YAML Structure</span></div>
            <div class="code-block-content">
              <pre><span class="key">cascade_id</span>: <span class="str">unique_workflow_name</span>  <span class="cmt"># Required</span>
<span class="key">description</span>: <span class="str">Human-readable description</span>

<span class="key">inputs_schema</span>:
  param_name: <span class="str">"Description"</span>

<span class="key">cells</span>:
  - <span class="key">name</span>: cell_name
    <span class="cmt"># ... cell configuration ...</span>

<span class="key">research_db</span>: <span class="str">db_name</span>  <span class="cmt"># Optional: persistent DuckDB</span>

<span class="key">triggers</span>:  <span class="cmt"># Optional: scheduling</span>
  - <span class="key">name</span>: daily
    <span class="key">type</span>: cron
    <span class="key">schedule</span>: <span class="str">"0 6 * * *"</span>

<span class="key">narrator</span>:  <span class="cmt"># Optional: voice narration</span>
  <span class="key">enabled</span>: <span class="kw">true</span>
  <span class="key">mode</span>: poll

<span class="key">auto_context</span>:  <span class="cmt"># Optional: context management</span>
  <span class="key">intra_cell</span>:
    <span class="key">enabled</span>: <span class="kw">true</span>
  <span class="key">inter_cell</span>:
    <span class="key">enabled</span>: <span class="kw">true</span></pre>
            </div>
          </div>

          <h3>Top-Level Fields</h3>
          <table>
            <thead>
              <tr><th>Field</th><th>Type</th><th>Description</th></tr>
            </thead>
            <tbody>
              <tr><td><code>cascade_id</code></td><td>string</td><td>Unique identifier (required)</td></tr>
              <tr><td><code>description</code></td><td>string</td><td>Optional description</td></tr>
              <tr><td><code>inputs_schema</code></td><td>object</td><td>Input parameters with descriptions</td></tr>
              <tr><td><code>cells</code></td><td>array</td><td>List of cell configurations (required)</td></tr>
              <tr><td><code>research_db</code></td><td>string</td><td>Persistent DuckDB database name</td></tr>
              <tr><td><code>triggers</code></td><td>array</td><td>Cron/sensor/webhook triggers</td></tr>
              <tr><td><code>narrator</code></td><td>object</td><td>Voice narration configuration</td></tr>
              <tr><td><code>auto_context</code></td><td>object</td><td>Automatic context management</td></tr>
            </tbody>
          </table>

          <h2 id="cell-config">Cell Configuration</h2>
          <p>
            Cells are the atomic execution units. Every cell must have <strong>exactly one</strong>
            primary execution type: <code>instructions</code> (LLM), <code>tool</code> (deterministic),
            <code>htmx</code> (screen), or <code>for_each_row</code> (SQL mapping).
          </p>

          <h3>Common Fields (All Cell Types)</h3>
          <table>
            <thead>
              <tr><th>Field</th><th>Type</th><th>Description</th></tr>
            </thead>
            <tbody>
              <tr><td><code>name</code></td><td>string</td><td>Cell identifier (required)</td></tr>
              <tr><td><code>handoffs</code></td><td>array</td><td>Valid next-cell targets</td></tr>
              <tr><td><code>context</code></td><td>object</td><td>Context configuration</td></tr>
              <tr><td><code>wards</code></td><td>object</td><td>Validation configuration</td></tr>
              <tr><td><code>narrator</code></td><td>bool/object</td><td>Voice narration override</td></tr>
              <tr><td><code>callouts</code></td><td>string/object</td><td>Message tagging</td></tr>
            </tbody>
          </table>

          <h3>LLM Cell Fields</h3>
          <div class="code-block">
            <div class="code-block-header"><span class="code-block-lang">LLM Cell Example</span></div>
            <div class="code-block-content">
              <pre>- <span class="key">name</span>: research
  <span class="key">instructions</span>: <span class="str">"Research {{ input.topic }}"</span>
  <span class="key">traits</span>: [brave_web_search]  <span class="cmt"># or "manifest"</span>
  <span class="key">model</span>: <span class="str">anthropic/claude-sonnet-4</span>
  <span class="key">rules</span>:
    <span class="key">max_turns</span>: <span class="num">10</span>
    <span class="key">max_attempts</span>: <span class="num">2</span>
  <span class="key">candidates</span>:
    <span class="key">factor</span>: <span class="num">5</span>
  <span class="key">output_schema</span>:
    <span class="key">type</span>: object</pre>
            </div>
          </div>

          <table>
            <thead>
              <tr><th>Field</th><th>Type</th><th>Default</th><th>Description</th></tr>
            </thead>
            <tbody>
              <tr><td><code>instructions</code></td><td>string</td><td>-</td><td>Jinja2 system prompt (required)</td></tr>
              <tr><td><code>traits</code></td><td>array/"manifest"</td><td>[]</td><td>Tool names or auto-select</td></tr>
              <tr><td><code>model</code></td><td>string</td><td>default</td><td>Model override</td></tr>
              <tr><td><code>use_native_tools</code></td><td>bool</td><td>false</td><td>Use provider native tools</td></tr>
              <tr><td><code>rules</code></td><td>object</td><td>{}</td><td>Execution rules</td></tr>
              <tr><td><code>candidates</code></td><td>object</td><td>null</td><td>Parallel attempts config</td></tr>
              <tr><td><code>output_schema</code></td><td>object</td><td>null</td><td>JSON Schema validation</td></tr>
              <tr><td><code>rag</code></td><td>object</td><td>null</td><td>RAG configuration</td></tr>
              <tr><td><code>use_training</code></td><td>bool</td><td>false</td><td>Inject training examples</td></tr>
            </tbody>
          </table>

          <h3>Deterministic Cell Fields</h3>
          <div class="code-block">
            <div class="code-block-header"><span class="code-block-lang">Deterministic Cell Example</span></div>
            <div class="code-block-content">
              <pre>- <span class="key">name</span>: load_data
  <span class="key">tool</span>: sql_data
  <span class="key">tool_inputs</span>:
    <span class="key">query</span>: <span class="str">"SELECT * FROM {{ input.table }}"</span>
  <span class="key">timeout</span>: <span class="str">5m</span>
  <span class="key">retry</span>:
    <span class="key">max_attempts</span>: <span class="num">3</span>
  <span class="key">on_error</span>: auto_fix
  <span class="key">routing</span>:
    <span class="key">success</span>: process
    <span class="key">error</span>: handle_error</pre>
            </div>
          </div>

          <table>
            <thead>
              <tr><th>Field</th><th>Type</th><th>Description</th></tr>
            </thead>
            <tbody>
              <tr><td><code>tool</code></td><td>string</td><td>Tool spec (required): "name", "python:mod.func", "sql:file.sql"</td></tr>
              <tr><td><code>tool_inputs</code></td><td>object</td><td>Jinja2-templated inputs</td></tr>
              <tr><td><code>routing</code></td><td>object</td><td>Route based on result._route</td></tr>
              <tr><td><code>on_error</code></td><td>string/object</td><td>"auto_fix", cell name, or config</td></tr>
              <tr><td><code>retry</code></td><td>object</td><td>Retry configuration</td></tr>
              <tr><td><code>timeout</code></td><td>string</td><td>e.g., "30s", "5m", "1h"</td></tr>
            </tbody>
          </table>

          <h3>HITL Screen Cell Fields</h3>
          <div class="code-block">
            <div class="code-block-header"><span class="code-block-lang">HITL Screen Example</span></div>
            <div class="code-block-content">
              <pre>- <span class="key">name</span>: review
  <span class="key">htmx</span>: <span class="str">|
    &lt;h2&gt;Review Report&lt;/h2&gt;
    &lt;div&gt;{{ outputs.generate.content }}&lt;/div&gt;
    &lt;form hx-post="/api/checkpoints/{{ checkpoint_id }}/respond"&gt;
      &lt;button name="response[action]" value="approve"&gt;Approve&lt;/button&gt;
    &lt;/form&gt;
  </span>
  <span class="key">htmx_title</span>: <span class="str">Review Screen</span>
  <span class="key">await_input</span>: <span class="kw">true</span></pre>
            </div>
          </div>

          <table>
            <thead>
              <tr><th>Field</th><th>Type</th><th>Description</th></tr>
            </thead>
            <tbody>
              <tr><td><code>htmx</code></td><td>string</td><td>HTML/HTMX template (Jinja2)</td></tr>
              <tr><td><code>htmx_title</code></td><td>string</td><td>Screen title</td></tr>
              <tr><td><code>htmx_description</code></td><td>string</td><td>Screen description</td></tr>
              <tr><td><code>await_input</code></td><td>bool</td><td>Wait for user response</td></tr>
            </tbody>
          </table>

          <h2 id="rules">Rules Configuration</h2>
          <p>Controls cell execution behavior, retries, and validation loops.</p>

          <div class="code-block">
            <div class="code-block-header"><span class="code-block-lang">RuleConfig Fields</span></div>
            <div class="code-block-content">
              <pre><span class="key">rules</span>:
  <span class="key">max_turns</span>: <span class="num">10</span>                    <span class="cmt"># Max conversation turns</span>
  <span class="key">max_attempts</span>: <span class="num">2</span>                 <span class="cmt"># Max retry attempts</span>
  <span class="key">loop_until</span>:                   <span class="cmt"># Validator for early exit</span>
    <span class="key">python</span>: <span class="str">"result = {...}"</span>
  <span class="key">loop_until_prompt</span>: <span class="str">"Goal"</span>   <span class="cmt"># Injected validation goal</span>
  <span class="key">loop_until_silent</span>: <span class="kw">false</span>     <span class="cmt"># Skip auto-injection</span>
  <span class="key">turn_prompt</span>: <span class="str">"Continue..."</span>    <span class="cmt"># Turn 1+ prompt</span>
  <span class="key">retry_instructions</span>: <span class="str">"Fix..."</span> <span class="cmt"># Retry prompt</span></pre>
            </div>
          </div>

          <h2 id="candidates">Candidates Configuration</h2>
          <p>Run multiple parallel attempts and select the best.</p>

          <div class="code-block">
            <div class="code-block-header"><span class="code-block-lang">CandidatesConfig Fields</span></div>
            <div class="code-block-content">
              <pre><span class="key">candidates</span>:
  <span class="key">factor</span>: <span class="num">5</span>                        <span class="cmt"># Number of candidates (or Jinja2)</span>
  <span class="key">max_parallel</span>: <span class="num">3</span>                <span class="cmt"># Concurrent executions</span>
  <span class="key">evaluator_instructions</span>: <span class="str">"..."</span> <span class="cmt"># LLM evaluator prompt</span>
  
  <span class="key">mutate</span>: <span class="kw">true</span>                     <span class="cmt"># Apply mutations</span>
  <span class="key">mutation_mode</span>: rewrite          <span class="cmt"># rewrite|augment|approach</span>
  
  <span class="key">mode</span>: evaluate                  <span class="cmt"># evaluate|aggregate</span>
  <span class="key">aggregator_instructions</span>: <span class="str">"..."</span> <span class="cmt"># For aggregate mode</span>
  
  <span class="key">validator</span>: <span class="str">"name"</span>              <span class="cmt"># Pre-eval filter</span>
  
  <span class="key">models</span>:                         <span class="cmt"># Multi-model</span>
    - anthropic/claude-sonnet-4
    - x-ai/grok-4.1-fast
  <span class="key">model_strategy</span>: round_robin
  
  <span class="key">cost_aware_evaluation</span>:
    <span class="key">enabled</span>: <span class="kw">true</span>
    <span class="key">quality_weight</span>: <span class="num">0.7</span>
  
  <span class="key">pareto_frontier</span>:
    <span class="key">enabled</span>: <span class="kw">true</span>
    <span class="key">policy</span>: balanced
  
  <span class="key">evaluator</span>: human               <span class="cmt"># human|hybrid</span>
  <span class="key">human_eval</span>:
    <span class="key">presentation</span>: side_by_side
  
  <span class="key">reforge</span>:                        <span class="cmt"># Iterative refinement</span>
    <span class="key">steps</span>: <span class="num">2</span>
    <span class="key">honing_prompt</span>: <span class="str">"Refine..."</span></pre>
            </div>
          </div>

          <h3>Key Candidate Fields</h3>
          <table>
            <thead>
              <tr><th>Field</th><th>Type</th><th>Default</th><th>Description</th></tr>
            </thead>
            <tbody>
              <tr><td><code>factor</code></td><td>int/string</td><td>1</td><td>Number of candidates (supports Jinja2)</td></tr>
              <tr><td><code>max_parallel</code></td><td>int</td><td>3</td><td>Max concurrent executions</td></tr>
              <tr><td><code>mutate</code></td><td>bool</td><td>true</td><td>Apply prompt mutations</td></tr>
              <tr><td><code>mutation_mode</code></td><td>enum</td><td>rewrite</td><td>rewrite, augment, approach</td></tr>
              <tr><td><code>mode</code></td><td>enum</td><td>evaluate</td><td>evaluate or aggregate</td></tr>
              <tr><td><code>evaluator</code></td><td>enum</td><td>null</td><td>human, hybrid, or LLM (default)</td></tr>
              <tr><td><code>downstream_model</code></td><td>bool</td><td>false</td><td>Propagate model to tools</td></tr>
            </tbody>
          </table>

          <h2 id="wards">Wards Configuration</h2>
          <p>Validation barriers at three stages: pre, post, and turn.</p>

          <div class="code-block">
            <div class="code-block-header"><span class="code-block-lang">WardsConfig Structure</span></div>
            <div class="code-block-content">
              <pre><span class="key">wards</span>:
  <span class="key">pre</span>:                           <span class="cmt"># Pre-execution</span>
    - <span class="key">validator</span>: <span class="str">"input_check"</span>
      <span class="key">mode</span>: blocking
  
  <span class="key">post</span>:                          <span class="cmt"># Post-execution</span>
    - <span class="key">validator</span>:
        <span class="key">python</span>: <span class="str">"result = {...}"</span>
      <span class="key">mode</span>: retry
      <span class="key">max_attempts</span>: <span class="num">3</span>
  
  <span class="key">turn</span>:                          <span class="cmt"># Per-turn (optional)</span>
    - <span class="key">validator</span>: <span class="str">"quality_check"</span>
      <span class="key">mode</span>: advisory</pre>
            </div>
          </div>

          <h3>Ward Modes</h3>
          <table>
            <thead>
              <tr><th>Mode</th><th>Behavior</th></tr>
            </thead>
            <tbody>
              <tr><td><code>blocking</code></td><td>Abort execution on failure</td></tr>
              <tr><td><code>advisory</code></td><td>Log warning but continue</td></tr>
              <tr><td><code>retry</code></td><td>Retry with error feedback (post only)</td></tr>
            </tbody>
          </table>

          <h2 id="context">Context Management</h2>

          <h3>Simple Context (Explicit)</h3>
          <div class="code-block">
            <div class="code-block-header"><span class="code-block-lang">Explicit Context</span></div>
            <div class="code-block-content">
              <pre><span class="key">context</span>:
  <span class="key">from</span>: [research, data_load]  <span class="cmt"># Include these cells</span>
  <span class="cmt"># or from: ["all"] for full context snowball</span></pre>
            </div>
          </div>

          <h3>Auto Context (Intelligent Selection)</h3>
          <div class="code-block">
            <div class="code-block-header"><span class="code-block-lang">Auto Context</span></div>
            <div class="code-block-content">
              <pre><span class="key">context</span>:
  <span class="key">mode</span>: auto
  <span class="key">selection</span>:
    <span class="key">strategy</span>: hybrid            <span class="cmt"># heuristic|semantic|llm|hybrid</span>
    <span class="key">max_tokens</span>: <span class="num">30000</span>
    <span class="key">recency_weight</span>: <span class="num">0.3</span>
    <span class="key">keyword_weight</span>: <span class="num">0.4</span>
  <span class="key">anchors</span>:
    <span class="key">window</span>: <span class="num">3</span>
    <span class="key">from_cells</span>: [previous]</pre>
            </div>
          </div>

          <h3>Intra-Cell Context (Per-Turn)</h3>
          <div class="code-block">
            <div class="code-block-header"><span class="code-block-lang">Intra-Cell Context</span></div>
            <div class="code-block-content">
              <pre><span class="key">intra_context</span>:
  <span class="key">enabled</span>: <span class="kw">true</span>
  <span class="key">window</span>: <span class="num">5</span>                     <span class="cmt"># Last N turns full fidelity</span>
  <span class="key">mask_observations_after</span>: <span class="num">3</span>  <span class="cmt"># Mask tool results after N</span>
  <span class="key">compress_loops</span>: <span class="kw">true</span>         <span class="cmt"># Compress retry attempts</span>
  <span class="key">preserve_reasoning</span>: <span class="kw">true</span>     <span class="cmt"># Keep thinking</span>
  <span class="key">preserve_errors</span>: <span class="kw">true</span>        <span class="cmt"># Keep errors</span></pre>
            </div>
          </div>

          <h2 id="advanced">Advanced Features</h2>

          <h3>Browser Automation</h3>
          <div class="code-block">
            <div class="code-block-header"><span class="code-block-lang">Browser Config</span></div>
            <div class="code-block-content">
              <pre><span class="key">browser</span>:
  <span class="key">url</span>: <span class="str">"https://example.com"</span>
  <span class="key">stability_detection</span>: <span class="kw">true</span>
  <span class="key">show_overlay</span>: <span class="kw">true</span></pre>
            </div>
          </div>

          <h3>Voice Narrator</h3>
          <div class="code-block">
            <div class="code-block-header"><span class="code-block-lang">Narrator Config</span></div>
            <div class="code-block-content">
              <pre><span class="key">narrator</span>:
  <span class="key">enabled</span>: <span class="kw">true</span>
  <span class="key">mode</span>: poll                     <span class="cmt"># poll or event</span>
  <span class="key">poll_interval_seconds</span>: <span class="num">3.0</span>
  <span class="key">context_turns</span>: <span class="num">5</span>
  <span class="key">instructions</span>: <span class="str">"Brief update..."</span></pre>
            </div>
          </div>

          <h3>Triggers (Scheduling)</h3>
          <div class="code-block">
            <div class="code-block-header"><span class="code-block-lang">Trigger Examples</span></div>
            <div class="code-block-content">
              <pre><span class="key">triggers</span>:
  - <span class="key">name</span>: daily
    <span class="key">type</span>: cron
    <span class="key">schedule</span>: <span class="str">"0 6 * * *"</span>
    <span class="key">timezone</span>: America/New_York
  
  - <span class="key">name</span>: on_data_ready
    <span class="key">type</span>: sensor
    <span class="key">check</span>: <span class="str">"python:sensors.check"</span>
    <span class="key">poll_interval</span>: <span class="str">5m</span>
  
  - <span class="key">name</span>: webhook
    <span class="key">type</span>: webhook
    <span class="key">auth</span>: <span class="str">"hmac:${SECRET}"</span></pre>
            </div>
          </div>

          <h3>RAG (Retrieval Augmented Generation)</h3>
          <div class="code-block">
            <div class="code-block-header"><span class="code-block-lang">RAG Config</span></div>
            <div class="code-block-content">
              <pre><span class="key">rag</span>:
  <span class="key">directory</span>: <span class="str">docs</span>
  <span class="key">recursive</span>: <span class="kw">true</span>
  <span class="key">chunk_chars</span>: <span class="num">1200</span>
  <span class="key">chunk_overlap</span>: <span class="num">200</span>
  <span class="key">model</span>: <span class="str">qwen/qwen3-embedding-8b</span></pre>
            </div>
          </div>

          <h3>SQL Function (Custom Operators)</h3>
          <div class="code-block">
            <div class="code-block-header"><span class="code-block-lang">SQL Function Config</span></div>
            <div class="code-block-content">
              <pre><span class="key">sql_function</span>:
  <span class="key">name</span>: sentiment_score
  <span class="key">operators</span>:
    - <span class="str">"SENTIMENT_SCORE({{ text }})"</span>
  <span class="key">args</span>:
    - <span class="key">name</span>: text
      <span class="key">type</span>: VARCHAR
  <span class="key">returns</span>: FLOAT
  <span class="key">shape</span>: SCALAR</pre>
            </div>
          </div>

          <div class="info-box tip">
            <div class="info-box-title">Complete Reference</div>
            <p>
              This page covers the most commonly used fields. For the complete reference,
              see <code>rvbbit/cascade.py</code> which contains all 1,599 lines of Pydantic models
              with inline documentation.
            </p>
          </div>

          <hr style="margin: 48px 0; border: none; border-top: 1px solid rgba(28, 246, 255, 0.2);">

          <h2>Next Steps</h2>
          <ul>
            <li><a href="cell-types.html">Cell Types</a> - Deep dive into each cell type</li>
            <li><a href="validation.html">Validation</a> - Complete wards reference</li>
            <li><a href="candidates.html">Candidates</a> - Parallel execution guide</li>
            <li><a href="context.html">Context</a> - Context management strategies</li>
          </ul>

        </main>
      </div>
    </div>

    <footer>
      <div class="container">
        <p>RVBBIT &copy; 2026 | <a href="https://github.com/rvbbit/rvbbit">GitHub</a></p>
      </div>
    </footer>
  </div>
</body>
</html>
