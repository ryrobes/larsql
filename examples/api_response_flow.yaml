cascade_id: api_response_flow
description: Generate API response with schema and semantic validation
inputs_schema:
  data: Description of data to return
  endpoint: API endpoint name
cells:
- handoffs:
  - validate_semantics
  instructions: "Generate a REST API response for endpoint: {{ input.endpoint }}\n\
    \nData to include: {{ input.data }}\n\nReturn ONLY valid JSON (no markdown) with\
    \ this structure:\n{\n  \"status\": \"success\" or \"error\",\n  \"code\": 200,\n\
    \  \"message\": \"descriptive message\",\n  \"data\": {},\n  \"timestamp\": \"\
    ISO 8601 timestamp\"\n}"
  name: generate_response
  output_schema:
    properties:
      code:
        maximum: 599
        minimum: 100
        type: integer
      data:
        type: object
      message:
        minLength: 5
        type: string
      status:
        enum:
        - success
        - error
        type: string
      timestamp:
        pattern: ^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}
        type: string
    required:
    - status
    - code
    - message
    - data
    - timestamp
    type: object
  rules:
    max_attempts: 3
    max_turns: 1
    retry_instructions: 'ðŸ”Œ API Response Schema Error:


      {{ schema_error }}


      Required fields:

      - status: "success" or "error"

      - code: integer 100-599

      - message: string (5+ chars)

      - data: object

      - timestamp: ISO 8601 format (YYYY-MM-DDTHH:MM:SS)


      Return ONLY valid JSON. Attempt {{ attempt }}/{{ max_attempts }}'
- context:
    from:
    - previous
  instructions: 'The JSON structure is valid! Now verify the response makes sense:


    Response code: {{ state.validated_output.code }}

    Status: {{ state.validated_output.status }}

    Message: {{ state.validated_output.message }}


    Provide brief confirmation that the API response is semantically correct (e.g.,
    success status matches 2xx code).'
  name: validate_semantics
  traits:
  - set_state
