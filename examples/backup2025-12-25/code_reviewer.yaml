# Code Review Cascade
# Demonstrates how YAML makes markdown-heavy prompts much cleaner

cascade_id: code_reviewer
description: >
  A multi-phase code review cascade that demonstrates the benefits
  of YAML for markdown-heavy prompt definitions.

inputs_schema:
  code: The code to review
  language: The programming language (optional)

phases:
  - name: security_review
    instructions: |
      # Security Review

      You are a security expert reviewing code for vulnerabilities.

      ## Code to Review

      ```{{ input.language | default('') }}
      {{ input.code }}
      ```

      ## Your Task

      Analyze this code for security issues. Look for:

      1. **Injection vulnerabilities**
         - SQL injection
         - Command injection
         - XSS

      2. **Authentication/Authorization issues**
         - Missing auth checks
         - Weak credential handling

      3. **Data exposure**
         - Sensitive data in logs
         - Unencrypted data transmission

      ## Output Format

      For each issue found, provide:
      - **Severity**: Critical / High / Medium / Low
      - **Location**: Line number or code snippet
      - **Description**: What the vulnerability is
      - **Fix**: How to remediate it

      If no issues are found, state that the code passes security review.
    tackle: []
    handoffs:
      - quality_review

  - name: quality_review
    instructions: |
      # Code Quality Review

      You are a senior developer reviewing code quality.

      ## Code to Review

      ```{{ input.language | default('') }}
      {{ input.code }}
      ```

      ## Previous Security Review

      {{ outputs.security_review }}

      ## Your Task

      Review this code for quality issues:

      ### Readability
      - Clear variable/function names
      - Appropriate comments
      - Consistent formatting

      ### Maintainability
      - DRY principles
      - Single responsibility
      - Proper error handling

      ### Performance
      - Obvious inefficiencies
      - N+1 queries
      - Unnecessary allocations

      ## Output Format

      Provide a structured review with:

      1. **Overall Score**: A/B/C/D/F
      2. **Strengths**: What the code does well
      3. **Areas for Improvement**: Specific suggestions
      4. **Refactoring Recommendations**: If any major changes are needed
    tackle: []
    context:
      from:
        - security_review
