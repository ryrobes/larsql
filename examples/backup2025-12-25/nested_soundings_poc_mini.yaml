# Nested Soundings POC (Mini version for quick testing)
#
# Same architecture as the full POC but with smaller factors:
# - 2 cascade-level soundings
# - 3 phase-level soundings (3 models)
# - 2 reforge steps
#
# This demonstrates the "soundings within soundings" pattern quickly.

cascade_id: nested_soundings_poc_mini
description: |
  Mini version of nested soundings POC for quick testing.
  Demonstrates cascade-level soundings containing phase-level soundings
  with multi-model execution and iterative reforge.

inputs_schema:
  challenge: "The design challenge to solve"

# OUTER LEVEL: Run the entire cascade twice
soundings:
  factor: 2
  max_parallel: 2
  mutate: true
  mutation_mode: approach
  evaluator_instructions: |
    You are the SECOND-TIER evaluator.

    You're seeing winning solutions from TWO independent planning runs.
    Each went through 3 model attempts + 2 reforge iterations.

    ## Evaluation Criteria
    - Solution Quality (40%) - Feasibility, correctness
    - Depth of Thought (30%) - Trade-offs, anticipates challenges
    - Clarity (30%) - Actionable, well-structured

    ## Decision
    Pick the winner. Format:
    ```
    WINNER: [0 or 1]
    REASONING: [2-3 sentences]
    ```

    If both are roughly equal with complementary strengths, merge them:
    ```
    WINNER: MERGED
    MERGED_SOLUTION: [synthesized solution]
    ```

phases:
  - name: plan
    instructions: |
      ## Challenge

      {{ input.challenge }}

      ---

      Create a comprehensive plan to address this challenge.

      {% if is_sounding %}
      (Sounding {{ sounding_index }}/{{ sounding_factor }} - explore a unique angle!)
      {% endif %}

      ## Required Sections

      ### Executive Summary
      [2-3 sentences on core approach]

      ### Key Components
      [3-4 main elements of the solution]

      ### Implementation Steps
      [Ordered list of concrete actions]

      ### Risks & Mitigations
      [What could go wrong + how to handle]

    tackle: []

    # INNER LEVEL: 3 parallel plans with different models
    soundings:
      factor: 3
      max_parallel: 3

      models:
        "anthropic/claude-sonnet-4": { factor: 1 }
        "openai/gpt-4.1": { factor: 1 }
        "google/gemini-2.5-flash": { factor: 1 }

      model_strategy: round_robin
      mutate: true
      mutation_mode: approach

      evaluator_instructions: |
        Evaluate these 3 plans. Pick the best based on:
        - Feasibility (can it be done?)
        - Completeness (covers all aspects?)
        - Clarity (well-structured?)

        Output:
        ```
        WINNER: [0, 1, or 2]
        REASONING: [1-2 sentences]
        ```

      # REFORGE: Iterate the winner twice
      reforge:
        steps: 2
        factor_per_step: 2
        mutate: false

        honing_prompt: |
          REFINE this winning plan. Make it:
          - More specific (concrete technologies, patterns)
          - More robust (error handling, edge cases)
          - More actionable (clear next steps)

          Keep all good parts. ADD depth without unnecessary restructuring.

        evaluator_override: |
          Compare refinements. Pick the one with most useful additions
          while maintaining clarity. Brief reasoning + winner number.

    rules:
      max_turns: 1
