cascade_id: signal_etl_hybrid
description: 'Hybrid ETL pipeline combining deterministic phases (fast, predictable,
  no LLM costs) with signals (external coordination) and LLM phases (intelligent summarization).

  '
inputs_schema:
  query: SQL query to validate and execute
cells:
- name: validate_query
  tool: python:windlass.demo_tools.validate_sql
  inputs:
    query: '{{ input.query }}'
  routing:
    valid: wait_for_data
    invalid: handle_invalid_query
  handoffs:
  - wait_for_data
  - handle_invalid_query
- name: handle_invalid_query
  instructions: 'The SQL query validation failed:


    Query: {{ input.query }}

    Error: {{ state.output_validate_query.error }}


    Explain the issue and suggest a corrected query.

    '
  traits: []
- name: wait_for_data
  instructions: 'Use await_signal to wait for signal ''etl_data_ready'' with timeout
    ''60s''.

    Description: ''Waiting for upstream data pipeline to complete''

    '
  traits:
  - await_signal
  handoffs:
  - transform_data
  - handle_timeout
- name: handle_timeout
  instructions: 'The upstream data signal timed out:


    {{ state.output_wait_for_data }}


    Suggest troubleshooting steps for the data pipeline.

    '
  traits: []
- name: transform_data
  tool: python:windlass.demo_tools.transform_data
  inputs:
    data: '[{"id": 1, "value": 100, "category": "A"}, {"id": 2, "value": 250, "category":
      "B"}, {"id": 3, "value": 175, "category": "A"}]'
    operation: sum_numeric
  routing:
    success: summarize_results
    empty: handle_empty_data
    error: handle_transform_error
  handoffs:
  - summarize_results
  - handle_empty_data
  - handle_transform_error
- name: handle_empty_data
  instructions: 'The data transformation returned no results. Log this gracefully.

    '
  traits: []
- name: handle_transform_error
  instructions: 'Transform failed: {{ state.last_deterministic_error }}

    Diagnose and suggest remediation.

    '
  traits: []
- name: summarize_results
  instructions: 'The ETL pipeline completed successfully!


    Original Query: {{ input.query }}

    Validation: {{ state.output_validate_query }}

    Signal Received: {{ state.output_wait_for_data }}

    Transform Results: {{ state.output_transform_data }}


    Provide a business-friendly summary of:

    1. What data was processed

    2. Key aggregations/insights

    3. Any notable patterns

    '
  traits: []
