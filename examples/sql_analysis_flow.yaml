cascade_id: sql_analysis_demo

description: Demonstrates SQL schema discovery and query execution with natural language

inputs_schema:
  question: Natural language question about the data

phases:
  - handoffs:
      - write_query
    instructions: |-
      The user asked: {{ input.question }}

      First, use sql_search to find relevant tables that might contain data to answer this question.

      Search for tables using natural language - the tool will return schema information including:
      - Column names and types
      - Value distributions for categorical columns
      - Sample rows
      - Row counts

      Analyze the results and identify which table(s) would be most useful.
    name: discover_schema
    tackle:
      - sql_search
      - list_sql_connections
  - context:
      from:
        - previous
    handoffs:
      - analyze_results
    instructions: "Based on the schema information from the previous phase, write a SQL query to answer:\
      \ {{ input.question }}\n\nUse the sql_query tool to execute your query.\n\nIMPORTANT Query Syntax:\n\
      - CSV folders: SELECT * FROM connection_name.table_name\n- PostgreSQL/MySQL: SELECT * FROM connection_name.schema.table\n\
      - Example: SELECT * FROM csv_files.bigfoot_sightings WHERE state = 'California'\n\nThe schema info\
      \ from the previous phase shows you:\n- Exact column names\n- Data types\n- Sample values (use these\
      \ to understand the data format)\n- Value distributions (shows you what values exist in categorical\
      \ columns)\n\nWrite a clear, efficient query based on this information."
    name: write_query
    tackle:
      - sql_query
  - context:
      from:
        - all
    instructions: "Analyze the query results from the previous phase and provide a clear answer to: {{\
      \ input.question }}\n\nSummarize:\n- Key findings from the data\n- Any interesting patterns or insights\n\
      - Direct answer to the user's question\n\nBe specific and reference actual numbers from the results."
    name: analyze_results
    tackle: []
