cascade_id: toon_format_demo
description: |
  Demonstrates TOON format usage for token-efficient data handling.

  TOON (Token-Oriented Object Notation) is automatically used for large SQL
  results, achieving 45-60% token savings vs JSON. This demo shows:
  1. Auto-TOON for SQL data (default behavior)
  2. Explicit TOON via Jinja2 filter
  3. Explicit JSON for comparison

inputs_schema:
  row_count: Number of rows to generate (default 100)

cells:
  - name: load_sample_data
    tool: sql_data
    inputs:
      query: "SELECT * FROM generate_series(1, {{ input.row_count | default(100) }}) as id, 'Sample data ' || id::VARCHAR as description"
      format: auto  # Auto-select TOON or JSON (default behavior)

  - name: analyze_with_auto_format
    instructions: |
      Analyze this dataset (automatically formatted as TOON if >5 rows):

      {{ outputs.load_sample_data.rows }}

      Provide:
      1. Row count
      2. Data format you received (TOON or JSON?)
      3. Your assessment of readability

    rules:
      max_turns: 1

  - name: analyze_with_explicit_toon
    instructions: |
      Analyze this dataset (explicitly formatted as TOON):

      {{ outputs.load_sample_data.rows | totoon }}

      Provide:
      1. Can you parse the TOON table format?
      2. How does it compare to JSON?

    rules:
      max_turns: 1

  - name: analyze_with_explicit_json
    instructions: |
      Analyze this dataset (explicitly formatted as JSON):

      {{ outputs.load_sample_data.rows | tojson }}

      Provide:
      1. Can you parse the JSON?
      2. Compare verbosity to previous formats

    rules:
      max_turns: 1

  - name: summary
    instructions: |
      Based on the previous analyses, summarize the key differences between
      TOON and JSON formats for LLM context:

      - Token efficiency
      - Readability
      - Structure clarity

      Previous cells' outputs:
      Auto-format: {{ outputs.analyze_with_auto_format }}
      TOON: {{ outputs.analyze_with_explicit_toon }}
      JSON: {{ outputs.analyze_with_explicit_json }}

    rules:
      max_turns: 1
