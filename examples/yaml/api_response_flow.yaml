cascade_id: api_response_flow

description: Generate API response with schema and semantic validation

inputs_schema:
  data: Description of data to return
  endpoint: API endpoint name

phases:
  - handoffs:
      - validate_semantics
    instructions: |-
      Generate a REST API response for endpoint: {{ input.endpoint }}

      Data to include: {{ input.data }}

      Return ONLY valid JSON (no markdown) with this structure:
      {
        "status": "success" or "error",
        "code": 200,
        "message": "descriptive message",
        "data": {},
        "timestamp": "ISO 8601 timestamp"
      }
    name: generate_response
    output_schema:
      properties:
        code:
          maximum: 599
          minimum: 100
          type: integer
        data:
          type: object
        message:
          minLength: 5
          type: string
        status:
          enum:
            - success
            - error
          type: string
        timestamp:
          pattern: ^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}
          type: string
      required:
        - status
        - code
        - message
        - data
        - timestamp
      type: object
    rules:
      max_attempts: 3
      max_turns: 1
      retry_instructions: |-
        ðŸ”Œ API Response Schema Error:

        {{ schema_error }}

        Required fields:
        - status: "success" or "error"
        - code: integer 100-599
        - message: string (5+ chars)
        - data: object
        - timestamp: ISO 8601 format (YYYY-MM-DDTHH:MM:SS)

        Return ONLY valid JSON. Attempt {{ attempt }}/{{ max_attempts }}
  - context:
      from:
        - previous
    instructions: "The JSON structure is valid! Now verify the response makes sense:\n\nResponse code:\
      \ {{ state.validated_output.code }}\nStatus: {{ state.validated_output.status }}\nMessage: {{ state.validated_output.message\
      \ }}\n\nProvide brief confirmation that the API response is semantically correct (e.g., success\
      \ status matches 2xx code)."
    name: validate_semantics
    tackle:
      - set_state
