cascade_id: ward_comprehensive_flow

description: Comprehensive example using all three ward modes together

inputs_schema:
  article_topic: Topic for the article
  target_length: Target word count

phases:
  - handoffs:
      - write
    instructions: |-
      Create an article outline for: {{ input.article_topic }}

      Target length: {{ input.target_length }} words

      Provide a structured outline with main points.
    name: plan
    rules:
      max_turns: 1
    wards:
      post:
        - mode: advisory
          validator: length_check
      pre:
        - mode: blocking
          validator: simple_validator
  - context:
      from:
        - previous
    handoffs:
      - finalize
    instructions: |-
      Based on your outline, write the full article about {{ input.article_topic }}.

      Make it engaging and well-structured. Include the word 'important' naturally in the content.
    name: write
    rules:
      max_attempts: 3
      max_turns: 1
      retry_instructions: |-
        Ward Validation:

        {{ validation_error }}

        Please revise. Attempt {{ attempt }}/{{ max_attempts }}
    wards:
      post:
        - mode: blocking
          validator: content_safety
        - max_attempts: 3
          mode: retry
          validator: keyword_validator
        - mode: advisory
          validator: grammar_check
  - context:
      from:
        - all
    instructions: |-
      Article passed all critical wards!

      Safety: PASSED (blocking)
      Keyword: PASSED (retry)
      Grammar: Checked (advisory)

      Provide a brief summary of the final article.
    name: finalize
    tackle:
      - set_state
