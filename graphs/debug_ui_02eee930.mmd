graph TD
    %% Styles
    classDef default fill:#f9f9f9,stroke:#333,stroke-width:1px,color:#000;
    classDef system fill:#e1f5fe,stroke:#333,color:#000;
    classDef user fill:#fff9c4,stroke:#333,color:#000;
    classDef agent fill:#dcedc8,stroke:#333,color:#000;
    classDef tool fill:#ffccbc,stroke:#333,color:#000;
    classDef error fill:#ffcdd2,stroke:#f44336,color:#000;
    classDef structure fill:#eeeeee,stroke:#666,stroke-dasharray: 5 5,color:#000;
    classDef cascade fill:#ffffff,stroke:#333,stroke-width:2px,color:#000;
    classDef soundings fill:#e3f2fd,stroke:#1976d2,stroke-width:3px,color:#000;
    classDef sounding_attempt fill:#bbdefb,stroke:#1976d2,stroke-dasharray: 3 3,color:#000;
    classDef winner fill:#c8e6c9,stroke:#388e3c,stroke-width:3px,color:#000;
    subgraph node_3843bbbd [STRUCTURE: Cascade: tool_demo]
    direction TB
    class node_3843bbbd cascade
        subgraph node_0f12e5fa [STRUCTURE: Phase: calc_phase]
        direction TB
        class node_0f12e5fa structure
                node_2fc69357["SYSTEM<br/>Calculate the factorial of 7 using Python code. Use the 'run_code' tool."]
            class node_2fc69357 system
                node_5d1b5444["USER<br/> Input Data:\n{}"]
            class node_5d1b5444 user
        end
        subgraph node_4dca362a [STRUCTURE: Phase: query_phase]
        direction TB
        class node_4dca362a structure
                node_d83d78bf["SYSTEM<br/>Query the 'crew.csv' file to list all roles. Use 'smart_sql_run'. The table name is simply the file path 'windlass/examples/crew.csv'. e.g. SELECT * FROM 'windlass/examples/crew.csv'"]
            class node_d83d78bf system
                node_5badf1a6["USER<br/> Input Data:\n{}"]
            class node_5badf1a6 user
        end
    end
        node_ab725fd9["ASSISTANT<br/>"]
    class node_ab725fd9 agent
        node_fb683cfa["TOOL<br/>5040\n"]
    class node_fb683cfa tool
        node_1fea247b["ASSISTANT<br/>**5040**\n\nThe factorial of 7 (7!) is 5040, computed via Python's `math.factorial(7)`."]
    class node_1fea247b agent
        node_a254d24c["USER<br/>Continue/Refine based on previous output."]
    class node_a254d24c user
        node_93b351e7["ASSISTANT<br/>**Confirmed: 5040**\n\nTo refine without relying on the `math` library, here's an iterative Python implementation for verification:\n\n```python\ndef factorial(n):\n    result = 1\n    for i in range(1, n + 1):\n        result *= i\n    return result\n\nprint(factorial(7))\n```\n\nThis also yields **5040**. No further refinement needed unless specified!"]
    class node_93b351e7 agent
        node_fad337c4["USER<br/>Continue/Refine based on previous output."]
    class node_fad337c4 user
        node_4f68a0bc["ASSISTANT<br/>"]
    class node_4f68a0bc agent
        node_8e21b41a["TOOL<br/>Error: name 'factorial' is not defined"]
    class node_8e21b41a tool
        node_04647fa0["ASSISTANT<br/>"]
    class node_04647fa0 agent
        node_a67fa8e3["ASSISTANT<br/>"]
    class node_a67fa8e3 agent
        node_3baad84c["TOOL<br/>Error: IO Error: No files found that match the pattern \'windlass/examples/crew.csv\'"]
    class node_3baad84c tool
        node_519e2e7a["ASSISTANT<br/>"]
    class node_519e2e7a agent
        node_ba9c4eb9["USER<br/>Continue/Refine based on previous output."]
    class node_ba9c4eb9 user
        node_05eaff2c["ASSISTANT<br/>"]
    class node_05eaff2c agent
        node_6dee1295["TOOL<br/>[{\'file\':\'examples\\/crew.csv\'}]"]
    class node_6dee1295 tool
        node_df799cf4["ASSISTANT<br/>"]
    class node_df799cf4 agent
        node_1e00369a["USER<br/>Continue/Refine based on previous output."]
    class node_1e00369a user
        node_fc6363a8["ASSISTANT<br/>"]
    class node_fc6363a8 agent
        node_7f143432["TOOL<br/>[{\'role\':\'Defense\'},{\'role\':\'Leader\'},{\'role\':\'Navigation\'},{\'role\':\'Logistics\'}]"]
    class node_7f143432 tool
        node_a17f5543["ASSISTANT<br/>**Roles in crew.csv:**\n\n- Defense\n- Leader\n- Navigation\n- Logistics\n\n(Extracted as distinct values from the `role` column using DuckDB SQL.)"]
    class node_a17f5543 agent
    node_3843bbbd -.-> node_ab725fd9
    node_ab725fd9 -.-> node_fb683cfa
    node_fb683cfa -.-> node_1fea247b
    node_1fea247b -.-> node_a254d24c
    node_a254d24c -.-> node_93b351e7
    node_93b351e7 -.-> node_fad337c4
    node_fad337c4 -.-> node_4f68a0bc
    node_4f68a0bc -.-> node_8e21b41a
    node_8e21b41a -.-> node_04647fa0
    node_04647fa0 -.-> node_a67fa8e3
    node_a67fa8e3 -.-> node_3baad84c
    node_3baad84c -.-> node_519e2e7a
    node_519e2e7a -.-> node_ba9c4eb9
    node_ba9c4eb9 -.-> node_05eaff2c
    node_05eaff2c -.-> node_6dee1295
    node_6dee1295 -.-> node_df799cf4
    node_df799cf4 -.-> node_1e00369a
    node_1e00369a -.-> node_fc6363a8
    node_fc6363a8 -.-> node_7f143432
    node_7f143432 -.-> node_a17f5543