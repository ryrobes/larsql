graph TD
    %% Styles
    classDef default fill:#f9f9f9,stroke:#333,stroke-width:1px;
    classDef system fill:#e1f5fe,stroke:#333;
    classDef user fill:#fff9c4,stroke:#333;
    classDef agent fill:#dcedc8,stroke:#333;
    classDef tool fill:#ffccbc,stroke:#333;
    classDef error fill:#ffcdd2,stroke:#f44336;
    classDef structure fill:#eeeeee,stroke:#666,stroke-dasharray: 5 5;
    classDef cascade fill:#ffffff,stroke:#333,stroke-width:2px;
    classDef soundings fill:#e3f2fd,stroke:#1976d2,stroke-width:3px;
    classDef sounding_attempt fill:#bbdefb,stroke:#1976d2,stroke-dasharray: 3 3;
    classDef winner fill:#c8e6c9,stroke:#388e3c,stroke-width:3px;
    subgraph node_2768e2e1 [STRUCTURE: Cascade: dashboard_metrics_ideation]
    direction TB
    class node_2768e2e1 cascade
        subgraph node_a31e27dc [STRUCTURE: Phase: ideate_metrics]
        direction TB
        class node_a31e27dc structure
                node_b9db520a["SOUNDINGS_RESULT<br/>Selected best of 4 attempts"]
            class node_b9db520a default
        end
        subgraph node_afbd6685 [STRUCTURE: Phase: finalize]
        direction TB
        class node_afbd6685 structure
                node_baf6d446["SYSTEM<br/>The metrics have been refined through 3 reforge steps! Provide a brief summary highlighting:\n- Top 3 metrics selected\n- Key visualization recommendations\n- Why this dashboard will be effective\n\nStore final metrics using set_state."]
            class node_baf6d446 system
                node_bce855c8["USER<br/> Input Data:\n{\'audience\': \'C-LEVEL Crew\', \'dashboard_type\': \'Widget Sales for the Year\'}"]
            class node_bce855c8 user
        end
    end
        node_f69a32fe["ASSISTANT<br/> Final Dashboard Summary: Widget Sales for the Year (C-Level Contrarian Edition)\n\n**Top 3 Metrics Selected**:\n1. **Revenue at Risk %** \u2013 Exposes over-reliance on top customers/channels (e.g., 35%).\n2. **Margin Erosion Rate** \u2013 Tracks QoQ profit decay (e.g., -1.2%).\n3. **Anti-Fragility Index** \u2013 Stress-tests sales survival in macro shocks (e.g., 92%).\n\n**Key Visualization Recommendations**:\n- Bullet charts & gauges for hero KPIs (amber/red thresholds).\n- Heatmaps & sparkli..."]
    class node_f69a32fe agent
        node_547af998["TOOL<br/>State updated: final_metrics = [{\'name\':\'Revenue at Risk %\',\'description\':\'% from top 5 customers/channels (e.g., 35%). Alert >25%.\',\'viz\':\'Bullet chart\',\'alert\':\'Diversify NOW (30-day fix)\'},{\'name\':\'Margin Erosion Rate\',\'description\':\'QoQ profit % decay (e.g., -1.2%).\',\'viz\':\'Sparkline trendline\',\'alert\':\'> -0.5% \u2192 Pricing autopsy (7 days)\'},{\'name\':\'Dependency Score\',\'description\':\'Composite of single-source risks (e.g., 72/100).\',\'viz\':\'Gauge w..."]
    class node_547af998 tool
        node_84c640c2["ASSISTANT<br/> Final Dashboard Summary: Widget Sales Reality Check (C-Level)\n\n**Top 3 Metrics Selected**:\n1. **Revenue at Risk %** (Bullet chart): Exposes over-reliance on top customers/channels (>25% alert \u2192 30-day diversification).\n2. **Margin Erosion Rate** (Sparkline trendline): Tracks QoQ profit decay (>-0.5% alert \u2192 7-day pricing fix).\n3. **Anti-Fragility Index** (Stress-test bars): Measures shock survival (<95% alert \u2192 immediate drills).\n\n**Key Visualization Recommendations**:\n- ..."]
    class node_84c640c2 agent
    node_2768e2e1 -.-> node_f69a32fe
    node_f69a32fe -.-> node_547af998
    node_547af998 -.-> node_84c640c2