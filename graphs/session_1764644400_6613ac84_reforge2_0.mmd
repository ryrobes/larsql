graph TD
    %% Styles
    classDef default fill:#f9f9f9,stroke:#333,stroke-width:1px;
    classDef system fill:#e1f5fe,stroke:#333;
    classDef user fill:#fff9c4,stroke:#333;
    classDef agent fill:#dcedc8,stroke:#333;
    classDef tool fill:#ffccbc,stroke:#333;
    classDef error fill:#ffcdd2,stroke:#f44336;
    classDef structure fill:#eeeeee,stroke:#666,stroke-dasharray: 5 5;
    classDef cascade fill:#ffffff,stroke:#333,stroke-width:2px;
    classDef soundings fill:#e3f2fd,stroke:#1976d2,stroke-width:3px;
    classDef sounding_attempt fill:#bbdefb,stroke:#1976d2,stroke-dasharray: 3 3;
    classDef winner fill:#c8e6c9,stroke:#388e3c,stroke-width:3px;
    subgraph node_051f8819 [STRUCTURE: Cascade: strategic_plan_reforge]
    direction TB
    class node_051f8819 cascade
        subgraph node_56ce216b [STRUCTURE: Phase: analyze_challenge]
        direction TB
        class node_56ce216b structure
                node_d84613d4["SYSTEM<br/>Analyze the business challenge: Limiting shrinkage in high crime retail areas\n\nTimeframe: ASAP - 6 months\n\nProvide:\n1. Current state assessment\n2. Root cause analysis\n3. Key stakeholders affected\n4. Market context\n\nIf '_refinement_context' is provided in input, incorporate that feedback:\nOriginal cascade goal: Create a strategic plan with cascade-level reforge for iterative improvement\n\nCurrent best output: {'session_id': 'session_1764644400_6613ac84_reforge1_1', 'state': {'input': ..."]
            class node_d84613d4 system
                node_00dc3fff["USER<br/> Input Data:\n{\'business_challenge\': \'Limiting shrinkage in high crime retail areas\', \'timeframe\': \'ASAP - 6 months\', \'_refinement_context\': \'Original cascade goal: Create a strategic plan with cascade-level reforge for iterative improvement\\n\\nCurrent best output: {'session_id': 'session_1764644400_6613ac84_reforge1_1', 'state': {'input': {'business_challenge': 'Limiting shrinkage in high crime retail areas', 'timeframe': 'ASAP - 6 months', '_refinement_context': 'Original cascade ..."]
            class node_00dc3fff user
        end
        subgraph node_30cb56fc [STRUCTURE: Phase: strategize]
        direction TB
        class node_30cb56fc structure
                node_31103e11["SYSTEM<br/>Based on the analysis, develop a strategic approach to address Limiting shrinkage in high crime retail areas.\n\nInclude:\n1. Strategic goals (3-5 key objectives)\n2. Approach and methodology\n3. Success criteria\n4. Initial resource estimates\n\nRefinement context (if reforging):\nOriginal cascade goal: Create a strategic plan with cascade-level reforge for iterative improvement\n\nCurrent best output: {'session_id': 'session_1764644400_6613ac84_reforge1_1', 'state': {'input': {'business_challe..."]
            class node_31103e11 system
                node_df8a85f9["USER<br/> Input Data:\n{\'business_challenge\': \'Limiting shrinkage in high crime retail areas\', \'timeframe\': \'ASAP - 6 months\', \'_refinement_context\': \'Original cascade goal: Create a strategic plan with cascade-level reforge for iterative improvement\\n\\nCurrent best output: {'session_id': 'session_1764644400_6613ac84_reforge1_1', 'state': {'input': {'business_challenge': 'Limiting shrinkage in high crime retail areas', 'timeframe': 'ASAP - 6 months', '_refinement_context': 'Original cascade ..."]
            class node_df8a85f9 user
        end
        subgraph node_61a28f22 [STRUCTURE: Phase: risk_assessment]
        direction TB
        class node_61a28f22 structure
                node_9b6a932a["SYSTEM<br/>Identify and analyze risks for the proposed strategy.\n\nProvide:\n1. Top 5 risks (with likelihood and impact)\n2. Mitigation strategies\n3. Contingency plans\n4. Early warning indicators\n\nRefinement context:\nOriginal cascade goal: Create a strategic plan with cascade-level reforge for iterative improvement\n\nCurrent best output: {'session_id': 'session_1764644400_6613ac84_reforge1_1', 'state': {'input': {'business_challenge': 'Limiting shrinkage in high crime retail areas', 'timeframe': 'AS..."]
            class node_9b6a932a system
                node_7098e57e["USER<br/> Input Data:\n{\'business_challenge\': \'Limiting shrinkage in high crime retail areas\', \'timeframe\': \'ASAP - 6 months\', \'_refinement_context\': \'Original cascade goal: Create a strategic plan with cascade-level reforge for iterative improvement\\n\\nCurrent best output: {'session_id': 'session_1764644400_6613ac84_reforge1_1', 'state': {'input': {'business_challenge': 'Limiting shrinkage in high crime retail areas', 'timeframe': 'ASAP - 6 months', '_refinement_context': 'Original cascade ..."]
            class node_7098e57e user
                node_ddce9863["SYSTEM<br/>Error: litellm.BadRequestError: OpenAIException - This endpoint's maximum context length is 2000000 tokens. However, you requested about 2627691 tokens (2627691 of text input). Please reduce the length of either one, or use the \'middle-out\' transform to compress your prompt automatically."]
            class node_ddce9863 system
        end
        subgraph node_38e11364 [STRUCTURE: Phase: finalize_plan]
        direction TB
        class node_38e11364 structure
                node_f79c6747["SYSTEM<br/>Synthesize the complete strategic plan.\n\nProvide an executive summary including:\n1. Vision statement\n2. Strategic goals\n3. Execution approach\n4. Risk overview\n5. Success metrics\n6. Timeline and milestones\n\nRefinement context:\nOriginal cascade goal: Create a strategic plan with cascade-level reforge for iterative improvement\n\nCurrent best output: {'session_id': 'session_1764644400_6613ac84_reforge1_1', 'state': {'input': {'business_challenge': 'Limiting shrinkage in high crime retail..."]
            class node_f79c6747 system
                node_35306b6b["USER<br/> Input Data:\n{\'business_challenge\': \'Limiting shrinkage in high crime retail areas\', \'timeframe\': \'ASAP - 6 months\', \'_refinement_context\': \'Original cascade goal: Create a strategic plan with cascade-level reforge for iterative improvement\\n\\nCurrent best output: {'session_id': 'session_1764644400_6613ac84_reforge1_1', 'state': {'input': {'business_challenge': 'Limiting shrinkage in high crime retail areas', 'timeframe': 'ASAP - 6 months', '_refinement_context': 'Original cascade ..."]
            class node_35306b6b user
                node_812f5175["SYSTEM<br/>Error: litellm.BadRequestError: OpenAIException - This endpoint's maximum context length is 2000000 tokens. However, you requested about 3503416 tokens (3503316 of text input, 100 of tool input). Please reduce the length of either one, or use the \'middle-out\' transform to compress your prompt automatically."]
            class node_812f5175 system
        end
    end
        node_982c427c["ASSISTANT<br/> 1. Current State Assessment\nShrinkage in high-crime retail areas remains acute at 3-8% ($10-50K/mo/store), per NRF 2023, but **edge cases amplify**: \'Flash mob\' smash-and-grabs (e.g., 2023 LA/Chicago spikes, $1M+ losses/night) overwhelm standard LP; internal \'ghost employee\' fraud (5-10% losses in gang-influenced stores, FBI reports); post-COVID \'professional boosters\' using kids/drones for $950 Prop 47 evasion. Conventional audits miss 20% \'unknown losses\' (e.g., counterfeit swaps). A..."]
    class node_982c427c agent
        node_2ee1fca8["ASSISTANT<br/> 1. Current State Assessment\nShrinkage rates in high-crime areas are 3-8% ($10-50K/mo/store), but **edge cases**: \'Flash mob\' events (e.g., 2023 LA/Chicago, $1M+ losses/night, 1-2x/month); gang \'protection rackets\' (10% unreported, per FBI); drone drops/counterfeit swaps (5% losses, NRF blind spot). Conventional metrics miss 25% \'ghost shrinkage\' (untracked internal fraud). ASAP: Viral TikTok theft videos (-20% traffic); 6-mo: Vendor boycotts (30% stock gaps). Benchmarks: Walgreens closed..."]
    class node_2ee1fca8 agent
    node_051f8819 -.-> node_982c427c
    node_982c427c -.-> node_2ee1fca8