graph TD
    %% Styles
    classDef default fill:#f9f9f9,stroke:#333,stroke-width:1px;
    classDef system fill:#e1f5fe,stroke:#333;
    classDef user fill:#fff9c4,stroke:#333;
    classDef agent fill:#dcedc8,stroke:#333;
    classDef tool fill:#ffccbc,stroke:#333;
    classDef error fill:#ffcdd2,stroke:#f44336;
    classDef structure fill:#eeeeee,stroke:#666,stroke-dasharray: 5 5;
    classDef cascade fill:#ffffff,stroke:#333,stroke-width:2px;
    classDef soundings fill:#e3f2fd,stroke:#1976d2,stroke-width:3px;
    classDef sounding_attempt fill:#bbdefb,stroke:#1976d2,stroke-dasharray: 3 3;
    classDef winner fill:#c8e6c9,stroke:#388e3c,stroke-width:3px;
    subgraph node_d71a9fa9 [STRUCTURE: Cascade: strategic_plan_reforge]
    direction TB
    class node_d71a9fa9 cascade
        subgraph node_e3c6cb26 [STRUCTURE: Phase: analyze_challenge]
        direction TB
        class node_e3c6cb26 structure
                node_b0d2698d["SYSTEM<br/>Analyze the business challenge: Limiting shrinkage in high crime retail areas\n\nTimeframe: ASAP - 6 months\n\nProvide:\n1. Current state assessment\n2. Root cause analysis\n3. Key stakeholders affected\n4. Market context\n\nIf '_refinement_context' is provided in input, incorporate that feedback:\nOriginal cascade goal: Create a strategic plan with cascade-level reforge for iterative improvement\n\nCurrent best output: {'session_id': 'session_1764644400_6613ac84_reforge1_1', 'state': {'input': ..."]
            class node_b0d2698d system
                node_f536850b["USER<br/> Input Data:\n{\'business_challenge\': \'Limiting shrinkage in high crime retail areas\', \'timeframe\': \'ASAP - 6 months\', \'_refinement_context\': \'Original cascade goal: Create a strategic plan with cascade-level reforge for iterative improvement\\n\\nCurrent best output: {'session_id': 'session_1764644400_6613ac84_reforge1_1', 'state': {'input': {'business_challenge': 'Limiting shrinkage in high crime retail areas', 'timeframe': 'ASAP - 6 months', '_refinement_context': 'Original cascade ..."]
            class node_f536850b user
        end
        subgraph node_4f51b576 [STRUCTURE: Phase: strategize]
        direction TB
        class node_4f51b576 structure
                node_f13e7e82["SYSTEM<br/>Based on the analysis, develop a strategic approach to address Limiting shrinkage in high crime retail areas.\n\nInclude:\n1. Strategic goals (3-5 key objectives)\n2. Approach and methodology\n3. Success criteria\n4. Initial resource estimates\n\nRefinement context (if reforging):\nOriginal cascade goal: Create a strategic plan with cascade-level reforge for iterative improvement\n\nCurrent best output: {'session_id': 'session_1764644400_6613ac84_reforge1_1', 'state': {'input': {'business_challe..."]
            class node_f13e7e82 system
                node_48b8ad12["USER<br/> Input Data:\n{\'business_challenge\': \'Limiting shrinkage in high crime retail areas\', \'timeframe\': \'ASAP - 6 months\', \'_refinement_context\': \'Original cascade goal: Create a strategic plan with cascade-level reforge for iterative improvement\\n\\nCurrent best output: {'session_id': 'session_1764644400_6613ac84_reforge1_1', 'state': {'input': {'business_challenge': 'Limiting shrinkage in high crime retail areas', 'timeframe': 'ASAP - 6 months', '_refinement_context': 'Original cascade ..."]
            class node_48b8ad12 user
        end
        subgraph node_7ac418d3 [STRUCTURE: Phase: risk_assessment]
        direction TB
        class node_7ac418d3 structure
                node_e6b500c0["SYSTEM<br/>Identify and analyze risks for the proposed strategy.\n\nProvide:\n1. Top 5 risks (with likelihood and impact)\n2. Mitigation strategies\n3. Contingency plans\n4. Early warning indicators\n\nRefinement context:\nOriginal cascade goal: Create a strategic plan with cascade-level reforge for iterative improvement\n\nCurrent best output: {'session_id': 'session_1764644400_6613ac84_reforge1_1', 'state': {'input': {'business_challenge': 'Limiting shrinkage in high crime retail areas', 'timeframe': 'AS..."]
            class node_e6b500c0 system
                node_ee8b46f6["USER<br/> Input Data:\n{\'business_challenge\': \'Limiting shrinkage in high crime retail areas\', \'timeframe\': \'ASAP - 6 months\', \'_refinement_context\': \'Original cascade goal: Create a strategic plan with cascade-level reforge for iterative improvement\\n\\nCurrent best output: {'session_id': 'session_1764644400_6613ac84_reforge1_1', 'state': {'input': {'business_challenge': 'Limiting shrinkage in high crime retail areas', 'timeframe': 'ASAP - 6 months', '_refinement_context': 'Original cascade ..."]
            class node_ee8b46f6 user
                node_18e6ee2b["SYSTEM<br/>Error: litellm.BadRequestError: OpenAIException - This endpoint's maximum context length is 2000000 tokens. However, you requested about 2627839 tokens (2627839 of text input). Please reduce the length of either one, or use the \'middle-out\' transform to compress your prompt automatically."]
            class node_18e6ee2b system
        end
        subgraph node_29791456 [STRUCTURE: Phase: finalize_plan]
        direction TB
        class node_29791456 structure
                node_0924c7e2["SYSTEM<br/>Synthesize the complete strategic plan.\n\nProvide an executive summary including:\n1. Vision statement\n2. Strategic goals\n3. Execution approach\n4. Risk overview\n5. Success metrics\n6. Timeline and milestones\n\nRefinement context:\nOriginal cascade goal: Create a strategic plan with cascade-level reforge for iterative improvement\n\nCurrent best output: {'session_id': 'session_1764644400_6613ac84_reforge1_1', 'state': {'input': {'business_challenge': 'Limiting shrinkage in high crime retail..."]
            class node_0924c7e2 system
                node_b45c2318["USER<br/> Input Data:\n{\'business_challenge\': \'Limiting shrinkage in high crime retail areas\', \'timeframe\': \'ASAP - 6 months\', \'_refinement_context\': \'Original cascade goal: Create a strategic plan with cascade-level reforge for iterative improvement\\n\\nCurrent best output: {'session_id': 'session_1764644400_6613ac84_reforge1_1', 'state': {'input': {'business_challenge': 'Limiting shrinkage in high crime retail areas', 'timeframe': 'ASAP - 6 months', '_refinement_context': 'Original cascade ..."]
            class node_b45c2318 user
                node_46d9b0e4["SYSTEM<br/>Error: litellm.BadRequestError: OpenAIException - This endpoint's maximum context length is 2000000 tokens. However, you requested about 3503563 tokens (3503463 of text input, 100 of tool input). Please reduce the length of either one, or use the \'middle-out\' transform to compress your prompt automatically."]
            class node_46d9b0e4 system
        end
    end
        node_dcc60626["ASSISTANT<br/> 1. Current State Assessment\nShrinkage in high-crime retail areas is 3-8% ($10-50K/mo/store), but **edge case challenge**: Conventional metrics miss \'unknown unknowns\' like gang-orchestrated internal theft (e.g., employee rings with external gangs, undetected in 25% audits per Jack L. Hayes) or cyber-shrinkage (POS hacks in 10% urban stores, FBI IC3). Uncommon scenarios: Flash mobs exploiting audits (post-COVID +35%, NRF); vendor fraud spikes during supply disruptions (e.g., 2022 port delays ..."]
    class node_dcc60626 agent
        node_9de30613["ASSISTANT<br/>Assistant:  1. Current State Assessment\nHigh-crime retail shrinkage 3-8% ($10-50K/mo/store), external theft 70%. **Edge cases**: Gang-orchestrated internal rings (25% undetected, Hayes Intl.); POS hacks (10%, FBI); flash mobs (35% post-COVID, NRF); vendor hoarding (2x in disruptions). Conventional audits miss 20% \'camouflage.\' Benchmarks: Family Dollar micro-franchises succeed in gangs.\n\n 2"]
    class node_9de30613 agent
    node_d71a9fa9 -.-> node_dcc60626
    node_dcc60626 -.-> node_9de30613