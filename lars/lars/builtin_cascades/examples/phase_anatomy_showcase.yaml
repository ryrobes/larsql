cascade_id: phase_anatomy_showcase
description: Comprehensive showcase of all phase features for testing the Phase Anatomy
  panel
inputs_schema:
  topic: The topic to analyze
  depth: How deep to go (shallow, medium, deep)
cells:
- name: initial_analysis
  instructions: 'You are an expert analyst. Analyze the following topic at the specified
    depth level.


    Topic: {{ input.topic }}

    Depth: {{ input.depth }}


    Provide a structured analysis with:

    1. Key concepts

    2. Main challenges

    3. Potential opportunities


    Be concise but thorough.

    '
  model: google/gemini-2.5-flash
  rules:
    max_turns: 2
  skills:
  - manifest
  output_schema:
    type: object
    required:
    - concepts
    - challenges
    - opportunities
- name: parallel_brainstorm
  instructions: 'Based on the initial analysis, brainstorm creative solutions.


    Previous analysis: {{ outputs.initial_analysis }}


    Generate 3-5 innovative ideas that address the challenges identified.

    Think outside the box and consider unconventional approaches.

    '
  context:
    from:
    - initial_analysis
    include:
    - output
  takes:
    factor: 6
    mutate: true
    models:
    - anthropic/claude-sonnet-4
    - google/gemini-2.5-flash
    - openai/gpt-4o-mini
    evaluator_instructions: 'Compare the three brainstorming outputs and select the
      winner.


      Criteria:

      1. Creativity and originality (40%)

      2. Feasibility of ideas (30%)

      3. Relevance to the challenges (30%)


      Explain your reasoning and declare the winner by index (0, 1, or 2).

      '
    validator:
      python: "if not content or len(content) < 100:\n    result = {\"valid\": False,\
        \ \"reason\": \"Output too short\"}\nelse:\n    result = {\"valid\": True,\
        \ \"reason\": \"Output meets minimum length\"}\n"
  rules:
    max_turns: 3
  skills:
  - manifest
- name: validated_refinement
  instructions: 'Take the winning brainstorm and refine it into a concrete proposal.


    Winning ideas: {{ outputs.parallel_brainstorm }}


    Create a detailed proposal with:

    - Executive summary

    - Implementation steps

    - Resource requirements

    - Timeline estimate

    '
  context:
    from:
    - parallel_brainstorm
    include:
    - output
    - winner
  wards:
    pre:
    - mode: blocking
      validator:
        python: "# Check if brainstorm output exists\nif not content or len(content)\
          \ < 50:\n    result = {\"valid\": False, \"reason\": \"No brainstorm output\
          \ available\"}\nelse:\n    result = {\"valid\": True, \"reason\": \"Input\
          \ quality verified\"}\n"
    post:
    - mode: advisory
      validator:
        python: "required = ['summary', 'steps', 'resources', 'timeline']\nmissing\
          \ = [r for r in required if r.lower() not in content.lower()]\nif missing:\n\
          \    result = {\"valid\": False, \"reason\": f\"Missing sections: {missing}\"\
          }\nelse:\n    result = {\"valid\": True, \"reason\": \"All required sections\
          \ present\"}\n"
    - mode: blocking
      validator:
        javascript: "const valid = content.length >= 500;\nresult = {\n  valid: valid,\n\
          \  reason: valid ? \"Sufficient detail provided\" : \"Proposal too brief\"\
          \n};\n"
  rules:
    max_turns: 2
  model: anthropic/claude-sonnet-4
- name: iterative_improvement
  instructions: 'Review and improve the proposal to meet quality standards.


    Current proposal: {{ outputs.validated_refinement }}


    Ensure the proposal:

    1. Has clear, actionable steps

    2. Includes realistic timelines

    3. Addresses potential risks

    4. Has measurable success criteria

    '
  context:
    from:
    - validated_refinement
  rules:
    max_turns: 5
    max_attempts: 3
    loop_until:
      python: "# Check for all required elements in the output\nchecks = {\n    'actionable':\
        \ 'step' in content.lower() or 'action' in content.lower(),\n    'timeline':\
        \ 'week' in content.lower() or 'month' in content.lower() or 'day' in content.lower(),\n\
        \    'risks': 'risk' in content.lower() or 'challenge' in content.lower(),\n\
        \    'metrics': 'metric' in content.lower() or 'measure' in content.lower()\
        \ or 'kpi' in content.lower()\n}\npassed = all(checks.values())\nfailed =\
        \ [k for k, v in checks.items() if not v]\nif passed:\n    result = {\"valid\"\
        : True, \"reason\": \"All quality criteria met\"}\nelse:\n    result = {\"\
        valid\": False, \"reason\": f\"Missing elements: {failed}\"}\n"
    turn_prompt: 'Your previous response was missing some elements: {{ validation_reason
      }}

      Please revise to include all required components.

      '
  model: google/gemini-2.5-flash
- name: reforged_synthesis
  instructions: 'Create a final synthesized document combining all insights.


    Original topic: {{ input.topic }}

    Analysis: {{ outputs.initial_analysis }}

    Improved proposal: {{ outputs.iterative_improvement }}


    Produce a polished, professional document.

    '
  context:
    from:
    - initial_analysis
    - iterative_improvement
    include:
    - output
  takes:
    factor: 2
    models:
    - anthropic/claude-sonnet-4
    - openai/gpt-4o
    evaluator_instructions: 'Select the better synthesis based on clarity, completeness,
      and professionalism.

      '
    reforge:
      steps: 3
      honing_prompt: 'The current output needs improvement: {{ validation_reason }}


        Please expand and enhance the synthesis while maintaining quality.

        '
  rules:
    max_turns: 2
- name: multi_perspective_review
  instructions: 'Provide a critical review of the synthesized document from your unique
    perspective.


    Document: {{ outputs.reforged_synthesis }}


    Take {{ take_index }} of {{ take_factor }}:

    {% if take_index == 0 %}

    Review from a TECHNICAL perspective - focus on feasibility and implementation
    details.

    {% elif take_index == 1 %}

    Review from a BUSINESS perspective - focus on ROI, market fit, and scalability.

    {% else %}

    Review from a USER perspective - focus on usability, adoption, and experience.

    {% endif %}

    '
  context:
    from:
    - reforged_synthesis
  takes:
    factor: 3
    mode: aggregate
    aggregator_instructions: 'Combine all three perspective reviews into a comprehensive
      feedback document.

      Organize by perspective (Technical, Business, User) and highlight:

      - Key strengths identified

      - Areas for improvement

      - Recommended next steps

      '
  rules:
    max_turns: 1
  model: google/gemini-2.5-flash
- name: save_results
  tool: set_state
  inputs:
    key: final_analysis
    value: '{{ outputs.multi_perspective_review }}'
- name: route_next_action
  instructions: 'Based on the multi-perspective review, determine the best next action.


    Review: {{ outputs.multi_perspective_review }}


    Decide whether to:

    1. APPROVE - The proposal is ready for implementation

    2. REVISE - More work needed on specific areas

    3. ESCALATE - Needs senior review due to complexity/risk


    Use the route_to tool to direct to the appropriate next phase.

    '
  context:
    from:
    - multi_perspective_review
  handoffs:
  - approve_proposal
  - request_revision
  - escalate_review
  rules:
    max_turns: 2
  skills:
  - manifest
  callouts: 'Decision Point: Routing Next Action'
- name: approve_proposal
  instructions: 'Generate the final approval document.


    Include:

    - Approval statement

    - Key decision factors

    - Implementation authorization

    - Success metrics to track


    Format with clear headers.

    '
  output_extraction:
    pattern: APPROVED:\s*(.+)
    store_as: approval_status
  output_schema:
    type: object
    properties:
      status:
        type: string
        enum:
        - approved
        - conditional
        - pending
      authorization_level:
        type: string
    required:
    - status
  rules:
    max_turns: 1
  model: anthropic/claude-sonnet-4
- name: request_revision
  instructions: 'Document the specific revisions needed.


    Based on the review feedback, list:

    1. Specific areas requiring changes

    2. Suggested improvements

    3. Deadline for revisions

    '
  rules:
    max_turns: 1
- name: escalate_review
  instructions: 'Prepare an escalation brief for senior review.


    Include:

    - Summary of the proposal

    - Reasons for escalation

    - Specific questions for senior leadership

    - Risk assessment

    '
  rules:
    max_turns: 1
  callouts: 'Escalation: High Priority Review'
