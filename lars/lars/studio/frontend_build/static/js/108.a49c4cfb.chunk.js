"use strict";(self.webpackChunklars_ui=self.webpackChunklars_ui||[]).push([[108],{877:(e,s,t)=>{t.d(s,{Q:()=>c});var a=t(93014),l=t(13839),i=t(52185),n=t(6026),r=t(3831),c=(0,a.gu)({chartName:"AreaChart",GraphicalChild:l.G,axisComponents:[{axisType:"xAxis",AxisComp:i.W},{axisType:"yAxis",AxisComp:n.h}],formatAxisMap:r.pr})},27108:(e,s,t)=>{t.r(s),t.d(s,{default:()=>M});var a=t(89379),l=t(65043),i=t(94424),n=t(87955),r=t(5748),c=t(50108),o=t(82291),d=t(38643),h=t(86150),u=t(877),m=t(13839),x=t(64065),p=t(24227),j=t(70579);const v={semantic_sql:{icon:"mdi:database-search",color:"#60a5fa",label:"Semantic SQL"},cascade_snapshot:{icon:"mdi:camera",color:"#a78bfa",label:"Snapshot"},visual_regression:{icon:"mdi:image-compare",color:"#f472b6",label:"Visual Regression"}},f={passed:"#34d399",failed:"#f87171",error:"#fb923c",skipped:"#64748b",running:"#fbbf24",pending:"#94a3b8"},g=e=>null===e||void 0===e?"-":"boolean"===typeof e?e?"Yes":"No":"number"===typeof e?Number.isInteger(e)?e.toLocaleString():e.toFixed(4):"object"===typeof e?JSON.stringify(e,null,2):String(e),b=e=>{let{label:s,value:t,color:a}=e;return null===t||void 0===t||""===t?null:(0,j.jsxs)("div",{className:"test-detail-field",children:[(0,j.jsx)("span",{className:"test-detail-field-label",children:s}),(0,j.jsx)("span",{className:"test-detail-field-value",style:a?{color:a}:void 0,children:g(t)})]})},N=e=>{let{title:s,content:t,language:a="sql"}=e;if(!t)return null;const l="string"===typeof t?t:JSON.stringify(t,null,2);return(0,j.jsxs)("div",{className:"test-detail-code-block",children:[(0,j.jsx)("div",{className:"test-detail-code-header",children:s}),(0,j.jsx)("pre",{className:"test-detail-code-content",children:l})]})},y=e=>{if(!e)return null;const s=e.indexOf("/browsers/");if(-1===s)return null;const t=e.substring(s+10);return"".concat(p.J,"/api/tests/visual/screenshot/").concat(t)},_=e=>{let{score:s,threshold:t=.95}=e;const a=Math.round(100*s),l=s>=t?"#34d399":"#f87171";return(0,j.jsxs)("div",{className:"visual-score-meter",children:[(0,j.jsxs)("div",{className:"visual-score-bar",children:[(0,j.jsx)("div",{className:"visual-score-fill",style:{width:"".concat(a,"%"),background:l}}),(0,j.jsx)("div",{className:"visual-score-threshold",style:{left:"".concat(100*t,"%")},title:"Threshold: ".concat(Math.round(100*t),"%")})]}),(0,j.jsxs)("div",{className:"visual-score-labels",children:[(0,j.jsxs)("span",{className:"visual-score-value",style:{color:l},children:[a,"%"]}),(0,j.jsxs)("span",{className:"visual-score-threshold-label",children:["Threshold: ",Math.round(100*t),"%"]})]})]})},S=e=>{let{screenshot:s,expanded:t,onToggle:a}=e;const{name:l,similarity:i,passed:n,previous_path:c,current_path:o,diff_path:d,error:h}=s,u=Math.round(100*i),m=n?"#34d399":"#f87171";return(0,j.jsxs)("div",{className:"visual-screenshot-card ".concat(n?"passed":"failed"," ").concat(t?"expanded":""),children:[(0,j.jsxs)("div",{className:"visual-screenshot-header",onClick:a,children:[(0,j.jsxs)("div",{className:"visual-screenshot-status",children:[(0,j.jsx)(r.In,{icon:n?"mdi:check-circle":"mdi:close-circle",width:16,style:{color:m}}),(0,j.jsx)("span",{className:"visual-screenshot-name",children:l})]}),(0,j.jsxs)("div",{className:"visual-screenshot-score",style:{color:m},children:[u,"%",(0,j.jsx)(r.In,{icon:t?"mdi:chevron-up":"mdi:chevron-down",width:16})]})]}),h&&(0,j.jsxs)("div",{className:"visual-screenshot-error",children:[(0,j.jsx)(r.In,{icon:"mdi:alert-circle",width:14}),(0,j.jsx)("span",{children:h})]}),t&&!h&&(0,j.jsxs)("div",{className:"visual-screenshot-comparison",children:[c&&(0,j.jsxs)("div",{className:"visual-screenshot-img-container",children:[(0,j.jsx)("div",{className:"visual-screenshot-img-label",children:"Previous"}),(0,j.jsx)("img",{src:y(c),alt:"Previous screenshot",className:"visual-screenshot-img",loading:"lazy"})]}),o&&(0,j.jsxs)("div",{className:"visual-screenshot-img-container",children:[(0,j.jsx)("div",{className:"visual-screenshot-img-label",children:"Current"}),(0,j.jsx)("img",{src:y(o),alt:"Current screenshot",className:"visual-screenshot-img",loading:"lazy"})]}),d&&(0,j.jsxs)("div",{className:"visual-screenshot-img-container diff",children:[(0,j.jsx)("div",{className:"visual-screenshot-img-label",children:"Diff"}),(0,j.jsx)("img",{src:y(d),alt:"Diff",className:"visual-screenshot-img",loading:"lazy"})]})]})]})},k=e=>{var s;let{test:t,lastRun:i,onClose:n,onRun:c,isRunning:o}=e;const[d,h]=(0,l.useState)([]),[u,m]=(0,l.useState)(!1),[g,y]=(0,l.useState)({}),k=null===i||void 0===i||null===(s=i.results)||void 0===s?void 0:s.find(e=>e.test_id===t.test_id),w=(null===k||void 0===k?void 0:k.status)||"pending",C=v[t.test_type]||v.semantic_sql,I=f[w]||f.pending,T=l.useMemo(()=>{if(null!==k&&void 0!==k&&k.screenshots_compared)try{return JSON.parse(k.screenshots_compared)}catch(e){return[]}return[]},[null===k||void 0===k?void 0:k.screenshots_compared]),R=(0,l.useCallback)(e=>{y(s=>(0,a.A)((0,a.A)({},s),{},{[e]:!s[e]}))},[]);(0,l.useEffect)(()=>{if(T.length>0){const e=T.filter(e=>!e.passed).reduce((e,s)=>(0,a.A)((0,a.A)({},e),{},{[s.name]:!0}),{});y(e)}},[T]);const O=(0,l.useCallback)(async()=>{m(!0);try{const e=await fetch("".concat(p.J,"/api/tests/").concat(encodeURIComponent(t.test_id),"/history?limit=10")),s=await e.json();s.error||h(s.history||[])}catch(e){console.error("Error fetching history:",e)}finally{m(!1)}},[t.test_id]);return(0,l.useEffect)(()=>{O()},[t.test_id]),t?(0,j.jsxs)("div",{className:"test-detail-panel",children:[(0,j.jsxs)("div",{className:"test-detail-header",children:[(0,j.jsxs)("div",{className:"test-detail-header-left",children:[(0,j.jsx)(r.In,{icon:C.icon,width:18,style:{color:C.color}}),(0,j.jsx)("span",{className:"test-detail-type",children:C.label})]}),(0,j.jsx)("button",{className:"test-detail-close",onClick:n,children:(0,j.jsx)(r.In,{icon:"mdi:close",width:18})})]}),(0,j.jsxs)("div",{className:"test-detail-content",children:[(0,j.jsxs)("div",{className:"test-detail-title-section",children:[(0,j.jsx)("h2",{className:"test-detail-title",children:t.test_name}),(0,j.jsx)("span",{className:"test-detail-status",style:{color:I,background:"".concat(I,"15")},children:w})]}),t.description&&(0,j.jsx)("p",{className:"test-detail-description",children:t.description}),t.test_group&&(0,j.jsxs)("div",{className:"test-detail-group",children:[(0,j.jsx)(r.In,{icon:"mdi:folder-outline",width:14}),(0,j.jsx)("span",{children:t.test_group})]}),t.source_file&&(0,j.jsxs)("div",{className:"test-detail-source",children:[(0,j.jsx)(r.In,{icon:"mdi:file-code-outline",width:14}),(0,j.jsx)("span",{children:t.source_file})]}),(0,j.jsxs)("button",{className:"test-detail-run-btn ".concat(o?"running":""),onClick:()=>c(t.test_id),disabled:o,children:[(0,j.jsx)(r.In,{icon:o?"mdi:loading":"mdi:play",width:14,className:o?"spin":""}),(0,j.jsx)("span",{children:o?"Running...":"Run This Test"})]}),(0,j.jsxs)("div",{className:"test-detail-section",children:[(0,j.jsx)("h3",{className:"test-detail-section-title",children:"Test Details"}),(0,j.jsxs)("div",{className:"test-detail-fields",children:[(0,j.jsx)(b,{label:"Test ID",value:t.test_id}),(0,j.jsx)(b,{label:"Test Type",value:t.test_type,color:C.color}),k&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(b,{label:"Duration",value:"".concat(Math.round(k.duration_ms||0),"ms")}),(0,j.jsx)(b,{label:"Expect Type",value:k.expect_type})]})]})]}),t.sql_query&&(0,j.jsxs)("div",{className:"test-detail-section",children:[(0,j.jsx)("h3",{className:"test-detail-section-title",children:"SQL Query"}),(0,j.jsx)(N,{title:"Query",content:t.sql_query})]}),t.expect&&(0,j.jsxs)("div",{className:"test-detail-section",children:[(0,j.jsx)("h3",{className:"test-detail-section-title",children:"Expected Value"}),(0,j.jsx)(N,{title:"Expected",content:JSON.stringify(t.expect,null,2),language:"json"})]}),k&&(0,j.jsxs)("div",{className:"test-detail-section",children:[(0,j.jsx)("h3",{className:"test-detail-section-title",children:"Last Run Result"}),(0,j.jsxs)("div",{className:"test-detail-fields",children:[(0,j.jsx)(b,{label:"Status",value:k.status,color:I}),(0,j.jsx)(b,{label:"Duration",value:"".concat(Math.round(k.duration_ms||0),"ms")}),k.actual_value&&(0,j.jsx)(b,{label:"Actual Value",value:k.actual_value})]}),k.failure_message&&(0,j.jsxs)("div",{className:"test-detail-failure",children:[(0,j.jsx)(r.In,{icon:"mdi:alert-circle",width:14}),(0,j.jsx)("span",{children:k.failure_message})]}),k.failure_diff&&(0,j.jsx)(N,{title:"Diff",content:k.failure_diff}),k.error_message&&(0,j.jsxs)("div",{className:"test-detail-error",children:[(0,j.jsxs)("div",{className:"test-detail-error-header",children:[(0,j.jsx)(r.In,{icon:"mdi:alert-octagon",width:14}),(0,j.jsx)("span",{children:k.error_type||"Error"})]}),(0,j.jsx)("p",{children:k.error_message}),k.error_traceback&&(0,j.jsx)("pre",{className:"test-detail-traceback",children:k.error_traceback})]})]}),"cascade_snapshot"===t.test_type&&(0,j.jsxs)("div",{className:"test-detail-section",children:[(0,j.jsx)("h3",{className:"test-detail-section-title",children:"Snapshot Details"}),(0,j.jsxs)("div",{className:"test-detail-fields",children:[(0,j.jsx)(b,{label:"Has Contracts",value:t.has_contracts,color:t.has_contracts?"#34d399":"#64748b"}),(0,j.jsx)(b,{label:"Has Anchors",value:t.has_anchors,color:t.has_anchors?"#34d399":"#64748b"}),t.validation_modes&&(0,j.jsx)(b,{label:"Validation Modes",value:t.validation_modes.join(", ")})]})]}),"visual_regression"===t.test_type&&k&&(0,j.jsxs)("div",{className:"test-detail-section",children:[(0,j.jsx)("h3",{className:"test-detail-section-title",children:"Visual Comparison"}),k.is_baseline&&(0,j.jsxs)("div",{className:"visual-baseline-notice",children:[(0,j.jsx)(r.In,{icon:"mdi:information",width:16}),(0,j.jsx)("span",{children:"Baseline established - this is the first run (no comparison available)"})]}),!k.is_baseline&&(0,j.jsxs)("div",{className:"visual-overall-score",children:[(0,j.jsx)("div",{className:"visual-overall-score-label",children:"Overall Similarity"}),(0,j.jsx)(_,{score:k.overall_score||0,threshold:t.threshold||.95})]}),(0,j.jsxs)("div",{className:"test-detail-fields",style:{marginTop:12},children:[(0,j.jsx)(b,{label:"Session ID",value:k.session_id}),k.previous_session_id&&(0,j.jsx)(b,{label:"Compared To",value:k.previous_session_id})]}),T.length>0&&(0,j.jsxs)("div",{className:"visual-screenshots-section",children:[(0,j.jsx)("div",{className:"visual-screenshots-header",children:(0,j.jsxs)("span",{children:["Screenshots (",T.filter(e=>e.passed).length,"/",T.length," passed)"]})}),(0,j.jsx)("div",{className:"visual-screenshots-list",children:T.map(e=>(0,j.jsx)(S,{screenshot:e,expanded:g[e.name]||!1,onToggle:()=>R(e.name)},e.name))})]})]}),"visual_regression"===t.test_type&&!k&&(0,j.jsxs)("div",{className:"test-detail-section",children:[(0,j.jsx)("h3",{className:"test-detail-section-title",children:"Visual Test Config"}),(0,j.jsxs)("div",{className:"test-detail-fields",children:[(0,j.jsx)(b,{label:"Initial URL",value:t.initial_url}),(0,j.jsx)(b,{label:"Threshold",value:"".concat(Math.round(100*(t.threshold||.95)),"%")}),t.browser_batch&&(0,j.jsx)(b,{label:"Commands",value:"".concat(t.browser_batch.length," commands")})]})]}),(0,j.jsxs)("div",{className:"test-detail-section",children:[(0,j.jsx)("h3",{className:"test-detail-section-title",children:"Run History"}),u?(0,j.jsx)("div",{className:"test-detail-history-loading",children:(0,j.jsx)(x.lp,{size:"small",message:"Loading history..."})}):0===d.length?(0,j.jsxs)("div",{className:"test-detail-history-empty",children:[(0,j.jsx)(r.In,{icon:"mdi:history",width:24}),(0,j.jsx)("span",{children:"No run history yet"})]}):(0,j.jsx)("div",{className:"test-detail-history",children:d.map((e,s)=>(0,j.jsxs)("div",{className:"test-detail-history-item",children:[(0,j.jsx)("div",{className:"test-detail-history-status",style:{background:f[e.status]||f.pending}}),(0,j.jsxs)("div",{className:"test-detail-history-info",children:[(0,j.jsx)("span",{className:"test-detail-history-date",children:e.started_at?new Date(e.started_at).toLocaleString():"-"}),(0,j.jsxs)("span",{className:"test-detail-history-duration",children:[Math.round(e.duration_ms||0),"ms"]})]}),e.failure_message&&(0,j.jsx)("span",{className:"test-detail-history-message",title:e.failure_message,children:e.failure_message.length>40?e.failure_message.slice(0,40)+"...":e.failure_message})]},e.run_id||s))})]})]})]}):null};n.syG.registerModules([n.JKr]);const w=n.zl0.withParams({backgroundColor:"#000000",foregroundColor:"#cbd5e1",headerBackgroundColor:"#0a0510",headerTextColor:"#f0f4f8",oddRowBackgroundColor:"#050410",borderColor:"#1a1628",rowBorder:!0,wrapperBorder:!1,headerFontSize:12,headerFontWeight:600,fontFamily:"'Google Sans Code', monospace",fontSize:13,accentColor:"#34d399",chromeBackgroundColor:"#000000"}),C={all:{label:"All Tests",icon:"mdi:test-tube",color:"#94a3b8"},semantic_sql:{label:"Semantic SQL",icon:"mdi:database-search",color:"#60a5fa"},cascade_snapshot:{label:"Snapshots",icon:"mdi:camera",color:"#a78bfa"},visual_regression:{label:"Visual",icon:"mdi:image-compare",color:"#f472b6"}},I={passed:"#34d399",failed:"#f87171",error:"#fb923c",skipped:"#64748b",running:"#fbbf24",pending:"#94a3b8"},T="tests_type",R=()=>{try{const e=localStorage.getItem(T);if(e&&C[e])return e}catch(e){}return"all"},O=e=>{let{data:s,title:t,icon:a,color:l,type:i="area"}=e;return s&&0!==s.length?(0,j.jsxs)("div",{className:"tests-mini-chart",children:[(0,j.jsxs)("div",{className:"tests-mini-chart-header",children:[(0,j.jsx)(r.In,{icon:a,width:14,style:{color:l}}),(0,j.jsx)("span",{children:t})]}),(0,j.jsx)("div",{className:"tests-mini-chart-content",children:(0,j.jsx)(c.u,{width:"100%",height:60,children:"bar"===i?(0,j.jsxs)(o.E,{data:s,children:[(0,j.jsx)(d.y,{dataKey:"value",fill:l,radius:[2,2,0,0]}),(0,j.jsx)(h.m,{contentStyle:{background:"#1a1a1f",border:"none",borderRadius:6,fontSize:11},labelStyle:{color:"#94a3b8"}})]}):(0,j.jsxs)(u.Q,{data:s,children:[(0,j.jsx)("defs",{children:(0,j.jsxs)("linearGradient",{id:"gradient-".concat(t.replace(/\s/g,"")),x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,j.jsx)("stop",{offset:"0%",stopColor:l,stopOpacity:.3}),(0,j.jsx)("stop",{offset:"100%",stopColor:l,stopOpacity:.05})]})}),(0,j.jsx)(m.G,{type:"monotone",dataKey:"value",stroke:l,fill:"url(#gradient-".concat(t.replace(/\s/g,""),")"),strokeWidth:1.5}),(0,j.jsx)(h.m,{contentStyle:{background:"#1a1a1f",border:"none",borderRadius:6,fontSize:11},labelStyle:{color:"#94a3b8"}})]})})})]}):(0,j.jsxs)("div",{className:"tests-mini-chart",children:[(0,j.jsxs)("div",{className:"tests-mini-chart-header",children:[(0,j.jsx)(r.In,{icon:a,width:14,style:{color:l}}),(0,j.jsx)("span",{children:t})]}),(0,j.jsx)("div",{className:"tests-mini-chart-empty",children:"No data"})]})},E=e=>{let{label:s,value:t,icon:a,color:l,subtext:i,onClick:n,active:c,clickable:o}=e;return(0,j.jsxs)("div",{className:"tests-stat-card ".concat(o?"clickable":""," ").concat(c?"active":""),onClick:n,style:c?{borderColor:l,background:"".concat(l,"10")}:{},children:[(0,j.jsx)("div",{className:"tests-stat-icon",style:{background:"".concat(l,"15"),color:l},children:(0,j.jsx)(r.In,{icon:a,width:18})}),(0,j.jsxs)("div",{className:"tests-stat-content",children:[(0,j.jsx)("div",{className:"tests-stat-value",style:{color:l},children:t}),(0,j.jsx)("div",{className:"tests-stat-label",children:s}),i&&(0,j.jsx)("div",{className:"tests-stat-subtext",children:i})]})]})},A=e=>{let{label:s,options:t,selected:a,onChange:i,color:n}=e;const[c,o]=(0,l.useState)(!1),d=(0,l.useRef)(null);(0,l.useEffect)(()=>{const e=e=>{d.current&&!d.current.contains(e.target)&&o(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);return(0,j.jsxs)("div",{className:"tests-filter",ref:d,children:[(0,j.jsxs)("button",{className:"tests-filter-btn ".concat(a.length>0?"active":""),onClick:()=>o(!c),children:[(0,j.jsx)("span",{className:"tests-filter-label",children:s}),a.length>0&&(0,j.jsx)("span",{className:"tests-filter-count",style:{background:n||"#64748b"},children:a.length}),(0,j.jsx)(r.In,{icon:c?"mdi:chevron-up":"mdi:chevron-down",width:14})]}),c&&(0,j.jsxs)("div",{className:"tests-filter-dropdown",children:[(0,j.jsxs)("div",{className:"tests-filter-header",children:[(0,j.jsx)("span",{children:s}),a.length>0&&(0,j.jsx)("button",{className:"tests-filter-clear",onClick:e=>{e.stopPropagation(),i([])},children:"Clear"})]}),(0,j.jsx)("div",{className:"tests-filter-options",children:t.map(e=>(0,j.jsxs)("label",{className:"tests-filter-option",children:[(0,j.jsx)("input",{type:"checkbox",checked:a.includes(e.value),onChange:()=>{return s=e.value,void(a.includes(s)?i(a.filter(e=>e!==s)):i([...a,s]));var s}}),(0,j.jsx)("span",{className:"tests-filter-option-label",style:{color:e.color||"#94a3b8"},children:e.label}),(0,j.jsx)("span",{className:"tests-filter-option-count",children:e.count})]},e.value))})]})]})},M=()=>{var e;const[s,t]=(0,l.useState)(R),[n,c]=(0,l.useState)(""),[o,d]=(0,l.useState)({}),[h,u]=(0,l.useState)(null),[m,v]=(0,l.useState)(!0),[f,g]=(0,l.useState)(null),[b,N]=(0,l.useState)(null),[y,_]=(0,l.useState)([]),[S,M]=(0,l.useState)([]),[L,z]=(0,l.useState)(!1),[J,D]=(0,l.useState)(null),[F,Q]=(0,l.useState)(null),[q,G]=(0,l.useState)("internal"),[V,P]=(0,l.useState)("structure"),[W,B]=(0,l.useState)([]),[H,K]=(0,l.useState)({}),[U,Y]=(0,l.useState)(null),X=(0,l.useCallback)(async()=>{try{const e=new URLSearchParams;"all"!==s&&e.set("type",s),n.trim()&&e.set("filter",n.trim());const t=await fetch("".concat(p.J,"/api/tests?").concat(e.toString())),l=await t.json();if(l.error)return void g(l.error);const i=[];for(const[s,n]of Object.entries(l.tests||{}))for(const e of n)i.push((0,a.A)((0,a.A)({},e),{},{_type:s}));B(e=>{return(s=e)===(t=i)||s&&t&&JSON.stringify(s)===JSON.stringify(t)?e:i;var s,t}),d(l.counts||{}),g(null)}catch(e){g(e.message)}finally{v(!1)}},[s,n]),Z=(0,l.useMemo)(()=>W.map(e=>{const s=H[e.test_id]||{},t=Object.values(s),l=t.length>0?t[0][0]:null;return(0,a.A)((0,a.A)({},e),{},{_status:(null===l||void 0===l?void 0:l.status)||"pending"})}),[W,H]),$=(0,l.useCallback)(async()=>{try{const e=await fetch("".concat(p.J,"/api/tests/stats?days=7")),s=await e.json();s.error||u(s)}catch(e){console.error("Error fetching stats:",e)}},[]),ee=(0,l.useCallback)(async()=>{try{const e=await fetch("".concat(p.J,"/api/tests/history/bulk?limit=10")),s=await e.json();!s.error&&s.history&&K(s.history)}catch(e){console.error("Error fetching test history:",e)}},[]),se=(0,l.useCallback)(async()=>{try{const e=await fetch("".concat(p.J,"/api/tests/runs?limit=1")),s=await e.json();if(s.runs&&s.runs.length>0){const e=s.runs[0].run_id,t=await fetch("".concat(p.J,"/api/tests/runs/").concat(e)),l=await t.json();!l.error&&l.results&&Q((0,a.A)((0,a.A)({},l.run),{},{passed:l.run.passed_tests,failed:l.run.failed_tests,total:l.run.total_tests,results:l.results}))}}catch(e){console.error("Error fetching last run:",e)}},[]),te=(0,l.useCallback)(e=>{t(e),N(null),_([]),M([]);try{localStorage.setItem(T,e)}catch(s){}},[]),{statusOptions:ae,groupOptions:le}=(0,l.useMemo)(()=>{const e={},s={};Z.forEach(t=>{const a=t._status||"pending";e[a]=(e[a]||0)+1;const l=t.test_group||"unknown";s[l]=(s[l]||0)+1});return{statusOptions:Object.entries(e).sort((e,s)=>s[1]-e[1]).map(e=>{let[s,t]=e;return{value:s,label:s,count:t,color:I[s]||I.pending}}),groupOptions:Object.entries(s).sort((e,s)=>s[1]-e[1]).slice(0,20).map(e=>{let[s,t]=e;return{value:s,label:s.length>30?"..."+s.slice(-27):s,count:t,color:"#94a3b8"}})}},[Z]),ie=(0,l.useMemo)(()=>{let e=Z;return y.length>0&&(e=e.filter(e=>y.includes(e._status))),S.length>0&&(e=e.filter(e=>S.includes(e.test_group))),e},[Z,y,S]),ne=(0,l.useMemo)(()=>{const e={passed:0,failed:0,error:0,skipped:0,pending:0};return ie.forEach(s=>{const t=s._status||"pending";void 0!==e[t]&&e[t]++}),e},[ie]),re=(0,l.useMemo)(()=>{let e=ie;return U&&(e=e.filter(e=>e._status===U)),e},[ie,U]),ce=(0,l.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;z(!0),D(null);try{const s={test_ids:e||re.map(e=>e.test_id),ssql_mode:q,snapshot_mode:V},t=await fetch("".concat(p.J,"/api/tests/run"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),a=await t.json();a.error?g(a.error):(console.log("[TestsView] Run complete:",a),D(a),Q(a),$(),ee())}catch(s){g(s.message)}finally{z(!1)}},[re,$,q,V]),oe="all"!==s||n.trim()||U||y.length>0||S.length>0,de=oe?"Run These (".concat(re.length,")"):"Run All",he=(0,l.useCallback)(e=>{Y(s=>s===e?null:e)},[]),ue=(0,l.useMemo)(()=>{if(null===h||void 0===h||!h.daily_trends)return{passed:[],failed:[],runs:[]};return{passed:h.daily_trends.map(e=>({date:e.date,value:e.passed||0})),failed:h.daily_trends.map(e=>({date:e.date,value:(e.failed||0)+(e.errors||0)})),runs:h.daily_trends.map(e=>({date:e.date,value:e.run_count||0}))}},[h]);(0,l.useMemo)(()=>null!==h&&void 0!==h&&h.daily_trends?h.daily_trends.reduce((e,s)=>({passed:e.passed+(s.passed||0),failed:e.failed+(s.failed||0)+(s.errors||0),runs:e.runs+(s.run_count||0)}),{passed:0,failed:0,runs:0}):{passed:0,failed:0,runs:0},[h]);(0,l.useEffect)(()=>{(async()=>{await se(),$(),ee()})()},[]),(0,l.useEffect)(()=>{X()},[F]),(0,l.useEffect)(()=>{X()},[s]),(0,l.useEffect)(()=>{const e=setTimeout(()=>{X()},300);return()=>clearTimeout(e)},[n]),(0,l.useEffect)(()=>{const e=setInterval(()=>{se(),$(),ee()},3e4);return()=>clearInterval(e)},[]);const me=(0,l.useMemo)(()=>[{field:"_status",headerName:"Status",width:100,cellRenderer:e=>{const s=e.value||"pending",t=I[s]||I.pending;return(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[(0,j.jsx)("span",{style:{width:8,height:8,borderRadius:"50%",background:t,flexShrink:0}}),(0,j.jsx)("span",{style:{color:t,fontSize:"11px",textTransform:"capitalize"},children:s})]})}},{field:"test_id",headerName:"History",width:140,cellRenderer:e=>{const s=H[e.value]||{},t=Object.keys(s);if(0===t.length)return(0,j.jsx)("div",{className:"tests-sparkline-container",title:"No history",children:(0,j.jsx)("span",{style:{color:"#475569",fontSize:"10px"},children:"\u2014"})});const a={internal:"int",simple:"sim",extended:"ext",structure:"str",contracts:"con",anchors:"anc",deterministic:"det",full:"ful",visual:"vis"},l=["internal","simple","extended","structure","contracts","anchors","deterministic","full","visual"],i=t.sort((e,s)=>{const t=l.indexOf(e),a=l.indexOf(s);return(-1===t?999:t)-(-1===a?999:a)});return(0,j.jsx)("div",{className:"tests-sparkline-container",children:i.map(e=>{const t=s[e]||[],l=[...t].reverse(),i=t.filter(e=>"passed"===e.status).length;return(0,j.jsxs)("div",{className:"tests-sparkline-row",title:"".concat(e,": ").concat(i,"/").concat(t.length," passed"),children:[(0,j.jsx)("span",{className:"tests-sparkline-mode",children:a[e]||e.slice(0,3)}),(0,j.jsx)("div",{className:"tests-sparkline",children:l.map((e,s)=>(0,j.jsx)("span",{className:"tests-sparkline-block",style:{background:I[e.status]||I.pending}},s))})]},e)})})}},{field:"test_type",headerName:"Type",width:130,cellRenderer:e=>{const s=C[e.value]||C.all;return(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[(0,j.jsx)(r.In,{icon:s.icon,width:14,style:{color:s.color}}),(0,j.jsx)("span",{style:{color:s.color,fontSize:"11px"},children:{semantic_sql:"SQL",cascade_snapshot:"Snapshot",visual_regression:"Visual"}[e.value]||e.value})]})},hide:"all"!==s},{field:"test_name",headerName:"Name",flex:1,minWidth:200,cellStyle:{color:"#f1f5f9",fontWeight:500}},{field:"test_group",headerName:"Group",width:200,cellStyle:{fontSize:"12px",color:"#94a3b8"},valueFormatter:e=>{const s=e.value||"";return s.length>30?"..."+s.slice(-27):s}},{field:"description",headerName:"Description",flex:2,minWidth:250,cellStyle:{fontSize:"12px",color:"#64748b"},valueFormatter:e=>{const s=e.value||"";return s.length>100?s.substring(0,100)+"...":s}},{field:"source_file",headerName:"Source",width:180,cellStyle:{fontSize:"11px",color:"#64748b"},valueFormatter:e=>{const s=e.value||"";return s.length>30?"..."+s.substring(s.length-27):s}}],[s,H]),xe=()=>Object.values(o).reduce((e,s)=>e+s,0),pe=(0,l.useCallback)(e=>{N(e.data)},[]),je=(0,l.useCallback)(()=>{N(null)},[]);return(0,j.jsxs)("div",{className:"tests-view ".concat(b?"with-detail":""),children:[(0,j.jsxs)("div",{className:"tests-header",children:[(0,j.jsxs)("div",{className:"tests-header-left",children:[(0,j.jsx)(r.In,{icon:"mdi:test-tube",width:20,style:{color:"#34d399"}}),(0,j.jsx)("h1",{children:"Tests"}),(0,j.jsx)("span",{className:"tests-subtitle",children:"Test Dashboard"})]}),(0,j.jsxs)("div",{className:"tests-header-right",children:[(0,j.jsxs)("div",{className:"tests-search",children:[(0,j.jsx)(r.In,{icon:"mdi:magnify",width:16,style:{color:"#64748b"}}),(0,j.jsx)("input",{type:"text",placeholder:"Search tests...",value:n,onChange:e=>c(e.target.value),className:"tests-search-input"}),n&&(0,j.jsx)("button",{className:"tests-search-clear",onClick:()=>c(""),children:(0,j.jsx)(r.In,{icon:"mdi:close",width:14})})]}),(0,j.jsxs)("div",{className:"tests-mode-selectors",children:[(0,j.jsxs)("select",{className:"tests-mode-select",value:q,onChange:e=>G(e.target.value),title:"SQL Test Mode",children:[(0,j.jsx)("option",{value:"internal",children:"SQL: Internal"}),(0,j.jsx)("option",{value:"simple",children:"SQL: Simple"}),(0,j.jsx)("option",{value:"extended",children:"SQL: Extended"}),(0,j.jsx)("option",{value:"full",children:"SQL: Full (all 3)"})]}),(0,j.jsxs)("select",{className:"tests-mode-select",value:V,onChange:e=>P(e.target.value),title:"Snapshot Test Mode",children:[(0,j.jsx)("option",{value:"structure",children:"Snapshot: Structure"}),(0,j.jsx)("option",{value:"contracts",children:"Snapshot: Contracts"}),(0,j.jsx)("option",{value:"anchors",children:"Snapshot: Anchors"}),(0,j.jsx)("option",{value:"deterministic",children:"Snapshot: Deterministic"}),(0,j.jsx)("option",{value:"full",children:"Snapshot: Full"})]})]}),(0,j.jsxs)("button",{className:"tests-run-btn ".concat(L?"running":""," ").concat(oe?"filtered":""),onClick:()=>ce(),disabled:L||0===re.length,children:[(0,j.jsx)(r.In,{icon:L?"mdi:loading":"mdi:play",width:16,className:L?"spin":""}),(0,j.jsx)("span",{children:L?"Running...":de})]}),(0,j.jsx)("div",{className:"tests-stats",children:(0,j.jsxs)("span",{className:"tests-stat",children:[(0,j.jsx)(r.In,{icon:"mdi:counter",width:14}),xe().toLocaleString()," tests"]})})]})]}),(0,j.jsxs)("div",{className:"tests-dashboard",children:[(0,j.jsxs)("div",{className:"tests-dashboard-stats",children:[(0,j.jsx)(E,{label:"Passed",value:ne.passed.toLocaleString(),icon:"mdi:check-circle",color:"#34d399",clickable:!0,active:"passed"===U,onClick:()=>he("passed")}),(0,j.jsx)(E,{label:"Failed",value:ne.failed.toLocaleString(),icon:"mdi:close-circle",color:"#f87171",clickable:!0,active:"failed"===U,onClick:()=>he("failed")}),(0,j.jsx)(E,{label:"Error",value:ne.error.toLocaleString(),icon:"mdi:alert-circle",color:"#fb923c",clickable:!0,active:"error"===U,onClick:()=>he("error")}),(0,j.jsx)(E,{label:"Skipped",value:ne.skipped.toLocaleString(),icon:"mdi:skip-next-circle",color:"#64748b",clickable:!0,active:"skipped"===U,onClick:()=>he("skipped")}),F&&(0,j.jsx)(E,{label:"Last Run",value:"".concat(F.passed,"/").concat(F.total),icon:"mdi:clock-check",color:"passed"===F.status?"#34d399":"#f87171",subtext:"".concat(Math.round(F.duration_ms),"ms")})]}),(0,j.jsxs)("div",{className:"tests-dashboard-charts",children:[(0,j.jsx)(O,{data:ue.passed,title:"Passed",icon:"mdi:check-circle",color:"#34d399",type:"area"}),(0,j.jsx)(O,{data:ue.failed,title:"Failed",icon:"mdi:close-circle",color:"#f87171",type:"area"}),(0,j.jsx)(O,{data:ue.runs,title:"Runs",icon:"mdi:play-circle",color:"#60a5fa",type:"bar"})]})]}),(0,j.jsx)("div",{className:"tests-tabs",children:Object.entries(C).map(e=>{let[t,a]=e;const l="all"===t?xe():o[t]||0;return"all"!==t&&0===l?null:(0,j.jsxs)("button",{className:"tests-tab ".concat(s===t?"active":""),onClick:()=>te(t),children:[(0,j.jsx)(r.In,{icon:a.icon,width:14,style:{color:s===t?a.color:void 0}}),(0,j.jsx)("span",{children:a.label}),(0,j.jsx)("span",{className:"tests-tab-count",children:l})]},t)})}),Z.length>0&&(0,j.jsxs)("div",{className:"tests-filter-bar",children:[(0,j.jsxs)("div",{className:"tests-filters",children:[ae.length>1&&(0,j.jsx)(A,{label:"Status",options:ae,selected:y,onChange:_,color:(null===(e=C[s])||void 0===e?void 0:e.color)||"#64748b"}),le.length>1&&(0,j.jsx)(A,{label:"Group",options:le,selected:S,onChange:M,color:"#64748b"})]}),(0,j.jsxs)("div",{className:"tests-filter-summary",children:[U&&(0,j.jsxs)("span",{className:"tests-filter-badge",style:{background:"".concat(I[U],"20"),color:I[U]},children:[U,(0,j.jsx)("button",{onClick:()=>Y(null),children:(0,j.jsx)(r.In,{icon:"mdi:close",width:10})})]}),(U||y.length>0||S.length>0)&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)("span",{className:"tests-filter-showing",children:["Showing ",re.length," of ",Z.length]}),(0,j.jsxs)("button",{className:"tests-filter-clear-all",onClick:()=>{Y(null),_([]),M([])},children:[(0,j.jsx)(r.In,{icon:"mdi:close",width:12}),"Clear all"]})]})]})]}),(0,j.jsxs)("div",{className:"tests-content",children:[f&&(0,j.jsxs)("div",{className:"tests-error",children:[(0,j.jsx)(r.In,{icon:"mdi:alert-circle",width:20}),(0,j.jsxs)("div",{children:[(0,j.jsx)("strong",{children:"Error loading tests"}),(0,j.jsx)("p",{children:f})]})]}),m&&!Z.length&&(0,j.jsx)(x.lp,{size:"medium",message:"Loading tests...",className:"video-loader--flex"}),!m&&!f&&(0,j.jsxs)("div",{className:"tests-grid-wrapper",children:[(0,j.jsx)("div",{className:"tests-grid-container",children:0===re.length?(0,j.jsxs)("div",{className:"tests-empty-state",children:[(0,j.jsx)(r.In,{icon:"mdi:test-tube-off",width:48,style:{color:"#64748b"}}),(0,j.jsx)("p",{children:"No tests found"}),(0,j.jsx)("span",{children:y.length>0||S.length>0?"Try adjusting your filters":n?"Try adjusting your search":"No tests discovered yet"})]}):(0,j.jsx)(i.W6,{theme:w,rowData:re,columnDefs:me,domLayout:"normal",suppressCellFocus:!0,enableCellTextSelection:!0,getRowHeight:e=>{const s=H[e.data.test_id]||{},t=Object.keys(s).length;return Math.max(36,20+15*Math.max(1,t))},headerHeight:40,onRowClicked:pe,rowStyle:{cursor:"pointer"},rowSelection:"single",getRowId:e=>e.data.test_id,rowClass:e=>(null===b||void 0===b?void 0:b.test_id)===e.data.test_id?"tests-row-selected":""},"grid-".concat(Object.values(H).reduce((e,s)=>e+Object.keys(s).length,0)))}),b&&(0,j.jsx)(k,{test:b,lastRun:F,onClose:je,onRun:e=>ce([e]),isRunning:L})]})]})]})}},82291:(e,s,t)=>{t.d(s,{E:()=>c});var a=t(93014),l=t(38643),i=t(52185),n=t(6026),r=t(3831),c=(0,a.gu)({chartName:"BarChart",GraphicalChild:l.y,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:i.W},{axisType:"yAxis",AxisComp:n.h}],formatAxisMap:r.pr})}}]);
//# sourceMappingURL=108.a49c4cfb.chunk.js.map