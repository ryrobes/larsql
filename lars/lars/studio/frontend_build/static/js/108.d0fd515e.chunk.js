"use strict";(self.webpackChunklars_ui=self.webpackChunklars_ui||[]).push([[108],{877:(e,s,t)=>{t.d(s,{Q:()=>c});var a=t(93014),l=t(13839),i=t(52185),n=t(6026),r=t(3831),c=(0,a.gu)({chartName:"AreaChart",GraphicalChild:l.G,axisComponents:[{axisType:"xAxis",AxisComp:i.W},{axisType:"yAxis",AxisComp:n.h}],formatAxisMap:r.pr})},27108:(e,s,t)=>{t.r(s),t.d(s,{default:()=>A});var a=t(89379),l=t(65043),i=t(94424),n=t(87955),r=t(5748),c=t(50108),o=t(82291),d=t(38643),h=t(86150),u=t(877),m=t(13839),p=t(64065),x=t(70579);const j={semantic_sql:{icon:"mdi:database-search",color:"#60a5fa",label:"Semantic SQL"},cascade_snapshot:{icon:"mdi:camera",color:"#a78bfa",label:"Snapshot"},visual_regression:{icon:"mdi:image-compare",color:"#f472b6",label:"Visual Regression"}},v={passed:"#34d399",failed:"#f87171",error:"#fb923c",skipped:"#64748b",running:"#fbbf24",pending:"#94a3b8"},f=e=>null===e||void 0===e?"-":"boolean"===typeof e?e?"Yes":"No":"number"===typeof e?Number.isInteger(e)?e.toLocaleString():e.toFixed(4):"object"===typeof e?JSON.stringify(e,null,2):String(e),g=e=>{let{label:s,value:t,color:a}=e;return null===t||void 0===t||""===t?null:(0,x.jsxs)("div",{className:"test-detail-field",children:[(0,x.jsx)("span",{className:"test-detail-field-label",children:s}),(0,x.jsx)("span",{className:"test-detail-field-value",style:a?{color:a}:void 0,children:f(t)})]})},b=e=>{let{title:s,content:t,language:a="sql"}=e;if(!t)return null;const l="string"===typeof t?t:JSON.stringify(t,null,2);return(0,x.jsxs)("div",{className:"test-detail-code-block",children:[(0,x.jsx)("div",{className:"test-detail-code-header",children:s}),(0,x.jsx)("pre",{className:"test-detail-code-content",children:l})]})},N=e=>{if(!e)return null;const s=e.indexOf("/browsers/");if(-1===s)return null;const t=e.substring(s+10);return"http://localhost:5050/api/tests/visual/screenshot/".concat(t)},y=e=>{let{score:s,threshold:t=.95}=e;const a=Math.round(100*s),l=s>=t?"#34d399":"#f87171";return(0,x.jsxs)("div",{className:"visual-score-meter",children:[(0,x.jsxs)("div",{className:"visual-score-bar",children:[(0,x.jsx)("div",{className:"visual-score-fill",style:{width:"".concat(a,"%"),background:l}}),(0,x.jsx)("div",{className:"visual-score-threshold",style:{left:"".concat(100*t,"%")},title:"Threshold: ".concat(Math.round(100*t),"%")})]}),(0,x.jsxs)("div",{className:"visual-score-labels",children:[(0,x.jsxs)("span",{className:"visual-score-value",style:{color:l},children:[a,"%"]}),(0,x.jsxs)("span",{className:"visual-score-threshold-label",children:["Threshold: ",Math.round(100*t),"%"]})]})]})},_=e=>{let{screenshot:s,expanded:t,onToggle:a}=e;const{name:l,similarity:i,passed:n,previous_path:c,current_path:o,diff_path:d,error:h}=s,u=Math.round(100*i),m=n?"#34d399":"#f87171";return(0,x.jsxs)("div",{className:"visual-screenshot-card ".concat(n?"passed":"failed"," ").concat(t?"expanded":""),children:[(0,x.jsxs)("div",{className:"visual-screenshot-header",onClick:a,children:[(0,x.jsxs)("div",{className:"visual-screenshot-status",children:[(0,x.jsx)(r.In,{icon:n?"mdi:check-circle":"mdi:close-circle",width:16,style:{color:m}}),(0,x.jsx)("span",{className:"visual-screenshot-name",children:l})]}),(0,x.jsxs)("div",{className:"visual-screenshot-score",style:{color:m},children:[u,"%",(0,x.jsx)(r.In,{icon:t?"mdi:chevron-up":"mdi:chevron-down",width:16})]})]}),h&&(0,x.jsxs)("div",{className:"visual-screenshot-error",children:[(0,x.jsx)(r.In,{icon:"mdi:alert-circle",width:14}),(0,x.jsx)("span",{children:h})]}),t&&!h&&(0,x.jsxs)("div",{className:"visual-screenshot-comparison",children:[c&&(0,x.jsxs)("div",{className:"visual-screenshot-img-container",children:[(0,x.jsx)("div",{className:"visual-screenshot-img-label",children:"Previous"}),(0,x.jsx)("img",{src:N(c),alt:"Previous screenshot",className:"visual-screenshot-img",loading:"lazy"})]}),o&&(0,x.jsxs)("div",{className:"visual-screenshot-img-container",children:[(0,x.jsx)("div",{className:"visual-screenshot-img-label",children:"Current"}),(0,x.jsx)("img",{src:N(o),alt:"Current screenshot",className:"visual-screenshot-img",loading:"lazy"})]}),d&&(0,x.jsxs)("div",{className:"visual-screenshot-img-container diff",children:[(0,x.jsx)("div",{className:"visual-screenshot-img-label",children:"Diff"}),(0,x.jsx)("img",{src:N(d),alt:"Diff",className:"visual-screenshot-img",loading:"lazy"})]})]})]})},S=e=>{var s;let{test:t,lastRun:i,onClose:n,onRun:c,isRunning:o}=e;const[d,h]=(0,l.useState)([]),[u,m]=(0,l.useState)(!1),[f,N]=(0,l.useState)({}),S=null===i||void 0===i||null===(s=i.results)||void 0===s?void 0:s.find(e=>e.test_id===t.test_id),k=(null===S||void 0===S?void 0:S.status)||"pending",w=j[t.test_type]||j.semantic_sql,C=v[k]||v.pending,I=l.useMemo(()=>{if(null!==S&&void 0!==S&&S.screenshots_compared)try{return JSON.parse(S.screenshots_compared)}catch(e){return[]}return[]},[null===S||void 0===S?void 0:S.screenshots_compared]),T=(0,l.useCallback)(e=>{N(s=>(0,a.A)((0,a.A)({},s),{},{[e]:!s[e]}))},[]);(0,l.useEffect)(()=>{if(I.length>0){const e=I.filter(e=>!e.passed).reduce((e,s)=>(0,a.A)((0,a.A)({},e),{},{[s.name]:!0}),{});N(e)}},[I]);const R=(0,l.useCallback)(async()=>{m(!0);try{const e=await fetch("http://localhost:5050/api/tests/".concat(encodeURIComponent(t.test_id),"/history?limit=10")),s=await e.json();s.error||h(s.history||[])}catch(e){console.error("Error fetching history:",e)}finally{m(!1)}},[t.test_id]);return(0,l.useEffect)(()=>{R()},[t.test_id]),t?(0,x.jsxs)("div",{className:"test-detail-panel",children:[(0,x.jsxs)("div",{className:"test-detail-header",children:[(0,x.jsxs)("div",{className:"test-detail-header-left",children:[(0,x.jsx)(r.In,{icon:w.icon,width:18,style:{color:w.color}}),(0,x.jsx)("span",{className:"test-detail-type",children:w.label})]}),(0,x.jsx)("button",{className:"test-detail-close",onClick:n,children:(0,x.jsx)(r.In,{icon:"mdi:close",width:18})})]}),(0,x.jsxs)("div",{className:"test-detail-content",children:[(0,x.jsxs)("div",{className:"test-detail-title-section",children:[(0,x.jsx)("h2",{className:"test-detail-title",children:t.test_name}),(0,x.jsx)("span",{className:"test-detail-status",style:{color:C,background:"".concat(C,"15")},children:k})]}),t.description&&(0,x.jsx)("p",{className:"test-detail-description",children:t.description}),t.test_group&&(0,x.jsxs)("div",{className:"test-detail-group",children:[(0,x.jsx)(r.In,{icon:"mdi:folder-outline",width:14}),(0,x.jsx)("span",{children:t.test_group})]}),t.source_file&&(0,x.jsxs)("div",{className:"test-detail-source",children:[(0,x.jsx)(r.In,{icon:"mdi:file-code-outline",width:14}),(0,x.jsx)("span",{children:t.source_file})]}),(0,x.jsxs)("button",{className:"test-detail-run-btn ".concat(o?"running":""),onClick:()=>c(t.test_id),disabled:o,children:[(0,x.jsx)(r.In,{icon:o?"mdi:loading":"mdi:play",width:14,className:o?"spin":""}),(0,x.jsx)("span",{children:o?"Running...":"Run This Test"})]}),(0,x.jsxs)("div",{className:"test-detail-section",children:[(0,x.jsx)("h3",{className:"test-detail-section-title",children:"Test Details"}),(0,x.jsxs)("div",{className:"test-detail-fields",children:[(0,x.jsx)(g,{label:"Test ID",value:t.test_id}),(0,x.jsx)(g,{label:"Test Type",value:t.test_type,color:w.color}),S&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(g,{label:"Duration",value:"".concat(Math.round(S.duration_ms||0),"ms")}),(0,x.jsx)(g,{label:"Expect Type",value:S.expect_type})]})]})]}),t.sql_query&&(0,x.jsxs)("div",{className:"test-detail-section",children:[(0,x.jsx)("h3",{className:"test-detail-section-title",children:"SQL Query"}),(0,x.jsx)(b,{title:"Query",content:t.sql_query})]}),t.expect&&(0,x.jsxs)("div",{className:"test-detail-section",children:[(0,x.jsx)("h3",{className:"test-detail-section-title",children:"Expected Value"}),(0,x.jsx)(b,{title:"Expected",content:JSON.stringify(t.expect,null,2),language:"json"})]}),S&&(0,x.jsxs)("div",{className:"test-detail-section",children:[(0,x.jsx)("h3",{className:"test-detail-section-title",children:"Last Run Result"}),(0,x.jsxs)("div",{className:"test-detail-fields",children:[(0,x.jsx)(g,{label:"Status",value:S.status,color:C}),(0,x.jsx)(g,{label:"Duration",value:"".concat(Math.round(S.duration_ms||0),"ms")}),S.actual_value&&(0,x.jsx)(g,{label:"Actual Value",value:S.actual_value})]}),S.failure_message&&(0,x.jsxs)("div",{className:"test-detail-failure",children:[(0,x.jsx)(r.In,{icon:"mdi:alert-circle",width:14}),(0,x.jsx)("span",{children:S.failure_message})]}),S.failure_diff&&(0,x.jsx)(b,{title:"Diff",content:S.failure_diff}),S.error_message&&(0,x.jsxs)("div",{className:"test-detail-error",children:[(0,x.jsxs)("div",{className:"test-detail-error-header",children:[(0,x.jsx)(r.In,{icon:"mdi:alert-octagon",width:14}),(0,x.jsx)("span",{children:S.error_type||"Error"})]}),(0,x.jsx)("p",{children:S.error_message}),S.error_traceback&&(0,x.jsx)("pre",{className:"test-detail-traceback",children:S.error_traceback})]})]}),"cascade_snapshot"===t.test_type&&(0,x.jsxs)("div",{className:"test-detail-section",children:[(0,x.jsx)("h3",{className:"test-detail-section-title",children:"Snapshot Details"}),(0,x.jsxs)("div",{className:"test-detail-fields",children:[(0,x.jsx)(g,{label:"Has Contracts",value:t.has_contracts,color:t.has_contracts?"#34d399":"#64748b"}),(0,x.jsx)(g,{label:"Has Anchors",value:t.has_anchors,color:t.has_anchors?"#34d399":"#64748b"}),t.validation_modes&&(0,x.jsx)(g,{label:"Validation Modes",value:t.validation_modes.join(", ")})]})]}),"visual_regression"===t.test_type&&S&&(0,x.jsxs)("div",{className:"test-detail-section",children:[(0,x.jsx)("h3",{className:"test-detail-section-title",children:"Visual Comparison"}),S.is_baseline&&(0,x.jsxs)("div",{className:"visual-baseline-notice",children:[(0,x.jsx)(r.In,{icon:"mdi:information",width:16}),(0,x.jsx)("span",{children:"Baseline established - this is the first run (no comparison available)"})]}),!S.is_baseline&&(0,x.jsxs)("div",{className:"visual-overall-score",children:[(0,x.jsx)("div",{className:"visual-overall-score-label",children:"Overall Similarity"}),(0,x.jsx)(y,{score:S.overall_score||0,threshold:t.threshold||.95})]}),(0,x.jsxs)("div",{className:"test-detail-fields",style:{marginTop:12},children:[(0,x.jsx)(g,{label:"Session ID",value:S.session_id}),S.previous_session_id&&(0,x.jsx)(g,{label:"Compared To",value:S.previous_session_id})]}),I.length>0&&(0,x.jsxs)("div",{className:"visual-screenshots-section",children:[(0,x.jsx)("div",{className:"visual-screenshots-header",children:(0,x.jsxs)("span",{children:["Screenshots (",I.filter(e=>e.passed).length,"/",I.length," passed)"]})}),(0,x.jsx)("div",{className:"visual-screenshots-list",children:I.map(e=>(0,x.jsx)(_,{screenshot:e,expanded:f[e.name]||!1,onToggle:()=>T(e.name)},e.name))})]})]}),"visual_regression"===t.test_type&&!S&&(0,x.jsxs)("div",{className:"test-detail-section",children:[(0,x.jsx)("h3",{className:"test-detail-section-title",children:"Visual Test Config"}),(0,x.jsxs)("div",{className:"test-detail-fields",children:[(0,x.jsx)(g,{label:"Initial URL",value:t.initial_url}),(0,x.jsx)(g,{label:"Threshold",value:"".concat(Math.round(100*(t.threshold||.95)),"%")}),t.browser_batch&&(0,x.jsx)(g,{label:"Commands",value:"".concat(t.browser_batch.length," commands")})]})]}),(0,x.jsxs)("div",{className:"test-detail-section",children:[(0,x.jsx)("h3",{className:"test-detail-section-title",children:"Run History"}),u?(0,x.jsx)("div",{className:"test-detail-history-loading",children:(0,x.jsx)(p.lp,{size:"small",message:"Loading history..."})}):0===d.length?(0,x.jsxs)("div",{className:"test-detail-history-empty",children:[(0,x.jsx)(r.In,{icon:"mdi:history",width:24}),(0,x.jsx)("span",{children:"No run history yet"})]}):(0,x.jsx)("div",{className:"test-detail-history",children:d.map((e,s)=>(0,x.jsxs)("div",{className:"test-detail-history-item",children:[(0,x.jsx)("div",{className:"test-detail-history-status",style:{background:v[e.status]||v.pending}}),(0,x.jsxs)("div",{className:"test-detail-history-info",children:[(0,x.jsx)("span",{className:"test-detail-history-date",children:e.started_at?new Date(e.started_at).toLocaleString():"-"}),(0,x.jsxs)("span",{className:"test-detail-history-duration",children:[Math.round(e.duration_ms||0),"ms"]})]}),e.failure_message&&(0,x.jsx)("span",{className:"test-detail-history-message",title:e.failure_message,children:e.failure_message.length>40?e.failure_message.slice(0,40)+"...":e.failure_message})]},e.run_id||s))})]})]})]}):null};n.syG.registerModules([n.JKr]);const k=n.zl0.withParams({backgroundColor:"#000000",foregroundColor:"#cbd5e1",headerBackgroundColor:"#0a0510",headerTextColor:"#f0f4f8",oddRowBackgroundColor:"#050410",borderColor:"#1a1628",rowBorder:!0,wrapperBorder:!1,headerFontSize:12,headerFontWeight:600,fontFamily:"'Google Sans Code', monospace",fontSize:13,accentColor:"#34d399",chromeBackgroundColor:"#000000"}),w={all:{label:"All Tests",icon:"mdi:test-tube",color:"#94a3b8"},semantic_sql:{label:"Semantic SQL",icon:"mdi:database-search",color:"#60a5fa"},cascade_snapshot:{label:"Snapshots",icon:"mdi:camera",color:"#a78bfa"},visual_regression:{label:"Visual",icon:"mdi:image-compare",color:"#f472b6"}},C={passed:"#34d399",failed:"#f87171",error:"#fb923c",skipped:"#64748b",running:"#fbbf24",pending:"#94a3b8"},I="tests_type",T=()=>{try{const e=localStorage.getItem(I);if(e&&w[e])return e}catch(e){}return"all"},R=e=>{let{data:s,title:t,icon:a,color:l,type:i="area"}=e;return s&&0!==s.length?(0,x.jsxs)("div",{className:"tests-mini-chart",children:[(0,x.jsxs)("div",{className:"tests-mini-chart-header",children:[(0,x.jsx)(r.In,{icon:a,width:14,style:{color:l}}),(0,x.jsx)("span",{children:t})]}),(0,x.jsx)("div",{className:"tests-mini-chart-content",children:(0,x.jsx)(c.u,{width:"100%",height:60,children:"bar"===i?(0,x.jsxs)(o.E,{data:s,children:[(0,x.jsx)(d.y,{dataKey:"value",fill:l,radius:[2,2,0,0]}),(0,x.jsx)(h.m,{contentStyle:{background:"#1a1a1f",border:"none",borderRadius:6,fontSize:11},labelStyle:{color:"#94a3b8"}})]}):(0,x.jsxs)(u.Q,{data:s,children:[(0,x.jsx)("defs",{children:(0,x.jsxs)("linearGradient",{id:"gradient-".concat(t.replace(/\s/g,"")),x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,x.jsx)("stop",{offset:"0%",stopColor:l,stopOpacity:.3}),(0,x.jsx)("stop",{offset:"100%",stopColor:l,stopOpacity:.05})]})}),(0,x.jsx)(m.G,{type:"monotone",dataKey:"value",stroke:l,fill:"url(#gradient-".concat(t.replace(/\s/g,""),")"),strokeWidth:1.5}),(0,x.jsx)(h.m,{contentStyle:{background:"#1a1a1f",border:"none",borderRadius:6,fontSize:11},labelStyle:{color:"#94a3b8"}})]})})})]}):(0,x.jsxs)("div",{className:"tests-mini-chart",children:[(0,x.jsxs)("div",{className:"tests-mini-chart-header",children:[(0,x.jsx)(r.In,{icon:a,width:14,style:{color:l}}),(0,x.jsx)("span",{children:t})]}),(0,x.jsx)("div",{className:"tests-mini-chart-empty",children:"No data"})]})},O=e=>{let{label:s,value:t,icon:a,color:l,subtext:i,onClick:n,active:c,clickable:o}=e;return(0,x.jsxs)("div",{className:"tests-stat-card ".concat(o?"clickable":""," ").concat(c?"active":""),onClick:n,style:c?{borderColor:l,background:"".concat(l,"10")}:{},children:[(0,x.jsx)("div",{className:"tests-stat-icon",style:{background:"".concat(l,"15"),color:l},children:(0,x.jsx)(r.In,{icon:a,width:18})}),(0,x.jsxs)("div",{className:"tests-stat-content",children:[(0,x.jsx)("div",{className:"tests-stat-value",style:{color:l},children:t}),(0,x.jsx)("div",{className:"tests-stat-label",children:s}),i&&(0,x.jsx)("div",{className:"tests-stat-subtext",children:i})]})]})},E=e=>{let{label:s,options:t,selected:a,onChange:i,color:n}=e;const[c,o]=(0,l.useState)(!1),d=(0,l.useRef)(null);(0,l.useEffect)(()=>{const e=e=>{d.current&&!d.current.contains(e.target)&&o(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);return(0,x.jsxs)("div",{className:"tests-filter",ref:d,children:[(0,x.jsxs)("button",{className:"tests-filter-btn ".concat(a.length>0?"active":""),onClick:()=>o(!c),children:[(0,x.jsx)("span",{className:"tests-filter-label",children:s}),a.length>0&&(0,x.jsx)("span",{className:"tests-filter-count",style:{background:n||"#64748b"},children:a.length}),(0,x.jsx)(r.In,{icon:c?"mdi:chevron-up":"mdi:chevron-down",width:14})]}),c&&(0,x.jsxs)("div",{className:"tests-filter-dropdown",children:[(0,x.jsxs)("div",{className:"tests-filter-header",children:[(0,x.jsx)("span",{children:s}),a.length>0&&(0,x.jsx)("button",{className:"tests-filter-clear",onClick:e=>{e.stopPropagation(),i([])},children:"Clear"})]}),(0,x.jsx)("div",{className:"tests-filter-options",children:t.map(e=>(0,x.jsxs)("label",{className:"tests-filter-option",children:[(0,x.jsx)("input",{type:"checkbox",checked:a.includes(e.value),onChange:()=>{return s=e.value,void(a.includes(s)?i(a.filter(e=>e!==s)):i([...a,s]));var s}}),(0,x.jsx)("span",{className:"tests-filter-option-label",style:{color:e.color||"#94a3b8"},children:e.label}),(0,x.jsx)("span",{className:"tests-filter-option-count",children:e.count})]},e.value))})]})]})},A=()=>{var e;const[s,t]=(0,l.useState)(T),[n,c]=(0,l.useState)(""),[o,d]=(0,l.useState)({}),[h,u]=(0,l.useState)(null),[m,j]=(0,l.useState)(!0),[v,f]=(0,l.useState)(null),[g,b]=(0,l.useState)(null),[N,y]=(0,l.useState)([]),[_,A]=(0,l.useState)([]),[M,L]=(0,l.useState)(!1),[z,D]=(0,l.useState)(null),[F,Q]=(0,l.useState)(null),[q,G]=(0,l.useState)("internal"),[V,J]=(0,l.useState)("structure"),[P,W]=(0,l.useState)([]),[B,H]=(0,l.useState)({}),[K,U]=(0,l.useState)(null),Y=(0,l.useCallback)(async()=>{try{const e=new URLSearchParams;"all"!==s&&e.set("type",s),n.trim()&&e.set("filter",n.trim());const t=await fetch("http://localhost:5050/api/tests?".concat(e.toString())),l=await t.json();if(l.error)return void f(l.error);const i=[];for(const[s,n]of Object.entries(l.tests||{}))for(const e of n)i.push((0,a.A)((0,a.A)({},e),{},{_type:s}));W(e=>{return(s=e)===(t=i)||s&&t&&JSON.stringify(s)===JSON.stringify(t)?e:i;var s,t}),d(l.counts||{}),f(null)}catch(e){f(e.message)}finally{j(!1)}},[s,n]),X=(0,l.useMemo)(()=>P.map(e=>{const s=B[e.test_id]||{},t=Object.values(s),l=t.length>0?t[0][0]:null;return(0,a.A)((0,a.A)({},e),{},{_status:(null===l||void 0===l?void 0:l.status)||"pending"})}),[P,B]),Z=(0,l.useCallback)(async()=>{try{const e=await fetch("http://localhost:5050/api/tests/stats?days=7"),s=await e.json();s.error||u(s)}catch(e){console.error("Error fetching stats:",e)}},[]),$=(0,l.useCallback)(async()=>{try{const e=await fetch("http://localhost:5050/api/tests/history/bulk?limit=10"),s=await e.json();!s.error&&s.history&&H(s.history)}catch(e){console.error("Error fetching test history:",e)}},[]),ee=(0,l.useCallback)(async()=>{try{const e=await fetch("http://localhost:5050/api/tests/runs?limit=1"),s=await e.json();if(s.runs&&s.runs.length>0){const e=s.runs[0].run_id,t=await fetch("http://localhost:5050/api/tests/runs/".concat(e)),l=await t.json();!l.error&&l.results&&Q((0,a.A)((0,a.A)({},l.run),{},{passed:l.run.passed_tests,failed:l.run.failed_tests,total:l.run.total_tests,results:l.results}))}}catch(e){console.error("Error fetching last run:",e)}},[]),se=(0,l.useCallback)(e=>{t(e),b(null),y([]),A([]);try{localStorage.setItem(I,e)}catch(s){}},[]),{statusOptions:te,groupOptions:ae}=(0,l.useMemo)(()=>{const e={},s={};X.forEach(t=>{const a=t._status||"pending";e[a]=(e[a]||0)+1;const l=t.test_group||"unknown";s[l]=(s[l]||0)+1});return{statusOptions:Object.entries(e).sort((e,s)=>s[1]-e[1]).map(e=>{let[s,t]=e;return{value:s,label:s,count:t,color:C[s]||C.pending}}),groupOptions:Object.entries(s).sort((e,s)=>s[1]-e[1]).slice(0,20).map(e=>{let[s,t]=e;return{value:s,label:s.length>30?"..."+s.slice(-27):s,count:t,color:"#94a3b8"}})}},[X]),le=(0,l.useMemo)(()=>{let e=X;return N.length>0&&(e=e.filter(e=>N.includes(e._status))),_.length>0&&(e=e.filter(e=>_.includes(e.test_group))),e},[X,N,_]),ie=(0,l.useMemo)(()=>{const e={passed:0,failed:0,error:0,skipped:0,pending:0};return le.forEach(s=>{const t=s._status||"pending";void 0!==e[t]&&e[t]++}),e},[le]),ne=(0,l.useMemo)(()=>{let e=le;return K&&(e=e.filter(e=>e._status===K)),e},[le,K]),re=(0,l.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;L(!0),D(null);try{const s={test_ids:e||ne.map(e=>e.test_id),ssql_mode:q,snapshot_mode:V},t=await fetch("http://localhost:5050/api/tests/run",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),a=await t.json();a.error?f(a.error):(console.log("[TestsView] Run complete:",a),D(a),Q(a),Z(),$())}catch(s){f(s.message)}finally{L(!1)}},[ne,Z,q,V]),ce="all"!==s||n.trim()||K||N.length>0||_.length>0,oe=ce?"Run These (".concat(ne.length,")"):"Run All",de=(0,l.useCallback)(e=>{U(s=>s===e?null:e)},[]),he=(0,l.useMemo)(()=>{if(null===h||void 0===h||!h.daily_trends)return{passed:[],failed:[],runs:[]};return{passed:h.daily_trends.map(e=>({date:e.date,value:e.passed||0})),failed:h.daily_trends.map(e=>({date:e.date,value:(e.failed||0)+(e.errors||0)})),runs:h.daily_trends.map(e=>({date:e.date,value:e.run_count||0}))}},[h]);(0,l.useMemo)(()=>null!==h&&void 0!==h&&h.daily_trends?h.daily_trends.reduce((e,s)=>({passed:e.passed+(s.passed||0),failed:e.failed+(s.failed||0)+(s.errors||0),runs:e.runs+(s.run_count||0)}),{passed:0,failed:0,runs:0}):{passed:0,failed:0,runs:0},[h]);(0,l.useEffect)(()=>{(async()=>{await ee(),Z(),$()})()},[]),(0,l.useEffect)(()=>{Y()},[F]),(0,l.useEffect)(()=>{Y()},[s]),(0,l.useEffect)(()=>{const e=setTimeout(()=>{Y()},300);return()=>clearTimeout(e)},[n]),(0,l.useEffect)(()=>{const e=setInterval(()=>{ee(),Z(),$()},3e4);return()=>clearInterval(e)},[]);const ue=(0,l.useMemo)(()=>[{field:"_status",headerName:"Status",width:100,cellRenderer:e=>{const s=e.value||"pending",t=C[s]||C.pending;return(0,x.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[(0,x.jsx)("span",{style:{width:8,height:8,borderRadius:"50%",background:t,flexShrink:0}}),(0,x.jsx)("span",{style:{color:t,fontSize:"11px",textTransform:"capitalize"},children:s})]})}},{field:"test_id",headerName:"History",width:140,cellRenderer:e=>{const s=B[e.value]||{},t=Object.keys(s);if(0===t.length)return(0,x.jsx)("div",{className:"tests-sparkline-container",title:"No history",children:(0,x.jsx)("span",{style:{color:"#475569",fontSize:"10px"},children:"\u2014"})});const a={internal:"int",simple:"sim",extended:"ext",structure:"str",contracts:"con",anchors:"anc",deterministic:"det",full:"ful",visual:"vis"},l=["internal","simple","extended","structure","contracts","anchors","deterministic","full","visual"],i=t.sort((e,s)=>{const t=l.indexOf(e),a=l.indexOf(s);return(-1===t?999:t)-(-1===a?999:a)});return(0,x.jsx)("div",{className:"tests-sparkline-container",children:i.map(e=>{const t=s[e]||[],l=[...t].reverse(),i=t.filter(e=>"passed"===e.status).length;return(0,x.jsxs)("div",{className:"tests-sparkline-row",title:"".concat(e,": ").concat(i,"/").concat(t.length," passed"),children:[(0,x.jsx)("span",{className:"tests-sparkline-mode",children:a[e]||e.slice(0,3)}),(0,x.jsx)("div",{className:"tests-sparkline",children:l.map((e,s)=>(0,x.jsx)("span",{className:"tests-sparkline-block",style:{background:C[e.status]||C.pending}},s))})]},e)})})}},{field:"test_type",headerName:"Type",width:130,cellRenderer:e=>{const s=w[e.value]||w.all;return(0,x.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[(0,x.jsx)(r.In,{icon:s.icon,width:14,style:{color:s.color}}),(0,x.jsx)("span",{style:{color:s.color,fontSize:"11px"},children:{semantic_sql:"SQL",cascade_snapshot:"Snapshot",visual_regression:"Visual"}[e.value]||e.value})]})},hide:"all"!==s},{field:"test_name",headerName:"Name",flex:1,minWidth:200,cellStyle:{color:"#f1f5f9",fontWeight:500}},{field:"test_group",headerName:"Group",width:200,cellStyle:{fontSize:"12px",color:"#94a3b8"},valueFormatter:e=>{const s=e.value||"";return s.length>30?"..."+s.slice(-27):s}},{field:"description",headerName:"Description",flex:2,minWidth:250,cellStyle:{fontSize:"12px",color:"#64748b"},valueFormatter:e=>{const s=e.value||"";return s.length>100?s.substring(0,100)+"...":s}},{field:"source_file",headerName:"Source",width:180,cellStyle:{fontSize:"11px",color:"#64748b"},valueFormatter:e=>{const s=e.value||"";return s.length>30?"..."+s.substring(s.length-27):s}}],[s,B]),me=()=>Object.values(o).reduce((e,s)=>e+s,0),pe=(0,l.useCallback)(e=>{b(e.data)},[]),xe=(0,l.useCallback)(()=>{b(null)},[]);return(0,x.jsxs)("div",{className:"tests-view ".concat(g?"with-detail":""),children:[(0,x.jsxs)("div",{className:"tests-header",children:[(0,x.jsxs)("div",{className:"tests-header-left",children:[(0,x.jsx)(r.In,{icon:"mdi:test-tube",width:20,style:{color:"#34d399"}}),(0,x.jsx)("h1",{children:"Tests"}),(0,x.jsx)("span",{className:"tests-subtitle",children:"Test Dashboard"})]}),(0,x.jsxs)("div",{className:"tests-header-right",children:[(0,x.jsxs)("div",{className:"tests-search",children:[(0,x.jsx)(r.In,{icon:"mdi:magnify",width:16,style:{color:"#64748b"}}),(0,x.jsx)("input",{type:"text",placeholder:"Search tests...",value:n,onChange:e=>c(e.target.value),className:"tests-search-input"}),n&&(0,x.jsx)("button",{className:"tests-search-clear",onClick:()=>c(""),children:(0,x.jsx)(r.In,{icon:"mdi:close",width:14})})]}),(0,x.jsxs)("div",{className:"tests-mode-selectors",children:[(0,x.jsxs)("select",{className:"tests-mode-select",value:q,onChange:e=>G(e.target.value),title:"SQL Test Mode",children:[(0,x.jsx)("option",{value:"internal",children:"SQL: Internal"}),(0,x.jsx)("option",{value:"simple",children:"SQL: Simple"}),(0,x.jsx)("option",{value:"extended",children:"SQL: Extended"}),(0,x.jsx)("option",{value:"full",children:"SQL: Full (all 3)"})]}),(0,x.jsxs)("select",{className:"tests-mode-select",value:V,onChange:e=>J(e.target.value),title:"Snapshot Test Mode",children:[(0,x.jsx)("option",{value:"structure",children:"Snapshot: Structure"}),(0,x.jsx)("option",{value:"contracts",children:"Snapshot: Contracts"}),(0,x.jsx)("option",{value:"anchors",children:"Snapshot: Anchors"}),(0,x.jsx)("option",{value:"deterministic",children:"Snapshot: Deterministic"}),(0,x.jsx)("option",{value:"full",children:"Snapshot: Full"})]})]}),(0,x.jsxs)("button",{className:"tests-run-btn ".concat(M?"running":""," ").concat(ce?"filtered":""),onClick:()=>re(),disabled:M||0===ne.length,children:[(0,x.jsx)(r.In,{icon:M?"mdi:loading":"mdi:play",width:16,className:M?"spin":""}),(0,x.jsx)("span",{children:M?"Running...":oe})]}),(0,x.jsx)("div",{className:"tests-stats",children:(0,x.jsxs)("span",{className:"tests-stat",children:[(0,x.jsx)(r.In,{icon:"mdi:counter",width:14}),me().toLocaleString()," tests"]})})]})]}),(0,x.jsxs)("div",{className:"tests-dashboard",children:[(0,x.jsxs)("div",{className:"tests-dashboard-stats",children:[(0,x.jsx)(O,{label:"Passed",value:ie.passed.toLocaleString(),icon:"mdi:check-circle",color:"#34d399",clickable:!0,active:"passed"===K,onClick:()=>de("passed")}),(0,x.jsx)(O,{label:"Failed",value:ie.failed.toLocaleString(),icon:"mdi:close-circle",color:"#f87171",clickable:!0,active:"failed"===K,onClick:()=>de("failed")}),(0,x.jsx)(O,{label:"Error",value:ie.error.toLocaleString(),icon:"mdi:alert-circle",color:"#fb923c",clickable:!0,active:"error"===K,onClick:()=>de("error")}),(0,x.jsx)(O,{label:"Skipped",value:ie.skipped.toLocaleString(),icon:"mdi:skip-next-circle",color:"#64748b",clickable:!0,active:"skipped"===K,onClick:()=>de("skipped")}),F&&(0,x.jsx)(O,{label:"Last Run",value:"".concat(F.passed,"/").concat(F.total),icon:"mdi:clock-check",color:"passed"===F.status?"#34d399":"#f87171",subtext:"".concat(Math.round(F.duration_ms),"ms")})]}),(0,x.jsxs)("div",{className:"tests-dashboard-charts",children:[(0,x.jsx)(R,{data:he.passed,title:"Passed",icon:"mdi:check-circle",color:"#34d399",type:"area"}),(0,x.jsx)(R,{data:he.failed,title:"Failed",icon:"mdi:close-circle",color:"#f87171",type:"area"}),(0,x.jsx)(R,{data:he.runs,title:"Runs",icon:"mdi:play-circle",color:"#60a5fa",type:"bar"})]})]}),(0,x.jsx)("div",{className:"tests-tabs",children:Object.entries(w).map(e=>{let[t,a]=e;const l="all"===t?me():o[t]||0;return"all"!==t&&0===l?null:(0,x.jsxs)("button",{className:"tests-tab ".concat(s===t?"active":""),onClick:()=>se(t),children:[(0,x.jsx)(r.In,{icon:a.icon,width:14,style:{color:s===t?a.color:void 0}}),(0,x.jsx)("span",{children:a.label}),(0,x.jsx)("span",{className:"tests-tab-count",children:l})]},t)})}),X.length>0&&(0,x.jsxs)("div",{className:"tests-filter-bar",children:[(0,x.jsxs)("div",{className:"tests-filters",children:[te.length>1&&(0,x.jsx)(E,{label:"Status",options:te,selected:N,onChange:y,color:(null===(e=w[s])||void 0===e?void 0:e.color)||"#64748b"}),ae.length>1&&(0,x.jsx)(E,{label:"Group",options:ae,selected:_,onChange:A,color:"#64748b"})]}),(0,x.jsxs)("div",{className:"tests-filter-summary",children:[K&&(0,x.jsxs)("span",{className:"tests-filter-badge",style:{background:"".concat(C[K],"20"),color:C[K]},children:[K,(0,x.jsx)("button",{onClick:()=>U(null),children:(0,x.jsx)(r.In,{icon:"mdi:close",width:10})})]}),(K||N.length>0||_.length>0)&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)("span",{className:"tests-filter-showing",children:["Showing ",ne.length," of ",X.length]}),(0,x.jsxs)("button",{className:"tests-filter-clear-all",onClick:()=>{U(null),y([]),A([])},children:[(0,x.jsx)(r.In,{icon:"mdi:close",width:12}),"Clear all"]})]})]})]}),(0,x.jsxs)("div",{className:"tests-content",children:[v&&(0,x.jsxs)("div",{className:"tests-error",children:[(0,x.jsx)(r.In,{icon:"mdi:alert-circle",width:20}),(0,x.jsxs)("div",{children:[(0,x.jsx)("strong",{children:"Error loading tests"}),(0,x.jsx)("p",{children:v})]})]}),m&&!X.length&&(0,x.jsx)(p.lp,{size:"medium",message:"Loading tests...",className:"video-loader--flex"}),!m&&!v&&(0,x.jsxs)("div",{className:"tests-grid-wrapper",children:[(0,x.jsx)("div",{className:"tests-grid-container",children:0===ne.length?(0,x.jsxs)("div",{className:"tests-empty-state",children:[(0,x.jsx)(r.In,{icon:"mdi:test-tube-off",width:48,style:{color:"#64748b"}}),(0,x.jsx)("p",{children:"No tests found"}),(0,x.jsx)("span",{children:N.length>0||_.length>0?"Try adjusting your filters":n?"Try adjusting your search":"No tests discovered yet"})]}):(0,x.jsx)(i.W6,{theme:k,rowData:ne,columnDefs:ue,domLayout:"normal",suppressCellFocus:!0,enableCellTextSelection:!0,getRowHeight:e=>{const s=B[e.data.test_id]||{},t=Object.keys(s).length;return Math.max(36,20+15*Math.max(1,t))},headerHeight:40,onRowClicked:pe,rowStyle:{cursor:"pointer"},rowSelection:"single",getRowId:e=>e.data.test_id,rowClass:e=>(null===g||void 0===g?void 0:g.test_id)===e.data.test_id?"tests-row-selected":""},"grid-".concat(Object.values(B).reduce((e,s)=>e+Object.keys(s).length,0)))}),g&&(0,x.jsx)(S,{test:g,lastRun:F,onClose:xe,onRun:e=>re([e]),isRunning:M})]})]})]})}},82291:(e,s,t)=>{t.d(s,{E:()=>c});var a=t(93014),l=t(38643),i=t(52185),n=t(6026),r=t(3831),c=(0,a.gu)({chartName:"BarChart",GraphicalChild:l.y,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:i.W},{axisType:"yAxis",AxisComp:n.h}],formatAxisMap:r.pr})}}]);
//# sourceMappingURL=108.d0fd515e.chunk.js.map