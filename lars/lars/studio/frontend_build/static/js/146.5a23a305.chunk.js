(self.webpackChunklars_ui=self.webpackChunklars_ui||[]).push([[146],{4579:(e,s,t)=>{"use strict";t.d(s,{A:()=>i});var n=t(89379),a=t(65043),l=t(24227);const c=750;function i(e){const[s,t]=(0,a.useState)([]),[i,o]=(0,a.useState)(null),[r,d]=(0,a.useState)([]),[u,h]=(0,a.useState)([]),[m,p]=(0,a.useState)({}),[x,j]=(0,a.useState)({currentCell:null,currentModel:null,totalCost:0,status:"idle",cascadeId:null,cellHistory:[],turnCount:0}),[g,v]=(0,a.useState)(null),[N,_]=(0,a.useState)(null),[y,w]=(0,a.useState)(0),[f,k]=(0,a.useState)(null),[C,b]=(0,a.useState)(!1),[S,I]=(0,a.useState)(null),[O,A]=(0,a.useState)({messageCount:0,tokensIn:0,tokensOut:0,durationMs:0,startTime:null,lastActivityTime:null,roleCounts:{},modelUsage:{},modelCosts:{},recentActivity:[]}),[E,T]=(0,a.useState)({}),[M,P]=(0,a.useState)(null),[F,D]=(0,a.useState)([]),R=(0,a.useRef)("1970-01-01 00:00:00"),J=(0,a.useRef)(new Set),L=(0,a.useRef)(new Map),$=(0,a.useRef)(null),H=(0,a.useRef)(null),U=(0,a.useRef)(null);(0,a.useEffect)(()=>{e!==U.current&&(console.log("[useExplorePolling] Session changed:",U.current,"\u2192",e,"- CLEARING ALL DATA"),$.current&&(clearInterval($.current),$.current=null),H.current&&(clearInterval(H.current),H.current=null),t([]),o(null),d([]),h([]),p({}),j({currentCell:null,currentModel:null,totalCost:0,status:"idle",cascadeId:null,cellHistory:[],turnCount:0}),v(null),_(null),w(0),k(null),b(!1),I(null),A({messageCount:0,tokensIn:0,tokensOut:0,durationMs:0,startTime:null,lastActivityTime:null,roleCounts:{},modelUsage:{},modelCosts:{},recentActivity:[]}),T({}),P(null),D([]),R.current="1970-01-01 00:00:00",J.current.clear(),L.current.forEach(e=>clearTimeout(e)),L.current.clear(),U.current=e,console.log("[useExplorePolling] State cleared, ready for new session"))},[e]);const z=(0,a.useCallback)(e=>{console.log("[deriveGhostMessages] Processing",e.length,"new logs");const s=[],t={};for(const n of e){let e=null,i=null;if(n.content_json)try{const s=JSON.parse(n.content_json);s.tool&&(e=s.tool,i=s.arguments||null)}catch(c){}if(!e&&n.tool_calls_json)try{const s=JSON.parse(n.tool_calls_json);var a,l;if(Array.isArray(s)&&s.length>0)e=(null===(a=s[0].function)||void 0===a?void 0:a.name)||s[0].name,i=(null===(l=s[0].function)||void 0===l?void 0:l.arguments)||s[0].arguments}catch(c){}if(!e&&n.metadata_json)try{const s=JSON.parse(n.metadata_json);s.tool_name&&(e=s.tool_name)}catch(c){}if(console.log("[deriveGhostMessages] Log:",{role:n.role,toolName:e,node_type:n.node_type,hasContent:!!n.content_json,message_id:n.message_id}),e&&"assistant"===n.role&&(console.log("[deriveGhostMessages] Found tool_call:",e),s.push({id:n.message_id||"ghost_".concat(Date.now(),"_").concat(Math.random()),type:"tool_call",tool:e,content:n.content_json,arguments:i,timestamp:n.timestamp,createdAt:Date.now()}),t[e]=(t[e]||0)+1),"tool"===n.role){let t=e||"tool";if(!e&&n.metadata_json)try{const e=JSON.parse(n.metadata_json);t=e.tool_name||e.name||"tool"}catch(c){}console.log("[deriveGhostMessages] Found tool_result:",t),s.push({id:n.message_id||"ghost_".concat(Date.now(),"_").concat(Math.random()),type:"tool_result",tool:t,result:n.content_json,timestamp:n.timestamp,createdAt:Date.now()})}if("assistant"===n.role&&!e&&n.content_json)try{const e=JSON.parse(n.content_json),t="string"===typeof e?e:JSON.stringify(e);t.length>50&&(console.log("[deriveGhostMessages] Found thinking message, len:",t.length),s.push({id:n.message_id||"ghost_".concat(Date.now(),"_").concat(Math.random()),type:"thinking",content:t,timestamp:n.timestamp,createdAt:Date.now()}))}catch(c){n.content_json.length>50&&(console.log("[deriveGhostMessages] Found raw thinking message"),s.push({id:n.message_id||"ghost_".concat(Date.now(),"_").concat(Math.random()),type:"thinking",content:n.content_json,timestamp:n.timestamp,createdAt:Date.now()}))}}console.log("[deriveGhostMessages] Created",s.length,"new ghosts"),Object.keys(t).length>0&&p(e=>{const s=(0,n.A)({},e);for(const[n,a]of Object.entries(t))s[n]=(s[n]||0)+a;return console.log("[deriveGhostMessages] Tool counts updated:",s),s}),s.length>0&&h(e=>{const t=[...e,...s];return console.log("[deriveGhostMessages] Ghost messages now:",t.length),t})},[]),G=(0,a.useCallback)((e,s)=>{if(0===s.length&&0===e.length)return;let t=0,a=0,l=0;const c={},i={},o={},r=[];for(const n of s){if(t+=parseInt(n.tokens_in||0,10),a+=parseInt(n.tokens_out||0,10),l+=parseInt(n.duration_ms||0,10),n.role&&(c[n.role]=(c[n.role]||0)+1),n.model){i[n.model]=(i[n.model]||0)+1;const e=parseFloat(n.cost||0);e>0&&(o[n.model]=(o[n.model]||0)+e)}if("tool"===n.role||"assistant"===n.role&&n.tool_calls_json){let e=null;try{if(n.tool_calls_json){var d,u,h;const s=JSON.parse(n.tool_calls_json);e=(null===(d=s[0])||void 0===d||null===(u=d.function)||void 0===u?void 0:u.name)||(null===(h=s[0])||void 0===h?void 0:h.name)}if(!e&&n.metadata_json){const s=JSON.parse(n.metadata_json);e=s.tool_name||s.name}}catch(x){}r.push({type:"tool"===n.role?"tool_result":"tool_call",tool:e||"unknown",cell:n.cell_name,timestamp:n.timestamp})}else"render"===n.role&&r.push({type:"checkpoint",cell:n.cell_name,timestamp:n.timestamp})}const m=e[0],p=e[e.length-1]||s[s.length-1];A(e=>{const d=(0,n.A)({},e.roleCounts);for(const[s,t]of Object.entries(c))d[s]=(d[s]||0)+t;const u=(0,n.A)({},e.modelUsage);for(const[s,t]of Object.entries(i))u[s]=(u[s]||0)+t;const h=(0,n.A)({},e.modelCosts);for(const[s,t]of Object.entries(o))h[s]=(h[s]||0)+t;const x=[...e.recentActivity,...r].slice(-8);return{messageCount:e.messageCount+s.length,tokensIn:e.tokensIn+t,tokensOut:e.tokensOut+a,durationMs:e.durationMs+l,startTime:e.startTime||(null===m||void 0===m?void 0:m.timestamp),lastActivityTime:(null===p||void 0===p?void 0:p.timestamp)||e.lastActivityTime,roleCounts:d,modelUsage:u,modelCosts:h,recentActivity:x}})},[]),W=(0,a.useCallback)((e,s)=>{console.log("[updateOrchestrationState] Processing",e.length,"logs");const t=[...e].reverse().find(e=>e.cell_name||e.model);console.log("[updateOrchestrationState] Latest log:",{cell_name:null===t||void 0===t?void 0:t.cell_name,model:null===t||void 0===t?void 0:t.model,role:null===t||void 0===t?void 0:t.role});let n="idle";if(i)n="waiting_human";else{const s=e.slice(-5);s.some(e=>"tool"===e.role)?n="tool_running":s.some(e=>"assistant"===e.role)&&(n="thinking")}const a={currentCell:(null===t||void 0===t?void 0:t.cell_name)||null,currentModel:(null===t||void 0===t?void 0:t.model)||null,totalCost:(null===s||void 0===s?void 0:s.total_cost)||0,status:n,cascadeId:(null===s||void 0===s?void 0:s.cascade_id)||null};console.log("[updateOrchestrationState] New state:",a),j(a)},[i]),V=(0,a.useCallback)(async()=>{if(e)try{b(!0);const s="".concat(l.J,"/api/playground/session-stream/").concat(e,"?after=").concat(encodeURIComponent(R.current)),n=await fetch(s);if(!n.ok)throw new Error("HTTP ".concat(n.status));const a=await n.json();if(a.error)throw new Error(a.error);const c=[];for(const e of a.rows||[])e.message_id&&!J.current.has(e.message_id)&&(J.current.add(e.message_id),c.push(e));c.length>0&&(console.log("[useExplorePolling] Got new rows:",c.length),console.log("[useExplorePolling] Sample row:",c[0]),t(e=>{const s=[...e,...c];return console.log("[useExplorePolling] Total logs now:",s.length),G(s,c),s}),z(c),R.current=a.cursor||R.current),void 0===a.total_cost&&void 0===a.session_status||t(e=>(W(e,a),e)),void 0!==a.session_status&&v(a.session_status),void 0!==a.session_error&&_(a.session_error),void 0!==a.total_cost&&w(a.total_cost),a.cascade_id&&k(a.cascade_id),a.cascade_analytics&&P(a.cascade_analytics),a.cell_analytics&&Object.keys(a.cell_analytics).length>0&&T(a.cell_analytics),a.child_sessions&&a.child_sessions.length>0&&D(a.child_sessions),I(null)}catch(s){console.error("[useExplorePolling] Session logs error:",s),I(s.message)}finally{b(!1)}},[e,z,G,W]),q=(0,a.useCallback)(async()=>{if(e)try{var s,t;const n=await fetch("".concat(l.J,"/api/checkpoints?session_id=").concat(e));if(!n.ok)throw new Error("HTTP ".concat(n.status));const a=await n.json();if(console.log("[pollCheckpoint] Response:",{error:a.error,count:null===(s=a.checkpoints)||void 0===s?void 0:s.length,checkpoints:null===(t=a.checkpoints)||void 0===t?void 0:t.map(e=>({id:e.id,status:e.status}))}),!a.error&&a.checkpoints&&a.checkpoints.length>0){d(a.checkpoints);const e=a.checkpoints.find(e=>"pending"===e.status);console.log("[pollCheckpoint] Pending checkpoint:",e?e.id:"none"),o(s=>(null===e||void 0===e?void 0:e.id)!==(null===s||void 0===s?void 0:s.id)?e||null:s)}else o(e=>e?null:e)}catch(n){console.error("[useExplorePolling] Checkpoint poll error:",n)}},[e]);return(0,a.useEffect)(()=>{if(!e)return;console.log("[useExplorePolling] Setting up polling for session:",e),V(),q();const s=setInterval(()=>{V()},c),t=setInterval(()=>{q()},c);return console.log("[useExplorePolling] Intervals set up"),()=>{console.log("[useExplorePolling] Cleanup: clearing intervals for session:",e),clearInterval(s),clearInterval(t),L.current.forEach(e=>clearTimeout(e)),L.current.clear()}},[e]),(0,a.useEffect)(()=>{if(("completed"===g||"cancelled"===g)&&e){const e=setTimeout(()=>{console.log("[useExplorePolling] Session completed, stopping polls"),$.current&&(clearInterval($.current),$.current=null),H.current&&(clearInterval(H.current),H.current=null)},1e4);return()=>clearTimeout(e)}},[g,e]),{logs:s,checkpoint:i,checkpointHistory:r,ghostMessages:u,orchestrationState:x,toolCounts:m,sessionStatus:g,sessionError:N,totalCost:y,cascadeId:f,sessionStats:O,cellAnalytics:E,cascadeAnalytics:M,childSessions:F,isPolling:C,error:S,refresh:()=>{V(),q()},clearGhosts:()=>{h([]),L.current.forEach(e=>clearTimeout(e)),L.current.clear()}}}},13218:e=>{"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},41497:(e,s,t)=>{"use strict";var n=t(13218);function a(){}function l(){}l.resetWarningCache=a,e.exports=function(){function e(e,s,t,a,l,c){if(c!==n){var i=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw i.name="Invariant Violation",i}}function s(){return e}e.isRequired=e;var t={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:s,element:e,elementType:e,instanceOf:s,node:e,objectOf:s,oneOf:s,oneOfType:s,shape:s,exact:s,checkPropTypes:l,resetWarningCache:a};return t.PropTypes=t,t}},51492:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>y});var n=t(65043),a=t(45685),l=t(59570),c=t(38491),i=t(5748),o=t(64065),r=t(92667),d=t(82172),u=t(8861),h=t(10777),m=t(70579);const p=e=>{let{sessionId:s,cascadeId:t,orchestrationState:a,totalCost:l,sessionStatus:c,toolCounts:o={},sessionStats:r={},cellAnalytics:d={},cascadeAnalytics:p=null,childSessions:x=[],onEnd:j,onNewCascade:g}=e;const v={running:{color:"cyan",icon:"mdi:play-circle",label:"Running"},blocked:{color:"yellow",icon:"mdi:hand-back-right",label:"Waiting"},completed:{color:"green",icon:"mdi:check-circle",label:"Complete"},cancelled:{color:"gray",icon:"mdi:cancel",label:"Cancelled"},error:{color:"red",icon:"mdi:alert-circle",label:"Error"},orphaned:{color:"orange",icon:"mdi:ghost",label:"Orphaned"}}[c]||{color:"gray",icon:"mdi:circle",label:"Idle"},N="running"===c||"blocked"===c,_=(0,n.useMemo)(()=>d&&0!==Object.keys(d).length?Object.entries(d).map(e=>{let[s,t]=e;return{name:s,cost:t.cell_cost||0,duration:t.cell_duration_ms||0,costPct:t.cell_cost_pct||0,durationPct:t.cell_duration_pct||0,isCostOutlier:t.is_cost_outlier,isDurationOutlier:t.is_duration_outlier}}).sort((e,s)=>s.costPct-e.costPct):[],[d]),y=e=>!e||e<1e3?"".concat(Math.round(e||0),"ms"):e<6e4?"".concat((e/1e3).toFixed(1),"s"):"".concat((e/6e4).toFixed(1),"m"),w=e=>e?e<1e3?String(e):e<1e6?"".concat((e/1e3).toFixed(1),"k"):"".concat((e/1e6).toFixed(2),"M"):"0",f=(0,n.useMemo)(()=>{if(!r.startTime)return null;const e=new Date(r.startTime);return(r.lastActivityTime?new Date(r.lastActivityTime):new Date)-e},[r.startTime,r.lastActivityTime]),k=e=>{switch(e){case"tool_call":return"mdi:arrow-right-bold";case"tool_result":return"mdi:check";case"checkpoint":return"mdi:checkbox-marked-circle";default:return"mdi:circle"}},C=e=>{switch(e){case"tool_call":return"#60a5fa";case"tool_result":return"#34d399";case"checkpoint":return"#fbbf24";default:return"#94a3b8"}};return(0,m.jsxs)("div",{className:"simple-sidebar",children:[(0,m.jsxs)("div",{className:"sidebar-header",children:[(0,m.jsx)("div",{className:"sidebar-status",children:(0,m.jsx)(h.A,{variant:"status",color:v.color,icon:v.icon,pulse:N,size:"sm",children:v.label})}),(0,m.jsx)("div",{className:"cascade-name",children:t||"Cascade"})]}),(0,m.jsxs)("div",{className:"session-id-row",children:[(0,m.jsx)(i.In,{icon:"mdi:identifier",width:"12"}),(0,m.jsx)("span",{title:s,children:s?s.slice(0,20)+(s.length>20?"...":""):"-"})]}),(0,m.jsxs)("div",{className:"stats-grid",children:[(0,m.jsxs)("div",{className:"stat-item stat-cost",children:[(0,m.jsxs)("div",{className:"stat-value",children:["$",(l||0).toFixed(4)]}),(0,m.jsx)("div",{className:"stat-label",children:"Cost"})]}),(0,m.jsxs)("div",{className:"stat-item stat-messages",children:[(0,m.jsx)("div",{className:"stat-value",children:r.messageCount||0}),(0,m.jsx)("div",{className:"stat-label",children:"Messages"})]}),(0,m.jsxs)("div",{className:"stat-item stat-tokens",children:[(0,m.jsx)("div",{className:"stat-value",children:w((r.tokensIn||0)+(r.tokensOut||0))}),(0,m.jsx)("div",{className:"stat-label",children:"Tokens"})]}),(0,m.jsxs)("div",{className:"stat-item stat-time",children:[(0,m.jsx)("div",{className:"stat-value",children:f?y(f):"-"}),(0,m.jsx)("div",{className:"stat-label",children:"Elapsed"})]})]}),a.currentCell&&(0,m.jsxs)("div",{className:"current-execution",children:[(0,m.jsxs)("div",{className:"exec-header",children:[(0,m.jsx)(i.In,{icon:"mdi:play",width:"12"}),(0,m.jsx)("span",{children:"Executing"})]}),(0,m.jsx)("div",{className:"exec-cell",children:a.currentCell}),a.currentModel&&(0,m.jsx)("div",{className:"exec-model",children:a.currentModel.split("/").pop()})]}),r.recentActivity&&r.recentActivity.length>0&&(0,m.jsxs)("div",{className:"activity-feed",children:[(0,m.jsxs)("div",{className:"section-header",children:[(0,m.jsx)(i.In,{icon:"mdi:pulse",width:"14"}),(0,m.jsx)("span",{children:"Activity"})]}),(0,m.jsx)("div",{className:"activity-list",children:r.recentActivity.slice(-5).reverse().map((e,s)=>(0,m.jsxs)("div",{className:"activity-item",children:[(0,m.jsx)(i.In,{icon:k(e.type),width:"12",style:{color:C(e.type)}}),(0,m.jsx)("span",{className:"activity-text",children:"checkpoint"===e.type?"Checkpoint":e.tool}),e.cell&&(0,m.jsxs)("span",{className:"activity-cell",children:["@",e.cell]})]},s))})]}),(r.tokensIn>0||r.tokensOut>0)&&(0,m.jsxs)("div",{className:"token-breakdown",children:[(0,m.jsxs)("div",{className:"section-header",children:[(0,m.jsx)(i.In,{icon:"mdi:counter",width:"14"}),(0,m.jsx)("span",{children:"Tokens"})]}),(0,m.jsxs)("div",{className:"token-bar-container",children:[(0,m.jsx)("div",{className:"token-bar token-bar-in",style:{width:"".concat(r.tokensIn/Math.max(r.tokensIn+r.tokensOut,1)*100,"%")}}),(0,m.jsx)("div",{className:"token-bar token-bar-out",style:{width:"".concat(r.tokensOut/Math.max(r.tokensIn+r.tokensOut,1)*100,"%")}})]}),(0,m.jsxs)("div",{className:"token-labels",children:[(0,m.jsxs)("span",{className:"token-in",children:[w(r.tokensIn)," in"]}),(0,m.jsxs)("span",{className:"token-out",children:[w(r.tokensOut)," out"]})]})]}),r.modelUsage&&Object.keys(r.modelUsage).length>0&&(0,m.jsxs)("div",{className:"model-usage",children:[(0,m.jsxs)("div",{className:"section-header",children:[(0,m.jsx)(i.In,{icon:"mdi:brain",width:"14"}),(0,m.jsx)("span",{children:"Models"}),r.modelCosts&&Object.keys(r.modelCosts).length>0&&(0,m.jsxs)("span",{className:"section-total",children:["$",Object.values(r.modelCosts).reduce((e,s)=>e+s,0).toFixed(4)]})]}),(0,m.jsx)("div",{className:"model-list",children:(()=>{const e=r.modelCosts||{},s=Math.max(...Object.values(e),1e-4);return Object.entries(r.modelUsage).sort((s,t)=>(e[t[0]]||0)-(e[s[0]]||0)).slice(0,4).map(t=>{let[n,a]=t;const l=e[n]||0,c=l/s*100;return(0,m.jsxs)("div",{className:"model-item",children:[(0,m.jsxs)("div",{className:"model-info",children:[(0,m.jsx)("span",{className:"model-name",title:n,children:n}),(0,m.jsxs)("span",{className:"model-stats",children:[(0,m.jsxs)("span",{className:"model-count",children:[a,"\xd7"]}),l>0&&(0,m.jsxs)("span",{className:"model-cost",children:["$",l.toFixed(4)]})]})]}),l>0&&(0,m.jsx)("div",{className:"model-bar-container",children:(0,m.jsx)("div",{className:"model-bar",style:{width:"".concat(c,"%")}})})]},n)})})()})]}),Object.keys(o).length>0&&(0,m.jsxs)("div",{className:"tool-activity",children:[(0,m.jsxs)("div",{className:"section-header",children:[(0,m.jsx)(i.In,{icon:"mdi:hammer-wrench",width:"14"}),(0,m.jsx)("span",{children:"Tools"}),(0,m.jsx)("span",{className:"section-total",children:Object.values(o).reduce((e,s)=>e+s,0)})]}),(0,m.jsx)("div",{className:"tool-list",children:Object.entries(o).sort((e,s)=>s[1]-e[1]).slice(0,6).map(e=>{let[s,t]=e;const n=t/Math.max(...Object.values(o))*100;return(0,m.jsxs)("div",{className:"tool-item",children:[(0,m.jsx)("span",{className:"tool-name",children:s}),(0,m.jsx)("div",{className:"tool-bar-container",children:(0,m.jsx)("div",{className:"tool-bar",style:{width:"".concat(n,"%")}})}),(0,m.jsx)("span",{className:"tool-count",children:t})]},s)})})]}),_.length>0&&(0,m.jsxs)("div",{className:"cell-progress",children:[(0,m.jsxs)("div",{className:"section-header",children:[(0,m.jsx)(i.In,{icon:"mdi:chart-timeline-variant",width:"14"}),(0,m.jsx)("span",{children:"Cells"})]}),(0,m.jsx)("div",{className:"cell-list",children:_.slice(0,5).map(e=>(0,m.jsxs)("div",{className:"cell-item ".concat(e.isCostOutlier?"cost-outlier":""," ").concat(e.isDurationOutlier?"duration-outlier":""),children:[(0,m.jsxs)("div",{className:"cell-header",children:[(0,m.jsx)("span",{className:"cell-name",children:e.name}),(e.isCostOutlier||e.isDurationOutlier)&&(0,m.jsx)(i.In,{icon:"mdi:alert",width:"12",className:"outlier-icon"})]}),(0,m.jsxs)("div",{className:"cell-metrics",children:[(0,m.jsxs)("span",{className:"cell-cost",children:["$",e.cost.toFixed(4)]}),(0,m.jsx)("span",{className:"cell-duration",children:y(e.duration)})]}),(0,m.jsx)("div",{className:"cell-bar-container",children:(0,m.jsx)("div",{className:"cell-bar",style:{width:"".concat(e.costPct,"%")},title:"".concat(e.costPct.toFixed(1),"% of cost")})})]},e.name))})]}),p&&(p.is_cost_outlier||p.is_duration_outlier)&&(0,m.jsxs)("div",{className:"analytics-insights",children:[(0,m.jsxs)("div",{className:"section-header",children:[(0,m.jsx)(i.In,{icon:"mdi:lightbulb-on",width:"14"}),(0,m.jsx)("span",{children:"Insights"})]}),(0,m.jsxs)("div",{className:"insights-list",children:[p.is_cost_outlier&&(0,m.jsxs)("div",{className:"insight-item insight-warning",children:[(0,m.jsx)(i.In,{icon:"mdi:currency-usd",width:"12"}),(0,m.jsxs)("span",{children:["Cost ",p.cost_z_score>0?"above":"below"," average"]})]}),p.is_duration_outlier&&(0,m.jsxs)("div",{className:"insight-item insight-warning",children:[(0,m.jsx)(i.In,{icon:"mdi:clock-alert",width:"12"}),(0,m.jsxs)("span",{children:["Duration ",p.duration_z_score>0?"above":"below"," average"]})]})]})]}),x.length>0&&(0,m.jsxs)("div",{className:"child-sessions",children:[(0,m.jsxs)("div",{className:"section-header",children:[(0,m.jsx)(i.In,{icon:"mdi:source-branch",width:"14"}),(0,m.jsx)("span",{children:"Sub-cascades"}),(0,m.jsx)("span",{className:"section-total",children:x.length})]}),(0,m.jsx)("div",{className:"child-list",children:x.slice(0,3).map(e=>(0,m.jsxs)("div",{className:"child-item",children:[(0,m.jsx)("span",{className:"child-cell",children:e.parent_cell||"spawn"}),(0,m.jsxs)("span",{className:"child-id",children:[e.session_id.slice(0,12),"..."]})]},e.session_id))})]}),r.roleCounts&&Object.keys(r.roleCounts).length>0&&(0,m.jsxs)("div",{className:"role-distribution",children:[(0,m.jsxs)("div",{className:"section-header",children:[(0,m.jsx)(i.In,{icon:"mdi:chart-pie",width:"14"}),(0,m.jsx)("span",{children:"Messages"})]}),(0,m.jsx)("div",{className:"role-chips",children:Object.entries(r.roleCounts).filter(e=>{let[s]=e;return["assistant","user","tool"].includes(s)}).map(e=>{let[s,t]=e;return(0,m.jsxs)("span",{className:"role-chip role-".concat(s),children:[s,": ",t]},s)})})]}),c&&(0,m.jsx)("div",{className:"status-indicator status-".concat(c),children:(0,m.jsxs)("div",{className:"status-indicator-content",children:["running"===c&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("div",{className:"status-spinner",children:(0,m.jsx)(i.In,{icon:"mdi:loading",width:"24",className:"spinning"})}),(0,m.jsxs)("div",{className:"status-text",children:[(0,m.jsx)("span",{className:"status-label",children:"Working"}),(0,m.jsx)("span",{className:"status-detail",children:a.currentCell||"Processing..."})]})]}),"blocked"===c&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("div",{className:"status-pulse",children:(0,m.jsx)(i.In,{icon:"mdi:hand-back-right",width:"24"})}),(0,m.jsxs)("div",{className:"status-text",children:[(0,m.jsx)("span",{className:"status-label",children:"Waiting for Input"}),(0,m.jsx)("span",{className:"status-detail",children:a.currentCell||"Human response needed"})]})]}),"completed"===c&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("div",{className:"status-check",children:(0,m.jsx)(i.In,{icon:"mdi:check-circle",width:"24"})}),(0,m.jsxs)("div",{className:"status-text",children:[(0,m.jsx)("span",{className:"status-label",children:"Complete"}),(0,m.jsx)("span",{className:"status-detail",children:"Cascade finished successfully"})]})]}),"error"===c&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("div",{className:"status-error",children:(0,m.jsx)(i.In,{icon:"mdi:alert-circle",width:"24"})}),(0,m.jsxs)("div",{className:"status-text",children:[(0,m.jsx)("span",{className:"status-label",children:"Error"}),(0,m.jsx)("span",{className:"status-detail",children:"Cascade encountered an error"})]})]}),"cancelled"===c&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("div",{className:"status-cancelled",children:(0,m.jsx)(i.In,{icon:"mdi:cancel",width:"24"})}),(0,m.jsxs)("div",{className:"status-text",children:[(0,m.jsx)("span",{className:"status-label",children:"Cancelled"}),(0,m.jsx)("span",{className:"status-detail",children:"Cascade was stopped"})]})]}),"orphaned"===c&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("div",{className:"status-orphaned",children:(0,m.jsx)(i.In,{icon:"mdi:ghost",width:"24"})}),(0,m.jsxs)("div",{className:"status-text",children:[(0,m.jsx)("span",{className:"status-label",children:"Orphaned"}),(0,m.jsx)("span",{className:"status-detail",children:"Session lost connection"})]})]})]})}),(0,m.jsxs)("div",{className:"sidebar-actions",children:[c&&!["completed","cancelled","error","orphaned"].includes(c)&&j&&(0,m.jsx)(u.A,{variant:"danger",size:"sm",icon:"mdi:stop-circle",onClick:j,children:"End"}),["completed","cancelled","error","orphaned"].includes(c)&&g&&(0,m.jsx)(u.A,{variant:"primary",size:"sm",icon:"mdi:plus-circle",onClick:g,children:"New Cascade"})]})]})};var x=t(89379),j=t(24227);const g=e=>{let{isOpen:s,onClose:t,onStart:a}=e;const[l,c]=(0,n.useState)("start"),[r,d]=(0,n.useState)([]),[u,h]=(0,n.useState)([]),[p,g]=(0,n.useState)(!0),[v,N]=(0,n.useState)(null),[_,y]=(0,n.useState)(null),[w,f]=(0,n.useState)({}),[k,C]=(0,n.useState)(""),b=n.useRef({start:!1,resume:!1});(0,n.useEffect)(()=>{s?"start"!==l||b.current.start?"resume"!==l||b.current.resume||(b.current.resume=!0,I()):(b.current.start=!0,S()):b.current={start:!1,resume:!1}},[s,l]);const S=async()=>{g(!0);try{const e=await fetch("".concat(j.J,"/api/cascade-definitions")),s=await e.json();if(s.error)return void N(s.error);const t=(Array.isArray(s)?s:[]).filter(e=>e.cascade_file&&!0===e.explorer).sort((e,s)=>(s.latest_run||"").localeCompare(e.latest_run||""));d(t),N(null)}catch(e){N(e.message)}finally{g(!1)}},I=async()=>{g(!0);try{const e=await fetch("".concat(j.J,"/api/sessions?limit=50")),s=await e.json();if(s.error)return void N(s.error);const t=Date.now(),n=864e5,a=(s.sessions||[]).filter(e=>{if("running"===e.status||"blocked"===e.status)return!0;if(!e.started_at)return!1;const s=new Date(e.started_at).getTime();return t-s<n}).sort((e,s)=>(s.updated_at||s.started_at||"").localeCompare(e.updated_at||e.started_at||""));h(a),N(null)}catch(e){N(e.message)}finally{g(!1)}},O=r.filter(e=>{var s,t,n;if(!k.trim())return!0;const a=k.toLowerCase(),l=null===(s=e.cascade_id)||void 0===s?void 0:s.toLowerCase().includes(a),c=null===(t=e.description)||void 0===t?void 0:t.toLowerCase().includes(a),i=null===(n=e.cascade_file)||void 0===n?void 0:n.toLowerCase().includes(a);return l||c||i});return(0,m.jsxs)(o.aF,{isOpen:s,onClose:t,size:"lg",children:[(0,m.jsx)(o.rQ,{title:"start"===l?"Start New Cascade":"Resume Session",subtitle:"start"===l?"Choose a cascade to run":"Jump back into a recent session",icon:"mdi:compass"}),(0,m.jsxs)(o.$m,{children:[!_&&(0,m.jsxs)("div",{className:"mode-tabs",children:[(0,m.jsxs)("button",{className:"mode-tab ".concat("start"===l?"active":""),onClick:()=>c("start"),children:[(0,m.jsx)(i.In,{icon:"mdi:plus-circle",width:"16"}),"Start New"]}),(0,m.jsxs)("button",{className:"mode-tab ".concat("resume"===l?"active":""),onClick:()=>c("resume"),children:[(0,m.jsx)(i.In,{icon:"mdi:restore",width:"16"}),"Resume (",u.length,")"]})]}),"start"===l&&!_&&(0,m.jsxs)(m.Fragment,{children:[p&&(0,m.jsxs)("div",{className:"picker-loading",children:[(0,m.jsx)(i.In,{icon:"mdi:loading",className:"spinning",width:"32"}),(0,m.jsx)("p",{children:"Loading cascades..."})]}),v&&(0,m.jsxs)("div",{className:"picker-error",children:[(0,m.jsx)(i.In,{icon:"mdi:alert-circle",width:"24"}),(0,m.jsx)("p",{children:v})]}),!p&&!v&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)("div",{className:"cascade-search",children:[(0,m.jsx)(i.In,{icon:"mdi:magnify",width:"20"}),(0,m.jsx)("input",{type:"text",placeholder:"Search cascades by name, description, or path...",value:k,onChange:e=>C(e.target.value),autoFocus:!0}),k&&(0,m.jsx)("button",{className:"search-clear",onClick:()=>C(""),title:"Clear search",children:(0,m.jsx)(i.In,{icon:"mdi:close",width:"16"})})]}),(0,m.jsxs)("div",{className:"cascade-count",children:[O.length," of ",r.length," cascades"]}),O.length>0?(0,m.jsx)("div",{className:"cascade-grid",children:O.map(e=>(0,m.jsxs)("div",{className:"cascade-card",onClick:()=>(e=>{y(e);const s={};e.inputs_schema&&Object.keys(e.inputs_schema).forEach(e=>{s[e]=""}),f(s)})(e),children:[(0,m.jsxs)("div",{className:"cascade-card-header",children:[(0,m.jsx)(i.In,{icon:"mdi:file-code",width:"20"}),(0,m.jsx)("span",{className:"cascade-name",children:e.cascade_id})]}),e.description&&(0,m.jsx)("p",{className:"cascade-description",children:e.description}),e.metrics&&e.metrics.run_count>0&&(0,m.jsxs)("div",{className:"cascade-stats",children:[(0,m.jsxs)("span",{children:[e.metrics.run_count," runs"]}),(0,m.jsxs)("span",{children:["$",(e.metrics.total_cost||0).toFixed(4)]})]})]},e.cascade_id))}):(0,m.jsxs)("div",{className:"cascade-no-results",children:[(0,m.jsx)(i.In,{icon:"mdi:magnify-close",width:"48"}),(0,m.jsxs)("p",{children:['No cascades match "',k,'"']}),(0,m.jsx)(o.$n,{variant:"ghost",size:"sm",onClick:()=>C(""),children:"Clear search"})]})]})]}),"resume"===l&&(0,m.jsxs)(m.Fragment,{children:[p&&(0,m.jsxs)("div",{className:"picker-loading",children:[(0,m.jsx)(i.In,{icon:"mdi:loading",className:"spinning",width:"32"}),(0,m.jsx)("p",{children:"Loading sessions..."})]}),v&&(0,m.jsxs)("div",{className:"picker-error",children:[(0,m.jsx)(i.In,{icon:"mdi:alert-circle",width:"24"}),(0,m.jsx)("p",{children:v})]}),!p&&!v&&(0,m.jsx)(m.Fragment,{children:u.length>0?(0,m.jsx)("div",{className:"session-list",children:u.map(e=>{const s={running:{color:"cyan",icon:"mdi:play-circle",label:"Running"},blocked:{color:"yellow",icon:"mdi:hand-back-right",label:"Waiting"},completed:{color:"green",icon:"mdi:check-circle",label:"Complete"},error:{color:"red",icon:"mdi:alert-circle",label:"Error"}}[n=e.status]||{color:"gray",icon:"mdi:circle",label:n};var n;return(0,m.jsxs)("div",{className:"session-card",onClick:()=>(e=>{a(null,null,e.session_id),t()})(e),children:[(0,m.jsxs)("div",{className:"session-card-header",children:[(0,m.jsx)(i.In,{icon:"mdi:history",width:"20"}),(0,m.jsx)("span",{className:"session-cascade",children:e.cascade_id}),(0,m.jsx)(o.Ex,{variant:"status",color:s.color,icon:s.icon,size:"sm",children:s.label})]}),(0,m.jsxs)("div",{className:"session-info",children:[(0,m.jsxs)("div",{className:"session-meta",children:[(0,m.jsx)("span",{className:"session-id",children:e.session_id}),(0,m.jsx)("span",{className:"session-time",children:new Date(e.started_at).toLocaleString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),e.current_cell&&(0,m.jsxs)("div",{className:"session-cell",children:["Cell: ",e.current_cell]}),(0,m.jsxs)("div",{className:"session-stats",children:[(0,m.jsxs)("span",{children:["$",(e.total_cost||0).toFixed(4)]}),(0,m.jsxs)("span",{children:[e.message_count||0," messages"]})]})]})]},e.session_id)})}):(0,m.jsxs)("div",{className:"session-empty",children:[(0,m.jsx)(i.In,{icon:"mdi:history-off",width:"48"}),(0,m.jsx)("p",{children:"No recent sessions"}),(0,m.jsx)(o.$n,{variant:"ghost",size:"sm",onClick:()=>c("start"),children:"Start a new cascade"})]})})]}),_&&(0,m.jsxs)("div",{className:"cascade-input-form",children:[(0,m.jsxs)("div",{className:"selected-cascade-header",children:[(0,m.jsx)(o.$n,{variant:"ghost",size:"sm",icon:"mdi:arrow-left",onClick:()=>y(null),children:"Back"}),(0,m.jsx)("h3",{children:_.cascade_id})]}),_.inputs_schema&&Object.keys(_.inputs_schema).length>0?(0,m.jsx)("div",{className:"input-fields",children:Object.entries(_.inputs_schema).map(e=>{let[s,t]=e;return(0,m.jsxs)("div",{className:"input-field",children:[(0,m.jsx)("label",{children:s}),(0,m.jsx)("p",{className:"input-description",children:t}),(0,m.jsx)("input",{type:"text",value:w[s]||"",onChange:e=>((e,s)=>{f(t=>(0,x.A)((0,x.A)({},t),{},{[e]:s}))})(s,e.target.value),placeholder:"Enter ".concat(s,"...")})]},s)})}):(0,m.jsx)("p",{className:"no-inputs",children:"No inputs required for this cascade"})]})]}),(0,m.jsxs)(o.jl,{children:[(0,m.jsx)(o.$n,{variant:"secondary",onClick:t,children:"Cancel"}),_&&(0,m.jsx)(o.$n,{variant:"primary",onClick:()=>{_&&(a(_.cascade_file,w),t())},icon:"mdi:play",children:"Run Cascade"})]})]})};var v=t(4579),N=t(60957),_=t(60263);const y=()=>{const{sessionId:e}=(0,a.g)(),s=(0,a.Zp)(),t=e?decodeURIComponent(e):null,{showToast:u}=(0,o.dj)(),[h,x]=(0,n.useState)(!t),[y,w]=(0,n.useState)(null),[f,k]=(0,n.useState)(null),C=(0,n.useCallback)(e=>{e&&e.context_hashes&&e.context_hashes.length>0?w(e):w(null)},[]),b=(0,n.useCallback)(()=>{w(null)},[]),S=(0,n.useCallback)(e=>{k(e)},[]),I=(0,n.useCallback)(e=>{console.log("[ExploreView] Navigate to message index:",e)},[]),O=n.useRef(!1);n.useEffect(()=>{if(t||O.current)return;O.current=!0;const e=localStorage.getItem("explore_last_session"),n=localStorage.getItem("explore_last_session_time");if(!e||!n)return void x(!0);if(Date.now()-parseInt(n,10)>=36e5)return console.log("[ExploreView] Session expired (>1h), showing picker"),void x(!0);fetch("".concat(j.J,"/api/sessions?limit=100")).then(e=>e.json()).then(t=>{var n;const a=null===(n=t.sessions)||void 0===n?void 0:n.find(s=>s.session_id===e);if(!a)return console.log("[ExploreView] Session not found, showing picker"),void x(!0);"running"===a.status||"blocked"===a.status?(console.log("[ExploreView] Auto-restoring active session:",e),s(_.bw.exploreWithSession(e)),x(!1)):(console.log("[ExploreView] Session is",a.status,"- showing picker for new cascade"),x(!0))}).catch(e=>{console.error("[ExploreView] Failed to validate session:",e),x(!0)})},[]);const{logs:A,checkpoint:E,orchestrationState:T,sessionStatus:M,sessionError:P,totalCost:F,cascadeId:D,toolCounts:R,sessionStats:J,cellAnalytics:L,cascadeAnalytics:$,childSessions:H,isPolling:U,error:z}=(0,v.A)(t);n.useEffect(()=>{t&&(localStorage.setItem("explore_last_session",t),localStorage.setItem("explore_last_session_time",Date.now().toString()),console.log("[ExploreView] Persisted session to localStorage:",t))},[t]);const G=async function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(n)return s(_.bw.exploreWithSession(n)),x(!1),void u("Resumed session",{type:"success"});try{const n=await fetch("".concat(j.J,"/api/run-cascade"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cascade_path:e,inputs:t})}),a=await n.json();if(a.error)return void u(a.error,{type:"error"});s(_.bw.exploreWithSession(a.session_id)),x(!1),u("Cascade started",{type:"success"})}catch(a){u("Failed to start: ".concat(a.message),{type:"error"})}};return t?U&&0===A.length?(0,m.jsx)(o.lp,{size:"large",message:"Loading session..."}):z?(0,m.jsxs)("div",{className:"explore-view-error",children:[(0,m.jsx)(i.In,{icon:"mdi:alert-circle",width:"32"}),(0,m.jsx)("h3",{children:"Error loading session"}),(0,m.jsx)("p",{children:z}),(0,m.jsx)(o.$n,{variant:"secondary",onClick:()=>s(_.bw.STUDIO),children:"Back to Studio"})]}):(0,m.jsxs)("div",{className:"explore-view",children:[(0,m.jsx)(g,{isOpen:h,onClose:()=>x(!1),onStart:G}),(0,m.jsxs)("div",{className:"explore-header",children:[(0,m.jsxs)("div",{className:"explore-header-left",children:[(0,m.jsx)(i.In,{icon:"mdi:compass",width:"24"}),(0,m.jsx)("h1",{children:"Explore"})]}),(0,m.jsx)(o.$n,{variant:"primary",size:"sm",icon:"mdi:plus-circle",onClick:()=>{localStorage.removeItem("explore_last_session"),localStorage.removeItem("explore_last_session_time"),x(!0)},children:"New Cascade"})]}),(0,m.jsxs)("div",{className:"explore-layout ".concat(y?"with-context-explorer":""),children:[(0,m.jsx)(l.N,{children:y&&(0,m.jsx)(c.P.div,{className:"explore-context-sidebar",initial:{opacity:0,x:-320,width:0},animate:{opacity:1,x:0,width:360},exit:{opacity:0,x:-320,width:0},transition:{duration:.3,ease:"easeOut"},children:(0,m.jsx)(d.A,{selectedMessage:y,allLogs:A,hoveredHash:f,onHoverHash:S,onClose:b,onNavigateToMessage:I,cascadeAnalytics:$,cellAnalytics:L})})}),(0,m.jsx)("div",{className:"explore-main-column",children:(0,m.jsxs)("div",{className:"explore-main-content",children:[(0,m.jsx)("div",{className:"explore-messages-log",children:(0,m.jsx)(r.A,{logs:A,currentSessionId:t,showFilters:!1,showCellColumn:!0,compact:!0,className:"explore-session-log",shouldPollBudget:!1,onMessageClick:C,hoveredHash:f,onHoverHash:S,externalSelectedMessage:y})}),E&&(0,m.jsxs)(c.P.div,{className:"current-checkpoint",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4},children:[(0,m.jsxs)("div",{className:"checkpoint-label",children:[(0,m.jsx)(i.In,{icon:"mdi:hand-back-right",width:"16"}),(0,m.jsx)("span",{children:"Human Input Required"})]}),(0,m.jsx)(o.cT,{checkpoint:E,onSubmit:async e=>{if(E)try{const s=await fetch("".concat(j.J,"/api/checkpoints/").concat(E.id,"/respond"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({response:e})}),t=await s.json();if(t.error)return void u("Failed: ".concat(t.error),{type:"error"});u("Response submitted",{type:"success"})}catch(s){u("Error: ".concat(s.message),{type:"error"})}},variant:"inline",showCellOutput:!0})]}),!E&&0===A.length&&(0,m.jsxs)("div",{className:"explore-empty",children:[(0,m.jsx)(i.In,{icon:"completed"===M?"mdi:check-circle":"mdi:compass",width:"64",className:"running"===M?"spinning-slow":""}),(0,m.jsxs)("h2",{children:["running"===M&&"Cascade Active","completed"===M&&"Cascade Complete","error"===M&&"Cascade Error","cancelled"===M&&"Cascade Cancelled",!M&&"Waiting for Activity"]}),(0,m.jsxs)("p",{children:["running"===M&&"Activity will appear here as the cascade executes.","completed"===M&&"All done! Start a new cascade to continue.","error"===M&&P,"cancelled"===M&&"This cascade was cancelled.",!M&&"Start a cascade to begin."]}),("completed"===M||"cancelled"===M||"error"===M)&&(0,m.jsx)(o.$n,{variant:"primary",icon:"mdi:plus",onClick:()=>{localStorage.removeItem("explore_last_session"),localStorage.removeItem("explore_last_session_time"),x(!0)},children:"New Cascade"})]})]})}),(0,m.jsx)(p,{sessionId:t,cascadeId:D,orchestrationState:T,totalCost:F,sessionStatus:M,toolCounts:R,sessionStats:J,cellAnalytics:L,cascadeAnalytics:$,childSessions:H,onEnd:async()=>{if(!window.confirm("Stop this cascade? This will cancel execution immediately."))return;const e=await(0,N.tn)(t,"User cancelled from ExploreView",!1);if(e.success){const s=e.forced?"Session terminated (was zombie/dead)":"Cancellation requested";u(s,{type:"success"}),e.forced&&setTimeout(()=>{window.location.reload()},1e3)}else u("Failed to cancel: ".concat(e.error),{type:"error"})},onNewCascade:()=>x(!0)})]})]}):(0,m.jsxs)("div",{className:"explore-view",children:[(0,m.jsx)(g,{isOpen:h,onClose:()=>s(_.bw.STUDIO),onStart:G}),(0,m.jsxs)("div",{className:"explore-empty-state",children:[(0,m.jsx)(i.In,{icon:"mdi:compass",width:"64"}),(0,m.jsx)("h2",{children:"No Session Selected"}),(0,m.jsx)("p",{children:"Select a cascade to start exploring"}),(0,m.jsx)(o.$n,{variant:"primary",icon:"mdi:plus",onClick:()=>x(!0),children:"Start Cascade"})]})]})}},65173:(e,s,t)=>{e.exports=t(41497)()}}]);
//# sourceMappingURL=146.5a23a305.chunk.js.map