"use strict";(self.webpackChunklars_ui=self.webpackChunklars_ui||[]).push([[225],{73108:(e,s,n)=>{n.r(s),n.d(s,{default:()=>H});var i=n(65043),t=n(45685),a=n(24768),l=n(5748),o=n(89379),c=n(35427),r=n(55267),d=n(28533),h=n(44508),m=n(63577),u=n.n(m),p=n(64065),x=(n(96299),n(70579));const j={promptNode:function(e){var s;let{data:n}=e;const[t,a]=(0,i.useState)(!1),l=(null===(s=n.prompt)||void 0===s?void 0:s.length)>150?n.prompt.substring(0,150)+"...":n.prompt,o=["prompt-node",n.is_winner?"winner":"",n.is_current_session?"current-session":"",n.is_future?"future":"",n.in_training_set?"in-training":"",n.isHighlighted?"highlighted":""].filter(Boolean).join(" "),r={rewrite:"#9333ea",augment:"#0ea5e9",approach:"#f59e0b",null:"#475569"},d=r[n.mutation_type]||r.null,h=["#34d399","#00e5ff","#9333ea","#f59e0b","#ef4444","#06b6d4","#ec4899","#a855f7"],m=n.parent_winners||[];return(0,x.jsxs)("div",{className:o,onClick:()=>a(!t),children:[(0,x.jsx)(c.h7,{type:"target",position:c.yX.Left}),(0,x.jsx)(c.h7,{type:"source",position:c.yX.Right}),(0,x.jsxs)("div",{className:"prompt-node-header",children:[(0,x.jsxs)("span",{className:"generation-label",children:["Gen ",n.generation]}),(0,x.jsxs)("div",{className:"prompt-node-badges",children:[n.is_winner&&(0,x.jsx)("span",{className:"winner-badge",title:"Winner",children:"\ud83d\udc51"}),n.is_current_session&&(0,x.jsx)("span",{className:"current-badge",title:"Current session",children:"\ud83d\udccd"}),n.in_training_set&&(0,x.jsx)("span",{className:"training-badge",title:"Active training set (last 5 winners)",children:"\ud83c\udf93"})]})]}),m.length>0&&(0,x.jsxs)("div",{className:"dna-bar-container",children:[(0,x.jsx)("div",{className:"dna-bar",children:m.map((e,s)=>(0,x.jsx)("div",{className:"dna-segment",style:{backgroundColor:h[s%h.length],width:"".concat(100/m.length,"%")},title:"Gen ".concat(e.generation," #").concat(e.take_index,": ").concat(e.prompt_snippet,"...")},"".concat(e.session_id,"_").concat(e.take_index)))}),(0,x.jsxs)("div",{className:"dna-label",children:["\ud83e\uddec ",m.length," parent",1!==m.length?"s":""]})]}),(0,x.jsx)("div",{className:"prompt-content",children:t?n.prompt:l}),n.mutation_type&&(0,x.jsx)("div",{className:"mutation-badge",style:{backgroundColor:d},children:n.mutation_type}),n.model&&(0,x.jsx)("div",{className:"model-label",children:n.model.split("/").pop()}),(0,x.jsxs)("div",{className:"prompt-node-footer",children:[(0,x.jsxs)("span",{className:"take-index",children:["#",n.take_index]}),t&&n.mutation_template&&(0,x.jsxs)("div",{className:"mutation-template",children:["Template: ",n.mutation_template]})]})]})}};function g(e){let{nodes:s,edges:n,metadata:t,loading:a,error:m,highlightedNode:g}=e;const[v,f,N]=(0,c.ck)([]),[w,_,b]=(0,c.fM)([]),[k,y]=(0,i.useState)(!1),I=(0,c.VH)();if((0,i.useEffect)(()=>{if(!s||0===s.length)return f([]),void _([]);let e=s,i=n;if(k){const t=new Set(s.filter(e=>{var s;return null===(s=e.data)||void 0===s?void 0:s.is_winner}).map(e=>e.id));e=s.filter(e=>t.has(e.id)),i=n.filter(e=>t.has(e.source)&&t.has(e.target))}const{nodes:t,edges:a}=function(e,s){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"LR";const i=new(u().graphlib.Graph);return i.setDefaultEdgeLabel(()=>({})),i.setGraph({rankdir:n,nodesep:80,ranksep:300,edgesep:50,marginx:50,marginy:50}),e.forEach(e=>{i.setNode(e.id,{width:320,height:220})}),s.forEach(e=>{i.setEdge(e.source,e.target)}),u().layout(i),{nodes:e.map(e=>{const s=i.node(e.id);return(0,o.A)((0,o.A)({},e),{},{position:{x:s.x-160,y:s.y-110}})}),edges:s}}(e,i,"LR");f(t),_(a)},[s,n,k,f,_]),(0,i.useEffect)(()=>{if(!v.length)return;const e=v.map(e=>(0,o.A)((0,o.A)({},e),{},{data:(0,o.A)((0,o.A)({},e.data),{},{isHighlighted:e.id===g})}));f(e),g&&I&&setTimeout(()=>{I.fitView({padding:.3,duration:800,nodes:[{id:g}]})},50)},[g,I]),a)return(0,x.jsx)("div",{className:"phylogeny-loading",children:(0,x.jsx)(p.lp,{size:"medium",message:"Loading prompt evolution..."})});if(m)return(0,x.jsxs)("div",{className:"phylogeny-error",children:[(0,x.jsx)(l.In,{icon:"mdi:alert-circle",width:"32"}),(0,x.jsx)("p",{children:"\u26a0\ufe0f Error loading evolution data"}),(0,x.jsx)("p",{className:"error-detail",children:m})]});if(!v.length){const e=m||t&&t.message;return(0,x.jsxs)("div",{className:"phylogeny-empty",children:[(0,x.jsx)(l.In,{icon:"mdi:chart-timeline",width:"48"}),(0,x.jsx)("p",{children:"\ud83d\udcca No evolution data available"}),e&&e.includes("species_hash")?(0,x.jsxs)("div",{className:"empty-detail",children:[(0,x.jsx)("p",{children:(0,x.jsx)("strong",{children:"Missing species_hash data"})}),(0,x.jsx)("p",{children:"This session doesn't have species_hash logged. This field is required for evolution tracking."}),(0,x.jsx)("p",{children:"Make sure you're running a recent version of LARS that logs species_hash."}),(0,x.jsxs)("details",{style:{marginTop:"12px",fontSize:"12px",color:"#64748b"},children:[(0,x.jsx)("summary",{style:{cursor:"pointer"},children:"What is species_hash?"}),(0,x.jsx)("p",{style:{marginTop:"8px",lineHeight:"1.5"},children:'Species hash is a unique identifier for your cell configuration (instructions, rules, takes settings). It ensures we only compare prompts with the same "DNA" template for fair analysis.'})]})]}):(0,x.jsxs)("p",{className:"empty-detail",children:["Run this cascade multiple times with takes (takes) to see prompt evolution!",e&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("br",{}),(0,x.jsx)("br",{}),(0,x.jsx)("strong",{children:"Error:"})," ",e]})]})]})}return(0,x.jsxs)("div",{className:"prompt-phylogeny-container",children:[(0,x.jsxs)("div",{className:"phylogeny-header",children:[(0,x.jsxs)("div",{className:"phylogeny-title",children:[(0,x.jsx)("h3",{children:"\ud83e\uddec Prompt Evolution"}),t.species_hash&&(0,x.jsxs)("span",{className:"species-hash",title:t.species_hash,children:["Species: ",t.species_hash.substring(0,8),"..."]})]}),(0,x.jsxs)("div",{className:"phylogeny-stats",children:[(0,x.jsxs)("span",{className:"stat",children:[(0,x.jsx)("strong",{children:t.session_count})," generations"]}),(0,x.jsxs)("span",{className:"stat",children:[(0,x.jsx)("strong",{children:t.total_takes})," total attempts"]}),t.total_takes&&t.session_count&&(0,x.jsxs)("span",{className:"stat",title:"Takes per generation",children:[(0,x.jsx)(l.In,{icon:"mdi:information-outline",width:"14"}),(0,x.jsx)("strong",{children:Math.round(t.total_takes/t.session_count)})," per gen"]}),(0,x.jsxs)("span",{className:"stat",children:[(0,x.jsx)("strong",{children:t.winner_count})," winners"]}),t.current_session_generation&&(0,x.jsxs)("span",{className:"stat current-gen",children:["You are at Gen ",(0,x.jsx)("strong",{children:t.current_session_generation})]})]}),(0,x.jsx)("div",{className:"phylogeny-controls",children:(0,x.jsxs)("label",{className:"control-toggle",children:[(0,x.jsx)("input",{type:"checkbox",checked:k,onChange:e=>y(e.target.checked)}),(0,x.jsx)(l.In,{icon:"mdi:trophy",width:"14"}),(0,x.jsx)("span",{children:"Winners Only"})]})})]}),(0,x.jsx)("div",{className:"phylogeny-canvas",children:(0,x.jsxs)(c.Gc,{nodes:v,edges:w,onNodesChange:N,onEdgesChange:b,nodeTypes:j,fitView:!0,fitViewOptions:{padding:.3,maxZoom:.8},minZoom:.1,maxZoom:2,defaultZoom:.7,children:[(0,x.jsx)(r.V,{color:"#1a1628",gap:16}),(0,x.jsx)(d.H,{}),(0,x.jsx)(h.o,{nodeColor:e=>{var s,n,i,t;return null!==(s=e.data)&&void 0!==s&&s.in_training_set?"#f59e0b":null!==(n=e.data)&&void 0!==n&&n.is_winner?"#34d399":null!==(i=e.data)&&void 0!==i&&i.is_current_session?"#00e5ff":null!==(t=e.data)&&void 0!==t&&t.is_future?"#475569":"#334155"},maskColor:"rgba(0, 0, 0, 0.7)"})]})}),(0,x.jsxs)("div",{className:"phylogeny-legend",children:[(0,x.jsxs)("div",{className:"legend-item",children:[(0,x.jsx)(l.In,{icon:"mdi:dna",width:"16"}),(0,x.jsx)("span",{children:"DNA Bar = Training Sources"})]}),(0,x.jsxs)("div",{className:"legend-item",children:[(0,x.jsx)("span",{className:"legend-icon",children:"\ud83d\udc51"}),(0,x.jsx)("span",{children:"Winner (enters gene pool)"})]}),(0,x.jsxs)("div",{className:"legend-item",children:[(0,x.jsx)("span",{className:"legend-icon",children:"\ud83c\udf93"}),(0,x.jsx)("span",{children:"Active Training Set (last 5)"})]}),(0,x.jsxs)("div",{className:"legend-item",children:[(0,x.jsx)("div",{className:"legend-line winner-line"}),(0,x.jsx)("span",{children:"Green = Last Gen Winner"})]}),(0,x.jsxs)("div",{className:"legend-item",children:[(0,x.jsx)("div",{className:"legend-line gene-pool-line"}),(0,x.jsx)("span",{children:"Purple = Gene Pool Ancestor"})]}),(0,x.jsxs)("div",{className:"legend-item",children:[(0,x.jsx)("span",{className:"legend-icon",children:"\ud83d\udccd"}),(0,x.jsx)("span",{children:"Current Session"})]})]})]})}function v(e){return(0,x.jsx)(c.Ln,{children:(0,x.jsx)(g,(0,o.A)({},e))})}function f(e){var s,n;let{species:i,isSelected:t,onClick:a}=e;const o=(null===(s=i.species_hash)||void 0===s?void 0:s.slice(0,8))||"unknown",c=i.avg_cost||0;return(0,x.jsxs)("button",{className:"species-chip ".concat(t?"selected":""),onClick:a,title:"Species ".concat(o,"\n").concat(i.session_count," generations \xb7 ").concat(i.total_attempts||0," total attempts\nAvg cost per gen: $").concat(c.toFixed(5),"\nTotal cost: $").concat((null===(n=i.total_cost)||void 0===n?void 0:n.toFixed(4))||"0"),children:[(0,x.jsx)(l.In,{icon:"mdi:dna",width:"12"}),(0,x.jsx)("span",{className:"chip-hash",children:o}),t&&(0,x.jsx)(l.In,{icon:"mdi:check-circle",width:"12",className:"check-icon"}),(0,x.jsxs)("div",{className:"chip-stats-inline",children:[(0,x.jsxs)("span",{className:"stat-item",children:[i.session_count,"gen"]}),(0,x.jsxs)("span",{className:"stat-item",children:[i.total_attempts,"att"]}),c>0&&(0,x.jsxs)("span",{className:"stat-item cost",children:["$",c.toFixed(4)]})]})]})}const N=e=>{let{species:s,selected:n,onSelect:i}=e;return s&&0!==s.length?(0,x.jsxs)("div",{className:"species-selector-compact",children:[(0,x.jsx)(l.In,{icon:"mdi:dna",width:"14",className:"selector-label-icon"}),(0,x.jsx)("span",{className:"selector-label",children:"Species:"}),(0,x.jsx)("div",{className:"species-chips",children:s.map(e=>(0,x.jsx)(f,{species:e,isSelected:n===e.species_hash,onClick:()=>i(e.species_hash)},e.species_hash))}),(0,x.jsxs)("span",{className:"species-count-compact",children:[s.length," found"]})]}):null},w=e=>{let{cascades:s,selected:n,onSelect:i,loading:t}=e;return(0,x.jsxs)("div",{className:"cascade-selector",children:[(0,x.jsx)(l.In,{icon:"mdi:ship-wheel",width:"20",className:"selector-icon"}),(0,x.jsxs)("select",{value:n||"",onChange:e=>i(e.target.value),disabled:t,className:"cascade-select",children:[(0,x.jsx)("option",{value:"",children:"Select a cascade to analyze..."}),s.map(e=>(0,x.jsxs)("option",{value:e.cascade_id,children:[e.cascade_id," (",e.session_count," runs",e.analysis_ready?" - Ready":"",")"]},e.cascade_id))]})]})};function _(e){let{ngram:s}=e;const n=(100*s.winner_freq).toFixed(0),i=(100*s.loser_freq).toFixed(0),t=s.heat,a=t>.3,l=t<-.3,o=a?"#34d399":l?"#38bdf8":"#64748b";return(0,x.jsxs)("div",{className:"ngram-bar ".concat(a?"hot":l?"cold":"neutral"),children:[(0,x.jsxs)("div",{className:"ngram-phrase",children:[(0,x.jsx)("span",{className:"ngram-icon",children:a?"\ud83d\udd25":l?"\u2744\ufe0f":"\u2796"}),(0,x.jsxs)("span",{className:"ngram-text",children:['"',s.ngram,'"']})]}),(0,x.jsxs)("div",{className:"ngram-stats",children:[(0,x.jsxs)("div",{className:"frequency-bars",children:[(0,x.jsxs)("div",{className:"freq-bar winner-bar",children:[(0,x.jsx)("div",{className:"freq-label",children:"Winners"}),(0,x.jsx)("div",{className:"freq-bar-track",children:(0,x.jsx)("div",{className:"freq-bar-fill",style:{width:"".concat(n,"%"),backgroundColor:"#34d399"}})}),(0,x.jsxs)("div",{className:"freq-value",children:[n,"%"]})]}),(0,x.jsxs)("div",{className:"freq-bar loser-bar",children:[(0,x.jsx)("div",{className:"freq-label",children:"Losers"}),(0,x.jsx)("div",{className:"freq-bar-track",children:(0,x.jsx)("div",{className:"freq-bar-fill",style:{width:"".concat(i,"%"),backgroundColor:"#64748b"}})}),(0,x.jsxs)("div",{className:"freq-value",children:[i,"%"]})]})]}),(0,x.jsxs)("div",{className:"ngram-counts",children:[(0,x.jsxs)("span",{className:"count-badge winner",children:[s.winner_count,"W"]}),(0,x.jsxs)("span",{className:"count-badge loser",children:[s.loser_count,"L"]})]}),(0,x.jsxs)("div",{className:"heat-score",style:{color:o},children:["Heat: ",t>0?"+":"",(100*t).toFixed(0),"%"]})]})]})}const b=e=>{let{cascadeId:s,cellName:n,speciesHash:t}=e;const[a,o]=(0,i.useState)(null),[c,r]=(0,i.useState)(!1),[d,h]=(0,i.useState)(null),[m,u]=(0,i.useState)("hot");(0,i.useEffect)(()=>{s&&n&&j()},[s,n,t]);const j=async()=>{r(!0),h(null);try{const e=new URLSearchParams;t&&e.append("species_hash",t);const i="http://localhost:5050/api/sextant/prompt-patterns/".concat(s,"/").concat(n).concat(e.toString()?"?"+e.toString():"");console.log("[NgramAnalysis] Fetching from:",i);const a=await fetch(i),l=await a.json();l.error?h(l.error):o(l)}catch(e){console.error("[NgramAnalysis] Failed to load:",e),h(e.message)}finally{r(!1)}};if(c)return(0,x.jsx)("div",{className:"ngram-loading",children:(0,x.jsx)(p.lp,{size:"small",message:"Analyzing phrase patterns..."})});if(d)return(0,x.jsxs)("div",{className:"ngram-error",children:[(0,x.jsx)(l.In,{icon:"mdi:alert-circle",width:"20"}),(0,x.jsx)("span",{children:d}),(0,x.jsxs)("button",{onClick:j,className:"retry-btn",children:[(0,x.jsx)(l.In,{icon:"mdi:refresh",width:"14"}),"Retry"]})]});if(!a)return(0,x.jsxs)("div",{className:"ngram-placeholder",children:[(0,x.jsx)(l.In,{icon:"mdi:text-search",width:"32"}),(0,x.jsx)("p",{children:"Phrase analysis will appear here once data loads"})]});const g=a.hot_ngrams||[],v=a.cold_ngrams||[],f=a.stats||{},N=a.cost_analysis||{};return(0,x.jsxs)("div",{className:"ngram-analysis",children:[(0,x.jsxs)("div",{className:"ngram-stats-header",children:[(0,x.jsxs)("div",{className:"stat-item",children:[(0,x.jsx)(l.In,{icon:"mdi:trophy",width:"14"}),(0,x.jsxs)("span",{children:[f.analyzed_winners||0," winners analyzed"]})]}),(0,x.jsxs)("div",{className:"stat-item",children:[(0,x.jsx)(l.In,{icon:"mdi:close-circle",width:"14"}),(0,x.jsxs)("span",{children:[f.analyzed_losers||0," losers analyzed"]})]}),(0,x.jsxs)("div",{className:"stat-item",children:[(0,x.jsx)(l.In,{icon:"mdi:format-text",width:"14"}),(0,x.jsxs)("span",{children:[f.total_chunks||0," chunks"]})]}),N.win_rate_pct&&(0,x.jsxs)("div",{className:"stat-item",children:[(0,x.jsx)(l.In,{icon:"mdi:percent",width:"14"}),(0,x.jsxs)("span",{children:[N.win_rate_pct,"% win rate"]})]})]}),(0,x.jsxs)("div",{className:"ngram-tabs",children:[(0,x.jsxs)("button",{className:"ngram-tab ".concat("hot"===m?"active":""),onClick:()=>u("hot"),children:[(0,x.jsx)(l.In,{icon:"mdi:fire",width:"16"}),(0,x.jsx)("span",{children:"Hot Phrases"}),(0,x.jsx)("span",{className:"tab-count",children:g.length})]}),(0,x.jsxs)("button",{className:"ngram-tab ".concat("cold"===m?"active":""),onClick:()=>u("cold"),children:[(0,x.jsx)(l.In,{icon:"mdi:snowflake",width:"16"}),(0,x.jsx)("span",{children:"Cold Phrases"}),(0,x.jsx)("span",{className:"tab-count",children:v.length})]})]}),(0,x.jsx)("div",{className:"ngram-list",children:"hot"===m?g.length>0?g.slice(0,12).map((e,s)=>(0,x.jsx)(_,{ngram:e},s)):(0,x.jsxs)("div",{className:"ngram-empty",children:[(0,x.jsx)(l.In,{icon:"mdi:fire-off",width:"24"}),(0,x.jsx)("p",{children:"No hot phrases found"})]}):v.length>0?v.slice(0,12).map((e,s)=>(0,x.jsx)(_,{ngram:e},s)):(0,x.jsxs)("div",{className:"ngram-empty",children:[(0,x.jsx)(l.In,{icon:"mdi:snowflake-off",width:"24"}),(0,x.jsx)("p",{children:"No cold phrases found"})]})}),(0,x.jsxs)("div",{className:"ngram-interpretation",children:[(0,x.jsx)(l.In,{icon:"mdi:lightbulb",width:"16"}),(0,x.jsx)("div",{className:"interpretation-text",children:"hot"===m?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("strong",{children:"Hot phrases"})," appear more frequently in winning prompts. These patterns correlate with success - consider incorporating them!"]}):(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("strong",{children:"Cold phrases"})," appear more frequently in losing prompts. These patterns correlate with failure - consider avoiding them!"]})})]}),(0,x.jsx)("div",{className:"ngram-actions",children:(0,x.jsxs)("button",{onClick:j,className:"refresh-ngram-btn",children:[(0,x.jsx)(l.In,{icon:"mdi:refresh",width:"14"}),"Refresh Analysis"]})})]})};function k(e){let{model:s}=e;const n=s.win_rate,i=s.avg_cost,t=(a=n)>=70?"#34d399":a>=50?"#00e5ff":a>=30?"#f59e0b":"#f87171";var a;return(0,x.jsxs)("div",{className:"model-bar",children:[(0,x.jsxs)("div",{className:"model-bar-header",children:[(0,x.jsxs)("div",{className:"model-info",children:[(0,x.jsx)(l.In,{icon:"mdi:robot",width:"14"}),(0,x.jsx)("span",{className:"model-name",title:s.model_full,children:s.model_short})]}),(0,x.jsxs)("div",{className:"model-meta",children:[(0,x.jsxs)("span",{className:"model-record",children:[s.wins,"/",s.attempts]}),i>0&&(0,x.jsxs)("span",{className:"model-avg-cost",children:["$",i.toFixed(5)]})]})]}),(0,x.jsx)("div",{className:"win-rate-track",children:(0,x.jsx)("div",{className:"win-rate-fill",style:{width:"".concat(Math.min(n,100),"%"),backgroundColor:t}})}),(0,x.jsxs)("div",{className:"model-bar-footer",children:[(0,x.jsxs)("span",{className:"win-rate-label",style:{color:t},children:[n.toFixed(1),"% win rate"]}),s.total_cost>0&&(0,x.jsxs)("span",{className:"total-cost-label",children:["Total: $",s.total_cost.toFixed(4)]})]})]})}const y=e=>{let{nodes:s}=e;const n=(0,i.useMemo)(()=>{if(!s||0===s.length)return[];const e={};return s.forEach(s=>{const n=s.data.model||"unknown",i=n.split("/").pop();e[n]||(e[n]={model_full:n,model_short:i,wins:0,attempts:0,total_cost:0,costs:[]}),e[n].attempts+=1,s.data.is_winner&&(e[n].wins+=1);const t=s.data.cost||0;e[n].total_cost+=t,e[n].costs.push(t)}),Object.values(e).map(e=>(0,o.A)((0,o.A)({},e),{},{win_rate:e.wins/e.attempts*100,avg_cost:e.costs.length>0?e.costs.reduce((e,s)=>e+s,0)/e.costs.length:0})).sort((e,s)=>s.win_rate-e.win_rate)},[s]);return s&&0!==s.length?0===n.length?(0,x.jsxs)("div",{className:"model-performance-empty",children:[(0,x.jsx)(l.In,{icon:"mdi:robot-outline",width:"32"}),(0,x.jsx)("p",{children:"No models found in evolution data"})]}):(0,x.jsxs)("div",{className:"model-performance",children:[(0,x.jsxs)("div",{className:"model-performance-header",children:[(0,x.jsx)(l.In,{icon:"mdi:podium",width:"18"}),(0,x.jsx)("h4",{children:"Model Leaderboard"}),(0,x.jsxs)("span",{className:"model-count",children:[n.length," model",1!==n.length?"s":""]})]}),(0,x.jsx)("div",{className:"model-list",children:n.map((e,s)=>(0,x.jsxs)("div",{className:"model-rank-item",children:[(0,x.jsxs)("div",{className:"rank-badge",style:{backgroundColor:0===s?"#f59e0b":1===s?"#94a3b8":2===s?"#cd7f32":"#334155"},children:["#",s+1]}),(0,x.jsx)(k,{model:e})]},e.model_full))}),(0,x.jsxs)("div",{className:"model-interpretation",children:[(0,x.jsx)(l.In,{icon:"mdi:information-outline",width:"14"}),(0,x.jsx)("span",{children:1===n.length?"Only one model tested. Run with multiple models to compare performance.":"Best performing: ".concat(n[0].model_short," with ").concat(n[0].win_rate.toFixed(1),"% win rate")})]})]}):(0,x.jsxs)("div",{className:"model-performance-empty",children:[(0,x.jsx)(l.In,{icon:"mdi:robot-outline",width:"32"}),(0,x.jsx)("p",{children:"No model data available"})]})};function I(e){let{icon:s,label:n,value:i,subvalue:t,trend:a,color:o}=e;return(0,x.jsxs)("div",{className:"metric-card",children:[(0,x.jsx)("div",{className:"metric-icon",style:{color:o},children:(0,x.jsx)(l.In,{icon:s,width:"16"})}),(0,x.jsxs)("div",{className:"metric-content",children:[(0,x.jsx)("div",{className:"metric-label",children:n}),(0,x.jsx)("div",{className:"metric-value",children:i}),t&&(0,x.jsx)("div",{className:"metric-subvalue",children:t}),a&&(0,x.jsxs)("div",{className:"metric-trend ".concat(a.direction),children:[(0,x.jsx)(l.In,{icon:"up"===a.direction?"mdi:trending-up":"mdi:trending-down",width:"12"}),a.value]})]})]})}const C=e=>{var s;let{nodes:n,metadata:t}=e;const a=(0,i.useMemo)(()=>{var e;if(!n||0===n.length)return null;const s={};n.forEach(e=>{const n=e.data.generation;s[n]||(s[n]={takes:[],winner:null,totalCost:0}),s[n].takes.push(e.data),s[n].totalCost+=e.data.cost||0,e.data.is_winner&&(s[n].winner=e.data)});const i=Object.values(s).sort((e,s)=>e.takes[0].generation-s.takes[0].generation),t=i.length,a=n.reduce((e,s)=>e+(s.data.cost||0),0),l=a/t,o=Math.floor(t/2),c=i.slice(0,o).reduce((e,s)=>e+s.totalCost,0)/o,r=(i.slice(o).reduce((e,s)=>e+s.totalCost,0)/(t-o)-c)/c*100,d=Math.min(5,t),h=new Set(n.map(e=>e.data.model).filter(Boolean)).size,m=n.filter(e=>e.data.mutation_type&&"nan"!==e.data.mutation_type).length/n.length*100,u=n.filter(e=>e.data.is_winner),p=u.filter(e=>e.data.mutation_type&&"nan"!==e.data.mutation_type),x=u.length>0?p.length/u.length*100:0,j=n.filter(e=>e.data.in_training_set).length,g=n.length/t,v=i.reduce((e,s)=>s.winner&&(!e||s.totalCost<e.totalCost)?s:e,null);return{totalGenerations:t,totalCost:a,avgCostPerGen:l,costTrend:{direction:r<0?"down":"up",value:"".concat(Math.abs(r).toFixed(0),"%")},genePoolSize:d,trainingSetSize:j,uniqueModels:h,mutationPct:m,mutatedWinnerPct:x,avgTakesPerGen:g,bestGeneration:null===v||void 0===v||null===(e=v.takes[0])||void 0===e?void 0:e.generation,bestGenCost:null===v||void 0===v?void 0:v.totalCost}},[n]);return a?(0,x.jsxs)("div",{className:"evolution-metrics",children:[(0,x.jsx)(I,{icon:"mdi:counter",label:"Generations",value:a.totalGenerations,subvalue:"".concat(a.avgTakesPerGen.toFixed(1)," avg takes"),color:"#00e5ff"}),(0,x.jsx)(I,{icon:"mdi:currency-usd",label:"Total Cost",value:"$".concat(a.totalCost.toFixed(4)),subvalue:"$".concat(a.avgCostPerGen.toFixed(5)," per gen"),trend:a.costTrend,color:"#34d399"}),(0,x.jsx)(I,{icon:"mdi:trophy",label:"Best Gen",value:"Gen ".concat(a.bestGeneration),subvalue:"$".concat(null===(s=a.bestGenCost)||void 0===s?void 0:s.toFixed(5)),color:"#fbbf24"}),(0,x.jsx)(I,{icon:"mdi:dna",label:"Gene Pool",value:a.genePoolSize,subvalue:"".concat(a.trainingSetSize," in training"),color:"#9333ea"}),(0,x.jsx)(I,{icon:"mdi:robot",label:"Models",value:a.uniqueModels,subvalue:1===a.uniqueModels?"Single model":"Multi-model",color:"#06b6d4"}),(0,x.jsx)(I,{icon:"mdi:auto-fix",label:"Mutations",value:"".concat(a.mutationPct.toFixed(0),"%"),subvalue:"".concat(a.mutatedWinnerPct.toFixed(0),"% of winners"),color:"#f59e0b"})]}):null};function S(e){let{parent:s,color:n,index:i}=e;return(0,x.jsxs)("div",{className:"parent-snippet",children:[(0,x.jsxs)("div",{className:"parent-badge",style:{backgroundColor:n},children:["Gen ",s.generation]}),(0,x.jsxs)("div",{className:"parent-text",children:['"',s.prompt_snippet,'..."']})]})}function E(e){var s;let{take:n,onClick:i,isHighlighted:t}=e;return(0,x.jsxs)("button",{className:"take-chip ".concat(n.is_winner?"winner":""," ").concat(t?"highlighted":""),onClick:i,title:"Take #".concat(n.take_index).concat(n.is_winner?" (Winner)":"","\nModel: ").concat(n.model,"\nCost: $").concat((null===(s=n.cost)||void 0===s?void 0:s.toFixed(4))||"0"),children:["#",n.take_index,n.is_winner&&(0,x.jsx)(l.In,{icon:"mdi:trophy",width:"10"}),n.in_training_set&&(0,x.jsx)("span",{className:"training-dot",children:"\ud83c\udf93"})]})}function F(e){let{generation:s,isCurrentSession:n,onTakeClick:t,highlightedNode:a}=e;const[o,c]=(0,i.useState)(!1),[r,d]=(0,i.useState)(!0),h=s.takes.find(e=>e.is_winner),m=s.takes.reduce((e,s)=>e+(s.cost||0),0),u=["#34d399","#00e5ff","#9333ea","#f59e0b","#ef4444","#06b6d4","#ec4899","#a855f7"],p=s.parent_winners||[],j=h||s.takes[0],g=(null===j||void 0===j?void 0:j.prompt)||"",v=g.length>300?g.substring(0,300)+"...":g,f=g.length>300;return(0,x.jsxs)("div",{className:"gen-lineage-card ".concat(n?"current-session":""),children:[(0,x.jsxs)("div",{className:"gen-lineage-header",children:[(0,x.jsxs)("div",{className:"gen-lineage-header-left",children:[(0,x.jsxs)("span",{className:"gen-number",children:["Gen ",s.generation]}),h&&(0,x.jsx)(l.In,{icon:"mdi:trophy",width:"14",className:"winner-icon"}),n&&(0,x.jsx)(l.In,{icon:"mdi:map-marker",width:"14",className:"current-marker"})]}),(0,x.jsxs)("div",{className:"gen-lineage-header-right",children:[(null===j||void 0===j?void 0:j.model)&&(0,x.jsx)("span",{className:"gen-model",children:j.model.split("/").pop().substring(0,12)}),(0,x.jsxs)("span",{className:"gen-cost",children:["$",m.toFixed(4)]})]})]}),p.length>0&&(0,x.jsxs)("div",{className:"gen-lineage-section",children:[(0,x.jsxs)("div",{className:"lineage-section-header",onClick:()=>d(!r),children:[(0,x.jsx)(l.In,{icon:"mdi:dna",width:"14"}),(0,x.jsxs)("span",{children:["Trained by ",p.length," parent",1!==p.length?"s":""]}),(0,x.jsx)(l.In,{icon:r?"mdi:chevron-up":"mdi:chevron-down",width:"14",className:"section-toggle"})]}),r&&(0,x.jsx)("div",{className:"parent-snippets",children:p.map((e,s)=>(0,x.jsx)(S,{parent:e,color:u[s%u.length],index:s},"".concat(e.session_id,"_").concat(e.take_index)))})]}),(null===j||void 0===j?void 0:j.mutation_type)&&(0,x.jsxs)("div",{className:"gen-lineage-section mutation-section",children:[(0,x.jsxs)("div",{className:"mutation-header",children:[(0,x.jsx)(l.In,{icon:"mdi:auto-fix",width:"14"}),(0,x.jsx)("span",{className:"mutation-type-label",children:j.mutation_type})]}),j.mutation_template&&(0,x.jsxs)("div",{className:"mutation-template-preview",children:['"',j.mutation_template.substring(0,100),j.mutation_template.length>100?"...":"",'"']})]}),(0,x.jsxs)("div",{className:"gen-lineage-section prompt-section",children:[(0,x.jsxs)("div",{className:"prompt-section-header",children:[(0,x.jsx)(l.In,{icon:"mdi:text-box",width:"14"}),(0,x.jsx)("span",{children:"Prompt"})]}),(0,x.jsx)("div",{className:"prompt-content-timeline",children:o?g:v}),f&&(0,x.jsxs)("button",{className:"show-more-btn",onClick:()=>c(!o),children:[(0,x.jsx)(l.In,{icon:o?"mdi:chevron-up":"mdi:chevron-down",width:"12"}),o?"Show less":"Show more"]})]}),(0,x.jsx)("div",{className:"gen-lineage-section takes-section",children:(0,x.jsx)("div",{className:"takes-chips",children:s.takes.map(e=>{const n="".concat(s.session_id,"_").concat(e.take_index),i=a===n;return(0,x.jsx)(E,{take:e,onClick:()=>t(n,e),isHighlighted:i},e.take_index)})})})]})}const T=e=>{let{metadata:s,nodes:n,onNodeFocus:t,highlightedNode:a,currentSessionId:o}=e;const c=(0,i.useMemo)(()=>{if(!n||0===n.length)return[];const e={};return n.forEach(s=>{const n=s.data.session_id;e[n]||(e[n]={session_id:n,generation:s.data.generation,timestamp:s.data.timestamp,takes:[],parent_winners:s.data.parent_winners||[]}),e[n].takes.push({take_index:s.data.take_index,is_winner:s.data.is_winner,in_training_set:s.data.in_training_set,mutation_type:s.data.mutation_type,mutation_template:s.data.mutation_template,model:s.data.model,prompt:s.data.prompt,cost:s.data.cost||0})}),Object.values(e).sort((e,s)=>e.generation-s.generation)},[n]),r=(e,s)=>{console.log("[Timeline] Take clicked:",e),t&&t(e)};return c&&0!==c.length?(0,x.jsxs)("div",{className:"generation-timeline",children:[(0,x.jsxs)("div",{className:"timeline-header",children:[(0,x.jsx)(l.In,{icon:"mdi:timeline-text",width:"18"}),(0,x.jsx)("h3",{children:"Lineage"}),(0,x.jsxs)("span",{className:"timeline-count",children:[c.length," gen",1!==c.length?"s":""]})]}),(0,x.jsx)("div",{className:"timeline-content",children:c.map((e,s)=>(0,x.jsxs)(i.Fragment,{children:[(0,x.jsx)(F,{generation:e,isCurrentSession:e.session_id===o,onTakeClick:r,highlightedNode:a}),s<c.length-1&&(0,x.jsx)("div",{className:"generation-connector",children:(0,x.jsx)(l.In,{icon:"mdi:arrow-down",width:"16",className:"connector-arrow"})})]},e.session_id))}),(0,x.jsxs)("div",{className:"timeline-footer",children:[(0,x.jsxs)("div",{className:"footer-stat",children:[(0,x.jsx)(l.In,{icon:"mdi:trophy",width:"14"}),(0,x.jsxs)("span",{children:[c.filter(e=>e.takes.some(e=>e.is_winner)).length," winners"]})]}),(0,x.jsxs)("div",{className:"footer-stat",children:[(0,x.jsx)(l.In,{icon:"mdi:graph-outline",width:"14"}),(0,x.jsxs)("span",{children:[c.reduce((e,s)=>e+s.takes.length,0)," attempts"]})]})]})]}):(0,x.jsxs)("div",{className:"generation-timeline-empty",children:[(0,x.jsx)(l.In,{icon:"mdi:timeline-clock-outline",width:"32"}),(0,x.jsx)("p",{children:"No generations to display"})]})},G=["#34d399","#00e5ff","#9333ea","#f59e0b","#ef4444","#06b6d4","#ec4899","#a855f7","#10b981","#3b82f6","#f97316","#14b8a6","#8b5cf6","#84cc16","#f43f5e","#6366f1","#22d3ee","#a3e635","#fb7185","#c084fc"];function M(e){let{snippet:s,color:n,generation:i,onClick:t,isHighlighted:a}=e;return(0,x.jsxs)("div",{className:"training-snippet ".concat(a?"highlighted":""),onClick:t,style:{borderLeftColor:n},children:[(0,x.jsxs)("div",{className:"training-badge",style:{backgroundColor:n},children:["Gen ",i]}),(0,x.jsx)("div",{className:"training-text",children:s})]})}function P(e){var s;let{generation:n,generationColor:t,onSnippetClick:a,highlightedGen:o,onEvolveClick:c}=e;const[r,d]=(0,i.useState)(!1),h=n.takes.find(e=>e.is_winner)||n.takes[0];console.log("[GenerationBlock] Gen",n.generation,"- Has winner:",!(null===h||void 0===h||!h.is_winner),"- Has evolveClick:",!!c);const m=(null===h||void 0===h?void 0:h.prompt)||"",u=m.length>400?m.substring(0,400)+"...":m,p=m.length>400,j=n.takes.reduce((e,s)=>e+(s.cost||0),0),g=n.parent_winners||[],v=o===n.generation;return(0,x.jsxs)("div",{className:"gen-block ".concat(v?"highlighted":""),children:[(0,x.jsxs)("div",{className:"gen-block-header",children:[(0,x.jsxs)("div",{className:"gen-block-number",style:{backgroundColor:t},children:["Gen ",n.generation]}),(null===h||void 0===h?void 0:h.is_winner)&&(0,x.jsx)(l.In,{icon:"mdi:trophy",width:"16",className:"block-winner-icon"}),(0,x.jsxs)("div",{className:"gen-block-meta",children:[(0,x.jsx)("span",{className:"block-model",children:null===h||void 0===h||null===(s=h.model)||void 0===s?void 0:s.split("/").pop().substring(0,15)}),(0,x.jsxs)("span",{className:"block-cost",children:["$",j.toFixed(4)]})]})]}),(0,x.jsxs)("div",{className:"winner-prompt-section",children:[(0,x.jsxs)("div",{className:"winner-prompt-header",children:[(0,x.jsx)(l.In,{icon:"mdi:star",width:"14"}),(0,x.jsx)("span",{children:"Winner"}),(null===h||void 0===h?void 0:h.mutation_type)&&(0,x.jsx)("span",{className:"winner-mutation",children:h.mutation_type}),(null===h||void 0===h?void 0:h.is_winner)&&c&&(0,x.jsxs)("button",{className:"evolve-btn-mini",onClick:e=>{e.stopPropagation(),console.log("[GenerationBlock] Evolve clicked!",n),c(n)},title:"Evolve: Promote this winner to baseline and create new species",children:[(0,x.jsx)(l.In,{icon:"mdi:dna",width:"12"}),"\u26a1 Evolve"]})]}),(0,x.jsx)("div",{className:"winner-prompt-content",style:{borderLeftColor:t},children:r?m:u}),p&&(0,x.jsxs)("button",{className:"toggle-prompt-btn",onClick:()=>d(!r),children:[(0,x.jsx)(l.In,{icon:r?"mdi:chevron-up":"mdi:chevron-down",width:"12"}),r?"Less":"More"]})]}),g.length>0&&(0,x.jsxs)("div",{className:"training-sources-section",children:[(0,x.jsxs)("div",{className:"training-sources-header",children:[(0,x.jsx)(l.In,{icon:"mdi:dna",width:"12"}),(0,x.jsxs)("span",{children:["Trained by ",g.length]})]}),(0,x.jsx)("div",{className:"training-sources-list",children:g.map((e,s)=>{const n=G[(e.generation-1)%G.length],i=o===e.generation;return(0,x.jsx)(M,{snippet:e.prompt_snippet,color:n,generation:e.generation,onClick:()=>a(e.generation),isHighlighted:i},"".concat(e.session_id,"_").concat(e.take_index))})})]}),(0,x.jsx)("div",{className:"block-takes",children:n.takes.map((e,s)=>{var n;return(0,x.jsxs)("span",{className:"block-take-chip ".concat(e.is_winner?"winner":""),title:"#".concat(e.take_index," - ").concat(e.model," - $").concat(null===(n=e.cost)||void 0===n?void 0:n.toFixed(4)),children:["#",e.take_index,e.is_winner&&"\ud83d\udc51"]},s)})})]})}const L=e=>{let{nodes:s,currentSessionId:n,onEvolveClick:t}=e;const[a,o]=(0,i.useState)(null),[c,r]=(0,i.useState)(!1),[d,h]=(0,i.useState)(0),[m,u]=(0,i.useState)(0),[p,j]=(0,i.useState)(0),[g,v]=(0,i.useState)(0),f=i.useRef(null);console.log("[LinearInfluenceView] onEvolveClick prop:",!!t);const N=(0,i.useMemo)(()=>{if(!s||0===s.length)return[];const e={};return s.forEach(s=>{const n=s.data.session_id;e[n]||(e[n]={session_id:n,generation:s.data.generation,timestamp:s.data.timestamp,takes:[],parent_winners:s.data.parent_winners||[]}),e[n].takes.push({take_index:s.data.take_index,is_winner:s.data.is_winner,in_training_set:s.data.in_training_set,mutation_type:s.data.mutation_type,mutation_template:s.data.mutation_template,model:s.data.model,prompt:s.data.prompt,cost:s.data.cost||0})}),Object.values(e).sort((e,s)=>e.generation-s.generation)},[s]),w=e=>{console.log("[LinearInfluence] Highlighting generation:",e),o(a===e?null:e)};return N&&0!==N.length?(0,x.jsxs)("div",{className:"linear-influence-view",children:[(0,x.jsxs)("div",{className:"linear-influence-header",children:[(0,x.jsx)(l.In,{icon:"mdi:arrow-right-bold",width:"20"}),(0,x.jsx)("h3",{children:"Influence Flow"}),(0,x.jsx)("span",{className:"influence-hint",children:"Colors show prompt influence across generations"})]}),(0,x.jsx)("div",{ref:f,className:"influence-timeline ".concat(c?"dragging":""),onMouseDown:e=>{f.current&&(e.target.closest("button")?console.log("[LinearInfluence] Clicked button, not dragging"):(r(!0),h(e.pageX-f.current.offsetLeft),u(e.pageY-f.current.offsetTop),j(f.current.scrollLeft),v(f.current.scrollTop)))},onMouseMove:e=>{if(!c||!f.current)return;const s=e.pageX-f.current.offsetLeft,n=e.pageY-f.current.offsetTop,i=Math.abs(s-d),t=Math.abs(n-m);if(i<5&&t<5)return;e.preventDefault();const a=1.5*(s-d),l=1.5*(n-m);f.current.scrollLeft=p-a,f.current.scrollTop=g-l},onMouseUp:()=>{r(!1)},onMouseLeave:()=>{r(!1)},children:N.map((e,s)=>{const n=G[(e.generation-1)%G.length];return(0,x.jsxs)(i.Fragment,{children:[(0,x.jsx)(P,{generation:e,generationColor:n,onSnippetClick:w,highlightedGen:a,onEvolveClick:t}),s<N.length-1&&(0,x.jsx)("div",{className:"block-connector",children:(0,x.jsx)(l.In,{icon:"mdi:arrow-right",width:"24",className:"connector-icon"})})]},e.session_id)})}),(0,x.jsxs)("div",{className:"linear-influence-legend",children:[(0,x.jsx)(l.In,{icon:"mdi:palette",width:"14"}),(0,x.jsx)("span",{children:"Each generation has a unique color. Click training snippets to highlight influence flow."})]})]}):(0,x.jsxs)("div",{className:"linear-influence-empty",children:[(0,x.jsx)(l.In,{icon:"mdi:timeline-outline",width:"48"}),(0,x.jsx)("p",{children:"No evolution data to display"})]})};function A(e){let{before:s,after:n}=e;return(0,x.jsxs)("div",{className:"diff-view",children:[(0,x.jsxs)("div",{className:"diff-section before",children:[(0,x.jsxs)("div",{className:"diff-header",children:[(0,x.jsx)(l.In,{icon:"mdi:minus-circle",width:"14"}),(0,x.jsx)("span",{children:"Current Baseline"})]}),(0,x.jsx)("div",{className:"diff-content",children:s})]}),(0,x.jsx)("div",{className:"diff-arrow",children:(0,x.jsx)(l.In,{icon:"mdi:arrow-down",width:"24"})}),(0,x.jsxs)("div",{className:"diff-section after",children:[(0,x.jsxs)("div",{className:"diff-header",children:[(0,x.jsx)(l.In,{icon:"mdi:plus-circle",width:"14"}),(0,x.jsx)("span",{children:"New Baseline (Evolved)"})]}),(0,x.jsx)("div",{className:"diff-content evolved",children:n})]})]})}const z=e=>{let{isOpen:s,onClose:n,generation:t,currentBaseline:a,cascadeId:o,cellName:c,onEvolve:r}=e;const[d,h]=(0,i.useState)(!1),[m,u]=(0,i.useState)(null);if(!s||!t)return null;const p=t.takes.find(e=>e.is_winner)||t.takes[0],j=(null===p||void 0===p?void 0:p.prompt)||"";return(0,x.jsx)("div",{className:"evolve-modal-overlay",onClick:n,children:(0,x.jsxs)("div",{className:"evolve-modal",onClick:e=>e.stopPropagation(),children:[(0,x.jsxs)("div",{className:"evolve-modal-header",children:[(0,x.jsx)(l.In,{icon:"mdi:dna",width:"24",className:"modal-icon"}),(0,x.jsxs)("div",{className:"modal-title-section",children:[(0,x.jsx)("h2",{children:"\u26a1 Evolve Species"}),(0,x.jsxs)("p",{className:"modal-subtitle",children:["Create new baseline from Gen ",t.generation," winner"]})]}),(0,x.jsx)("button",{className:"close-modal-btn",onClick:n,children:(0,x.jsx)(l.In,{icon:"mdi:close",width:"20"})})]}),(0,x.jsxs)("div",{className:"evolve-modal-body",children:[(0,x.jsx)(A,{before:a,after:j}),(0,x.jsxs)("div",{className:"evolve-metadata",children:[(0,x.jsxs)("div",{className:"metadata-item",children:[(0,x.jsx)(l.In,{icon:"mdi:tag",width:"14"}),(0,x.jsxs)("span",{children:["Cascade: ",(0,x.jsx)("code",{children:o})]})]}),(0,x.jsxs)("div",{className:"metadata-item",children:[(0,x.jsx)(l.In,{icon:"mdi:hexagon-outline",width:"14"}),(0,x.jsxs)("span",{children:["Cell: ",(0,x.jsx)("code",{children:c})]})]}),(0,x.jsxs)("div",{className:"metadata-item",children:[(0,x.jsx)(l.In,{icon:"mdi:counter",width:"14"}),(0,x.jsxs)("span",{children:["Generation: ",(0,x.jsx)("strong",{children:t.generation})]})]}),(null===p||void 0===p?void 0:p.model)&&(0,x.jsxs)("div",{className:"metadata-item",children:[(0,x.jsx)(l.In,{icon:"mdi:robot",width:"14"}),(0,x.jsxs)("span",{children:["Model: ",(0,x.jsx)("code",{children:p.model.split("/").pop()})]})]})]}),(0,x.jsxs)("div",{className:"evolve-warning",children:[(0,x.jsx)(l.In,{icon:"mdi:alert",width:"16"}),(0,x.jsxs)("div",{className:"warning-text",children:[(0,x.jsx)("strong",{children:"This will update your cascade YAML file"})," and create a new species. Future runs will use this evolved prompt as the baseline."]})]}),m&&(0,x.jsxs)("div",{className:"evolve-error",children:[(0,x.jsx)(l.In,{icon:"mdi:alert-circle",width:"16"}),(0,x.jsx)("span",{children:m})]})]}),(0,x.jsxs)("div",{className:"evolve-modal-footer",children:[(0,x.jsx)("button",{className:"cancel-btn",onClick:n,disabled:d,children:"Cancel"}),(0,x.jsx)("button",{className:"evolve-btn",onClick:async()=>{h(!0),u(null);try{var e,s;const i=await fetch("http://localhost:5050/api/sextant/evolve-species",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cascade_id:o,cell_name:c,new_instructions:j,promoted_from:{session_id:t.session_id,generation:t.generation,take_index:p.take_index,old_species_hash:(null===(e=t.parent_winners)||void 0===e||null===(s=e[0])||void 0===s?void 0:s.session_id)||null}})}),a=await i.json();if(a.error)throw new Error(a.error);console.log("[EvolveModal] Species evolved:",a),r&&r(a),n()}catch(i){console.error("[EvolveModal] Failed to evolve:",i),u(i.message)}finally{h(!1)}},disabled:d,children:d?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(l.In,{icon:"mdi:loading",width:"16",className:"spin"}),(0,x.jsx)("span",{children:"Evolving..."})]}):(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(l.In,{icon:"mdi:dna",width:"16"}),(0,x.jsx)("span",{children:"\u26a1 Evolve Species"})]})})]})]})})};var q=n(60263);const H=()=>{var e;const{cascadeId:s,sessionId:n}=(0,t.g)(),o=(0,t.Zp)(),c=s?decodeURIComponent(s):null,r=n?decodeURIComponent(n):null,[d,h]=(0,i.useState)(null),[m,u]=(0,i.useState)(null),[p,j]=(0,i.useState)(null),[g,f]=(0,i.useState)([]),[_,k]=(0,i.useState)([]),[I,S]=(0,i.useState)(!0),[E,F]=(0,i.useState)(!1),[G,M]=(0,i.useState)(!1),[P,A]=(0,i.useState)("ngrams"),[H,R]=(0,i.useState)(!1),[W,O]=(0,i.useState)(null),[$,B]=(0,i.useState)(null),[V,D]=(0,i.useState)([]),[U,Z]=(0,i.useState)([]),[X,Y]=(0,i.useState)(!1),[J,K]=(0,i.useState)(null),[Q,ee]=(0,i.useState)(null),[se,ne]=(0,i.useState)([70,30]),[ie,te]=(0,i.useState)("linear");(0,i.useEffect)(()=>{c&&h(c),r&&u(r)},[c,r]),(0,i.useEffect)(()=>{ae()},[]),(0,i.useEffect)(()=>{d&&!m&&le()},[d]);const ae=async()=>{try{S(!0);const e=await fetch("http://localhost:5050/api/sextant/cascades"),s=await e.json();f(s.cascades||[])}catch(e){console.error("Failed to fetch cascades:",e)}finally{S(!1)}},le=async()=>{if(d)try{var e;F(!0);const s=await fetch("http://localhost:5050/api/sessions?cascade_id=".concat(d,"&limit=20")),n=await s.json();let i=null,t=null,a=null;for(const e of n.sessions||[]){const s=await fetch("http://localhost:5050/api/sextant/evolution/".concat(e.session_id,"?as_of=session&include_future=false")),n=await s.json();if(n.nodes&&n.nodes.length>0&&n.metadata){i=n.metadata.cell_name,t=n.metadata.species_hash,a=e.session_id;break}}if(!i)return console.warn("[Evolution] No sessions with evolution data found for cascade:",d),void F(!1);const l=await fetch("http://localhost:5050/api/sextant/species/".concat(d,"/").concat(i)),o=await l.json();k(o.species||[]),console.log("[Evolution] Found species:",null===(e=o.species)||void 0===e?void 0:e.length),o.species&&1===o.species.length?(j(o.species[0].species_hash),u(a),console.log("[Evolution] Auto-selected single species and session")):o.species&&o.species.length>1?(j(t),u(a),console.log("[Evolution] Multiple species found, user can choose")):u(a),F(!1)}catch(s){console.error("Failed to fetch latest session:",s),F(!1)}},oe=async e=>{if(d&&e)try{const i=await fetch("http://localhost:5050/api/sessions?cascade_id=".concat(d,"&limit=20")),t=await i.json();for(const a of t.sessions||[]){var s,n;const i=await fetch("http://localhost:5050/api/sextant/evolution/".concat(a.session_id,"?as_of=session&include_future=false")),t=await i.json();if((null===(s=t.metadata)||void 0===s?void 0:s.species_hash)===e&&(null===(n=t.nodes)||void 0===n?void 0:n.length)>0)return u(a.session_id),void console.log("[Evolution] Found session for species:",a.session_id)}console.warn("[Evolution] No session found for species:",e)}catch(i){console.error("Failed to fetch session for species:",i)}},ce=(null===(e=V.find(e=>1===e.data.generation&&0===e.data.take_index))||void 0===e?void 0:e.data.prompt)||"";(0,i.useEffect)(()=>{m&&re()},[m,p]);const re=async()=>{if(m){Y(!0),K(null);try{var e;const s=new URLSearchParams({as_of:"session",include_future:"false"});p&&s.append("species_hash",p);const n=await fetch("http://localhost:5050/api/sextant/evolution/".concat(m,"?").concat(s));if(!n.ok)throw new Error("HTTP ".concat(n.status,": ").concat(n.statusText));const i=await n.json();if(i.error)throw new Error(i.error);D(i.nodes||[]),Z(i.edges||[]),B(i.metadata||{}),console.log("[Evolution] Data loaded:",null===(e=i.nodes)||void 0===e?void 0:e.length,"nodes")}catch(s){console.error("[Evolution] Failed to fetch evolution data:",s),K(s.message)}finally{Y(!1)}}},de=g.find(e=>e.cascade_id===d);return(0,x.jsxs)("div",{className:"evolution-view",children:[(0,x.jsxs)("div",{className:"evolution-header",children:[(0,x.jsxs)("div",{className:"evolution-header-left",children:[(0,x.jsx)(l.In,{icon:"mdi:family-tree",width:"32",className:"evolution-icon"}),(0,x.jsxs)("div",{className:"evolution-header-text",children:[(0,x.jsx)("h1",{children:"Evolution"}),(0,x.jsx)("p",{className:"evolution-subtitle",children:"Prompt Observatory"})]})]}),(0,x.jsx)("div",{className:"evolution-header-right",children:$?(0,x.jsxs)("div",{className:"evolution-stats",children:[$.cell_name&&(0,x.jsxs)("div",{className:"stat-item cell-name",children:[(0,x.jsx)(l.In,{icon:"mdi:hexagon-outline",width:"16"}),(0,x.jsx)("span",{children:$.cell_name})]}),(0,x.jsxs)("div",{className:"stat-item",children:[(0,x.jsx)(l.In,{icon:"mdi:counter",width:"16"}),(0,x.jsxs)("span",{children:[$.session_count||0," generations"]})]}),(0,x.jsxs)("div",{className:"stat-item",children:[(0,x.jsx)(l.In,{icon:"mdi:trophy",width:"16"}),(0,x.jsxs)("span",{children:[$.winner_count||0," winners"]})]}),(0,x.jsxs)("div",{className:"stat-item",children:[(0,x.jsx)(l.In,{icon:"mdi:graph-outline",width:"16"}),(0,x.jsxs)("span",{children:[$.total_takes||0," attempts"]})]})]}):de?(0,x.jsxs)("div",{className:"evolution-stats",children:[(0,x.jsxs)("div",{className:"stat-item cascade-wide",title:"Cascade-wide stats (all cells)",children:[(0,x.jsx)(l.In,{icon:"mdi:information-outline",width:"14"}),(0,x.jsx)("span",{style:{fontSize:"11px",opacity:.7},children:"Cascade-wide:"})]}),(0,x.jsxs)("div",{className:"stat-item",children:[(0,x.jsx)(l.In,{icon:"mdi:counter",width:"16"}),(0,x.jsxs)("span",{children:[de.session_count," runs"]})]}),(0,x.jsxs)("div",{className:"stat-item",children:[(0,x.jsx)(l.In,{icon:"mdi:trophy",width:"16"}),(0,x.jsxs)("span",{children:[de.winner_count," total winners"]})]})]}):null})]}),(0,x.jsxs)("div",{className:"evolution-controls",children:[(0,x.jsx)(w,{cascades:g,selected:d,onSelect:e=>{h(e),u(null),j(null),k([]),e&&o(q.bw.evolutionWithCascade(e))},loading:I}),d&&(0,x.jsxs)("div",{className:"view-mode-toggle",children:[(0,x.jsxs)("button",{className:"mode-btn ".concat("graph"===ie?"active":""),onClick:()=>te("graph"),title:"Graph view - spatial tree layout",children:[(0,x.jsx)(l.In,{icon:"mdi:graph-outline",width:"16"}),(0,x.jsx)("span",{children:"Graph"})]}),(0,x.jsxs)("button",{className:"mode-btn ".concat("linear"===ie?"active":""),onClick:()=>te("linear"),title:"Linear view - horizontal influence flow",children:[(0,x.jsx)(l.In,{icon:"mdi:arrow-right-bold",width:"16"}),(0,x.jsx)("span",{children:"Linear"})]})]}),m&&(0,x.jsxs)("div",{className:"evolution-session-badge",children:[(0,x.jsx)(l.In,{icon:"mdi:map-marker",width:"16"}),(0,x.jsx)("span",{children:"Viewing evolution for:"}),(0,x.jsxs)("code",{children:[m.slice(0,12),"..."]}),(0,x.jsx)("button",{className:"clear-session-btn",onClick:()=>{return u(e=null),void(e&&d&&o(q.bw.evolutionWithSession(d,e)));var e},title:"Show all generations",children:(0,x.jsx)(l.In,{icon:"mdi:close",width:"16"})})]})]}),d?(0,x.jsxs)(x.Fragment,{children:[_.length>0&&(0,x.jsx)("div",{className:"evolution-species-inline",children:(0,x.jsx)(N,{species:_,selected:p,onSelect:e=>{j(e),u(null),oe(e)}})}),V.length>0&&(0,x.jsx)(C,{nodes:V,metadata:$}),(0,x.jsx)("div",{className:"evolution-main-section",children:"graph"===ie?(0,x.jsxs)(a.A,{className:"evolution-split",sizes:se,minSize:[400,200],gutterSize:8,onDragEnd:e=>ne(e),children:[(0,x.jsx)("div",{className:"evolution-phylogeny-section",children:(0,x.jsx)(v,{nodes:V,edges:U,metadata:$,loading:X,error:J,highlightedNode:Q})}),(0,x.jsx)("div",{className:"evolution-timeline-section",children:(0,x.jsx)(T,{metadata:$,nodes:V,onNodeFocus:e=>{console.log("[Evolution] Focusing node:",e),ee(e)},highlightedNode:Q,currentSessionId:m})})]}):(0,x.jsx)(L,{nodes:V,currentSessionId:m,onEvolveClick:e=>{console.log("[Evolution] Evolve clicked for generation:",e.generation),O(e),R(!0)}})}),(0,x.jsxs)("div",{className:"evolution-patterns-section",children:[(0,x.jsxs)("button",{className:"patterns-toggle",onClick:()=>M(!G),children:[(0,x.jsx)(l.In,{icon:G?"mdi:chevron-down":"mdi:chevron-right",width:"20"}),(0,x.jsx)(l.In,{icon:"mdi:chart-bar",width:"20"}),(0,x.jsx)("span",{children:"Analysis"}),(0,x.jsx)("span",{className:"patterns-hint",children:"Phrase patterns & model performance"})]}),G&&(0,x.jsxs)("div",{className:"analysis-panel",children:[(0,x.jsxs)("div",{className:"analysis-tabs",children:[(0,x.jsxs)("button",{className:"analysis-tab ".concat("ngrams"===P?"active":""),onClick:()=>A("ngrams"),children:[(0,x.jsx)(l.In,{icon:"mdi:text-search",width:"16"}),(0,x.jsx)("span",{children:"Phrases"})]}),(0,x.jsxs)("button",{className:"analysis-tab ".concat("models"===P?"active":""),onClick:()=>A("models"),children:[(0,x.jsx)(l.In,{icon:"mdi:robot",width:"16"}),(0,x.jsx)("span",{children:"Models"})]})]}),(0,x.jsx)("div",{className:"analysis-tab-content",children:"ngrams"===P&&null!==$&&void 0!==$&&$.cell_name?(0,x.jsx)(b,{cascadeId:d,cellName:$.cell_name,speciesHash:p||$.species_hash}):"models"===P?(0,x.jsx)(y,{nodes:V}):null})]})]})]}):(0,x.jsxs)("div",{className:"evolution-empty",children:[(0,x.jsx)(l.In,{icon:"mdi:telescope",width:"64"}),(0,x.jsx)("h2",{children:"Select a Cascade to Analyze"}),(0,x.jsx)("p",{children:"Evolution visualizes how prompts evolve across multiple runs using a gene pool metaphor. See which approaches win, how winners train new generations, and discover optimization opportunities."}),(0,x.jsxs)("div",{className:"evolution-empty-hints",children:[(0,x.jsxs)("div",{className:"hint-item",children:[(0,x.jsx)(l.In,{icon:"mdi:dna",width:"20"}),(0,x.jsx)("span",{children:"Gene Pool: Winners train the next generation"})]}),(0,x.jsxs)("div",{className:"hint-item",children:[(0,x.jsx)(l.In,{icon:"mdi:fire",width:"20"}),(0,x.jsx)("span",{children:"Pattern Analysis: See what makes winners win"})]}),(0,x.jsxs)("div",{className:"hint-item",children:[(0,x.jsx)(l.In,{icon:"mdi:chart-timeline",width:"20"}),(0,x.jsx)("span",{children:"Time Travel: View evolution as of any session"})]})]})]}),(0,x.jsx)(z,{isOpen:H,onClose:()=>R(!1),generation:W,currentBaseline:ce,cascadeId:d,cellName:null===$||void 0===$?void 0:$.cell_name,onEvolve:e=>{console.log("[Evolution] Species evolved:",e),ae()}})]})}}}]);
//# sourceMappingURL=225.5a545907.chunk.js.map