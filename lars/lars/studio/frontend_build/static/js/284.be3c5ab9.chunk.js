"use strict";(self.webpackChunklars_ui=self.webpackChunklars_ui||[]).push([[284],{88707:(e,t,o)=>{o.r(t),o.d(t,{default:()=>w});var a=o(65043),n=o(45685),l=o(94424),s=o(87955),r=o(5748),i=o(64065),c=o(55785),d=o(90628),u=o(26232),p=o(60263),h=o(70579);s.syG.registerModules([s.JKr]);const f=()=>(0,h.jsx)("div",{className:"ag-overlay-loading-center",style:{height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,h.jsx)(i.lp,{size:"small",message:"Loading..."})}),m=e=>{const t=e.value;if(!t)return(0,h.jsx)("span",{style:{color:"#475569",fontSize:"11px"},children:"-"});const o={tiny:{label:"T",color:"#34d399"},small:{label:"S",color:"#60a5fa"},medium:{label:"M",color:"#94a3b8"},large:{label:"L",color:"#fbbf24"},huge:{label:"H",color:"#f87171"}}[t]||{label:"?",color:"#94a3b8"};return(0,h.jsx)("span",{style:{background:o.color,color:"#0f172a",padding:"2px 6px",borderRadius:"3px",fontSize:"11px",fontWeight:"600"},children:o.label})},g=e=>{const t=e.value||0,o=e.data.cost_z_score||0,a=e.data.is_cost_outlier?"#f87171":Math.abs(o)>1?"#fbbf24":"#34d399",n=Math.abs(o)>1?"(".concat(o>0?"+":"").concat(o.toFixed(1),"\u03c3)"):"";return(0,h.jsxs)("div",{style:{color:a,fontWeight:"500"},children:[(0,h.jsxs)("div",{children:["$",t.toFixed(4)]}),n&&(0,h.jsx)("div",{style:{fontSize:"10px",marginTop:"2px"},children:n})]})},_=e=>{const t=e.value||0,o=e.data.total_context_cost_estimated||0,a=t>60?"#fbbf24":t<30?"#34d399":"#94a3b8";return(0,h.jsxs)("div",{style:{color:a,fontWeight:"500"},children:[(0,h.jsxs)("div",{children:[t.toFixed(0),"%"]}),t>0&&(0,h.jsxs)("div",{style:{fontSize:"10px",marginTop:"2px",color:"#64748b"},children:["ctx: $",o.toFixed(3)]})]})},x=e=>{const t=e.value||0,o=(t/1e3).toFixed(1),a=e.data.cluster_avg_duration||0,n=e.data.is_duration_outlier,l=n?"#f87171":"#94a3b8",s=a>0?(t/a).toFixed(1):null;return(0,h.jsxs)("div",{style:{color:l,fontWeight:"500"},children:[(0,h.jsxs)("div",{children:[o,"s"]}),n&&s&&(0,h.jsxs)("div",{style:{fontSize:"10px",marginTop:"2px",color:"#64748b"},children:[s,"x slower"]})]})},v=e=>{const t=e.value||[];if(!t.length)return(0,h.jsx)("span",{style:{color:"#475569",fontSize:"11px"},children:"-"});const o=e=>{const t=e.split("/");return t[t.length-1]},a=[{bg:"rgba(167, 139, 250, 0.2)",border:"#a78bfa",text:"#c4b5fd"},{bg:"rgba(96, 165, 250, 0.2)",border:"#60a5fa",text:"#93c5fd"},{bg:"rgba(52, 211, 153, 0.2)",border:"#34d399",text:"#6ee7b7"},{bg:"rgba(251, 191, 36, 0.2)",border:"#fbbf24",text:"#fcd34d"},{bg:"rgba(248, 113, 113, 0.2)",border:"#f87171",text:"#fca5a5"},{bg:"rgba(45, 212, 191, 0.2)",border:"#2dd4bf",text:"#5eead4"}];return(0,h.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:"3px",alignItems:"center",paddingTop:"10px"},children:t.map((e,t)=>{const n=a[t%a.length];return(0,h.jsx)("span",{title:e,style:{display:"inline-block",padding:"1px 5px",fontSize:"9px",fontWeight:"500",fontFamily:"var(--font-mono)",backgroundColor:n.bg,border:"1px solid ".concat(n.border),borderRadius:"3px",color:n.text,whiteSpace:"nowrap",maxWidth:"100px",overflow:"hidden",textOverflow:"ellipsis",lineHeight:"1.3"},children:o(e)},e)})})},b=s.zl0.withParams({backgroundColor:"#000000",foregroundColor:"#cbd5e1",headerBackgroundColor:"#0a0510",headerTextColor:"#f0f4f8",oddRowBackgroundColor:"#050410",borderColor:"#1a1628",rowBorder:!0,wrapperBorder:!1,headerFontSize:12,headerFontWeight:600,fontFamily:"'Google Sans Code', monospace",fontSize:13,accentColor:"#00e5ff",chromeBackgroundColor:"#000000"}),y=["analyze_context_relevance"],w=()=>{const[e,t]=(0,a.useState)([]),[o,s]=(0,a.useState)(null),[i,w]=(0,a.useState)(!0),[S,j]=(0,a.useState)(null),[C,N]=(0,a.useState)(600),F=(0,u.I)({pollInterval:6e4}),[T,z]=(0,a.useState)(!0),R=(0,a.useRef)(null),I=(0,a.useRef)(null),k=(0,n.Zp)(),M=(0,a.useRef)(null),D=async()=>{try{0===e.length&&w(!0);const o=await fetch("http://localhost:5050/api/sessions?limit=100"),a=await o.json();if(a.error)return void j(a.error);const n=(a.sessions||[]).map(e=>({session_id:e.session_id,cascade_id:e.cascade_id,status:e.status,current_cell:e.current_cell||e.current_cell,started_at:e.started_at,completed_at:e.completed_at,updated_at:e.updated_at,error_message:e.error_message,depth:e.depth||0,duration:e.completed_at&&e.started_at?W(new Date(e.completed_at)-new Date(e.started_at)):"RUNNING"===e.status?"Running...":"-",total_cost:e.total_cost||0,total_duration_ms:e.total_duration_ms||0,message_count:e.message_count||0,input_data:e.input_data,output:e.output||null,cost_diff_pct:e.cost_diff_pct,messages_diff_pct:e.messages_diff_pct,duration_diff_pct:e.duration_diff_pct,input_category:e.input_category,input_char_count:e.input_char_count||0,cost_z_score:e.cost_z_score||0,duration_z_score:e.duration_z_score||0,is_cost_outlier:e.is_cost_outlier||!1,is_duration_outlier:e.is_duration_outlier||!1,cluster_avg_cost:e.cluster_avg_cost||0,cluster_avg_duration:e.cluster_avg_duration||0,cluster_run_count:e.cluster_run_count||0,context_cost_pct:e.context_cost_pct||0,total_context_cost_estimated:e.total_context_cost_estimated||0,models:e.models||[]})),l=JSON.stringify(n.map(e=>({id:e.session_id,status:e.status,cell:e.current_cell,updated:e.updated_at,cost:e.total_cost,msgs:e.message_count})));l!==M.current?(console.log("[Console] Data changed, updating grid. Sample row:",n[0]),t(n),M.current=l):console.log("[Console] Data unchanged, skipping update"),j(null)}catch(o){j(o.message)}finally{w(!1)}},H=async()=>{try{const e=await fetch("http://localhost:5050/api/console/kpis"),t=await e.json();if(t.error)return void console.error("[Console] KPI fetch error:",t.error);s(t)}catch(e){console.error("[Console] KPI fetch failed:",e.message)}};(0,a.useEffect)(()=>{D(),H();const e=setInterval(()=>{D(),H()},1e4);return()=>clearInterval(e)},[]),(0,a.useEffect)(()=>{const e=()=>{if(!I.current)return;const e=window.innerHeight,t=e-I.current.getBoundingClientRect().top-20,o=Math.max(400,Math.min(t,.7*e));N(o)};e(),window.addEventListener("resize",e);const t=setTimeout(e,100);return()=>{window.removeEventListener("resize",e),clearTimeout(t)}},[]);const W=e=>{if(!e)return"-";const t=Math.floor(e/1e3);if(t<60)return"".concat(t,"s");const o=Math.floor(t/60),a=t%60;return"".concat(o,"m ").concat(a,"s")},B=(0,a.useMemo)(()=>T?e.filter(e=>!y.includes(e.cascade_id)):e,[e,T]),L=(0,a.useMemo)(()=>[{field:"session_id",headerName:"Session ID",cellClass:"console-session-id",flex:2,minWidth:180},{field:"cascade_id",headerName:"Cascade",flex:2,minWidth:150},{field:"status",headerName:"Status",width:100,cellRenderer:e=>{var t;const o={running:"#00e5ff",starting:"#00e5ff",completed:"#34d399",error:"#ff006e",cancelled:"#64748b",blocked:"#fbbf24",orphaned:"#9333ea"}[null===(t=e.value)||void 0===t?void 0:t.toLowerCase()]||"#64748b";return(0,h.jsx)("span",{style:{color:o,fontWeight:600,textTransform:"uppercase",fontSize:"11px"},children:e.value})}},{field:"models",headerName:"Models",headerTooltip:"LLM models used in this session",width:180,wrapText:!0,autoHeight:!0,cellRenderer:v,tooltipValueGetter:e=>{const t=e.value||[];return t.length?t.join("\n"):"No models used"}},{field:"current_cell",headerName:"Last Cell",flex:1,minWidth:120,hide:!0},{field:"output",headerName:"Output",flex:2,minWidth:180,wrapText:!0,autoHeight:!0,valueFormatter:e=>{if(!e.value)return"-";const t=String(e.value);return t.length>150?t.slice(0,150)+"...":t},tooltipValueGetter:e=>e.value?String(e.value):null,cellStyle:{fontFamily:"var(--font-mono)",fontSize:"12px",color:"#94a3b8",lineHeight:"1.4",whiteSpace:"normal",paddingTop:"8px",paddingBottom:"8px"}},{field:"input_category",headerName:"Input",headerTooltip:"Input size category for apples-to-apples comparison",width:80,cellRenderer:m,tooltipValueGetter:e=>{const t=e.value,o=e.data.input_char_count||0;return t?"Input size: ".concat(t," (").concat(o," chars)"):o>0?"Input size: ".concat(o," chars (no category)"):"No input data"}},{field:"total_cost",headerName:"Cost",headerTooltip:"Statistical anomaly score vs similar input size runs",width:130,wrapText:!0,autoHeight:!0,cellRenderer:g,tooltipValueGetter:e=>{const t=e.value||0,o=e.data.cluster_avg_cost||0,a=e.data.cluster_run_count||0,n=e.data.cost_z_score||0;return"Cost: $".concat(t.toFixed(4)," | Cluster avg: $").concat(o.toFixed(4)," (n=").concat(a," similar runs) | Z-score: ").concat(n.toFixed(1),"\u03c3")},cellStyle:{fontFamily:"var(--font-mono)",lineHeight:"1.4",whiteSpace:"normal",paddingTop:"4px",paddingBottom:"4px"}},{field:"context_cost_pct",headerName:"Context%",headerTooltip:"Percentage of cost from context injection vs new tokens",width:100,wrapText:!0,autoHeight:!0,cellRenderer:_,tooltipValueGetter:e=>{const t=e.value||0,o=e.data.total_context_cost_estimated||0,a=(e.data.total_cost||0)-o;return"Context cost: $".concat(o.toFixed(4)," (").concat(t.toFixed(0),"%) | New tokens: $").concat(a.toFixed(4))},cellStyle:{fontFamily:"var(--font-mono)",lineHeight:"1.4",whiteSpace:"normal",paddingTop:"4px",paddingBottom:"4px"}},{field:"total_duration_ms",headerName:"Duration",headerTooltip:"Execution time compared to similar input size runs",width:120,wrapText:!0,autoHeight:!0,cellRenderer:x,tooltipValueGetter:e=>{const t=e.value||0,o=e.data.cluster_avg_duration||0,a=e.data.cluster_run_count||0,n=o>0?(t/o).toFixed(1):0;return"Duration: ".concat((t/1e3).toFixed(1),"s | Cluster avg: ").concat((o/1e3).toFixed(1),"s (n=").concat(a," similar runs) | ").concat(n,"x ").concat(t>o?"slower":"faster")},cellStyle:{fontFamily:"var(--font-mono)",lineHeight:"1.4",whiteSpace:"normal",paddingTop:"4px",paddingBottom:"4px"}},{field:"cost_diff_pct",hide:!0},{field:"messages_diff_pct",hide:!0},{field:"duration_diff_pct",hide:!0},{field:"message_count",hide:!0},{field:"input_data",headerName:"Inputs",flex:2,minWidth:150,wrapText:!0,autoHeight:!0,valueFormatter:e=>{if(!e.value)return"-";try{const t="string"===typeof e.value?JSON.parse(e.value):e.value;if("object"===typeof t&&null!==t){const e=JSON.stringify(t,null,2);return e.length>150?e.slice(0,150)+"...":e}const o=JSON.stringify(t);return o.length>150?o.slice(0,150)+"...":o}catch(t){const o=String(e.value);return o.length>150?o.slice(0,150)+"...":o}},tooltipValueGetter:e=>{if(!e.value)return null;try{const t="string"===typeof e.value?JSON.parse(e.value):e.value;return JSON.stringify(t,null,2)}catch(t){return String(e.value)}},cellStyle:{fontFamily:"var(--font-mono)",fontSize:"12px",lineHeight:"1.4",whiteSpace:"normal",paddingTop:"8px",paddingBottom:"8px"}},{field:"started_at",headerName:"Started",width:100,valueFormatter:e=>{if(!e.value)return"-";const t=new Date(e.value+"Z"),o=new Date-t,a=Math.floor(o/6e4),n=Math.floor(a/60),l=Math.floor(n/24);if(a<1)return"<1m ago";if(a<60)return"".concat(a,"m ago");if(n<24){const e=a%60;return e>0?"".concat(n,"h ").concat(e,"m ago"):"".concat(n,"h ago")}if(l<7){const e=n%24;return e>0?"".concat(l,"d ").concat(e,"h ago"):"".concat(l,"d ago")}return t.toLocaleDateString(void 0,{month:"short",day:"numeric"})},tooltipValueGetter:e=>{if(!e.value)return null;const t=new Date(e.value+"Z");return"Local: ".concat(t.toLocaleString(),"\nUTC: ").concat(e.value)}}],[]),O=(0,a.useMemo)(()=>({sortable:!0,filter:!0,resizable:!0,autoHeight:!0,wrapText:!1,menuTabs:["filterMenuTab","generalMenuTab","columnsMenuTab"]}),[]);return(0,h.jsxs)("div",{className:"console-view",children:[(0,h.jsxs)("div",{className:"console-header",children:[(0,h.jsxs)("div",{className:"console-title",children:[(0,h.jsx)(r.In,{icon:"mdi:console",width:"32"}),(0,h.jsx)("h1",{children:"Console"})]}),(0,h.jsx)("div",{className:"console-subtitle",children:"System analytics and recent activity"})]}),(o||null!==F.balance)&&(0,h.jsxs)("div",{className:"console-kpi-grid",style:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:"12px",marginBottom:"16px"},children:[o&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(d.A,{icon:"mdi:cash",title:"24h Cost",value:"$".concat(o.total_cost_24h.toFixed(2)),subtitle:o.cost_trend,color:"#34d399"}),(0,h.jsx)(d.A,{icon:"mdi:alert-circle",title:"Active Outliers",value:o.outlier_count,subtitle:"in last 24h",color:o.outlier_count>0?"#f87171":"#94a3b8"}),(0,h.jsx)(d.A,{icon:"mdi:percent",title:"Avg Context%",value:"".concat(o.avg_context_pct.toFixed(0),"%"),subtitle:o.context_trend,color:"#60a5fa"})]}),(0,h.jsx)(d.A,{icon:"mdi:wallet",title:"OR Balance",value:null!==F.balance?"$".concat(F.balance.toFixed(2)):"\u2014",subtitle:null!==F.runwayDays?"~".concat(F.runwayDays,"d runway"):null!==F.burnRate24h?"$".concat(F.burnRate24h.toFixed(2),"/hr"):null,color:null===F.balance?"#64748b":F.balance>20?"#34d399":F.balance>5?"#fbbf24":"#f87171"})]}),(0,h.jsxs)("div",{className:"console-section",children:[(0,h.jsxs)("div",{className:"console-section-header",children:[(0,h.jsx)(r.In,{icon:"mdi:chart-line",width:"14"}),(0,h.jsx)("h2",{children:"Cost Timeline"})]}),(0,h.jsx)("div",{className:"console-chart-wrapper",children:(0,h.jsx)(c.A,{})})]}),(0,h.jsxs)("div",{className:"console-section",children:[(0,h.jsxs)("div",{className:"console-section-header",children:[(0,h.jsx)(r.In,{icon:"mdi:table",width:"14"}),(0,h.jsx)("h2",{children:"Recent Sessions"}),(0,h.jsxs)("span",{className:"console-count",children:[T&&B.length!==e.length?"".concat(B.length," of ").concat(e.length):e.length," sessions"]}),(0,h.jsxs)("button",{className:"console-system-toggle ".concat(T?"active":""),onClick:()=>z(!T),title:T?"Show system cascades":"Hide system cascades",children:[(0,h.jsx)(r.In,{icon:T?"mdi:eye-off":"mdi:eye",width:"12"}),(0,h.jsx)("span",{children:"System"})]})]}),S&&(0,h.jsxs)("div",{className:"console-error",children:[(0,h.jsx)(r.In,{icon:"mdi:alert-circle",width:"20"}),(0,h.jsx)("span",{children:S})]}),!S&&(0,h.jsx)("div",{ref:I,className:"console-grid-container",style:{height:"".concat(C,"px")},children:(0,h.jsx)(l.W6,{ref:R,theme:b,rowData:B,columnDefs:L,defaultColDef:O,getRowId:e=>e.data.session_id,domLayout:"normal",suppressCellFocus:!0,suppressMovableColumns:!1,enableCellTextSelection:!0,ensureDomOrder:!0,animateRows:!0,loading:i,loadingOverlayComponent:f,onRowClicked:e=>{const{cascade_id:t,session_id:o}=e.data;t&&o&&k(p.bw.studioWithSession(t,o))},onFirstDataRendered:e=>{e.api.sizeColumnsToFit()},rowClass:"console-grid-row-clickable",tooltipShowDelay:500})})]})]})}}}]);
//# sourceMappingURL=284.be3c5ab9.chunk.js.map