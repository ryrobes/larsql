(self.webpackChunklars_ui=self.webpackChunklars_ui||[]).push([[330],{13218:e=>{"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},41497:(e,t,s)=>{"use strict";var a=s(13218);function n(){}function i(){}i.resetWarningCache=n,e.exports=function(){function e(e,t,s,n,i,r){if(r!==a){var c=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw c.name="Invariant Violation",c}}function t(){return e}e.isRequired=e;var s={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:i,resetWarningCache:n};return s.PropTypes=s,s}},65173:(e,t,s)=>{e.exports=s(41497)()},68268:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>$});var a=s(65043),n=s(5748),i=s(64065),r=s(70579);const c=e=>{let{title:t,value:s,subtitle:a,trend:i,icon:c,color:l="#00e5ff"}=e;const o=i>0?"#ff006e":i<0?"#34d399":"#64748b",d=i>0?"mdi:trending-up":"mdi:trending-down";return(0,r.jsxs)("div",{className:"training-kpi-card",children:[(0,r.jsx)("div",{className:"training-kpi-icon",children:(0,r.jsx)(n.In,{icon:c,width:14,style:{color:"#475569"}})}),(0,r.jsxs)("div",{className:"training-kpi-content",children:[(0,r.jsx)("span",{className:"training-kpi-label",children:t}),(0,r.jsx)("span",{className:"training-kpi-value",style:{color:l},children:s}),a&&(0,r.jsx)("span",{className:"training-kpi-unit",children:a})]}),void 0!==i&&0!==i&&(0,r.jsxs)("div",{className:"training-kpi-trend",style:{color:o},children:[(0,r.jsx)(n.In,{icon:d,width:12}),(0,r.jsxs)("span",{children:[Math.abs(i).toFixed(0),"%"]})]})]})},l=(0,a.memo)(c);var o=s(45685),d=s(94424),m=s(87955),h=s(24768),u=s(60263),p=s(11704),x=s(18571);const g=e=>{let{example:t,onClose:s}=e;const a=(0,o.Zp)();if(!t)return null;const i=()=>{try{const e=JSON.parse(t.user_input);return JSON.stringify(e,null,2)}catch(e){return t.user_input}},c=(()=>{const e=i(),t=e.match(/TEXT:\s*([^\n]+)/),s=e.match(/CRITERION:\s*([^\n]+)/);return t&&s?{text:t[1].trim(),criterion:s[1].trim(),isSemanticSQL:!0}:{isSemanticSQL:!1}})();return(0,r.jsxs)("div",{className:"training-detail-panel",children:[(0,r.jsxs)("div",{className:"training-detail-header",children:[(0,r.jsxs)("div",{className:"training-detail-title",children:[(0,r.jsx)(n.In,{icon:"mdi:information",width:16,style:{color:"#00e5ff"}}),(0,r.jsx)("span",{className:"training-detail-cascade",children:t.cascade_id}),(0,r.jsx)("span",{className:"training-detail-sep",children:"\xb7"}),(0,r.jsx)("span",{className:"training-detail-cell",children:t.cell_name}),t.model&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"training-detail-sep",children:"\xb7"}),(0,r.jsx)("span",{className:"training-detail-model",children:t.model})]})]}),(0,r.jsxs)("div",{className:"training-detail-meta",children:[t.cost>0&&(0,r.jsxs)("span",{className:"training-detail-cost",children:["$",t.cost.toFixed(4)]}),t.tokens_in>0&&(0,r.jsxs)("span",{className:"training-detail-tokens",children:[t.tokens_in.toLocaleString()," in"]}),t.tokens_out>0&&(0,r.jsxs)("span",{className:"training-detail-tokens",children:[t.tokens_out.toLocaleString()," out"]}),(0,r.jsx)("button",{className:"training-detail-close",onClick:s,title:"Close detail panel",children:(0,r.jsx)(n.In,{icon:"mdi:close",width:16})})]})]}),(0,r.jsxs)("div",{className:"training-detail-body",children:[c.isSemanticSQL&&(0,r.jsxs)("div",{className:"training-detail-section training-detail-section-semantic",children:[(0,r.jsxs)("div",{className:"training-detail-section-header",children:[(0,r.jsx)(n.In,{icon:"mdi:database-search",width:14}),(0,r.jsx)("span",{children:"Semantic SQL Parameters"})]}),(0,r.jsxs)("div",{className:"training-semantic-params",children:[(0,r.jsxs)("div",{className:"training-semantic-param",children:[(0,r.jsx)("span",{className:"training-semantic-label",children:"TEXT:"}),(0,r.jsx)("code",{className:"training-semantic-value",children:c.text})]}),(0,r.jsxs)("div",{className:"training-semantic-param",children:[(0,r.jsx)("span",{className:"training-semantic-label",children:"CRITERION:"}),(0,r.jsx)("code",{className:"training-semantic-value",children:c.criterion})]})]})]}),(0,r.jsxs)("div",{className:"training-detail-section",children:[(0,r.jsxs)("div",{className:"training-detail-section-header",children:[(0,r.jsx)(n.In,{icon:"mdi:code-braces",width:14}),(0,r.jsx)("span",{children:"User Input (Full Request)"}),(0,r.jsxs)("span",{className:"training-detail-section-size",children:[t.user_input.length," chars"]})]}),(0,r.jsx)("div",{className:"training-detail-code-container",children:(0,r.jsx)(p.A,{language:"json",style:x.$,customStyle:{margin:0,borderRadius:0,background:"transparent",fontSize:"11px",maxHeight:"300px",overflow:"auto"},codeTagProps:{style:{fontFamily:"'JetBrains Mono', monospace"}},children:i()})})]}),(0,r.jsxs)("div",{className:"training-detail-section",children:[(0,r.jsxs)("div",{className:"training-detail-section-header",children:[(0,r.jsx)(n.In,{icon:"mdi:message-reply",width:14}),(0,r.jsx)("span",{children:"Assistant Output"}),t.assistant_output.startsWith('"')&&t.assistant_output.endsWith('"')&&(0,r.jsx)("span",{className:"training-detail-badge",style:{background:"rgba(52, 211, 153, 0.1)",color:"#34d399"},children:"Quoted String"})]}),(0,r.jsx)("div",{className:"training-detail-code-container",children:(0,r.jsx)(p.A,{language:t.assistant_output.startsWith("{")||t.assistant_output.startsWith("[")?"json":"text",style:x.$,customStyle:{margin:0,borderRadius:0,background:"transparent",fontSize:"12px",maxHeight:"300px",overflow:"auto"},codeTagProps:{style:{fontFamily:"'JetBrains Mono', monospace",color:"#34d399"}},children:(()=>{const e=t.assistant_output;if(e.startsWith('"')&&e.endsWith('"')){const t=e.slice(1,-1);try{const e=JSON.parse(t);return JSON.stringify(e,null,2)}catch(s){return t}}try{const t=JSON.parse(e);return JSON.stringify(t,null,2)}catch(a){return e}})()})})]}),(0,r.jsxs)("div",{className:"training-detail-section",children:[(0,r.jsxs)("div",{className:"training-detail-section-header",children:[(0,r.jsx)(n.In,{icon:"mdi:tag",width:14}),(0,r.jsx)("span",{children:"Metadata"})]}),(0,r.jsxs)("div",{className:"training-detail-metadata",children:[(0,r.jsxs)("div",{className:"training-metadata-item",children:[(0,r.jsx)("span",{className:"training-metadata-label",children:"Trace ID:"}),(0,r.jsx)("code",{className:"training-metadata-value",children:t.trace_id})]}),(0,r.jsxs)("div",{className:"training-metadata-item",children:[(0,r.jsx)("span",{className:"training-metadata-label",children:"Session ID:"}),(0,r.jsxs)("code",{className:"training-metadata-value training-metadata-link",onClick:()=>{t.session_id&&t.cascade_id&&a(u.bw.studioWithSession(t.cascade_id,t.session_id))},children:[t.session_id,(0,r.jsx)(n.In,{icon:"mdi:open-in-new",width:12})]})]}),t.caller_id&&(0,r.jsxs)("div",{className:"training-metadata-item",children:[(0,r.jsx)("span",{className:"training-metadata-label",children:"Caller ID:"}),(0,r.jsx)("code",{className:"training-metadata-value",children:t.caller_id})]}),(0,r.jsxs)("div",{className:"training-metadata-item",children:[(0,r.jsx)("span",{className:"training-metadata-label",children:"Timestamp:"}),(0,r.jsx)("span",{className:"training-metadata-value",children:new Date(t.timestamp).toLocaleString()})]}),null!==t.confidence&&void 0!==t.confidence&&(0,r.jsxs)("div",{className:"training-metadata-item",children:[(0,r.jsx)("span",{className:"training-metadata-label",children:"Confidence:"}),(0,r.jsx)("span",{className:"training-metadata-value",style:{color:t.confidence>=.9?"#34d399":t.confidence>=.7?"#fbbf24":"#ff006e"},children:t.confidence.toFixed(2)})]}),t.notes&&(0,r.jsxs)("div",{className:"training-metadata-item",children:[(0,r.jsx)("span",{className:"training-metadata-label",children:"Notes:"}),(0,r.jsx)("span",{className:"training-metadata-value",children:t.notes})]}),t.tags&&t.tags.length>0&&(0,r.jsxs)("div",{className:"training-metadata-item",children:[(0,r.jsx)("span",{className:"training-metadata-label",children:"Tags:"}),(0,r.jsx)("div",{className:"training-metadata-tags",children:t.tags.map(e=>(0,r.jsx)("span",{className:"training-tag",children:e},e))})]})]})]})]})]})};var j=s(24227);m.syG.registerModules([m.JKr]);const f=m.zl0.withParams({backgroundColor:"#000000",foregroundColor:"#cbd5e1",headerBackgroundColor:"#0a0510",headerTextColor:"#f0f4f8",oddRowBackgroundColor:"#050410",borderColor:"#1a1628",rowBorder:!0,wrapperBorder:!1,headerFontSize:12,headerFontWeight:600,fontFamily:"'Google Sans Code', monospace",fontSize:13,accentColor:"#00e5ff",chromeBackgroundColor:"#000000"}),v=e=>{let{examples:t=[],onSelectionChanged:s,onMarkTrainable:i}=e;const c=(0,o.Zp)(),l=(0,a.useRef)(null),[m,p]=(0,a.useState)(""),[x,v]=(0,a.useState)(null),N=(0,a.useCallback)(()=>{if(!l.current)return;const e=l.current.api.getSelectedRows();s&&s(e)},[s]),y=(0,a.useCallback)(e=>{const t=e.data;(null===x||void 0===x?void 0:x.trace_id)===t.trace_id?v(null):v(t)},[x]),b=(0,a.useCallback)(()=>{v(null)},[]),w=(0,a.useMemo)(()=>[{field:"trainable",headerName:"Trainable",width:100,checkboxSelection:!1,cellRenderer:e=>{const t=e.value;return(0,r.jsx)("div",{className:"training-toggle-cell",onClick:s=>{s.stopPropagation(),(async(e,t)=>{try{if(await fetch("".concat(j.J,"/api/training/mark-trainable"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({trace_ids:[e],trainable:!t})}),l.current){const s=l.current.api.getRowNode(e);s&&s.setDataValue("trainable",!t)}}catch(s){console.error("Failed to toggle trainable:",s)}})(e.data.trace_id,t)},children:(0,r.jsx)(n.In,{icon:t?"mdi:checkbox-marked":"mdi:checkbox-blank-outline",width:18,style:{color:t?"#34d399":"#475569",cursor:"pointer"}})})}},{field:"verified",headerName:"Verified",width:100,cellRenderer:e=>{const t=e.value;return(0,r.jsx)("div",{className:"training-toggle-cell",onClick:s=>{s.stopPropagation(),(async(e,t)=>{try{if(await fetch("".concat(j.J,"/api/training/mark-trainable"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({trace_ids:[e],trainable:!0,verified:!t})}),l.current){const s=l.current.api.getRowNode(e);s&&(s.setDataValue("verified",!t),s.setDataValue("trainable",!0))}}catch(s){console.error("Failed to toggle verified:",s)}})(e.data.trace_id,t)},children:(0,r.jsx)(n.In,{icon:t?"mdi:shield-check":"mdi:shield-outline",width:18,style:{color:t?"#a78bfa":"#475569",cursor:"pointer"}})})}},{field:"cascade_id",headerName:"Cascade",width:180,filter:"agTextColumnFilter",cellRenderer:e=>(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[(0,r.jsx)(n.In,{icon:"mdi:sitemap",width:12,style:{color:"#60a5fa"}}),(0,r.jsx)("span",{children:e.value})]})},{field:"cell_name",headerName:"Cell",width:140,filter:"agTextColumnFilter",cellRenderer:e=>(0,r.jsx)("span",{style:{color:"#fbbf24",fontFamily:"'JetBrains Mono', monospace"},children:e.value})},{field:"user_input",headerName:"Input",width:300,filter:"agTextColumnFilter",cellClass:"training-text-cell",tooltipField:"user_input",wrapText:!1,autoHeight:!1},{field:"assistant_output",headerName:"Output",width:300,filter:"agTextColumnFilter",cellClass:"training-text-cell",tooltipField:"assistant_output",wrapText:!1,autoHeight:!1,cellRenderer:e=>{const t=e.value;return"true"===t||"false"===t?(0,r.jsx)("span",{style:{color:"true"===t?"#34d399":"#ff006e",fontWeight:600},children:t}):t}},{field:"confidence",headerName:"Confidence",width:120,filter:"agNumberColumnFilter",valueFormatter:e=>{var t;return(null===(t=e.value)||void 0===t?void 0:t.toFixed(2))||"0.00"},cellRenderer:e=>{const t=e.value||0,s=t>=.9?"#34d399":t>=.7?"#fbbf24":"#ff006e";return(0,r.jsx)("span",{style:{color:s,fontFamily:"'JetBrains Mono', monospace",fontWeight:600},children:t.toFixed(2)})}},{field:"model",headerName:"Model",width:220,filter:"agTextColumnFilter",cellRenderer:e=>{if(!e.value)return"-";const t=e.value.split("/"),s=t[t.length-1];return(0,r.jsx)("span",{style:{color:"#94a3b8",fontSize:"11px",fontFamily:"'JetBrains Mono', monospace"},children:s})}},{field:"cost",headerName:"Cost",width:100,filter:"agNumberColumnFilter",valueFormatter:e=>e.value?"$".concat(e.value.toFixed(4)):"$0.0000",cellRenderer:e=>{const t=e.value||0;return(0,r.jsxs)("span",{style:{color:"#34d399",fontFamily:"'JetBrains Mono', monospace",fontSize:"12px"},children:["$",t.toFixed(4)]})}},{field:"timestamp",headerName:"Time",width:160,filter:"agDateColumnFilter",valueFormatter:e=>{if(!e.value)return"-";try{return new Date(e.value).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(t){return e.value}}},{field:"caller_id",headerName:"Caller",width:180,filter:"agTextColumnFilter",cellRenderer:e=>{if(!e.value)return"-";const t=e.value.split("-"),s=t[t.length-1];return(0,r.jsx)("span",{style:{color:"#64748b",fontSize:"11px",fontFamily:"'JetBrains Mono', monospace"},children:s})}}],[]),k=(0,a.useMemo)(()=>({sortable:!0,resizable:!0,filter:!0,floatingFilter:!1}),[]),C=(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"training-grid-toolbar",children:[(0,r.jsxs)("div",{className:"training-search-box",children:[(0,r.jsx)(n.In,{icon:"mdi:magnify",width:14,style:{color:"#64748b"}}),(0,r.jsx)("input",{type:"text",placeholder:"Quick search...",value:m,onChange:e=>p(e.target.value),className:"training-search-input"})]}),(0,r.jsxs)("div",{className:"training-grid-info",children:[(0,r.jsxs)("span",{children:[t.length," examples"]}),x&&(0,r.jsx)("span",{className:"training-grid-hint",children:"\xb7 Click row again to deselect"})]})]}),(0,r.jsx)("div",{className:"training-grid-wrapper",children:(0,r.jsx)(d.W6,{ref:l,theme:f,rowData:t,columnDefs:w,defaultColDef:k,rowSelection:"multiple",suppressRowClickSelection:!0,onSelectionChanged:N,onRowClicked:y,onRowDoubleClicked:e=>{const{session_id:t,cascade_id:s}=e.data;t&&s&&c(u.bw.studioWithSession(s,t))},getRowId:e=>e.data.trace_id,quickFilterText:m,animateRows:!0,domLayout:"normal",pagination:!0,paginationPageSize:100,paginationPageSizeSelector:[50,100,200,500],enableCellTextSelection:!0,tooltipShowDelay:500})})]});return(0,r.jsx)("div",{className:"training-grid-container",children:x?(0,r.jsxs)(h.A,{className:"training-split-container",direction:"vertical",sizes:[60,40],minSize:[200,150],gutterSize:6,cursor:"row-resize",children:[(0,r.jsx)("div",{className:"training-split-pane",children:C}),(0,r.jsx)("div",{className:"training-split-pane",children:(0,r.jsx)(g,{example:x,onClose:b})})]}):C})};var N=s(97950),y=s(59570),b=s(38491),w=s(89379),k=s(7189),C=s(91051),S=s(34930);function _(e){const t=(0,S.M)(()=>(0,k.OQ)(e)),{isStatic:s}=(0,a.useContext)(C.Q);if(s){const[,s]=(0,a.useState)(e);(0,a.useEffect)(()=>t.on("change",s),[])}return t}var I=s(26744);var T=s(98412),P=s(40293);function O(e,t){const s=_(t()),a=()=>s.set(t());return a(),(0,P.E)(()=>{const t=()=>T.Gt.preRender(a,!1,!0),s=e.map(e=>e.on("change",t));return()=>{s.forEach(e=>e()),(0,T.WG)(a)}}),s}function F(e,t,s,a){if("function"===typeof e)return function(e){k.bt.current=[],e();const t=O(k.bt.current,e);return k.bt.current=void 0,t}(e);const n="function"===typeof t?t:function(){const e=!Array.isArray(arguments.length<=0?void 0:arguments[0]),t=e?0:-1,s=0+t<0||arguments.length<=0+t?void 0:arguments[0+t],a=1+t<0||arguments.length<=1+t?void 0:arguments[1+t],n=2+t<0||arguments.length<=2+t?void 0:arguments[2+t],i=3+t<0||arguments.length<=3+t?void 0:arguments[3+t],r=(0,I.G)(a,n,i);return e?r(s):r}(t,s,a);return Array.isArray(e)?E(e,n):E([e],e=>{let[t]=e;return n(t)})}function E(e,t){const s=(0,S.M)(()=>[]);return O(e,()=>{s.length=0;const a=e.length;for(let t=0;t<a;t++)s[t]=e[t].get();return t(s)})}const R=150,L=e=>{let{text:t,maxLength:s=300,className:n=""}=e;const[i,c]=(0,a.useState)(!1);if(!t)return(0,r.jsx)("span",{className:"swipe-card-empty",children:"No content"});const l=t.length>s,o=i||!l?t:t.slice(0,s)+"...";return(0,r.jsxs)("div",{className:"expandable-text ".concat(n),children:[(0,r.jsx)("pre",{className:"expandable-text-content",children:o}),l&&(0,r.jsx)("button",{className:"expandable-text-toggle",onClick:e=>{e.stopPropagation(),c(!i)},children:i?"Show less":"Show more"})]})},A=e=>{var t;let{userInput:s}=e;const i=(0,a.useMemo)(()=>{if(!s)return null;try{const e=JSON.parse(s),t=e.messages||[],a=t.find(e=>"system"===e.role),n=t.filter(e=>"user"===e.role),i=n[n.length-1];let r=null;const c=((null===a||void 0===a?void 0:a.content)||"")+((null===i||void 0===i?void 0:i.content)||""),l=c.match(/TEXT:\s*([^\n]+)/),o=c.match(/CRITERION:\s*([^\n]+)/);l&&o&&(r={text:l[1].trim(),criterion:o[1].trim()});const d=c.match(/VALUE:\s*([^\n]+)/),m=c.match(/TYPE:\s*([^\n]+)/);d&&m&&!r&&(r={text:d[1].trim(),criterion:m[1].trim(),labels:{key1:"VALUE",key2:"TYPE"}});const h=e.tools||[],u=h.map(e=>{var t;return(null===(t=e.function)||void 0===t?void 0:t.name)||e.name}).filter(Boolean),p=e.model;let x=null;if(null!==a&&void 0!==a&&a.content&&!r){const e=a.content.split("\n\n")[0];x=e.length>200?e.slice(0,200)+"...":e}let g=null;if(null!==i&&void 0!==i&&i.content)if("string"===typeof i.content)g=i.content;else if(Array.isArray(i.content)){g=i.content.filter(e=>"text"===e.type).map(e=>e.text).join("\n")}return{semanticParams:r,systemSummary:x,userContent:g,toolNames:u,toolCount:h.length,model:p,messageCount:t.length}}catch(e){const t=(e=>{const t={model:null,userContent:null,systemContent:null,semanticParams:null},s=e.match(/"model":\s*"([^"]+)"/);s&&(t.model=s[1]);let a=e.indexOf('"role": "user"');-1===a&&(a=e.indexOf('"role":"user"'));let n=e.indexOf('"role": "system"');-1===n&&(n=e.indexOf('"role":"system"'));const i=(e,t)=>{if(-1===t)return null;const s=e.indexOf('"content":',t);if(-1===s)return null;const a=e.indexOf('"',s+10);if(-1===a)return null;let n="",i=a+1;for(;i<e.length;)if("\\"===e[i]&&i+1<e.length){const t=e[i+1];n+="n"===t?"\n":'"'===t?'"':"\\"===t?"\\":"t"===t?"\t":t,i+=2}else{if('"'===e[i])break;n+=e[i],i++}return n||null};-1!==a&&(t.userContent=i(e,a)),-1!==n&&(t.systemContent=i(e,n));const r=(t.userContent||"")+(t.systemContent||"")+e,c=r.match(/VALUE:\s*([^\n\\]+)/),l=r.match(/TYPE:\s*([^\n\\]+)/);c&&l&&(t.semanticParams={text:c[1].trim(),criterion:l[1].trim(),labels:{key1:"VALUE",key2:"TYPE"}});const o=r.match(/TEXT:\s*([^\n\\]+)/),d=r.match(/CRITERION:\s*([^\n\\]+)/);return o&&d&&!t.semanticParams&&(t.semanticParams={text:o[1].trim(),criterion:d[1].trim()}),t})(s);return t.userContent||t.systemContent||t.semanticParams?{semanticParams:t.semanticParams,systemSummary:null,userContent:t.userContent||t.systemContent,toolNames:[],toolCount:0,model:t.model,messageCount:0}:{plainText:s}}},[s]);if(!i)return(0,r.jsx)("span",{className:"swipe-card-empty",children:"No input data"});if(i.plainText)return(0,r.jsx)(L,{text:i.plainText,maxLength:400});const c=(null===(t=i.semanticParams)||void 0===t?void 0:t.labels)||{key1:"TEXT",key2:"CRITERION"};return(0,r.jsxs)("div",{className:"structured-input",children:[i.semanticParams&&(0,r.jsxs)("div",{className:"structured-section structured-section--semantic",children:[(0,r.jsxs)("div",{className:"structured-label",children:[(0,r.jsx)(n.In,{icon:"mdi:database-search",width:12}),"VALUE"===c.key1?"Normalization Task":"Semantic SQL"]}),(0,r.jsxs)("div",{className:"structured-params",children:[(0,r.jsxs)("div",{className:"structured-param",children:[(0,r.jsx)("span",{className:"param-key",children:c.key1}),(0,r.jsx)("span",{className:"param-value param-value--text",children:i.semanticParams.text})]}),(0,r.jsxs)("div",{className:"structured-param",children:[(0,r.jsx)("span",{className:"param-key",children:c.key2}),(0,r.jsx)("span",{className:"param-value param-value--criterion",children:i.semanticParams.criterion})]})]})]}),i.userContent&&(0,r.jsxs)("div",{className:"structured-section",children:[(0,r.jsxs)("div",{className:"structured-label",children:[(0,r.jsx)(n.In,{icon:"mdi:account",width:12}),"User Request"]}),(0,r.jsx)(L,{text:i.userContent,maxLength:300,className:"structured-content"})]}),i.systemSummary&&!i.semanticParams&&(0,r.jsxs)("div",{className:"structured-section structured-section--system",children:[(0,r.jsxs)("div",{className:"structured-label",children:[(0,r.jsx)(n.In,{icon:"mdi:cog",width:12}),"System Context"]}),(0,r.jsx)(L,{text:i.systemSummary,maxLength:200,className:"structured-content structured-content--dim"})]}),(i.toolCount>0||i.messageCount>1)&&(0,r.jsxs)("div",{className:"structured-meta-row",children:[i.toolCount>0&&(0,r.jsxs)("span",{className:"structured-meta-badge",title:i.toolNames.join(", "),children:[(0,r.jsx)(n.In,{icon:"mdi:tools",width:11}),i.toolCount," tool",1!==i.toolCount?"s":""]}),i.messageCount>2&&(0,r.jsxs)("span",{className:"structured-meta-badge",children:[(0,r.jsx)(n.In,{icon:"mdi:message-text",width:11}),i.messageCount," msgs"]})]})]})},J=e=>{let{output:t}=e;const s=(0,a.useMemo)(()=>{if(!t)return null;let e=t;e.startsWith('"')&&e.endsWith('"')&&(e=e.slice(1,-1),e=e.replace(/\\n/g,"\n").replace(/\\t/g,"\t").replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{const t=JSON.parse(e);return"object"===typeof t&&null!==t?void 0!==t.result?{type:"result",value:t.result,extra:t}:void 0!==t.answer?{type:"answer",value:t.answer,extra:t}:void 0!==t.output?{type:"output",value:t.output,extra:t}:void 0!==t.response?{type:"response",value:t.response,extra:t}:void 0!==t.content?{type:"content",value:t.content,extra:t}:void 0!==t.text?{type:"text",value:t.text,extra:t}:void 0!==t.value?{type:"value",value:t.value,extra:t}:Array.isArray(t)?{type:"array",items:t}:{type:"object",data:t}:{type:"primitive",value:t}}catch(c){}const s=/^#{1,6}\s+/m.test(e),a=/```[\s\S]*?```/m.test(e),n=/^[\s]*[-*+]\s+/m.test(e),i=/^[\s]*\d+\.\s+/m.test(e),r=/\*\*[^*]+\*\*|\*[^*]+\*|__[^_]+__|_[^_]+_/.test(e);return s||a||n||i||r?{type:"markdown",content:e}:{type:"text",content:e}},[t]);if(!s)return(0,r.jsx)("span",{className:"swipe-card-empty",children:"No output"});switch(s.type){case"result":case"answer":case"output":case"response":case"content":case"text":case"value":{const e=s.value,t=Object.keys(s.extra||{}).filter(e=>!["result","answer","output","response","content","text","value"].includes(e));return(0,r.jsxs)("div",{className:"structured-output",children:[(0,r.jsx)("div",{className:"structured-output-main",children:"object"===typeof e?(0,r.jsx)("pre",{className:"structured-output-json",children:JSON.stringify(e,null,2)}):(0,r.jsx)("div",{className:"structured-output-value",children:String(e)})}),t.length>0&&(0,r.jsx)("div",{className:"structured-output-extra",children:t.slice(0,3).map(e=>(0,r.jsxs)("span",{className:"structured-output-badge",children:[(0,r.jsxs)("span",{className:"structured-output-badge-key",children:[e,":"]}),(0,r.jsx)("span",{className:"structured-output-badge-value",children:"object"===typeof s.extra[e]?JSON.stringify(s.extra[e]).slice(0,30):String(s.extra[e]).slice(0,30)})]},e))})]})}case"array":{const e=s.items;return(0,r.jsxs)("div",{className:"structured-output",children:[(0,r.jsxs)("div",{className:"structured-output-array-header",children:[(0,r.jsx)(n.In,{icon:"mdi:code-array",width:12}),(0,r.jsxs)("span",{children:[e.length," items"]})]}),(0,r.jsxs)("div",{className:"structured-output-array",children:[e.slice(0,5).map((e,t)=>(0,r.jsxs)("div",{className:"structured-output-array-item",children:[(0,r.jsx)("span",{className:"structured-output-array-idx",children:t}),(0,r.jsx)("span",{className:"structured-output-array-value",children:"object"===typeof e?JSON.stringify(e):String(e)})]},t)),e.length>5&&(0,r.jsxs)("div",{className:"structured-output-array-more",children:["+",e.length-5," more"]})]})]})}case"object":{const e=Object.entries(s.data);return(0,r.jsx)("div",{className:"structured-output",children:(0,r.jsxs)("div",{className:"structured-output-object",children:[e.slice(0,6).map(e=>{let[t,s]=e;return(0,r.jsxs)("div",{className:"structured-output-kv",children:[(0,r.jsx)("span",{className:"structured-output-key",children:t}),(0,r.jsx)("span",{className:"structured-output-val",children:"object"===typeof s?JSON.stringify(s).slice(0,50):String(s).slice(0,80)})]},t)}),e.length>6&&(0,r.jsxs)("div",{className:"structured-output-more",children:["+",e.length-6," more fields"]})]})})}case"primitive":return(0,r.jsx)("div",{className:"structured-output",children:(0,r.jsx)("div",{className:"structured-output-primitive",children:String(s.value)})});case"markdown":{const e=s.content.split("\n");return(0,r.jsxs)("div",{className:"structured-output structured-output--markdown",children:[e.slice(0,15).map((e,t)=>{const s=e.match(/^(#{1,6})\s+(.*)$/);if(s){const e=s[1].length;return(0,r.jsx)("div",{className:"md-header md-h".concat(e),children:s[2]},t)}if(/^[\s]*[-*+]\s+/.test(e))return(0,r.jsxs)("div",{className:"md-list-item",children:[(0,r.jsx)("span",{className:"md-bullet",children:"\u2022"}),e.replace(/^[\s]*[-*+]\s+/,"")]},t);const a=e.match(/^[\s]*(\d+)\.\s+(.*)$/);return a?(0,r.jsxs)("div",{className:"md-list-item",children:[(0,r.jsxs)("span",{className:"md-number",children:[a[1],"."]}),a[2]]},t):e.startsWith("```")?(0,r.jsx)("div",{className:"md-code-fence",children:e.replace(/```/g,"")},t):e.trim()?(0,r.jsx)("div",{className:"md-text",children:e},t):(0,r.jsx)("div",{className:"md-blank"},t)}),e.length>15&&(0,r.jsxs)("div",{className:"structured-output-more",children:["+",e.length-15," more lines"]})]})}default:return(0,r.jsx)(L,{text:s.content||t,maxLength:400})}},D=e=>{var t,s;let{example:a,onSwipe:i,isActive:c=!0,stackIndex:l=0,exitDirection:o=null}=e;const d=_(0),m=_(0),h=F(d,[-300,300],[-30,30]),u=F(d,[0,200],[0,1]),p=F(d,[-200,0],[1,0]),x=F(m,[0,200],[0,1]),g=F(d,[0,R],[0,1]),j=F(d,[-150,0],[1,0]),f=F(m,[0,R],[0,1]),v={scale:1-.05*l,y:8*l,zIndex:10-l},N={right:{x:1500,rotate:30,opacity:0},left:{x:-1500,rotate:-30,opacity:0},down:{y:1e3,rotate:0,opacity:0}},y=(null===(t=a.model)||void 0===t?void 0:t.split("/").pop())||"unknown";return(0,r.jsxs)(b.P.div,{className:"swipe-card ".concat(c?"swipe-card--active":""),drag:c,dragConstraints:{left:0,right:0,top:0,bottom:0},dragElastic:1,onDragEnd:(e,t)=>{if(!c)return;const{offset:s,velocity:a}=t;s.x>R||a.x>500?i("hot"):s.x<-150||a.x<-500?i("not"):(s.y>R||a.y>500)&&i("skip")},style:{x:c?d:0,y:c?m:v.y,rotate:c?h:0,scale:v.scale,zIndex:v.zIndex,opacity:l>0?1-.15*l:1},initial:v,animate:o?N[o]:(0,w.A)((0,w.A)({},v),{},{opacity:l>0?1-.15*l:1}),exit:o?N[o]:{opacity:0},transition:{type:"spring",stiffness:300,damping:30,mass:.8},children:[c&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(b.P.div,{className:"swipe-card-indicator swipe-card-indicator--hot",style:{opacity:u},children:[(0,r.jsx)(n.In,{icon:"mdi:fire",width:32}),(0,r.jsx)("span",{children:"HOT"})]}),(0,r.jsxs)(b.P.div,{className:"swipe-card-indicator swipe-card-indicator--not",style:{opacity:p},children:[(0,r.jsx)(n.In,{icon:"mdi:close-thick",width:32}),(0,r.jsx)("span",{children:"NOT"})]}),(0,r.jsxs)(b.P.div,{className:"swipe-card-indicator swipe-card-indicator--skip",style:{opacity:x},children:[(0,r.jsx)(n.In,{icon:"mdi:debug-step-over",width:32}),(0,r.jsx)("span",{children:"SKIP"})]}),(0,r.jsx)(b.P.div,{className:"swipe-card-glow swipe-card-glow--hot",style:{opacity:g}}),(0,r.jsx)(b.P.div,{className:"swipe-card-glow swipe-card-glow--not",style:{opacity:j}}),(0,r.jsx)(b.P.div,{className:"swipe-card-glow swipe-card-glow--skip",style:{opacity:f}})]}),(0,r.jsxs)("div",{className:"swipe-card-content",children:[(0,r.jsxs)("div",{className:"swipe-card-section",children:[(0,r.jsxs)("div",{className:"swipe-card-section-header",children:[(0,r.jsx)(n.In,{icon:"mdi:arrow-right-bold",width:14}),(0,r.jsx)("span",{children:"INPUT"})]}),(0,r.jsx)("div",{className:"swipe-card-section-body",children:(0,r.jsx)(A,{userInput:a.user_input})})]}),(0,r.jsxs)("div",{className:"swipe-card-section swipe-card-section--output",children:[(0,r.jsxs)("div",{className:"swipe-card-section-header",children:[(0,r.jsx)(n.In,{icon:"mdi:arrow-left-bold",width:14}),(0,r.jsx)("span",{children:"OUTPUT"}),(0,r.jsxs)("span",{className:"swipe-card-section-size",children:[(null===(s=a.assistant_output)||void 0===s?void 0:s.length)||0," chars"]})]}),(0,r.jsx)("div",{className:"swipe-card-section-body",children:(0,r.jsx)(J,{output:a.assistant_output})})]}),(0,r.jsxs)("div",{className:"swipe-card-metadata",children:[(0,r.jsxs)("span",{className:"swipe-card-meta-item swipe-card-meta-cascade",children:[(0,r.jsx)(n.In,{icon:"mdi:sitemap",width:12}),a.cascade_id]}),(0,r.jsx)("span",{className:"swipe-card-meta-item swipe-card-meta-cell",children:a.cell_name}),(0,r.jsx)("span",{className:"swipe-card-meta-item swipe-card-meta-model",children:y}),a.cost>0&&(0,r.jsxs)("span",{className:"swipe-card-meta-item swipe-card-meta-cost",children:["$",a.cost.toFixed(4)]})]})]})]})},z=e=>{let{isOpen:t,examples:s,onClose:i,onComplete:c}=e;const[l,o]=(0,a.useState)(0),[d,m]=(0,a.useState)([]),[h,u]=(0,a.useState)(null),[p,x]=(0,a.useState)(!1),[g,f]=(0,a.useState)([]),[v,w]=(0,a.useState)(!1),[k,C]=(0,a.useState)(!1);(0,a.useEffect)(()=>{t&&(o(0),m([]),u(null),x(!1),f([]),w(!1),C(!1))},[t]),(0,a.useEffect)(()=>(document.body.style.overflow=t?"hidden":"",()=>{document.body.style.overflow=""}),[t]);const S=(0,a.useCallback)(async e=>{if(0!==e.length){w(!0);try{const t=e.filter(e=>"hot"===e.decision).map(e=>e.trace_id),s=e.filter(e=>"not"===e.decision).map(e=>e.trace_id);t.length>0&&await fetch("".concat(j.J,"/api/training/mark-trainable"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({trace_ids:t,trainable:!0,verified:!0,confidence:1,notes:"Marked via Hot or Not"})}),s.length>0&&await fetch("".concat(j.J,"/api/training/mark-trainable"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({trace_ids:s,trainable:!1})})}catch(t){console.error("Failed to submit decisions:",t)}finally{w(!1)}}},[]),_=(0,a.useCallback)(async()=>{d.length>0&&await S(d),null===c||void 0===c||c(d),i()},[d,S,c,i]),I=(0,a.useCallback)(e=>{if(p||l>=s.length)return;x(!0);const t={trace_id:s[l].trace_id,decision:e,timestamp:Date.now()};m(e=>[...e,t]),f(e=>[...e,{decision:t,index:l}]);u("hot"===e?"right":"not"===e?"left":"down"),setTimeout(()=>{u(null),o(e=>e+1),x(!1),l>=s.length-1&&C(!0)},300)},[p,l,s]),T=(0,a.useCallback)(()=>{if(0===g.length||p)return;x(!0);const e=g[g.length-1];f(e=>e.slice(0,-1)),m(e=>e.slice(0,-1)),o(e.index),C(!1),setTimeout(()=>{x(!1)},200)},[g,p]);(0,a.useEffect)(()=>{if(!t)return;const e=e=>{if("INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&(!p||"escape"===e.key.toLowerCase()))switch(e.key.toLowerCase()){case"w":e.preventDefault(),k||I("not");break;case"s":e.preventDefault(),k||I("skip");break;case"d":e.preventDefault(),k||I("hot");break;case"escape":e.preventDefault(),_();break;case"z":(e.metaKey||e.ctrlKey)&&(e.preventDefault(),T())}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[t,p,k,I,T,_]);const P={hot:d.filter(e=>"hot"===e.decision).length,not:d.filter(e=>"not"===e.decision).length,skip:d.filter(e=>"skip"===e.decision).length,total:d.length},O=s.length>0?l/s.length*100:0,F=s.slice(l,l+3);return t?(0,N.createPortal)((0,r.jsx)(y.N,{children:(0,r.jsx)(b.P.div,{className:"hon-modal-backdrop",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},onClick:_,children:(0,r.jsxs)(b.P.div,{className:"hon-modal",onClick:e=>e.stopPropagation(),initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2},children:[(0,r.jsxs)("div",{className:"hon-header",children:[(0,r.jsxs)("div",{className:"hon-header-left",children:[(0,r.jsx)(n.In,{icon:"mdi:fire",width:20,className:"hon-header-icon"}),(0,r.jsx)("span",{className:"hon-title",children:"Hot or Not"})]}),(0,r.jsxs)("div",{className:"hon-progress-container",children:[(0,r.jsx)("div",{className:"hon-progress-bar",children:(0,r.jsx)(b.P.div,{className:"hon-progress-fill",initial:{width:0},animate:{width:"".concat(O,"%")},transition:{duration:.3}})}),(0,r.jsxs)("span",{className:"hon-progress-text",children:[l," / ",s.length]})]}),(0,r.jsxs)("div",{className:"hon-header-right",children:[g.length>0&&(0,r.jsx)("button",{className:"hon-undo-btn",onClick:T,disabled:p,title:"Undo (Cmd+Z)",children:(0,r.jsx)(n.In,{icon:"mdi:undo",width:16})}),(0,r.jsx)("button",{className:"hon-close-btn",onClick:_,title:"Close (Escape)",children:(0,r.jsx)(n.In,{icon:"mdi:close",width:20})})]})]}),(0,r.jsx)("div",{className:"hon-content",children:0===s.length?(0,r.jsxs)("div",{className:"hon-empty",children:[(0,r.jsx)(n.In,{icon:"mdi:filter-off",width:48}),(0,r.jsx)("h3",{children:"No examples match filters"}),(0,r.jsx)("p",{children:"Adjust your filters to see training examples"})]}):k?(0,r.jsxs)(b.P.div,{className:"hon-summary",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:[(0,r.jsx)(n.In,{icon:"mdi:check-circle",width:64,className:"hon-summary-icon"}),(0,r.jsx)("h2",{children:"Review Complete"}),(0,r.jsxs)("div",{className:"hon-summary-stats",children:[(0,r.jsxs)("div",{className:"hon-stat hon-stat--hot",children:[(0,r.jsx)(n.In,{icon:"mdi:fire",width:24}),(0,r.jsx)("span",{className:"hon-stat-value",children:P.hot}),(0,r.jsx)("span",{className:"hon-stat-label",children:"Hot"})]}),(0,r.jsxs)("div",{className:"hon-stat hon-stat--not",children:[(0,r.jsx)(n.In,{icon:"mdi:close-thick",width:24}),(0,r.jsx)("span",{className:"hon-stat-value",children:P.not}),(0,r.jsx)("span",{className:"hon-stat-label",children:"Not"})]}),(0,r.jsxs)("div",{className:"hon-stat hon-stat--skip",children:[(0,r.jsx)(n.In,{icon:"mdi:debug-step-over",width:24}),(0,r.jsx)("span",{className:"hon-stat-value",children:P.skip}),(0,r.jsx)("span",{className:"hon-stat-label",children:"Skipped"})]})]}),(0,r.jsx)("button",{className:"hon-done-btn",onClick:_,disabled:v,children:v?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.In,{icon:"mdi:loading",width:16,className:"hon-spinner"}),"Saving..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.In,{icon:"mdi:check",width:16}),"Done"]})})]}):(0,r.jsx)("div",{className:"hon-card-stack",children:(0,r.jsx)(y.N,{mode:"popLayout",children:F.map((e,t)=>(0,r.jsx)(D,{example:e,isActive:0===t,stackIndex:t,exitDirection:0===t?h:null,onSwipe:I},e.trace_id))})})}),!k&&s.length>0&&(0,r.jsxs)("div",{className:"hon-footer",children:[(0,r.jsxs)("div",{className:"hon-hint hon-hint--not",children:[(0,r.jsx)("kbd",{children:"W"}),(0,r.jsx)("span",{children:"NOT"})]}),(0,r.jsxs)("div",{className:"hon-hint hon-hint--skip",children:[(0,r.jsx)("kbd",{children:"S"}),(0,r.jsx)("span",{children:"SKIP"})]}),(0,r.jsxs)("div",{className:"hon-hint hon-hint--hot",children:[(0,r.jsx)("kbd",{children:"D"}),(0,r.jsx)("span",{children:"HOT"})]})]}),!k&&d.length>0&&(0,r.jsxs)("div",{className:"hon-stats-bar",children:[(0,r.jsxs)("span",{className:"hon-mini-stat hon-mini-stat--hot",children:[(0,r.jsx)(n.In,{icon:"mdi:fire",width:12})," ",P.hot]}),(0,r.jsxs)("span",{className:"hon-mini-stat hon-mini-stat--not",children:[(0,r.jsx)(n.In,{icon:"mdi:close-thick",width:12})," ",P.not]}),(0,r.jsxs)("span",{className:"hon-mini-stat hon-mini-stat--skip",children:[(0,r.jsx)(n.In,{icon:"mdi:debug-step-over",width:12})," ",P.skip]})]})]})})}),document.body):null},M=e=>{let{options:t=[],selected:s=[],onChange:i,placeholder:c="Select...",searchPlaceholder:l="Search...",allLabel:o="All",maxDisplayed:d=2}=e;const m=Array.isArray(s)?s:[],[h,u]=(0,a.useState)(!1),[p,x]=(0,a.useState)(""),g=(0,a.useRef)(null),j=(0,a.useRef)(null),f=(0,a.useMemo)(()=>{if(!p)return t;const e=p.toLowerCase();return t.filter(t=>t.toLowerCase().includes(e))},[t,p]);(0,a.useEffect)(()=>{const e=e=>{g.current&&!g.current.contains(e.target)&&(u(!1),x(""))};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,a.useEffect)(()=>{h&&j.current&&j.current.focus()},[h]);const v=e=>{e.stopPropagation(),i([])},N=0===m.length,y=N?o:m.length<=d?m.join(", "):"".concat(m.slice(0,d).join(", ")," +").concat(m.length-d);return(0,r.jsxs)("div",{className:"sms-container",ref:g,children:[(0,r.jsxs)("div",{className:"sms-trigger ".concat(h?"sms-trigger--open":""),onClick:()=>u(!h),children:[(0,r.jsx)("span",{className:"sms-trigger-text ".concat(N?"sms-trigger-text--all":""),children:y}),(0,r.jsxs)("div",{className:"sms-trigger-icons",children:[m.length>0&&(0,r.jsx)("button",{className:"sms-clear-btn",onClick:v,title:"Clear selection",children:(0,r.jsx)(n.In,{icon:"mdi:close",width:12})}),(0,r.jsx)(n.In,{icon:"mdi:chevron-down",width:16,className:"sms-chevron ".concat(h?"sms-chevron--open":"")})]})]}),h&&(0,r.jsxs)("div",{className:"sms-dropdown",children:[(0,r.jsxs)("div",{className:"sms-search-container",children:[(0,r.jsx)(n.In,{icon:"mdi:magnify",width:14,className:"sms-search-icon"}),(0,r.jsx)("input",{ref:j,type:"text",className:"sms-search-input",placeholder:l,value:p,onChange:e=>x(e.target.value),onClick:e=>e.stopPropagation()}),p&&(0,r.jsx)("button",{className:"sms-search-clear",onClick:e=>{e.stopPropagation(),x("")},children:(0,r.jsx)(n.In,{icon:"mdi:close",width:12})})]}),(0,r.jsxs)("div",{className:"sms-options",children:[(0,r.jsxs)("div",{className:"sms-option sms-option--all ".concat(N?"sms-option--selected":""),onClick:()=>{m.length===t.length?i([]):i([...t])},children:[(0,r.jsx)(n.In,{icon:m.length===t.length?"mdi:checkbox-marked":"mdi:checkbox-blank-outline",width:16,className:"sms-checkbox"}),(0,r.jsx)("span",{children:o}),(0,r.jsx)("span",{className:"sms-option-count",children:t.length})]}),(0,r.jsx)("div",{className:"sms-divider"}),0===f.length?(0,r.jsx)("div",{className:"sms-no-results",children:"No matches found"}):f.map(e=>{const t=m.includes(e);return(0,r.jsxs)("div",{className:"sms-option ".concat(t?"sms-option--selected":""),onClick:()=>(e=>{m.includes(e)?i(m.filter(t=>t!==e)):i([...m,e])})(e),children:[(0,r.jsx)(n.In,{icon:t?"mdi:checkbox-marked":"mdi:checkbox-blank-outline",width:16,className:"sms-checkbox"}),(0,r.jsx)("span",{className:"sms-option-label",children:e})]},e)})]}),m.length>0&&(0,r.jsxs)("div",{className:"sms-footer",children:[(0,r.jsxs)("span",{children:[m.length," selected"]}),(0,r.jsx)("button",{className:"sms-footer-clear",onClick:v,children:"Clear all"})]})]})]})},W="training_cascadeFilter",U="training_cellFilter",B="training_showTrainableOnly",H=()=>{try{const e=localStorage.getItem(W);if(!e)return[];const t=JSON.parse(e);return Array.isArray(t)?t:[]}catch(e){return[]}},V=()=>{try{const e=localStorage.getItem(U);if(!e)return[];const t=JSON.parse(e);return Array.isArray(t)?t:[]}catch(e){return[]}},Q=()=>{try{return"true"===localStorage.getItem(B)}catch(e){return!1}},$=()=>{const[e,t]=(0,a.useState)(null),[s,c]=(0,a.useState)([]),[o,d]=(0,a.useState)(H),[m,h]=(0,a.useState)(V),[u,p]=(0,a.useState)(Q),[x,g]=(0,a.useState)(""),[f,N]=(0,a.useState)(""),[y,b]=(0,a.useState)(!1),[w,k]=(0,a.useState)([]),[C,S]=(0,a.useState)([]),[_,I]=(0,a.useState)(!0),[T,P]=(0,a.useState)(null),[O,F]=(0,a.useState)([]),[E,R]=(0,a.useState)(!1),[L,A]=(0,a.useState)(!1),[J,D]=(0,a.useState)(0),$=(0,a.useRef)(null);(0,a.useEffect)(()=>($.current&&clearTimeout($.current),x!==f&&(b(!0),$.current=setTimeout(()=>{N(x),b(!1)},300)),()=>{$.current&&clearTimeout($.current)}),[x,f]);const q=async()=>{try{const e=await fetch("".concat(j.J,"/api/training/stats")),s=await e.json();if(s.error)return void P(s.error);const a=s.stats||[];t(a),P(null)}catch(e){P(e.message)}},X=async()=>{try{const e=new URLSearchParams;o&&o.length>0&&o.forEach(t=>e.append("cascade_id",t)),m&&m.length>0&&m.forEach(t=>e.append("cell_name",t)),u&&e.append("trainable","true"),f&&f.trim()&&e.append("search",f.trim());const t=await fetch("".concat(j.J,"/api/training/filter-options?").concat(e)),s=await t.json();if(s.error)return void console.error("Filter options error:",s.error);k(s.cascades||[]),S(s.cells||[])}catch(e){console.error("Failed to fetch filter options:",e)}},G=async()=>{try{const e=new URLSearchParams;o&&o.length>0&&o.forEach(t=>e.append("cascade_id",t)),m&&m.length>0&&m.forEach(t=>e.append("cell_name",t)),u&&e.append("trainable","true"),f&&f.trim()&&e.append("search",f.trim()),e.append("limit","500");const t=await fetch("".concat(j.J,"/api/training/examples?").concat(e)),s=await t.json();if(s.error)return void P(s.error);c(s.examples||[]),P(null)}catch(e){P(e.message)}finally{I(!1)}},K=async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(0!==O.length)try{const s=O.map(e=>e.trace_id);await fetch("".concat(j.J,"/api/training/mark-trainable"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({trace_ids:s,trainable:e,verified:t})}),await G(),F([])}catch(s){P(s.message)}},Y=(0,a.useCallback)(e=>{d(e);try{localStorage.setItem(W,JSON.stringify(e))}catch(t){}},[]),Z=(0,a.useCallback)(e=>{h(e);try{localStorage.setItem(U,JSON.stringify(e))}catch(t){}},[]),ee=(0,a.useCallback)(e=>{p(e);try{localStorage.setItem(B,String(e))}catch(t){}},[]);(0,a.useEffect)(()=>{q(),X()},[]),(0,a.useEffect)(()=>{G(),X()},[o,m,u,f]),(0,a.useEffect)(()=>{const e=setInterval(()=>{y||(q(),G(),X())},3e4);return()=>clearInterval(e)},[o,m,u,f,y]);const te=a.useMemo(()=>e&&0!==e.length?{total_executions:e.reduce((e,t)=>e+t.total_executions,0),trainable_count:e.reduce((e,t)=>e+t.trainable_count,0),verified_count:e.reduce((e,t)=>e+t.verified_count,0),avg_confidence:e.reduce((e,t)=>e+t.avg_confidence,0)/e.length,cascades_count:new Set(e.map(e=>e.cascade_id)).size,cells_count:e.length}:{total_executions:0,trainable_count:0,verified_count:0,avg_confidence:0,cascades_count:0,cells_count:0},[e]),se=te.total_executions>0?(te.trainable_count/te.total_executions*100).toFixed(1):0,ae=te.trainable_count>0?(te.verified_count/te.trainable_count*100).toFixed(1):0;return(0,r.jsxs)("div",{className:"training-view",children:[(0,r.jsxs)("div",{className:"training-header",children:[(0,r.jsxs)("div",{className:"training-header-left",children:[(0,r.jsx)(n.In,{icon:"mdi:school",width:20,style:{color:"#00e5ff"}}),(0,r.jsx)("h1",{children:"Training Examples"}),(0,r.jsx)("span",{className:"training-subtitle",children:"Universal Few-Shot Learning System"})]}),(0,r.jsx)("div",{className:"training-header-right",children:(0,r.jsx)("button",{className:"training-refresh-btn",onClick:()=>{q(),G()},title:"Refresh data",children:(0,r.jsx)(n.In,{icon:"mdi:refresh",width:16})})})]}),(0,r.jsxs)("div",{className:"training-filters",children:[(0,r.jsxs)("div",{className:"training-filter-group",children:[(0,r.jsx)("label",{className:"training-filter-label",children:"Cascade:"}),(0,r.jsx)(M,{options:w,selected:o,onChange:Y,placeholder:"Filter cascades...",searchPlaceholder:"Search cascades...",allLabel:"All Cascades"})]}),(0,r.jsxs)("div",{className:"training-filter-group",children:[(0,r.jsx)("label",{className:"training-filter-label",children:"Cell:"}),(0,r.jsx)(M,{options:C,selected:m,onChange:Z,placeholder:"Filter cells...",searchPlaceholder:"Search cells...",allLabel:"All Cells"})]}),(0,r.jsx)("div",{className:"training-filter-group",children:(0,r.jsxs)("label",{className:"training-filter-checkbox",children:[(0,r.jsx)("input",{type:"checkbox",checked:u,onChange:e=>ee(e.target.checked)}),(0,r.jsx)("span",{children:"Trainable Only"})]})}),(0,r.jsx)("div",{className:"training-filter-spacer"}),(0,r.jsxs)("div",{className:"training-search-container",children:[(0,r.jsx)(n.In,{icon:"mdi:magnify",width:16,className:"training-search-icon"}),(0,r.jsx)("input",{type:"text",className:"training-search-input",placeholder:"Search inputs & outputs...",value:x,onChange:e=>g(e.target.value)}),y&&(0,r.jsx)(n.In,{icon:"mdi:loading",width:14,className:"training-search-spinner"}),x&&!y&&(0,r.jsx)("button",{className:"training-search-clear",onClick:()=>g(""),title:"Clear search",children:(0,r.jsx)(n.In,{icon:"mdi:close",width:14})})]}),(0,r.jsx)("div",{className:"training-selection-info",children:O.length>0&&(0,r.jsxs)("span",{children:[O.length," selected"]})})]}),(0,r.jsxs)("div",{className:"training-kpi-row",children:[(0,r.jsx)(l,{title:"Total Executions",value:te.total_executions.toLocaleString(),icon:"mdi:database",color:"#60a5fa"}),(0,r.jsx)(l,{title:"Trainable",value:te.trainable_count.toLocaleString(),subtitle:"".concat(se,"% of total"),icon:"mdi:check-circle",color:"#34d399"}),(0,r.jsx)(l,{title:"Verified",value:te.verified_count.toLocaleString(),subtitle:"".concat(ae,"% of trainable"),icon:"mdi:shield-check",color:"#a78bfa"}),(0,r.jsx)(l,{title:"Avg Confidence",value:te.avg_confidence.toFixed(2),subtitle:"quality score",icon:"mdi:star",color:"#fbbf24"}),(0,r.jsx)(l,{title:"Cascades",value:te.cascades_count.toString(),subtitle:"".concat(te.cells_count," cells"),icon:"mdi:sitemap",color:"#00e5ff"})]}),(0,r.jsxs)("div",{className:"training-actions",children:[(0,r.jsxs)("button",{className:"training-action-btn training-action-btn--accent",onClick:()=>R(!0),disabled:0===s.length,children:[(0,r.jsx)(n.In,{icon:"mdi:fire",width:14}),(0,r.jsx)("span",{children:"Hot or Not"})]}),(0,r.jsxs)("button",{className:"training-action-btn training-action-btn--secondary",onClick:async()=>{const e=O.length>0,t=e?O.length:s.length;if(0!==t){A(!0),D(t);try{let s;s=e?{trace_ids:O.map(e=>e.trace_id)}:{filters:{cascade_id:o,cell_name:m,trainable:!!u||void 0,search:f||void 0,limit:500,offset:0}};const a=await fetch("".concat(j.J,"/api/training/assess-confidence"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),n=await a.json();if(n.error)return P(n.error),void A(!1);D(n.queued_count||t),setTimeout(()=>{G(),q(),A(!1)},3e3)}catch(a){P(a.message),A(!1)}}},disabled:L||0===s.length,title:O.length>0?"Assess confidence for ".concat(O.length," selected"):"Assess confidence for all ".concat(s.length," visible"),children:[(0,r.jsx)(n.In,{icon:L?"mdi:loading":"mdi:brain",width:14,className:L?"spin":""}),(0,r.jsx)("span",{children:L?"Assessing ".concat(J,"..."):"Assess Confidence"})]}),(0,r.jsx)("div",{className:"training-actions-divider"}),(0,r.jsxs)("button",{className:"training-action-btn training-action-btn--primary",onClick:()=>K(!0,!1),disabled:0===O.length,children:[(0,r.jsx)(n.In,{icon:"mdi:check-circle",width:14}),(0,r.jsx)("span",{children:"Mark as Trainable"})]}),(0,r.jsxs)("button",{className:"training-action-btn training-action-btn--success",onClick:()=>K(!0,!0),disabled:0===O.length,children:[(0,r.jsx)(n.In,{icon:"mdi:shield-check",width:14}),(0,r.jsx)("span",{children:"Mark as Verified"})]}),(0,r.jsxs)("button",{className:"training-action-btn training-action-btn--danger",onClick:()=>K(!1,!1),disabled:0===O.length,children:[(0,r.jsx)(n.In,{icon:"mdi:close-circle",width:14}),(0,r.jsx)("span",{children:"Remove from Training"})]})]}),(0,r.jsxs)("div",{className:"training-content",children:[T&&(0,r.jsxs)("div",{className:"training-error",children:[(0,r.jsx)(n.In,{icon:"mdi:alert-circle",width:20}),(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"Error loading data"}),(0,r.jsx)("p",{children:T})]})]}),_&&0===s.length&&(0,r.jsx)(i.lp,{size:"medium",message:"Loading training examples...",className:"video-loader--flex"}),!_&&!T&&(0,r.jsx)(v,{examples:s,onSelectionChanged:F,onMarkTrainable:K})]}),(0,r.jsx)(z,{isOpen:E,examples:s,onClose:()=>R(!1),onComplete:async e=>{R(!1),await new Promise(e=>setTimeout(e,500)),await G(),await q();const t=e.filter(e=>"hot"===e.decision).length,s=e.filter(e=>"not"===e.decision).length,a=e.filter(e=>"skip"===e.decision).length;(t>0||s>0)&&console.log("Hot or Not complete: ".concat(t," hot, ").concat(s," not, ").concat(a," skipped"))}})]})}}}]);
//# sourceMappingURL=330.91eac44b.chunk.js.map