"use strict";(self.webpackChunklars_ui=self.webpackChunklars_ui||[]).push([[470],{31470:(e,s,t)=>{t.r(s),t.d(s,{default:()=>ne});var a=t(65043),l=t(5748),i=t(45685),n=t(50108),c=t(82291),r=t(87734),o=t(52185),d=t(6026),h=t(86150),u=t(38643),m=t(17869),x=t(81519),p=t(16350),v=t(13839),j=t(90168),y=t(70579);const f=e=>null===e||void 0===e?"$0.00":"$".concat(e>=1?e.toFixed(2):e>=.01?e.toFixed(3):e.toFixed(4)),g=e=>null===e||void 0===e?"0":e>=1e6?"".concat((e/1e6).toFixed(1),"M"):e>=1e3?"".concat((e/1e3).toFixed(1),"K"):e.toString(),N=e=>{let{items:s,value:t,onChange:i,labelKey:n,placeholder:c="Filter...",formatCount:r=g}=e;const[o,d]=(0,a.useState)(!1),[h,u]=(0,a.useState)(""),m=(0,a.useRef)(null);(0,a.useEffect)(()=>{const e=e=>{m.current&&!m.current.contains(e.target)&&(d(!1),u(""))};if(o)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[o]);const x=h?s.filter(e=>(e[n]||"").toLowerCase().includes(h.toLowerCase())):s;t&&s.find(e=>e[n]===t);return(0,y.jsxs)("div",{className:"filter-dropdown",ref:m,children:[t?(0,y.jsxs)("button",{className:"filter-dropdown-active",onClick:()=>i(null),title:"Clear filter",children:[(0,y.jsx)("span",{className:"filter-dropdown-value",children:t}),(0,y.jsx)(l.In,{icon:"mdi:close",width:12})]}):(0,y.jsxs)("button",{className:"filter-dropdown-trigger",onClick:()=>d(!o),children:[(0,y.jsx)(l.In,{icon:"mdi:filter-variant",width:14}),(0,y.jsx)("span",{children:"Filter"}),(0,y.jsx)(l.In,{icon:"mdi:chevron-down",width:14})]}),o&&(0,y.jsxs)("div",{className:"filter-dropdown-menu",children:[(0,y.jsxs)("div",{className:"filter-dropdown-search",children:[(0,y.jsx)(l.In,{icon:"mdi:magnify",width:14}),(0,y.jsx)("input",{type:"text",placeholder:c,value:h,onChange:e=>u(e.target.value),autoFocus:!0})]}),(0,y.jsx)("div",{className:"filter-dropdown-list",children:0===x.length?(0,y.jsx)("div",{className:"filter-dropdown-empty",children:"No matches"}):x.map((e,s)=>(0,y.jsxs)("button",{className:"filter-dropdown-item ".concat(t===e[n]?"active":""),onClick:()=>{i(e[n]),d(!1),u("")},children:[(0,y.jsx)("span",{className:"filter-dropdown-item-label",children:e[n]}),(0,y.jsx)("span",{className:"filter-dropdown-item-count",children:r(e.count)})]},s))})]})]})},w=e=>{let{active:s,payload:t}=e;if(!s||!t||!t.length)return null;const a=t[0].payload,l=a.count>0?(a.cost||0)/a.count:0;return(0,y.jsxs)("div",{className:"sql-trail-tooltip",children:[(0,y.jsx)("div",{className:"sql-trail-tooltip-title",children:a.query_type||"Unknown"}),a._isOthers&&a._otherTypes&&(0,y.jsxs)("div",{className:"sql-trail-tooltip-subtitle",children:[a._otherTypes.length," types: ",a._otherTypes.slice(0,5).join(", "),a._otherTypes.length>5&&" +".concat(a._otherTypes.length-5," more")]}),(0,y.jsxs)("div",{className:"sql-trail-tooltip-row",children:[(0,y.jsx)("span",{children:"Queries"}),(0,y.jsx)("span",{children:g(a.count)})]}),a.cost>0&&(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)("div",{className:"sql-trail-tooltip-row",children:[(0,y.jsx)("span",{children:"Total Cost"}),(0,y.jsx)("span",{children:f(a.cost)})]}),(0,y.jsxs)("div",{className:"sql-trail-tooltip-row",children:[(0,y.jsx)("span",{children:"Avg/Query"}),(0,y.jsx)("span",{children:f(l)})]})]})]})},_=e=>{let{active:s,payload:t}=e;if(!s||!t||!t.length)return null;const a=t[0].payload,l=a.count>0?(a.cost||0)/a.count:0;return(0,y.jsxs)("div",{className:"sql-trail-tooltip",children:[(0,y.jsx)("div",{className:"sql-trail-tooltip-title",children:a.udf_type||"Unknown"}),a._isOthers&&a._otherTypes&&(0,y.jsxs)("div",{className:"sql-trail-tooltip-subtitle",children:[a._otherTypes.length," types: ",a._otherTypes.slice(0,5).join(", "),a._otherTypes.length>5&&" +".concat(a._otherTypes.length-5," more")]}),(0,y.jsxs)("div",{className:"sql-trail-tooltip-row",children:[(0,y.jsx)("span",{children:"Invocations"}),(0,y.jsx)("span",{children:g(a.count)})]}),a.cost>0&&(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)("div",{className:"sql-trail-tooltip-row",children:[(0,y.jsx)("span",{children:"Total Cost"}),(0,y.jsx)("span",{children:f(a.cost)})]}),(0,y.jsxs)("div",{className:"sql-trail-tooltip-row",children:[(0,y.jsx)("span",{children:"Avg/Call"}),(0,y.jsx)("span",{children:f(l)})]})]})]})},b=e=>{let{queries:s,onQueryClick:t}=e;const[i,n]=(0,a.useState)(Date.now());(0,a.useEffect)(()=>{if(0===s.length)return;const e=setInterval(()=>n(Date.now()),1e3);return()=>clearInterval(e)},[s.length]);const c=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:80;if(!e)return"-";const t=e.replace(/\s+/g," ").trim();return t.length<=s?t:t.substring(0,s)+"..."},r=e=>{if(!e)return"-";const s=new Date(e).getTime();if(Number.isNaN(s))return"-";const t=Math.max(0,i-s),a=Math.floor(t/1e3),l=Math.floor(a/60),n=Math.floor(l/60);return n>0?"".concat(n,"h ").concat(l%60,"m"):l>0?"".concat(l,"m ").concat(a%60,"s"):"".concat(a,"s")};return(0,y.jsxs)("div",{className:"overview-chart-card running-queries-card",children:[(0,y.jsx)("div",{className:"overview-card-header",children:(0,y.jsxs)("div",{className:"overview-card-title",children:[(0,y.jsx)(l.In,{icon:"mdi:run-fast",width:14}),(0,y.jsx)("span",{children:"Running Queries"}),(0,y.jsx)("span",{className:"running-count-badge",children:s.length})]})}),(0,y.jsx)("div",{className:"running-queries-table-wrapper",children:(0,y.jsxs)("table",{className:"query-table",children:[(0,y.jsx)("thead",{children:(0,y.jsxs)("tr",{children:[(0,y.jsx)("th",{children:"Started"}),(0,y.jsx)("th",{children:"Query"}),(0,y.jsx)("th",{children:"Type"}),(0,y.jsx)("th",{children:"Cost"}),(0,y.jsx)("th",{children:"Calls"}),(0,y.jsx)("th",{children:"Elapsed"}),(0,y.jsx)("th",{children:"Status"})]})}),(0,y.jsx)("tbody",{children:s.map(e=>(0,y.jsxs)("tr",{onClick:()=>t&&t(e),children:[(0,y.jsx)("td",{className:"cell-nowrap",children:new Date(e.started_at||e.timestamp).toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit",second:"2-digit"})}),(0,y.jsx)("td",{className:"query-sql",title:e.query_raw,children:c(e.query_raw||e.query_preview)}),(0,y.jsx)("td",{className:"cell-type",children:e.query_type||"-"}),(0,y.jsx)("td",{className:"cell-cost",children:f(e.total_cost)}),(0,y.jsx)("td",{className:"cell-calls",children:e.llm_calls_count||0}),(0,y.jsx)("td",{className:"cell-elapsed",children:r(e.started_at||e.timestamp)}),(0,y.jsx)("td",{children:(0,y.jsxs)("span",{className:"status-badge status-running",children:[(0,y.jsx)("span",{className:"running-pulse"}),"running"]})})]},e.caller_id||e.query_id))})]})})]})},k=e=>{var s,t;let{data:a,cacheStats:i,timeSeries:k,runningQueries:C=[],onQueryClick:S,granularity:q="daily",onGranularityChange:I,queryTypeFilter:T,udfTypeFilter:E,onQueryTypeFilter:L,onUdfTypeFilter:F}=e;if(!a||!a.kpis)return(0,y.jsxs)("div",{className:"empty-state",children:[(0,y.jsx)(l.In,{icon:"mdi:database-off",width:48,className:"empty-state-icon"}),(0,y.jsx)("div",{className:"empty-state-title",children:"No data available"}),(0,y.jsx)("div",{className:"empty-state-text",children:"Run some SQL queries with LARS UDFs to see analytics here."})]});const{total_queries:O=0,total_cost:R=0,total_llm_calls:A=0,avg_duration_ms:M=0,cache_hit_rate:D=0}=a.kpis,P=a.udf_distribution||[],U=a.udf_types_distribution||[],z=((null===k||void 0===k?void 0:k.series)||[]).map(e=>{var s,t,a,l,i,n;return{period:e.period||e.date||e.timestamp,queries:null!==(s=null!==(t=e.query_count)&&void 0!==t?t:e.queries)&&void 0!==s?s:0,calls:null!==(a=null!==(l=e.llm_calls)&&void 0!==l?l:e.llm_calls_count)&&void 0!==a?a:0,cost:null!==(i=null!==(n=e.total_cost)&&void 0!==n?n:e.cost)&&void 0!==i?i:0}}),Q=[...P].sort((e,s)=>(s.count||0)-(e.count||0)),G=Q.length>10?[...Q.slice(0,10),{query_type:"Others",count:Q.slice(10).reduce((e,s)=>e+(s.count||0),0),cost:Q.slice(10).reduce((e,s)=>e+(s.cost||0),0),_isOthers:!0,_otherTypes:Q.slice(10).map(e=>e.query_type)}]:Q,W=[...U].sort((e,s)=>(s.count||0)-(e.count||0)),J=W.length>10?[...W.slice(0,10),{udf_type:"Others",count:W.slice(10).reduce((e,s)=>e+(s.count||0),0),cost:W.slice(10).reduce((e,s)=>e+(s.cost||0),0),_isOthers:!0,_otherTypes:W.slice(10).map(e=>e.udf_type)}]:W,K=function(e){let{tick:s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const t=new Date(e);if(Number.isNaN(t.getTime()))return e;switch(q){case"minute":return t.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"});case"hourly":return s?t.toLocaleTimeString(void 0,{hour:"2-digit"}):t.toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit"});case"weekly":return s?"Wk ".concat(t.toLocaleDateString(void 0,{month:"short",day:"numeric"})):"Week of ".concat(t.toLocaleDateString(void 0,{month:"short",day:"numeric"}));case"monthly":return s?t.toLocaleDateString(void 0,{month:"short"}):t.toLocaleDateString(void 0,{month:"short",year:"numeric"});default:return((e,s)=>{const t=new Date(e);return Number.isNaN(t.getTime())?e:t.toLocaleDateString(void 0,s)})(e,{month:"short",day:"numeric"})}},H=e=>{var s;let{active:t,payload:a,label:l}=e;if(!t||!a||!a.length)return null;const i=a.find(e=>"queries"===e.dataKey),n=a.find(e=>"calls"===e.dataKey),c=((null===(s=a[0])||void 0===s?void 0:s.payload)||{}).cost;return(0,y.jsxs)("div",{className:"sql-trail-tooltip",children:[(0,y.jsx)("div",{className:"sql-trail-tooltip-title",children:K(l)}),(0,y.jsxs)("div",{className:"sql-trail-tooltip-row",children:[(0,y.jsx)("span",{children:"Queries"}),(0,y.jsx)("span",{children:i?g(i.value):"0"})]}),(0,y.jsxs)("div",{className:"sql-trail-tooltip-row",children:[(0,y.jsx)("span",{children:"LLM Calls"}),(0,y.jsx)("span",{children:n?g(n.value):"0"})]}),c>0&&(0,y.jsxs)("div",{className:"sql-trail-tooltip-row",children:[(0,y.jsx)("span",{children:"Cost"}),(0,y.jsx)("span",{children:f(c||0)})]})]})};return(0,y.jsxs)("div",{className:"overview-panel",children:[(0,y.jsxs)("div",{className:"overview-kpis",children:[(0,y.jsxs)("div",{className:"kpi-card",children:[(0,y.jsxs)("div",{className:"kpi-header",children:[(0,y.jsx)(l.In,{icon:"mdi:database-search",width:16}),(0,y.jsx)("span",{children:"Total Queries"})]}),(0,y.jsx)("div",{className:"kpi-value purple",children:g(O)}),(0,y.jsx)("div",{className:"kpi-subtext",children:"SQL queries executed"})]}),(0,y.jsxs)("div",{className:"kpi-card",children:[(0,y.jsxs)("div",{className:"kpi-header",children:[(0,y.jsx)(l.In,{icon:"mdi:currency-usd",width:16}),(0,y.jsx)("span",{children:"Total Cost"})]}),(0,y.jsx)("div",{className:"kpi-value green",children:f(R)}),(0,y.jsxs)("div",{className:"kpi-subtext",children:[g(A)," LLM calls"]})]}),(0,y.jsxs)("div",{className:"kpi-card",children:[(0,y.jsxs)("div",{className:"kpi-header",children:[(0,y.jsx)(l.In,{icon:"mdi:cached",width:16}),(0,y.jsx)("span",{children:"Cache Hit Rate"})]}),(0,y.jsxs)("div",{className:"kpi-value blue",children:[D.toFixed(1),"%"]}),(0,y.jsxs)("div",{className:"kpi-subtext",children:[g((null===i||void 0===i||null===(s=i.overall)||void 0===s?void 0:s.total_hits)||0)," hits / ",g((null===i||void 0===i||null===(t=i.overall)||void 0===t?void 0:t.total_misses)||0)," misses"]})]}),(0,y.jsxs)("div",{className:"kpi-card",children:[(0,y.jsxs)("div",{className:"kpi-header",children:[(0,y.jsx)(l.In,{icon:"mdi:timer-outline",width:16}),(0,y.jsx)("span",{children:"Avg Duration"})]}),(0,y.jsx)("div",{className:"kpi-value yellow",children:(B=M,null===B||void 0===B?"0ms":B<1e3?"".concat(Math.round(B),"ms"):B<6e4?"".concat((B/1e3).toFixed(1),"s"):"".concat((B/6e4).toFixed(1),"m"))}),(0,y.jsx)("div",{className:"kpi-subtext",children:"Per query execution"})]})]}),(0,y.jsxs)("div",{className:"overview-row",children:[(0,y.jsxs)("div",{className:"overview-chart-card",children:[(0,y.jsxs)("div",{className:"overview-card-header",children:[(0,y.jsxs)("div",{className:"overview-card-title",children:[(0,y.jsx)(l.In,{icon:"mdi:shape-outline",width:14}),(0,y.jsx)("span",{children:"Queries by Type"}),(0,y.jsx)("span",{className:"overview-card-count",children:Q.length})]}),(0,y.jsx)(N,{items:Q,value:T,onChange:L,labelKey:"query_type",placeholder:"Search types..."})]}),G.length>0?(0,y.jsx)(n.u,{width:"100%",height:340,children:(0,y.jsxs)(c.E,{data:G,layout:"vertical",margin:{top:8,right:60,left:8,bottom:0},children:[(0,y.jsxs)("defs",{children:[(0,y.jsxs)("linearGradient",{id:"sqlTrailTypeGradient",x1:"0",y1:"0",x2:"1",y2:"0",children:[(0,y.jsx)("stop",{offset:"0%",stopColor:"var(--color-accent-cyan)",stopOpacity:.85}),(0,y.jsx)("stop",{offset:"100%",stopColor:"var(--color-accent-purple)",stopOpacity:.85})]}),(0,y.jsxs)("linearGradient",{id:"sqlTrailTypeGradientSelected",x1:"0",y1:"0",x2:"1",y2:"0",children:[(0,y.jsx)("stop",{offset:"0%",stopColor:"var(--color-accent-cyan)",stopOpacity:1}),(0,y.jsx)("stop",{offset:"100%",stopColor:"var(--color-accent-purple)",stopOpacity:1})]}),(0,y.jsxs)("linearGradient",{id:"sqlTrailTypeGradientDim",x1:"0",y1:"0",x2:"1",y2:"0",children:[(0,y.jsx)("stop",{offset:"0%",stopColor:"var(--color-accent-cyan)",stopOpacity:.25}),(0,y.jsx)("stop",{offset:"100%",stopColor:"var(--color-accent-purple)",stopOpacity:.25})]})]}),(0,y.jsx)(r.d,{strokeDasharray:"3 3",stroke:"var(--color-border-dim)",horizontal:!1}),(0,y.jsx)(o.W,{type:"number",tick:{fill:"var(--color-text-dim)",fontSize:10},axisLine:{stroke:"var(--color-border-dim)"},tickLine:!1,tickFormatter:e=>g(e)}),(0,y.jsx)(d.h,{type:"category",dataKey:"query_type",width:140,tick:{fill:"var(--color-text-muted)",fontSize:11},axisLine:!1,tickLine:!1}),(0,y.jsx)(h.m,{content:(0,y.jsx)(w,{}),cursor:{fill:"rgba(0, 229, 255, 0.08)"}}),(0,y.jsxs)(u.y,{dataKey:"count",radius:[0,6,6,0],onClick:e=>{!e._isOthers&&L&&L(e.query_type)},children:[G.map((e,s)=>{const t=T===e.query_type,a=null!==T,l=e._isOthers;let i="url(#sqlTrailTypeGradient)";return t?i="url(#sqlTrailTypeGradientSelected)":a&&(i="url(#sqlTrailTypeGradientDim)"),(0,y.jsx)(m.f,{fill:i,style:{cursor:l?"default":"pointer"}},"cell-".concat(s))}),(0,y.jsx)(x.Z,{dataKey:"cost",position:"right",formatter:e=>f(e),style:{fill:"var(--color-accent-green)",fontSize:10,fontWeight:500}})]})]})}):(0,y.jsx)("div",{className:"overview-empty",children:"No query type data available"}),(0,y.jsxs)("div",{className:"chart-legend chart-legend--compact",children:[(0,y.jsxs)("span",{className:"legend-item",children:[(0,y.jsx)("span",{className:"legend-bar",style:{background:"linear-gradient(to right, var(--color-accent-cyan), var(--color-accent-purple))"}}),"Queries"]}),(0,y.jsxs)("span",{className:"legend-item",children:[(0,y.jsx)("span",{className:"legend-text",style:{color:"var(--color-accent-green)"},children:"$"}),"Cost"]})]})]}),(0,y.jsxs)("div",{className:"overview-chart-card",children:[(0,y.jsxs)("div",{className:"overview-card-header",children:[(0,y.jsxs)("div",{className:"overview-card-title",children:[(0,y.jsx)(l.In,{icon:"mdi:function-variant",width:14}),(0,y.jsx)("span",{children:"UDF Invocations"}),(0,y.jsx)("span",{className:"overview-card-count",children:W.length})]}),(0,y.jsx)(N,{items:W,value:E,onChange:F,labelKey:"udf_type",placeholder:"Search UDFs..."})]}),J.length>0?(0,y.jsx)(n.u,{width:"100%",height:340,children:(0,y.jsxs)(c.E,{data:J,layout:"vertical",margin:{top:8,right:60,left:8,bottom:0},children:[(0,y.jsxs)("defs",{children:[(0,y.jsxs)("linearGradient",{id:"sqlTrailUdfGradient",x1:"0",y1:"0",x2:"1",y2:"0",children:[(0,y.jsx)("stop",{offset:"0%",stopColor:"var(--color-accent-purple)",stopOpacity:.85}),(0,y.jsx)("stop",{offset:"100%",stopColor:"var(--color-accent-pink)",stopOpacity:.85})]}),(0,y.jsxs)("linearGradient",{id:"sqlTrailUdfGradientSelected",x1:"0",y1:"0",x2:"1",y2:"0",children:[(0,y.jsx)("stop",{offset:"0%",stopColor:"var(--color-accent-purple)",stopOpacity:1}),(0,y.jsx)("stop",{offset:"100%",stopColor:"var(--color-accent-pink)",stopOpacity:1})]}),(0,y.jsxs)("linearGradient",{id:"sqlTrailUdfGradientDim",x1:"0",y1:"0",x2:"1",y2:"0",children:[(0,y.jsx)("stop",{offset:"0%",stopColor:"var(--color-accent-purple)",stopOpacity:.25}),(0,y.jsx)("stop",{offset:"100%",stopColor:"var(--color-accent-pink)",stopOpacity:.25})]})]}),(0,y.jsx)(r.d,{strokeDasharray:"3 3",stroke:"var(--color-border-dim)",horizontal:!1}),(0,y.jsx)(o.W,{type:"number",tick:{fill:"var(--color-text-dim)",fontSize:10},axisLine:{stroke:"var(--color-border-dim)"},tickLine:!1,tickFormatter:e=>g(e)}),(0,y.jsx)(d.h,{type:"category",dataKey:"udf_type",width:140,tick:{fill:"var(--color-text-muted)",fontSize:11},axisLine:!1,tickLine:!1}),(0,y.jsx)(h.m,{content:(0,y.jsx)(_,{}),cursor:{fill:"rgba(167, 139, 250, 0.08)"}}),(0,y.jsxs)(u.y,{dataKey:"count",radius:[0,6,6,0],onClick:e=>{!e._isOthers&&F&&F(e.udf_type)},children:[J.map((e,s)=>{const t=E===e.udf_type,a=null!==E,l=e._isOthers;let i="url(#sqlTrailUdfGradient)";return t?i="url(#sqlTrailUdfGradientSelected)":a&&(i="url(#sqlTrailUdfGradientDim)"),(0,y.jsx)(m.f,{fill:i,style:{cursor:l?"default":"pointer"}},"cell-".concat(s))}),(0,y.jsx)(x.Z,{dataKey:"cost",position:"right",formatter:e=>f(e),style:{fill:"var(--color-accent-green)",fontSize:10,fontWeight:500}})]})]})}):(0,y.jsx)("div",{className:"overview-empty",children:"No UDF invocations recorded"}),(0,y.jsxs)("div",{className:"chart-legend chart-legend--compact",children:[(0,y.jsxs)("span",{className:"legend-item",children:[(0,y.jsx)("span",{className:"legend-bar",style:{background:"linear-gradient(to right, var(--color-accent-purple), var(--color-accent-pink))"}}),"Invocations"]}),(0,y.jsxs)("span",{className:"legend-item",children:[(0,y.jsx)("span",{className:"legend-text",style:{color:"var(--color-accent-green)"},children:"$"}),"Cost"]})]})]})]}),(0,y.jsxs)("div",{className:"overview-chart-card",children:[(0,y.jsxs)("div",{className:"overview-card-header",children:[(0,y.jsxs)("div",{className:"overview-card-title",children:[(0,y.jsx)(l.In,{icon:"mdi:chart-timeline-variant",width:14}),(0,y.jsx)("span",{children:"Query Activity Over Time"})]}),(0,y.jsx)("div",{className:"sql-trail-granularity",children:[{value:"minute",label:"Minutes"},{value:"hourly",label:"Hourly"},{value:"daily",label:"Daily"},{value:"weekly",label:"Weekly"},{value:"monthly",label:"Monthly"}].map(e=>(0,y.jsx)("button",{type:"button",className:"sql-trail-granularity-btn ".concat(q===e.value?"active":""),onClick:()=>I&&I(e.value),children:e.label},e.value))})]}),z.length>0?(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(n.u,{width:"100%",height:250,children:(0,y.jsxs)(p.X,{data:z,margin:{top:12,right:16,left:8,bottom:0},children:[(0,y.jsx)("defs",{children:(0,y.jsxs)("linearGradient",{id:"sqlTrailQueriesGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,y.jsx)("stop",{offset:"5%",stopColor:"var(--color-accent-cyan)",stopOpacity:.35}),(0,y.jsx)("stop",{offset:"95%",stopColor:"var(--color-accent-cyan)",stopOpacity:0})]})}),(0,y.jsx)(r.d,{strokeDasharray:"3 3",stroke:"var(--color-border-dim)",vertical:!1}),(0,y.jsx)(o.W,{dataKey:"period",tick:{fill:"var(--color-text-dim)",fontSize:10},axisLine:{stroke:"var(--color-border-dim)"},tickLine:!1,tickFormatter:e=>K(e,{tick:!0})}),(0,y.jsx)(d.h,{yAxisId:"left",tick:{fill:"var(--color-text-dim)",fontSize:10},axisLine:!1,tickLine:!1,tickFormatter:e=>g(e)}),(0,y.jsx)(d.h,{yAxisId:"right",orientation:"right",tick:{fill:"var(--color-text-dim)",fontSize:10},axisLine:!1,tickLine:!1,tickFormatter:e=>g(e)}),(0,y.jsx)(h.m,{content:(0,y.jsx)(H,{})}),(0,y.jsx)(v.G,{yAxisId:"left",type:"monotone",dataKey:"queries",stroke:"var(--color-accent-cyan)",strokeWidth:1.5,fill:"url(#sqlTrailQueriesGradient)",name:"Queries"}),(0,y.jsx)(j.N,{yAxisId:"right",type:"monotone",dataKey:"calls",stroke:"var(--color-accent-purple)",strokeWidth:2,dot:!1,name:"LLM Calls",activeDot:{r:4,strokeWidth:2,stroke:"var(--color-bg-primary)"}})]})}),(0,y.jsxs)("div",{className:"sql-trail-activity-legend",children:[(0,y.jsxs)("span",{className:"legend-item",children:[(0,y.jsx)("span",{className:"legend-dot legend-queries"}),"Queries"]}),(0,y.jsxs)("span",{className:"legend-item",children:[(0,y.jsx)("span",{className:"legend-dot legend-calls"}),"LLM Calls"]})]})]}):(0,y.jsx)("div",{className:"overview-empty",children:"No time series data available"})]}),C.length>0&&(0,y.jsx)(b,{queries:C,onQueryClick:S})]});var B},C=e=>{if(!e)return"-";return new Date(e).toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},S=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:80;if(!e)return"-";const t=e.replace(/\s+/g," ").trim();return t.length<=s?t:t.substring(0,s)+"..."},q=(e,s)=>{const t=(e||0)+(s||0);return 0===t?0:(e||0)/t*100},I=e=>{let{queries:s=[],total:t=0,onQuerySelect:i}=e;const[n,c]=(0,a.useState)(""),[r,o]=(0,a.useState)("all"),[d,h]=(0,a.useState)("all"),[u,m]=(0,a.useState)("timestamp"),[x,p]=(0,a.useState)(!0),[v,j]=(0,a.useState)(Date.now());(0,a.useEffect)(()=>{if(!s.some(e=>"running"===e.status))return;const e=setInterval(()=>{j(Date.now())},1e3);return()=>clearInterval(e)},[s]);const f=(0,a.useMemo)(()=>{let e=[...s];if(n){const s=n.toLowerCase();e=e.filter(e=>(e.query_raw||"").toLowerCase().includes(s)||(e.caller_id||"").toLowerCase().includes(s)||(e.query_type||"").toLowerCase().includes(s))}return"all"!==r&&(e=e.filter(e=>e.status===r)),"all"!==d&&(e=e.filter(e=>(e.udf_types||[]).includes(d))),e.sort((e,s)=>{let t,a;switch(u){case"cost":t=e.total_cost||0,a=s.total_cost||0;break;case"duration":t=e.duration_ms||0,a=s.duration_ms||0;break;case"calls":t=e.llm_calls_count||0,a=s.llm_calls_count||0;break;case"cache":t=q(e.cache_hits,e.cache_misses),a=q(s.cache_hits,s.cache_misses);break;default:t=new Date(e.started_at||e.timestamp).getTime(),a=new Date(s.started_at||s.timestamp).getTime()}return x?a-t:t-a}),e},[s,n,r,d,u,x]),g=e=>{u===e?p(!x):(m(e),p(!0))},N=e=>{let{field:s}=e;return u!==s?null:(0,y.jsx)(l.In,{icon:x?"mdi:arrow-down":"mdi:arrow-up",width:12})};return 0===s.length?(0,y.jsxs)("div",{className:"empty-state",children:[(0,y.jsx)(l.In,{icon:"mdi:database-search-outline",width:48,className:"empty-state-icon"}),(0,y.jsx)("div",{className:"empty-state-title",children:"No queries found"}),(0,y.jsx)("div",{className:"empty-state-text",children:"Execute SQL queries using LARS UDFs to see them here."})]}):(0,y.jsxs)("div",{className:"query-explorer",children:[(0,y.jsxs)("div",{className:"explorer-toolbar",children:[(0,y.jsxs)("div",{className:"explorer-search",children:[(0,y.jsx)(l.In,{icon:"mdi:magnify",width:16,className:"explorer-search-icon"}),(0,y.jsx)("input",{type:"text",placeholder:"Search queries...",value:n,onChange:e=>c(e.target.value)})]}),(0,y.jsxs)("select",{className:"explorer-filter",value:r,onChange:e=>o(e.target.value),children:[(0,y.jsx)("option",{value:"all",children:"All Status"}),(0,y.jsx)("option",{value:"completed",children:"Completed"}),(0,y.jsx)("option",{value:"running",children:"Running"}),(0,y.jsx)("option",{value:"error",children:"Error"})]}),(0,y.jsxs)("select",{className:"explorer-filter",value:d,onChange:e=>h(e.target.value),children:[(0,y.jsx)("option",{value:"all",children:"All Types"}),(0,y.jsx)("option",{value:"lars_udf",children:"lars_udf"}),(0,y.jsx)("option",{value:"lars_cascade_udf",children:"lars_cascade_udf"}),(0,y.jsx)("option",{value:"llm_aggregate",children:"llm_aggregate"}),(0,y.jsx)("option",{value:"semantic_op",children:"semantic_op"})]}),(0,y.jsxs)("div",{className:"explorer-summary",children:["Showing ",f.length," of ",t," queries"]})]}),(0,y.jsx)("div",{className:"explorer-grid",children:(0,y.jsxs)("table",{className:"query-table",children:[(0,y.jsx)("thead",{children:(0,y.jsxs)("tr",{children:[(0,y.jsxs)("th",{className:"sortable ".concat("timestamp"===u?"sorted":""),onClick:()=>g("timestamp"),children:["Time ",(0,y.jsx)(N,{field:"timestamp"})]}),(0,y.jsx)("th",{children:"Query"}),(0,y.jsx)("th",{children:"Type"}),(0,y.jsxs)("th",{className:"sortable ".concat("cost"===u?"sorted":""),onClick:()=>g("cost"),children:["Cost ",(0,y.jsx)(N,{field:"cost"})]}),(0,y.jsxs)("th",{className:"sortable ".concat("calls"===u?"sorted":""),onClick:()=>g("calls"),children:["Calls ",(0,y.jsx)(N,{field:"calls"})]}),(0,y.jsxs)("th",{className:"sortable ".concat("cache"===u?"sorted":""),onClick:()=>g("cache"),children:["Cache ",(0,y.jsx)(N,{field:"cache"})]}),(0,y.jsxs)("th",{className:"sortable ".concat("duration"===u?"sorted":""),onClick:()=>g("duration"),children:["Duration ",(0,y.jsx)(N,{field:"duration"})]}),(0,y.jsx)("th",{children:"Status"})]})}),(0,y.jsx)("tbody",{children:f.map(e=>{const s=q(e.cache_hits,e.cache_misses),t=(a=s)>=80?"cache-high":a>=50?"cache-mid":"cache-low";var a;const l="running"===e.status,n=l?((e,s)=>{const t=e.started_at||e.timestamp||e.created_at,a=t?new Date(t).getTime():NaN;return Number.isNaN(a)?null:Math.max(0,s-a)})(e,v):null,c=l&&null!==n?n:e.duration_ms,r="completed"===e.status?"status-completed":"running"===e.status?"status-running":"status-error";return(0,y.jsxs)("tr",{onClick:()=>i(e),children:[(0,y.jsx)("td",{className:"cell-nowrap",children:C(e.started_at||e.timestamp)}),(0,y.jsx)("td",{className:"query-sql",title:e.query_raw,children:S(e.query_raw)}),(0,y.jsx)("td",{className:"cell-type",children:(e.udf_types||[]).join(", ")||e.query_type||"-"}),(0,y.jsx)("td",{className:"cell-cost",children:(d=e.total_cost,null===d||void 0===d?"$0.00":"$".concat(d>=1?d.toFixed(2):d>=.01?d.toFixed(3):d.toFixed(4)))}),(0,y.jsx)("td",{className:"cell-calls",children:e.llm_calls_count||0}),(0,y.jsx)("td",{children:(0,y.jsxs)("div",{className:"cache-bar",children:[(0,y.jsx)("div",{className:"cache-bar-track",children:(0,y.jsx)("div",{className:"cache-bar-fill ".concat(t),style:{width:"".concat(s,"%")}})}),(0,y.jsxs)("span",{className:"cache-bar-text ".concat(t),children:[s.toFixed(0),"%"]})]})}),(0,y.jsx)("td",{className:"cell-nowrap",children:(o=c,null===o||void 0===o?"-":o<1e3?"".concat(Math.round(o),"ms"):o<6e4?"".concat((o/1e3).toFixed(1),"s"):"".concat((o/6e4).toFixed(1),"m"))}),(0,y.jsx)("td",{children:(0,y.jsx)("span",{className:"status-badge ".concat(r),children:e.status||"unknown"})})]},e.caller_id||e.query_id);var o,d})})]})})]})};var T=t(94424),E=t(87955),L=t(24227);E.syG.registerModules([E.JKr]);const F=E.zl0.withParams({backgroundColor:"#000000",foregroundColor:"#cbd5e1",headerBackgroundColor:"#0a0510",headerTextColor:"#f0f4f8",oddRowBackgroundColor:"#050410",borderColor:"#1a1628",rowBorder:!0,wrapperBorder:!1,headerFontSize:12,headerFontWeight:600,fontFamily:"'Google Sans Code', monospace",fontSize:13,accentColor:"#00e5ff",chromeBackgroundColor:"#000000"}),O=e=>null===e||void 0===e?"$0.00":"$".concat(e>=1?e.toFixed(2):e>=.01?e.toFixed(3):e.toFixed(4)),R=e=>null===e||void 0===e?"0":e>=1e6?"".concat((e/1e6).toFixed(1),"M"):e>=1e3?"".concat((e/1e3).toFixed(1),"K"):e.toString(),A=e=>{if(!e)return"-";return new Date(e).toLocaleString()},M=["var(--color-accent-cyan)","var(--color-accent-purple)","var(--color-accent-green)","var(--color-accent-yellow)","var(--color-accent-pink)","var(--color-accent-blue)"],D={semantic_infix:{border:"var(--color-accent-purple)",bg:"rgba(167, 139, 250, 0.15)"},semantic_function:{border:"var(--color-accent-cyan)",bg:"rgba(0, 229, 255, 0.12)"},llm_aggregate:{border:"var(--color-accent-green)",bg:"rgba(52, 211, 153, 0.15)"},llm_case:{border:"var(--color-accent-yellow)",bg:"rgba(251, 191, 36, 0.15)"},structural:{border:"var(--color-accent-pink)",bg:"rgba(244, 114, 182, 0.12)"}},P=/\b(SELECT|FROM|WHERE|AND|OR|NOT|IN|LIKE|BETWEEN|IS|NULL|AS|ON|JOIN|LEFT|RIGHT|INNER|OUTER|CROSS|GROUP|BY|ORDER|HAVING|LIMIT|OFFSET|UNION|ALL|DISTINCT|INSERT|UPDATE|DELETE|CREATE|DROP|ALTER|TABLE|INDEX|VIEW|INTO|VALUES|SET|CASE|WHEN|THEN|ELSE|END|CAST|COALESCE|NULLIF|EXISTS|ANY|SOME|TRUE|FALSE|ASC|DESC|WITH|RECURSIVE|OVER|PARTITION|ROW_NUMBER|RANK|DENSE_RANK|LEAD|LAG|FIRST_VALUE|LAST_VALUE|COUNT|SUM|AVG|MIN|MAX|ARRAY|STRUCT|UNNEST)\b/gi,U=/\b(semantic_\w+|lars_\w+|SUMMARIZE|THEMES|EXTRACT_ENTITIES|CLASSIFY|SENTIMENT|LLM_CASE)\b/gi,z=/('(?:''|[^'])*')/g,Q=/\b(\d+\.?\d*)\b/g,G=/(--[^\n]*|\/\*[\s\S]*?\*\/)/g,W=e=>{if(!e)return null;const s=[];let t;const a=new RegExp(G.source,"gi");for(;null!==(t=a.exec(e));)s.push({start:t.index,end:t.index+t[0].length,type:"comment",text:t[0]});const l=new RegExp(z.source,"g");for(;null!==(t=l.exec(e));)s.push({start:t.index,end:t.index+t[0].length,type:"string",text:t[0]});const i=new RegExp(P.source,"gi");for(;null!==(t=i.exec(e));)s.push({start:t.index,end:t.index+t[0].length,type:"keyword",text:t[0]});const n=new RegExp(U.source,"gi");for(;null!==(t=n.exec(e));)s.push({start:t.index,end:t.index+t[0].length,type:"function",text:t[0]});const c=new RegExp(Q.source,"g");for(;null!==(t=c.exec(e));)s.push({start:t.index,end:t.index+t[0].length,type:"number",text:t[0]});s.sort((e,s)=>e.start-s.start);const r=[];let o=0;for(const u of s)u.start>=o&&(r.push(u),o=u.end);const d=[];let h=0;for(const u of r)u.start>h&&d.push((0,y.jsx)("span",{className:"sql-plain",children:e.slice(h,u.start)},"t-".concat(h))),d.push((0,y.jsx)("span",{className:"sql-".concat(u.type),children:u.text},"m-".concat(u.start))),h=u.end;return h<e.length&&d.push((0,y.jsx)("span",{className:"sql-plain",children:e.slice(h)},"t-".concat(h))),d},J=e=>{let{sql:s,calls:t,showLineNumbers:l=!0,onSpanHover:i,onSpanClick:n,hoveredSpanIndex:c,highlightedFunction:r}=e;const o=(0,a.useMemo)(()=>((e,s)=>{if(!s||0===s.length)return[{type:"plain",text:e}];const t=[...s].sort((e,s)=>e.start-s.start),a=[];let l=0;for(const c of t)c.start>=l&&(a.push(c),l=c.end);const i=[];let n=0;for(const c of a)c.start>n&&i.push({type:"plain",text:e.slice(n,c.start)}),c.end>c.start&&i.push({type:"semantic",text:e.slice(c.start,c.end),call:c}),n=c.end;return n<e.length&&i.push({type:"plain",text:e.slice(n)}),i})(s||"",t||[]),[s,t]),d=(0,a.useMemo)(()=>s?s.split("\n"):[],[s]);if(!s)return(0,y.jsx)("div",{className:"semantic-sql-empty",children:"No SQL to display"});const h=null!==c||null!==r;return(0,y.jsxs)("div",{className:"semantic-sql-viewer ".concat(h?"semantic-sql-viewer--has-focus":""),children:[l&&(0,y.jsx)("div",{className:"semantic-sql-line-numbers",children:d.map((e,s)=>(0,y.jsx)("div",{className:"semantic-sql-line-number",children:s+1},s))}),(0,y.jsx)("pre",{className:"semantic-sql-code",children:(0,y.jsx)("code",{children:o.map((e,s)=>{if("plain"===e.type)return(0,y.jsx)("span",{className:"semantic-sql-plain",children:W(e.text)},s);const t=e.call,a=D[t.kind]||D.semantic_function,l=c===s,o=r&&(t.function===r||t.display===r);return(0,y.jsx)("span",{className:"semantic-span semantic-span--".concat(t.kind," ").concat(l||o?"semantic-span--hovered":""),style:{"--span-border":a.border,"--span-bg":a.bg},onMouseEnter:()=>i&&i(s,t),onMouseLeave:()=>i&&i(null,null),onClick:()=>n&&n(t),children:(0,y.jsx)("span",{className:"semantic-span-content",children:W(e.text)})},s)})})}),t&&t.length>0&&(0,y.jsx)("div",{className:"semantic-sql-legend",children:Object.entries(D).map(e=>{let[s,a]=e;return t.some(e=>e.kind===s)?(0,y.jsxs)("div",{className:"semantic-sql-legend-item",children:[(0,y.jsx)("span",{className:"semantic-sql-legend-color",style:{borderColor:a.border,background:a.bg}}),(0,y.jsx)("span",{className:"semantic-sql-legend-label",children:s.replace(/_/g," ")})]},s):null})})]})},K=e=>{var s;let{hoveredCall:t,spawnedSessions:i,cascadeExecutions:n}=e;const c=(0,a.useMemo)(()=>{if(!t)return null;const e=t.cascade_id,s=t.function,a=(i||[]).filter(t=>!(!e||t.cascade_id!==e)||(!(!s||t.cascade_id!==s)||!!(s&&t.cascade_id&&t.cascade_id.includes(s)))),l=(n||[]).filter(t=>!(!e||t.cascade_id!==e)||(!(!s||t.cascade_id!==s)||!!(s&&t.cascade_id&&t.cascade_id.includes(s)))),c=a.reduce((e,s)=>e+(s.total_cost||0),0),r=a.reduce((e,s)=>e+(s.total_tokens_in||0),0),o=a.reduce((e,s)=>e+(s.total_tokens_out||0),0),d=a.reduce((e,s)=>e+(s.message_count||0),0),h=a.length,u=l.length,m=[...new Set(a.map(e=>e.model).filter(Boolean))];return{cascadeId:e||s,display:t.display,kind:t.kind,shape:t.shape,returns:t.returns,totalCost:c,totalTokensIn:r,totalTokensOut:o,totalMessages:d,sessionCount:h,executionCount:u,models:m,hasData:h>0||u>0}},[t,i,n]);if(!t)return(0,y.jsxs)("div",{className:"span-metrics-empty",children:[(0,y.jsx)(l.In,{icon:"mdi:cursor-default-click",width:24}),(0,y.jsx)("span",{children:"Hover a semantic span to see metrics"})]});const r=D[t.kind]||D.semantic_function;return(0,y.jsxs)("div",{className:"span-metrics-panel",children:[(0,y.jsxs)("div",{className:"span-metrics-header",style:{borderColor:r.border},children:[(0,y.jsx)("div",{className:"span-metrics-kind",style:{color:r.border},children:null===(s=t.kind)||void 0===s?void 0:s.replace(/_/g," ")}),(0,y.jsx)("div",{className:"span-metrics-display",children:(null===c||void 0===c?void 0:c.display)||t.function||"-"}),(null===c||void 0===c?void 0:c.cascadeId)&&(0,y.jsxs)("div",{className:"span-metrics-cascade",children:[(0,y.jsx)(l.In,{icon:"mdi:arrow-right",width:10}),(0,y.jsx)("code",{children:c.cascadeId})]})]}),null!==c&&void 0!==c&&c.hasData?(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)("div",{className:"span-metrics-grid",children:[(0,y.jsxs)("div",{className:"span-metric",children:[(0,y.jsx)("div",{className:"span-metric-value accent-green",children:O(c.totalCost)}),(0,y.jsx)("div",{className:"span-metric-label",children:"Cost"})]}),(0,y.jsxs)("div",{className:"span-metric",children:[(0,y.jsx)("div",{className:"span-metric-value accent-purple",children:R(c.executionCount)}),(0,y.jsx)("div",{className:"span-metric-label",children:"Executions"})]}),(0,y.jsxs)("div",{className:"span-metric",children:[(0,y.jsx)("div",{className:"span-metric-value accent-cyan",children:R(c.sessionCount)}),(0,y.jsx)("div",{className:"span-metric-label",children:"Sessions"})]}),(0,y.jsxs)("div",{className:"span-metric",children:[(0,y.jsx)("div",{className:"span-metric-value accent-blue",children:R(c.totalMessages)}),(0,y.jsx)("div",{className:"span-metric-label",children:"LLM Calls"})]}),(0,y.jsxs)("div",{className:"span-metric span-metric--wide",children:[(0,y.jsxs)("div",{className:"span-metric-value",children:[R(c.totalTokensIn)," / ",R(c.totalTokensOut)]}),(0,y.jsx)("div",{className:"span-metric-label",children:"Tokens In / Out"})]}),c.models.length>0&&(0,y.jsxs)("div",{className:"span-metric span-metric--wide",children:[(0,y.jsxs)("div",{className:"span-metric-models",children:[c.models.slice(0,3).map((e,s)=>(0,y.jsx)("span",{className:"span-metric-model",children:e},s)),c.models.length>3&&(0,y.jsxs)("span",{className:"span-metric-model",children:["+",c.models.length-3]})]}),(0,y.jsx)("div",{className:"span-metric-label",children:"Models"})]})]}),(0,y.jsxs)("div",{className:"span-metrics-action",children:[(0,y.jsx)(l.In,{icon:"mdi:open-in-new",width:12}),(0,y.jsx)("span",{children:"Click span to open in Studio"})]})]}):(0,y.jsxs)("div",{className:"span-metrics-no-data",children:[(0,y.jsx)(l.In,{icon:"mdi:information-outline",width:16}),(0,y.jsx)("span",{children:"No execution data for this span"}),(null===c||void 0===c?void 0:c.shape)&&(0,y.jsxs)("div",{className:"span-metrics-shape",children:[(0,y.jsx)("span",{className:"span-metrics-shape-badge",children:c.shape}),c.returns&&(0,y.jsxs)("span",{className:"span-metrics-returns",children:["\u2192 ",c.returns]})]})]})]})},H=e=>{let{semanticCalls:s,spawnedSessions:t,cascadeExecutions:i,onFunctionHover:n,onFunctionClick:c,highlightedFunction:r}=e;const o=(0,a.useMemo)(()=>{if(!s||0===s.length)return{functions:[],totalCost:0,totalCalls:0,hasData:!1};const e=new Map;for(const n of s){const s=n.function||n.display||"unknown",a=n.cascade_id;e.has(s)||e.set(s,{name:s,kind:n.kind,cascadeId:a,occurrences:0,cost:0,tokens:0,sessions:0,messages:0});const l=e.get(s);l.occurrences+=1;const i=(t||[]).filter(e=>!(!a||e.cascade_id!==a)||(!(!s||e.cascade_id!==s)||!!(s&&e.cascade_id&&e.cascade_id.includes(s))));0===l.sessions&&(l.cost=i.reduce((e,s)=>e+(s.total_cost||0),0),l.tokens=i.reduce((e,s)=>e+(s.total_tokens_in||0)+(s.total_tokens_out||0),0),l.sessions=i.length,l.messages=i.reduce((e,s)=>e+(s.message_count||0),0))}const a=Array.from(e.values()).sort((e,s)=>s.cost-e.cost),l=a.reduce((e,s)=>e+s.cost,0),i=a.reduce((e,s)=>e+s.messages,0);return{functions:a,totalCost:l,totalCalls:i,hasData:a.some(e=>e.sessions>0)}},[s,t,i]);if(!s||0===s.length)return(0,y.jsxs)("div",{className:"semantic-summary-empty",children:[(0,y.jsx)(l.In,{icon:"mdi:function-variant",width:24}),(0,y.jsx)("span",{children:"No semantic functions in this query"})]});const d=Math.max(...o.functions.map(e=>e.cost),1e-4);return(0,y.jsxs)("div",{className:"semantic-summary-panel",children:[(0,y.jsxs)("div",{className:"semantic-summary-header",children:[(0,y.jsxs)("span",{className:"semantic-summary-count",children:[o.functions.length," functions"]}),o.hasData&&(0,y.jsxs)("span",{className:"semantic-summary-total",children:[O(o.totalCost)," total"]})]}),(0,y.jsx)("div",{className:"semantic-summary-list",children:o.functions.map((e,s)=>{const t=D[e.kind]||D.semantic_function,a=o.totalCost>0?e.cost/d*100:0,l=r===e.name;return(0,y.jsxs)("div",{className:"semantic-summary-item ".concat(l?"semantic-summary-item--highlighted":""),onMouseEnter:()=>n&&n(e.name),onMouseLeave:()=>n&&n(null),onClick:()=>c&&c(e.name,e.cascadeId),children:[(0,y.jsx)("div",{className:"semantic-summary-bar",style:{width:"".concat(a,"%"),background:t.bg}}),(0,y.jsxs)("div",{className:"semantic-summary-content",children:[(0,y.jsxs)("div",{className:"semantic-summary-name",style:{color:t.border},children:[e.name,e.occurrences>1&&(0,y.jsxs)("span",{className:"semantic-summary-occurrences",children:["\xd7",e.occurrences]})]}),(0,y.jsx)("div",{className:"semantic-summary-stats",children:e.sessions>0?(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)("span",{className:"semantic-summary-stat accent-green",children:O(e.cost)}),(0,y.jsxs)("span",{className:"semantic-summary-stat",children:[R(e.messages)," calls"]}),(0,y.jsxs)("span",{className:"semantic-summary-stat",children:[R(e.tokens)," tok"]})]}):(0,y.jsx)("span",{className:"semantic-summary-stat dim",children:"no execution data"})})]})]},e.name)})}),(0,y.jsxs)("div",{className:"semantic-summary-hint",children:[(0,y.jsx)(l.In,{icon:"mdi:open-in-new",width:12}),(0,y.jsx)("span",{children:"Click to open in Studio"})]})]})},B=e=>{let{active:s,payload:t}=e;if(!s||!t||!t.length)return null;const a=t[0].payload;return(0,y.jsxs)("div",{className:"sql-trail-tooltip",children:[(0,y.jsx)("div",{className:"sql-trail-tooltip-title",children:a.model}),(0,y.jsxs)("div",{className:"sql-trail-tooltip-row",children:[(0,y.jsx)("span",{children:"Cost"}),(0,y.jsx)("span",{children:O(a.cost||0)})]}),(0,y.jsxs)("div",{className:"sql-trail-tooltip-row",children:[(0,y.jsx)("span",{children:"Calls"}),(0,y.jsx)("span",{children:R(a.calls||0)})]})]})},V=e=>{var s,t,i,n;let{cellInfo:c,onClose:r}=e;const[o,d]=(0,a.useState)(null),[h,u]=(0,a.useState)(!0),[m,x]=(0,a.useState)(null);return(0,a.useEffect)(()=>{if(null===c||void 0===c||!c.session_id)return void u(!1);(async()=>{u(!0);try{const e=await fetch("".concat(L.J,"/api/sql-trail/session/").concat(encodeURIComponent(c.session_id),"/messages?limit=50"));if(!e.ok)throw new Error("HTTP ".concat(e.status));const s=await e.json();d(s)}catch(e){x(e.message)}finally{u(!1)}})()},[null===c||void 0===c?void 0:c.session_id]),c?(0,y.jsxs)("div",{className:"cell-detail-panel",children:[(0,y.jsxs)("div",{className:"cell-detail-header",children:[(0,y.jsxs)("div",{className:"cell-detail-title",children:[(0,y.jsx)(l.In,{icon:"mdi:brain",width:16}),(0,y.jsxs)("span",{children:["Cell [",c.row_index,", ",c.column_name,"]"]})]}),(0,y.jsx)("button",{className:"btn btn-ghost btn-xs",onClick:r,children:(0,y.jsx)(l.In,{icon:"mdi:close",width:16})})]}),(0,y.jsxs)("div",{className:"cell-detail-meta",children:[(0,y.jsxs)("div",{className:"cell-detail-meta-item",children:[(0,y.jsx)("span",{className:"cell-detail-meta-label",children:"Session"}),(0,y.jsxs)("code",{className:"cell-detail-meta-value",children:[null===(s=c.session_id)||void 0===s?void 0:s.substring(0,20),"..."]})]}),(0,y.jsxs)("div",{className:"cell-detail-meta-item",children:[(0,y.jsx)("span",{className:"cell-detail-meta-label",children:"Cascade"}),(0,y.jsx)("span",{className:"cell-detail-meta-value",children:c.cascade_id||"-"})]}),(0,y.jsxs)("div",{className:"cell-detail-meta-item",children:[(0,y.jsx)("span",{className:"cell-detail-meta-label",children:"Model"}),(0,y.jsx)("span",{className:"cell-detail-meta-value",children:c.model||"-"})]}),(0,y.jsxs)("div",{className:"cell-detail-meta-item",children:[(0,y.jsx)("span",{className:"cell-detail-meta-label",children:"Cost"}),(0,y.jsx)("span",{className:"cell-detail-meta-value accent-green",children:O(c.cost)})]})]}),(0,y.jsxs)("div",{className:"cell-detail-messages",children:[h&&(0,y.jsxs)("div",{className:"cell-detail-loading",children:[(0,y.jsx)(l.In,{icon:"mdi:loading",width:20,className:"spin"}),(0,y.jsx)("span",{children:"Loading messages..."})]}),m&&(0,y.jsxs)("div",{className:"cell-detail-error",children:[(0,y.jsx)(l.In,{icon:"mdi:alert-circle",width:16}),(0,y.jsx)("span",{children:m})]}),o&&!h&&(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)("div",{className:"cell-detail-messages-header",children:[(0,y.jsxs)("span",{children:[(null===(t=o.messages)||void 0===t?void 0:t.length)||0," messages"]}),(0,y.jsxs)("span",{className:"cell-detail-tokens",children:[R((null===(i=o.total_tokens)||void 0===i?void 0:i.in)||0)," in / ",R((null===(n=o.total_tokens)||void 0===n?void 0:n.out)||0)," out"]})]}),(0,y.jsx)("div",{className:"cell-detail-messages-list",children:(o.messages||[]).map((e,s)=>{var t;return(0,y.jsxs)("div",{className:"cell-detail-message cell-detail-message--".concat(e.role),children:[(0,y.jsxs)("div",{className:"cell-detail-message-header",children:[(0,y.jsx)("span",{className:"cell-detail-message-role cell-detail-message-role--".concat(e.role),children:e.role}),e.cell_name&&(0,y.jsx)("span",{className:"cell-detail-message-phase",children:e.cell_name}),e.cost>0&&(0,y.jsx)("span",{className:"cell-detail-message-cost",children:O(e.cost)})]}),(0,y.jsx)("div",{className:"cell-detail-message-content",children:"string"===typeof e.content?e.content.substring(0,500)+(e.content.length>500?"...":""):JSON.stringify(e.content).substring(0,500)}),(null===(t=e.tool_calls)||void 0===t?void 0:t.length)>0&&(0,y.jsx)("div",{className:"cell-detail-message-tools",children:e.tool_calls.map((e,s)=>(0,y.jsxs)("span",{className:"cell-detail-tool-call",children:[(0,y.jsx)(l.In,{icon:"mdi:function",width:12}),e.name]},s))})]},s)})})]})]}),(0,y.jsx)("div",{className:"cell-detail-actions",children:(0,y.jsxs)("button",{className:"btn btn-ghost btn-sm",onClick:()=>{c.cascade_id&&c.session_id&&(window.location.href="/studio/".concat(encodeURIComponent(c.cascade_id),"/").concat(encodeURIComponent(c.session_id)))},disabled:!c.cascade_id||!c.session_id,children:[(0,y.jsx)(l.In,{icon:"mdi:open-in-new",width:14}),"Open in Studio"]})})]}):null},$=e=>{var s,t,i;let{callerId:n,resultLocation:c}=e;const r=(0,a.useRef)(null),[o,d]=(0,a.useState)(null),[h,u]=(0,a.useState)(!0),[m,x]=(0,a.useState)(null),[p,v]=(0,a.useState)(0),j=100,[f,g]=(0,a.useState)(null),[N,w]=(0,a.useState)(null),[_,b]=(0,a.useState)(!1),k=(0,a.useMemo)(()=>{if(null===f||void 0===f||!f.cells)return new Map;const e=new Map;for(const s of f.cells){const t="".concat(s.row_index,":").concat(s.column_name);e.has(t)||e.set(t,s)}return e},[f]),C=(0,a.useMemo)(()=>{var e;return null!==f&&void 0!==f&&null!==(e=f.cells)&&void 0!==e&&e.length?Math.max(...f.cells.map(e=>e.cost||0)):0},[f]),S=(0,a.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;u(!0),x(null);try{const s=await fetch("".concat(L.J,"/api/sql-trail/query/").concat(encodeURIComponent(n),"/results?offset=").concat(e,"&limit=").concat(j));if(!s.ok){const e=await s.json().catch(()=>({}));throw new Error(e.message||e.error||"HTTP ".concat(s.status))}const t=await s.json();d(t),v(e)}catch(s){console.error("Failed to fetch results:",s),x(s.message)}finally{u(!1)}},[n]),q=(0,a.useCallback)(async()=>{try{const e=await fetch("".concat(L.J,"/api/sql-trail/query/").concat(encodeURIComponent(n),"/cell-attribution"));if(e.ok){const s=await e.json();g(s)}}catch(e){console.warn("Failed to fetch cell attribution:",e)}},[n]);(0,a.useEffect)(()=>{S(0),q()},[S,q]);const I=(0,a.useCallback)(e=>{const s="".concat(L.J,"/api/sql-trail/query/").concat(encodeURIComponent(n),"/results/export?format=").concat(e);window.open(s,"_blank")},[n]),E=(0,a.useCallback)(()=>{p>=j&&S(p-j)},[p,S]),A=(0,a.useCallback)(()=>{null!==o&&void 0!==o&&o.has_more&&S(p+j)},[p,o,S]),M=(0,a.useCallback)((e,s)=>{const t="".concat(e,":").concat(s),a=k.get(t);a&&w(a)},[k]),D=(0,a.useMemo)(()=>null!==o&&void 0!==o&&o.columns?o.columns.map((e,s)=>({field:"col_".concat(s),headerName:e.name,headerTooltip:"".concat(e.name," (").concat(e.type,")"),sortable:!0,filter:!0,resizable:!0,minWidth:100,flex:1,cellRenderer:s=>{var t;const a=s.value,i=(null===(t=s.data)||void 0===t?void 0:t._rowIndex)+p,n=e.name,c="".concat(i,":").concat(n),r=k.get(c),o=!!r;let d={};if(_&&o&&C>0){const e=r.cost/C;d={background:"rgba(167, 139, 250, ".concat(.4*e,")")}}const h=null===a||void 0===a?(0,y.jsx)("span",{className:"results-null",children:"NULL"}):"object"===typeof a?(0,y.jsx)("span",{className:"results-json",children:JSON.stringify(a)}):String(a);return o?(0,y.jsxs)("div",{className:"results-cell results-cell--attributed",style:d,onClick:()=>M(i,n),title:"LLM computed - ".concat(O(r.cost)," - Click for details"),children:[(0,y.jsx)("span",{className:"results-cell-indicator",children:(0,y.jsx)(l.In,{icon:"mdi:sparkles",width:12})}),(0,y.jsx)("span",{className:"results-cell-value",children:h})]}):(0,y.jsx)("div",{className:"results-cell",children:h})}})):[],[null===o||void 0===o?void 0:o.columns,k,_,C,p,M]),P=(0,a.useMemo)(()=>null!==o&&void 0!==o&&o.rows&&null!==o&&void 0!==o&&o.columns?o.rows.map((e,s)=>{const t={_rowIndex:s};return o.columns.forEach((s,a)=>{t["col_".concat(a)]=e[a]}),t}):[],[o]),U=(0,a.useMemo)(()=>({sortable:!0,filter:!0,resizable:!0,minWidth:80}),[]),z=(0,a.useCallback)(e=>{e.api.autoSizeAllColumns()},[]),Q=(null===f||void 0===f||null===(s=f.summary)||void 0===s?void 0:s.total_cells)>0,G=(null===f||void 0===f||null===(t=f.summary)||void 0===t?void 0:t.columns_with_attribution)||[];return(0,y.jsxs)("div",{className:"results-viewer",children:[(0,y.jsxs)("div",{className:"results-viewer-header",children:[(0,y.jsxs)("div",{className:"results-viewer-title",children:[(0,y.jsx)(l.In,{icon:"mdi:table-large",width:16}),(0,y.jsx)("span",{children:"Query Results"}),o&&(0,y.jsxs)("span",{className:"results-viewer-count",children:[R(o.total_rows)," rows"]}),Q&&(0,y.jsxs)("span",{className:"results-viewer-attribution-badge",children:[(0,y.jsx)(l.In,{icon:"mdi:sparkles",width:12}),f.summary.total_cells," LLM cells",(0,y.jsx)("span",{className:"results-viewer-attribution-cost",children:O(f.summary.total_cost)})]})]}),(0,y.jsxs)("div",{className:"results-viewer-actions",children:[Q&&(0,y.jsxs)("button",{className:"btn btn-ghost btn-xs ".concat(_?"btn-active":""),onClick:()=>b(!_),title:"Toggle cost heatmap",children:[(0,y.jsx)(l.In,{icon:"mdi:gradient-horizontal",width:14}),"Heatmap"]}),(0,y.jsxs)("button",{className:"btn btn-ghost btn-xs",onClick:()=>I("csv"),title:"Export as CSV",children:[(0,y.jsx)(l.In,{icon:"mdi:file-delimited",width:14}),"CSV"]}),(0,y.jsxs)("button",{className:"btn btn-ghost btn-xs",onClick:()=>I("json"),title:"Export as JSON",children:[(0,y.jsx)(l.In,{icon:"mdi:code-json",width:14}),"JSON"]})]})]}),Q&&(0,y.jsxs)("div",{className:"results-viewer-attribution-summary",children:[(0,y.jsx)("span",{className:"results-viewer-attribution-label",children:"LLM-computed columns:"}),G.map(e=>(0,y.jsxs)("span",{className:"results-viewer-attribution-col",children:[(0,y.jsx)(l.In,{icon:"mdi:sparkles",width:10}),e]},e)),(null===(i=f.summary.models_used)||void 0===i?void 0:i.length)>0&&(0,y.jsxs)("span",{className:"results-viewer-attribution-models",children:["via ",f.summary.models_used.map(e=>e.model).join(", ")]})]}),m&&(0,y.jsxs)("div",{className:"results-viewer-error",children:[(0,y.jsx)(l.In,{icon:"mdi:alert-circle",width:16}),(0,y.jsx)("span",{children:m}),(0,y.jsx)("button",{className:"btn btn-ghost btn-xs",onClick:()=>S(p),children:"Retry"})]}),h&&(0,y.jsxs)("div",{className:"results-viewer-loading",children:[(0,y.jsx)(l.In,{icon:"mdi:loading",width:24,className:"spin"}),(0,y.jsx)("span",{children:"Loading results..."})]}),o&&!h&&(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)("div",{className:"results-viewer-grid-wrapper",children:(0,y.jsx)(T.W6,{ref:r,rowData:P,columnDefs:D,defaultColDef:U,theme:F,animateRows:!1,onFirstDataRendered:z,enableCellTextSelection:!0,ensureDomOrder:!0,suppressRowClickSelection:!0,pagination:!0,paginationPageSize:25,paginationPageSizeSelector:[25,50,100]})}),o.total_rows>j&&(0,y.jsxs)("div",{className:"results-viewer-pagination",children:[(0,y.jsxs)("button",{className:"btn btn-ghost btn-xs",onClick:E,disabled:0===p,children:[(0,y.jsx)(l.In,{icon:"mdi:chevron-left",width:14}),"Previous ",j]}),(0,y.jsxs)("span",{className:"results-viewer-page-info",children:["Rows ",p+1," - ",Math.min(p+o.rows.length,o.total_rows)," of ",R(o.total_rows)]}),(0,y.jsxs)("button",{className:"btn btn-ghost btn-xs",onClick:A,disabled:!o.has_more,children:["Next ",j,(0,y.jsx)(l.In,{icon:"mdi:chevron-right",width:14})]})]}),(0,y.jsx)("div",{className:"results-viewer-footer",children:(0,y.jsxs)("code",{className:"results-viewer-location-small",children:["lars_results.",o.result_table||(null===c||void 0===c?void 0:c.result_table)]})})]}),N&&(0,y.jsx)(V,{cellInfo:N,onClose:()=>w(null)})]})},X=e=>{let{data:s,onBack:t}=e;const[i,m]=(0,a.useState)(null),[x,p]=(0,a.useState)(!1),[v,j]=(0,a.useState)(null),[f,g]=(0,a.useState)(null),[N,w]=(0,a.useState)(null),[_,b]=(0,a.useState)(null),k=(0,a.useCallback)((e,s)=>{g(e),w(s),null!==e&&b(null)},[]),C=(0,a.useCallback)(e=>{b(e)},[]),S=(0,a.useCallback)((e,t)=>{const a=(null===s||void 0===s?void 0:s.spawned_sessions)||[],l=(null===s||void 0===s?void 0:s.cascade_executions)||[],i=a.find(s=>!(!t||s.cascade_id!==t)||(!(!e||s.cascade_id!==e)||!!(e&&s.cascade_id&&s.cascade_id.includes(e)))),n=!i&&l.find(s=>!(!t||s.cascade_id!==t)||(!(!e||s.cascade_id!==e)||!!(e&&s.cascade_id&&s.cascade_id.includes(e)))),c=(null===i||void 0===i?void 0:i.session_id)||(null===n||void 0===n?void 0:n.session_id),r=t||e;if(r&&c){const e="/studio/".concat(encodeURIComponent(r),"/").concat(encodeURIComponent(c));window.location.href=e}else if(r){const e="/studio/".concat(encodeURIComponent(r));window.location.href=e}},[s]),q=(0,a.useCallback)((e,s,t)=>{if(!e)return;const a=e.cascade_id,l=e.function,i=(s||[]).find(e=>!(!a||e.cascade_id!==a)||(!(!l||e.cascade_id!==l)||!!(l&&e.cascade_id&&e.cascade_id.includes(l)))),n=!i&&(t||[]).find(e=>!(!a||e.cascade_id!==a)||(!(!l||e.cascade_id!==l)||!!(l&&e.cascade_id&&e.cascade_id.includes(l)))),c=(null===i||void 0===i?void 0:i.session_id)||(null===n||void 0===n?void 0:n.session_id),r=a||l;if(r&&c){const e="/studio/".concat(encodeURIComponent(r),"/").concat(encodeURIComponent(c));console.log("Navigating to Studio:",e),window.location.href=e}else if(r){const e="/studio/".concat(encodeURIComponent(r));console.log("Navigating to Studio (cascade only):",e),window.location.href=e}else console.log("No cascade_id or session_id found for span:",e)},[]),I=(0,a.useCallback)(async e=>{if(e&&e.trim()){p(!0),j(null);try{const s=await fetch("".concat(L.J,"/api/sql/inspect"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sql:e})});if(!s.ok)throw new Error("HTTP ".concat(s.status));const t=await s.json();if(t.error)throw new Error(t.error);m(t),console.log("SQL Inspection result:",t)}catch(s){console.error("Failed to inspect SQL:",s),j(s.message)}finally{p(!1)}}else m(null)},[]),T=(null===s||void 0===s?void 0:s.query)||s,E=null===T||void 0===T?void 0:T.query_raw;if((0,a.useEffect)(()=>{E&&I(E)},[E,I]),!s)return(0,y.jsxs)("div",{className:"empty-state",children:[(0,y.jsx)(l.In,{icon:"mdi:file-document-outline",width:48,className:"empty-state-icon"}),(0,y.jsx)("div",{className:"empty-state-title",children:"No query selected"}),(0,y.jsx)("div",{className:"empty-state-text",children:"Select a query from the Explorer to see details."})]});const F=(s.spawned_sessions||[]).map(e=>({session_id:e.session_id,cascade_id:e.cascade_id,model:e.model||"-",total_cost:e.total_cost||0,total_tokens_in:e.total_tokens_in||0,total_tokens_out:e.total_tokens_out||0,message_count:e.message_count||0,timestamp:e.started_at||e.timestamp})),D=s.cascade_executions||[],P=(s.models_used||[]).map(e=>({model:e.model,cost:e.total_cost,calls:e.call_count,tokens_in:e.tokens_in,tokens_out:e.tokens_out})),{caller_id:U,query_template:z,query_fingerprint:Q,query_type:G,udf_types:W=[],status:V,started_at:X,completed_at:Y,duration_ms:Z,rows_input:ee,rows_output:se,total_cost:te,total_tokens_in:ae,total_tokens_out:le,llm_calls_count:ie,cache_hits:ne=0,cache_misses:ce=0,error_message:re}=T,oe=ne+ce,de=oe>0?ne/oe*100:0,he=(ue=de)>=80?"cache-high":ue>=50?"cache-mid":"cache-low";var ue;const me="completed"===V?"status-completed":"running"===V?"status-running":"status-error",xe=(null===i||void 0===i?void 0:i.calls)||[],pe=xe.length>0;return(0,y.jsxs)("div",{className:"query-detail",children:[(0,y.jsxs)("div",{className:"detail-header",children:[(0,y.jsxs)("button",{className:"btn btn-ghost btn-sm detail-back-btn",onClick:t,children:[(0,y.jsx)(l.In,{icon:"mdi:arrow-left",width:16}),(0,y.jsx)("span",{children:"Back"})]}),(0,y.jsx)("span",{className:"detail-title",children:"Query:"}),(0,y.jsx)("code",{className:"detail-caller-id",children:U}),(0,y.jsx)("span",{className:"status-badge ".concat(me),children:V})]}),(0,y.jsxs)("div",{className:"detail-stats",children:[(0,y.jsxs)("div",{className:"detail-stat",children:[(0,y.jsx)("div",{className:"detail-stat-label",children:"Total Cost"}),(0,y.jsx)("div",{className:"detail-stat-value accent-green",children:O(te)})]}),(0,y.jsxs)("div",{className:"detail-stat",children:[(0,y.jsx)("div",{className:"detail-stat-label",children:"LLM Calls"}),(0,y.jsx)("div",{className:"detail-stat-value accent-purple",children:R(ie)})]}),(0,y.jsxs)("div",{className:"detail-stat",children:[(0,y.jsx)("div",{className:"detail-stat-label",children:"Duration"}),(0,y.jsx)("div",{className:"detail-stat-value accent-blue",children:(ve=Z,null===ve||void 0===ve?"-":ve<1e3?"".concat(Math.round(ve),"ms"):ve<6e4?"".concat((ve/1e3).toFixed(1),"s"):"".concat((ve/6e4).toFixed(1),"m"))})]}),(0,y.jsxs)("div",{className:"detail-stat",children:[(0,y.jsx)("div",{className:"detail-stat-label",children:"Cache Hit Rate"}),(0,y.jsxs)("div",{className:"detail-stat-value ".concat(he),children:[de.toFixed(1),"%"]})]}),(0,y.jsxs)("div",{className:"detail-stat",children:[(0,y.jsx)("div",{className:"detail-stat-label",children:"Rows In / Out"}),(0,y.jsxs)("div",{className:"detail-stat-value",children:[R(ee)," / ",R(se)]})]}),(0,y.jsxs)("div",{className:"detail-stat",children:[(0,y.jsx)("div",{className:"detail-stat-label",children:"Tokens In / Out"}),(0,y.jsxs)("div",{className:"detail-stat-value",children:[R(ae)," / ",R(le)]})]})]}),(0,y.jsxs)("div",{className:"detail-grid",children:[(0,y.jsxs)("div",{className:"detail-sql-card",children:[(0,y.jsxs)("div",{className:"detail-sql-header",children:[(0,y.jsxs)("h4",{children:[(0,y.jsx)(l.In,{icon:"mdi:code-braces",width:16}),"SQL Query",pe&&(0,y.jsxs)("span",{className:"detail-semantic-badge",children:[(0,y.jsx)(l.In,{icon:"mdi:brain",width:12}),xe.length," semantic"]})]}),(0,y.jsxs)("div",{className:"detail-tags",children:[x&&(0,y.jsxs)("span",{className:"detail-tag detail-tag--loading",children:[(0,y.jsx)(l.In,{icon:"mdi:loading",width:12,className:"spin"}),"inspecting..."]}),W.map(e=>(0,y.jsx)("span",{className:"detail-tag",children:e},e))]})]}),(0,y.jsx)("div",{className:"detail-sql-content detail-sql-content--semantic",children:(0,y.jsx)(J,{sql:E||"",calls:xe,showLineNumbers:!0,onSpanHover:k,onSpanClick:e=>q(e,F,D),hoveredSpanIndex:f,highlightedFunction:_})}),v&&(0,y.jsxs)("div",{className:"detail-sql-footer detail-sql-footer--error",children:[(0,y.jsx)(l.In,{icon:"mdi:alert-circle",width:12}),"Inspection failed: ",v]})]}),(0,y.jsxs)("div",{className:"detail-sql-card detail-metrics-card",children:[(0,y.jsx)("div",{className:"detail-sql-header",children:(0,y.jsxs)("h4",{children:[(0,y.jsx)(l.In,{icon:"mdi:chart-box",width:16}),N?"Span Metrics":"Semantic Breakdown"]})}),N?(0,y.jsx)(K,{hoveredCall:N,spawnedSessions:F,cascadeExecutions:D}):(0,y.jsx)(H,{semanticCalls:xe,spawnedSessions:F,cascadeExecutions:D,onFunctionHover:C,onFunctionClick:S,highlightedFunction:_})]})]}),z&&z!==E&&(0,y.jsxs)("div",{className:"detail-sql-card",children:[(0,y.jsxs)("div",{className:"detail-sql-header",children:[(0,y.jsxs)("h4",{children:[(0,y.jsx)(l.In,{icon:"mdi:fingerprint",width:16}),"Fingerprint Template"]}),(0,y.jsx)("code",{className:"detail-fingerprint",children:Q})]}),(0,y.jsx)("div",{className:"detail-sql-content detail-sql-content--semantic",children:(0,y.jsx)(J,{sql:z||"",calls:[],showLineNumbers:!0})})]}),P&&P.length>0&&(0,y.jsxs)("div",{className:"detail-sql-card",children:[(0,y.jsx)("div",{className:"detail-sql-header",children:(0,y.jsx)("h4",{children:"Cost by Model"})}),(0,y.jsxs)("div",{className:"detail-models",children:[(0,y.jsx)("div",{className:"detail-models-chart",children:(0,y.jsx)(n.u,{width:"100%",height:180,children:(0,y.jsxs)(c.E,{data:P,layout:"vertical",margin:{top:4,right:16,left:12,bottom:0},children:[(0,y.jsx)("defs",{children:(0,y.jsxs)("linearGradient",{id:"sqlTrailModelGradient",x1:"0",y1:"0",x2:"1",y2:"0",children:[(0,y.jsx)("stop",{offset:"0%",stopColor:"var(--color-accent-purple)",stopOpacity:.9}),(0,y.jsx)("stop",{offset:"100%",stopColor:"var(--color-accent-cyan)",stopOpacity:.9})]})}),(0,y.jsx)(r.d,{strokeDasharray:"3 3",stroke:"var(--color-border-dim)",horizontal:!1}),(0,y.jsx)(o.W,{type:"number",tick:{fill:"var(--color-text-dim)",fontSize:10},axisLine:!1,tickLine:!1,tickFormatter:e=>O(e)}),(0,y.jsx)(d.h,{type:"category",dataKey:"model",width:90,tick:{fill:"var(--color-text-muted)",fontSize:11},axisLine:!1,tickLine:!1}),(0,y.jsx)(h.m,{content:(0,y.jsx)(B,{})}),(0,y.jsx)(u.y,{dataKey:"cost",fill:"url(#sqlTrailModelGradient)",radius:[0,6,6,0]})]})})}),(0,y.jsx)("div",{className:"detail-models-list",children:P.map((e,s)=>(0,y.jsxs)("div",{className:"detail-model-row",children:[(0,y.jsx)("span",{className:"detail-model-color",style:{background:M[s%M.length]}}),(0,y.jsx)("span",{className:"detail-model-name",children:e.model}),(0,y.jsx)("span",{className:"detail-model-cost",children:O(e.cost)}),(0,y.jsxs)("span",{className:"detail-model-calls",children:["(",R(e.calls||0)," calls)"]})]},e.model))})]})]}),re&&(0,y.jsxs)("div",{className:"detail-sql-card detail-error-card",children:[(0,y.jsx)("div",{className:"detail-sql-header detail-error-header",children:(0,y.jsxs)("h4",{children:[(0,y.jsx)(l.In,{icon:"mdi:alert-circle",width:16}),"Error"]})}),(0,y.jsx)("div",{className:"detail-sql-content detail-error-content",children:re})]}),T.has_materialized_result&&(0,y.jsx)("div",{className:"detail-sql-card detail-results-card",children:(0,y.jsx)($,{callerId:U,resultLocation:{db_name:T.result_db_name,db_path:T.result_db_path,schema:T.result_schema,table:T.result_table}})}),(0,y.jsxs)("div",{className:"detail-sessions",children:[(0,y.jsxs)("div",{className:"detail-sessions-header",children:[(0,y.jsx)("h4",{children:"Spawned LLM Sessions"}),(0,y.jsxs)("span",{className:"detail-sessions-count",children:[F.length," sessions"]})]}),F.length>0?(0,y.jsxs)("table",{className:"query-table",children:[(0,y.jsx)("thead",{children:(0,y.jsxs)("tr",{children:[(0,y.jsx)("th",{children:"Session ID"}),(0,y.jsx)("th",{children:"Cascade"}),(0,y.jsx)("th",{children:"Cost"}),(0,y.jsx)("th",{children:"Tokens In/Out"}),(0,y.jsx)("th",{children:"Time"})]})}),(0,y.jsx)("tbody",{children:F.slice(0,50).map(e=>{var s;return(0,y.jsxs)("tr",{children:[(0,y.jsx)("td",{children:(0,y.jsxs)("code",{className:"detail-session-id",children:[null===(s=e.session_id)||void 0===s?void 0:s.substring(0,16),"..."]})}),(0,y.jsx)("td",{className:"detail-session-cascade",children:e.cascade_id||"-"}),(0,y.jsx)("td",{className:"detail-session-cost",children:O(e.total_cost)}),(0,y.jsxs)("td",{children:[R(e.total_tokens_in)," / ",R(e.total_tokens_out)]}),(0,y.jsx)("td",{className:"detail-session-time",children:A(e.timestamp)})]},e.session_id)})})]}):(0,y.jsx)("div",{className:"detail-sessions-empty",children:"No session data available"}),F.length>50&&(0,y.jsxs)("div",{className:"detail-sessions-footer",children:["Showing 50 of ",F.length," sessions"]})]}),(0,y.jsxs)("div",{className:"detail-meta",children:[(0,y.jsxs)("span",{children:["Started: ",A(X)]}),Y&&(0,y.jsxs)("span",{children:["Completed: ",A(Y)]}),G&&(0,y.jsxs)("span",{children:["Type: ",G]})]})]});var ve};var Y=t(89379);const Z=e=>null===e||void 0===e?"$0.00":"$".concat(e>=1?e.toFixed(2):e>=.01?e.toFixed(3):e.toFixed(4)),ee=e=>null===e||void 0===e?"-":e<1e3?"".concat(Math.round(e),"ms"):e<6e4?"".concat((e/1e3).toFixed(1),"s"):"".concat((e/6e4).toFixed(1),"m"),se=e=>{if(!e)return"-";const s=new Date(e);return Number.isNaN(s.getTime())?e:s.toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},te=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:120;if(!e)return"-";const t=e.replace(/\s+/g," ").trim();return t.length<=s?t:t.substring(0,s)+"..."},ae=e=>"completed"===e?"status-completed":"running"===e?"status-running":"error"===e?"status-error":"",le=e=>{let{patterns:s=[],onPatternClick:t,onQuerySelect:i}=e;const[n,c]=(0,a.useState)("count"),[r,o]=(0,a.useState)(!0),[d,h]=(0,a.useState)(null),[u,m]=(0,a.useState)({}),[x,p]=(0,a.useState)({}),v=(0,a.useMemo)(()=>{const e=[...s];return e.sort((e,s)=>{let t,a;switch(n){case"cost":t=e.total_cost||0,a=s.total_cost||0;break;case"avg_cost":t=e.avg_cost||0,a=s.avg_cost||0;break;case"cache_rate":t=e.cache_hit_rate||0,a=s.cache_hit_rate||0;break;case"duration":t=e.avg_duration_ms||0,a=s.avg_duration_ms||0;break;default:t=e.query_count||0,a=s.query_count||0}return r?a-t:t-a}),e},[s,n,r]),j=e=>{n===e?o(!r):(c(e),o(!0))};(0,a.useEffect)(()=>{if(!d)return;if(u[d])return;if(x[d])return;(async()=>{p(e=>(0,Y.A)((0,Y.A)({},e),{},{[d]:!0}));try{const e=new URLSearchParams({fingerprint:d,limit:20}),s=await fetch("".concat(L.J,"/api/sql-trail/queries?").concat(e)),t=await s.json();t.error||m(e=>(0,Y.A)((0,Y.A)({},e),{},{[d]:t.queries||[]}))}catch(e){console.error("Failed to fetch pattern executions:",e)}finally{p(e=>(0,Y.A)((0,Y.A)({},e),{},{[d]:!1}))}})()},[d,u,x]);const f=e=>{let{field:s}=e;return n!==s?null:(0,y.jsx)(l.In,{icon:r?"mdi:arrow-down":"mdi:arrow-up",width:12})};return 0===s.length?(0,y.jsxs)("div",{className:"empty-state",children:[(0,y.jsx)(l.In,{icon:"mdi:fingerprint",width:48,className:"empty-state-icon"}),(0,y.jsx)("div",{className:"empty-state-title",children:"No patterns found"}),(0,y.jsx)("div",{className:"empty-state-text",children:"Query patterns are detected by normalizing SQL and grouping by fingerprint. Execute some queries to see patterns here."})]}):(0,y.jsxs)("div",{className:"patterns-panel",children:[(0,y.jsxs)("div",{className:"patterns-info",children:[(0,y.jsx)(l.In,{icon:"mdi:information-outline",width:14,className:"patterns-info-icon"}),(0,y.jsx)("span",{children:"Patterns group similar SQL queries by normalizing literals. Low cache rates may indicate optimization opportunities."})]}),(0,y.jsxs)("table",{className:"patterns-table",children:[(0,y.jsx)("thead",{children:(0,y.jsxs)("tr",{children:[(0,y.jsx)("th",{style:{width:"40px"}}),(0,y.jsx)("th",{children:"Pattern Template"}),(0,y.jsxs)("th",{className:"sortable ".concat("count"===n?"sorted":""),onClick:()=>j("count"),style:{width:"80px"},children:["Count ",(0,y.jsx)(f,{field:"count"})]}),(0,y.jsxs)("th",{className:"sortable ".concat("cost"===n?"sorted":""),onClick:()=>j("cost"),style:{width:"100px"},children:["Total Cost ",(0,y.jsx)(f,{field:"cost"})]}),(0,y.jsxs)("th",{className:"sortable ".concat("avg_cost"===n?"sorted":""),onClick:()=>j("avg_cost"),style:{width:"100px"},children:["Avg Cost ",(0,y.jsx)(f,{field:"avg_cost"})]}),(0,y.jsxs)("th",{className:"sortable ".concat("cache_rate"===n?"sorted":""),onClick:()=>j("cache_rate"),style:{width:"120px"},children:["Cache Rate ",(0,y.jsx)(f,{field:"cache_rate"})]}),(0,y.jsxs)("th",{className:"sortable ".concat("duration"===n?"sorted":""),onClick:()=>j("duration"),style:{width:"100px"},children:["Avg Duration ",(0,y.jsx)(f,{field:"duration"})]})]})}),(0,y.jsx)("tbody",{children:v.map(e=>{var s,t;const n=e.cache_hit_rate||0,c=(r=n)>=80?"cache-high":r>=50?"cache-mid":"cache-low";var r;const o=n<50&&e.query_count>1,m=d===e.fingerprint;return(0,y.jsxs)(a.Fragment,{children:[(0,y.jsxs)("tr",{onClick:()=>h(m?null:e.fingerprint),className:"pattern-row",children:[(0,y.jsx)("td",{children:(0,y.jsx)(l.In,{icon:m?"mdi:chevron-down":"mdi:chevron-right",width:16,className:"pattern-chevron"})}),(0,y.jsxs)("td",{children:[(0,y.jsx)("div",{className:"pattern-template",title:e.query_template,children:te(e.query_template)}),e.udf_types&&e.udf_types.length>0&&(0,y.jsx)("div",{className:"pattern-tags",children:e.udf_types.map(e=>(0,y.jsx)("span",{className:"pattern-tag",children:e},e))})]}),(0,y.jsx)("td",{className:"pattern-count",children:e.query_count}),(0,y.jsx)("td",{className:"cell-cost",children:Z(e.total_cost)}),(0,y.jsx)("td",{className:"cell-avg",children:Z(e.avg_cost)}),(0,y.jsx)("td",{children:(0,y.jsxs)("div",{className:"cache-rate",children:[(0,y.jsx)("div",{className:"cache-bar-track",children:(0,y.jsx)("div",{style:{width:"".concat(n,"%")},className:"cache-bar-fill ".concat(c)})}),(0,y.jsxs)("span",{className:"cache-rate-text ".concat(c),children:[n.toFixed(0),"%"]}),o&&(0,y.jsx)(l.In,{icon:"mdi:alert",width:14,className:"cache-rate-warning",title:"Low cache hit rate"})]})}),(0,y.jsx)("td",{children:ee(e.avg_duration_ms)})]}),m&&(0,y.jsx)("tr",{children:(0,y.jsx)("td",{colSpan:7,className:"pattern-details-cell",children:(0,y.jsxs)("div",{className:"pattern-details",children:[(0,y.jsxs)("div",{className:"pattern-details-block",children:[(0,y.jsx)("div",{className:"pattern-details-label",children:"Full Template"}),(0,y.jsx)("pre",{className:"pattern-details-pre",children:e.query_template})]}),(0,y.jsxs)("div",{className:"pattern-details-meta",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("span",{children:"Fingerprint:"}),(0,y.jsx)("code",{children:e.fingerprint})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("span",{children:"Total LLM Calls:"}),e.total_llm_calls||0]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("span",{children:"Cache Hits:"}),e.total_cache_hits||0]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("span",{children:"Cache Misses:"}),e.total_cache_misses||0]})]}),(0,y.jsxs)("div",{className:"pattern-executions",children:[(0,y.jsxs)("div",{className:"pattern-executions-header",children:[(0,y.jsx)(l.In,{icon:"mdi:history",width:14}),(0,y.jsxs)("span",{children:["Recent Executions (",(null===(s=u[e.fingerprint])||void 0===s?void 0:s.length)||0,")"]})]}),x[e.fingerprint]?(0,y.jsxs)("div",{className:"pattern-executions-loading",children:[(0,y.jsx)(l.In,{icon:"mdi:loading",width:16,className:"spin"}),(0,y.jsx)("span",{children:"Loading executions..."})]}):0===((null===(t=u[e.fingerprint])||void 0===t?void 0:t.length)||0)?(0,y.jsx)("div",{className:"pattern-executions-empty",children:"No executions found for this pattern"}):(0,y.jsx)("div",{className:"pattern-executions-grid",children:u[e.fingerprint].map(e=>(0,y.jsxs)("div",{className:"pattern-execution-card ".concat(ae(e.status)),onClick:s=>{s.stopPropagation(),i&&i(e)},title:"Click to view query details",children:[(0,y.jsxs)("div",{className:"execution-card-header",children:[(0,y.jsx)("span",{className:"execution-status ".concat(ae(e.status)),children:e.status}),(0,y.jsx)("span",{className:"execution-time",children:se(e.started_at)})]}),(0,y.jsxs)("div",{className:"execution-card-stats",children:[(0,y.jsxs)("div",{className:"execution-stat",children:[(0,y.jsx)(l.In,{icon:"mdi:currency-usd",width:12}),(0,y.jsx)("span",{children:Z(e.total_cost)})]}),(0,y.jsxs)("div",{className:"execution-stat",children:[(0,y.jsx)(l.In,{icon:"mdi:timer-outline",width:12}),(0,y.jsx)("span",{children:ee(e.duration_ms)})]}),e.llm_calls_count>0&&(0,y.jsxs)("div",{className:"execution-stat",children:[(0,y.jsx)(l.In,{icon:"mdi:robot",width:12}),(0,y.jsxs)("span",{children:[e.llm_calls_count," calls"]})]})]}),(0,y.jsxs)("div",{className:"execution-card-id",children:[(0,y.jsxs)("code",{children:[e.caller_id.substring(0,16),"..."]}),(0,y.jsx)(l.In,{icon:"mdi:arrow-right",width:12})]})]},e.caller_id))})]})]})})})]},e.fingerprint)})})]})]})},ie=(e,s)=>e===s||!(!e||!s)&&JSON.stringify(e)===JSON.stringify(s),ne=()=>{const{callerId:e}=(0,i.g)(),[s,t]=(0,a.useState)(e?"detail":"overview"),[n,c]=(0,a.useState)(()=>{const e=localStorage.getItem("sqlTrail_timeRange");return e?parseInt(e,10):7}),[r,o]=(0,a.useState)(()=>{const e=localStorage.getItem("sqlTrail_granularity");return e&&["minute","hourly","daily","weekly","monthly"].includes(e)?e:"daily"}),[d,h]=(0,a.useState)(!0),[u,m]=(0,a.useState)(null),[x,p]=(0,a.useState)(null),[v,j]=(0,a.useState)({queries:[],total:0}),[f,g]=(0,a.useState)([]),[N,w]=(0,a.useState)({patterns:[]}),[_,b]=(0,a.useState)(null),[C,S]=(0,a.useState)({series:[]}),[q,T]=(0,a.useState)(null),[E,F]=(0,a.useState)(null),[O,R]=(0,a.useState)(null),A=(0,a.useRef)(!0),M=(0,a.useCallback)(async()=>{try{const e=new URLSearchParams({days:n});E&&e.append("query_type",E),O&&e.append("udf_type",O);const s=await fetch("".concat(L.J,"/api/sql-trail/overview?").concat(e)),t=await s.json();if(t.error)return void m(t.error);p(e=>ie(e,t)?e:t)}catch(e){console.error("Failed to fetch overview:",e)}},[n,E,O]),D=(0,a.useCallback)(async()=>{try{const e=new URLSearchParams({days:n,limit:100});E&&e.append("query_type",E),O&&e.append("udf_type",O);const s=await fetch("".concat(L.J,"/api/sql-trail/queries?").concat(e)),t=await s.json();if(t.error)return void m(t.error);j(e=>ie(e,t)?e:t)}catch(e){console.error("Failed to fetch queries:",e)}},[n,E,O]),P=(0,a.useCallback)(async()=>{try{const e=new URLSearchParams({days:n,status:"running",limit:50});E&&e.append("query_type",E),O&&e.append("udf_type",O);const s=await fetch("".concat(L.J,"/api/sql-trail/queries?").concat(e)),t=await s.json();if(t.error)return;g(e=>ie(e,t.queries)?e:t.queries||[])}catch(e){console.error("Failed to fetch running queries:",e)}},[n,E,O]),U=(0,a.useCallback)(async()=>{try{const e=new URLSearchParams({days:n});E&&e.append("query_type",E),O&&e.append("udf_type",O);const s=await fetch("".concat(L.J,"/api/sql-trail/patterns?").concat(e)),t=await s.json();if(t.error)return void m(t.error);w(e=>ie(e,t)?e:t)}catch(e){console.error("Failed to fetch patterns:",e)}},[n,E,O]),z=(0,a.useCallback)(async()=>{try{const e=new URLSearchParams({days:n});E&&e.append("query_type",E),O&&e.append("udf_type",O);const s=await fetch("".concat(L.J,"/api/sql-trail/cache-stats?").concat(e)),t=await s.json();if(t.error)return;b(e=>ie(e,t)?e:t)}catch(e){console.error("Failed to fetch cache stats:",e)}},[n,E,O]),Q=(0,a.useCallback)(async()=>{try{const e=new URLSearchParams({days:n,granularity:r});E&&e.append("query_type",E),O&&e.append("udf_type",O);const s=await fetch("".concat(L.J,"/api/sql-trail/time-series?").concat(e)),t=await s.json();if(t.error)return;S(e=>ie(e,t)?e:t)}catch(e){console.error("Failed to fetch time series:",e)}},[n,r,E,O]),G=(0,a.useCallback)(async e=>{try{const s=await fetch("".concat(L.J,"/api/sql-trail/query/").concat(encodeURIComponent(e))),t=await s.json();if(t.error)return void m(t.error);T(t)}catch(s){console.error("Failed to fetch query detail:",s)}},[]);(0,a.useEffect)(()=>{A.current&&h(!0),m(null),Promise.all([M(),D(),P(),U(),z(),Q()]).finally(()=>{h(!1),A.current=!1})},[n,r,M,D,P,U,z,Q]),(0,a.useEffect)(()=>{e&&(t("detail"),G(e))},[e,G]),(0,a.useEffect)(()=>{const e=setInterval(()=>{M(),D(),P(),z(),Q()},3e4);return()=>clearInterval(e)},[M,D,P,z,Q]),(0,a.useEffect)(()=>{const e=setInterval(()=>{P()},5e3);return()=>clearInterval(e)},[P]),(0,a.useEffect)(()=>{localStorage.setItem("sqlTrail_timeRange",n.toString())},[n]),(0,a.useEffect)(()=>{localStorage.setItem("sqlTrail_granularity",r)},[r]);const W=e=>{e&&e.caller_id&&(G(e.caller_id),t("detail"))};return(0,y.jsxs)("div",{className:"sql-trail-view",children:[(0,y.jsxs)("div",{className:"sql-trail-header",children:[(0,y.jsxs)("div",{className:"sql-trail-header-left",children:[(0,y.jsx)(l.In,{icon:"mdi:database-search",width:20,className:"sql-trail-header-icon"}),(0,y.jsx)("h1",{children:"SQL Trail"}),(0,y.jsx)("span",{className:"sql-trail-subtitle",children:"Query-level analytics"})]}),(0,y.jsx)("div",{className:"sql-trail-header-right",children:(0,y.jsxs)("select",{value:n,onChange:e=>c(parseInt(e.target.value,10)),className:"sql-trail-time-select",children:[(0,y.jsx)("option",{value:1,children:"Last 24 Hours"}),(0,y.jsx)("option",{value:7,children:"Last 7 Days"}),(0,y.jsx)("option",{value:30,children:"Last 30 Days"}),(0,y.jsx)("option",{value:90,children:"Last 90 Days"})]})})]}),(0,y.jsxs)("div",{className:"sql-trail-tabs",children:[(0,y.jsxs)("button",{className:"sql-trail-tab ".concat("overview"===s?"active":""),onClick:()=>t("overview"),children:[(0,y.jsx)(l.In,{icon:"mdi:view-dashboard",width:14}),(0,y.jsx)("span",{children:"Overview"})]}),(0,y.jsxs)("button",{className:"sql-trail-tab ".concat("explorer"===s?"active":""),onClick:()=>t("explorer"),children:[(0,y.jsx)(l.In,{icon:"mdi:format-list-bulleted",width:14}),(0,y.jsx)("span",{children:"Query Explorer"}),v.total>0&&(0,y.jsx)("span",{className:"sql-trail-tab-badge",children:v.total})]}),q&&(0,y.jsxs)("button",{className:"sql-trail-tab ".concat("detail"===s?"active":""),onClick:()=>t("detail"),children:[(0,y.jsx)(l.In,{icon:"mdi:file-document-outline",width:14}),(0,y.jsx)("span",{children:"Query Detail"})]}),(0,y.jsxs)("button",{className:"sql-trail-tab ".concat("patterns"===s?"active":""),onClick:()=>t("patterns"),children:[(0,y.jsx)(l.In,{icon:"mdi:fingerprint",width:14}),(0,y.jsx)("span",{children:"Patterns"})]}),(0,y.jsxs)("div",{className:"sql-trail-filters-inline",children:[E&&(0,y.jsxs)("button",{className:"sql-trail-filter-chip",onClick:()=>F(null),title:"Click to remove filter",children:[(0,y.jsxs)("span",{children:["Type: ",E]}),(0,y.jsx)(l.In,{icon:"mdi:close",width:12})]}),O&&(0,y.jsxs)("button",{className:"sql-trail-filter-chip",onClick:()=>R(null),title:"Click to remove filter",children:[(0,y.jsxs)("span",{children:["UDF: ",O]}),(0,y.jsx)(l.In,{icon:"mdi:close",width:12})]}),(E||O)&&(0,y.jsx)("button",{className:"sql-trail-clear-filters",onClick:()=>{F(null),R(null)},children:"Clear"})]})]}),(0,y.jsxs)("div",{className:"sql-trail-content",children:[d&&(0,y.jsxs)("div",{className:"sql-trail-loading",children:[(0,y.jsx)(l.In,{icon:"mdi:loading",width:24,className:"spin"}),(0,y.jsx)("span",{children:"Loading SQL Trail data..."})]}),u&&(0,y.jsxs)("div",{className:"sql-trail-error",children:[(0,y.jsx)(l.In,{icon:"mdi:alert-circle",width:20}),(0,y.jsx)("span",{children:u})]}),!d&&!u&&(0,y.jsxs)(y.Fragment,{children:["overview"===s&&(0,y.jsx)(k,{data:x,cacheStats:_,queryTypeFilter:E,udfTypeFilter:O,onQueryTypeFilter:e=>{F(s=>s===e?null:e)},onUdfTypeFilter:e=>{R(s=>s===e?null:e)},timeSeries:C,runningQueries:f,granularity:r,onGranularityChange:o,onQueryClick:W}),"explorer"===s&&(0,y.jsx)(I,{queries:v.queries,total:v.total,onQuerySelect:W}),"detail"===s&&q&&(0,y.jsx)(X,{data:q,onBack:()=>{T(null),t("explorer")}}),"patterns"===s&&(0,y.jsx)(le,{patterns:N.patterns,onPatternClick:e=>{console.log("Pattern clicked:",e)},onQuerySelect:W})]})]})]})}},82291:(e,s,t)=>{t.d(s,{E:()=>r});var a=t(93014),l=t(38643),i=t(52185),n=t(6026),c=t(3831),r=(0,a.gu)({chartName:"BarChart",GraphicalChild:l.y,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:i.W},{axisType:"yAxis",AxisComp:n.h}],formatAxisMap:c.pr})},87734:(e,s,t)=>{t.d(s,{d:()=>T});var a=t(65043),l=t(11629),i=t.n(l),n=t(155),c=t(76307),r=t(240),o=t(71845),d=t(98854),h=t(57671),u=t(52103),m=["x1","y1","x2","y2","key"],x=["offset"];function p(e){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p(e)}function v(e,s){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);s&&(a=a.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),t.push.apply(t,a)}return t}function j(e){for(var s=1;s<arguments.length;s++){var t=null!=arguments[s]?arguments[s]:{};s%2?v(Object(t),!0).forEach(function(s){y(e,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):v(Object(t)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(t,s))})}return e}function y(e,s,t){return(s=function(e){var s=function(e,s){if("object"!=p(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var a=t.call(e,s||"default");if("object"!=p(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===s?String:Number)(e)}(e,"string");return"symbol"==p(s)?s:s+""}(s))in e?Object.defineProperty(e,s,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[s]=t,e}function f(){return f=Object.assign?Object.assign.bind():function(e){for(var s=1;s<arguments.length;s++){var t=arguments[s];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},f.apply(this,arguments)}function g(e,s){if(null==e)return{};var t,a,l=function(e,s){if(null==e)return{};var t={};for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){if(s.indexOf(a)>=0)continue;t[a]=e[a]}return t}(e,s);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],s.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(l[t]=e[t])}return l}var N=function(e){var s=e.fill;if(!s||"none"===s)return null;var t=e.fillOpacity,l=e.x,i=e.y,n=e.width,c=e.height,r=e.ry;return a.createElement("rect",{x:l,y:i,ry:r,width:n,height:c,stroke:"none",fill:s,fillOpacity:t,className:"recharts-cartesian-grid-bg"})};function w(e,s){var t;if(a.isValidElement(e))t=a.cloneElement(e,s);else if(i()(e))t=e(s);else{var l=s.x1,n=s.y1,c=s.x2,o=s.y2,d=s.key,h=g(s,m),u=(0,r.J9)(h,!1),p=(u.offset,g(u,x));t=a.createElement("line",f({},p,{x1:l,y1:n,x2:c,y2:o,fill:"none",key:d}))}return t}function _(e){var s=e.x,t=e.width,l=e.horizontal,i=void 0===l||l,n=e.horizontalPoints;if(!i||!n||!n.length)return null;var c=n.map(function(a,l){var n=j(j({},e),{},{x1:s,y1:a,x2:s+t,y2:a,key:"line-".concat(l),index:l});return w(i,n)});return a.createElement("g",{className:"recharts-cartesian-grid-horizontal"},c)}function b(e){var s=e.y,t=e.height,l=e.vertical,i=void 0===l||l,n=e.verticalPoints;if(!i||!n||!n.length)return null;var c=n.map(function(a,l){var n=j(j({},e),{},{x1:a,y1:s,x2:a,y2:s+t,key:"line-".concat(l),index:l});return w(i,n)});return a.createElement("g",{className:"recharts-cartesian-grid-vertical"},c)}function k(e){var s=e.horizontalFill,t=e.fillOpacity,l=e.x,i=e.y,n=e.width,c=e.height,r=e.horizontalPoints,o=e.horizontal;if(!(void 0===o||o)||!s||!s.length)return null;var d=r.map(function(e){return Math.round(e+i-i)}).sort(function(e,s){return e-s});i!==d[0]&&d.unshift(0);var h=d.map(function(e,r){var o=!d[r+1]?i+c-e:d[r+1]-e;if(o<=0)return null;var h=r%s.length;return a.createElement("rect",{key:"react-".concat(r),y:e,x:l,height:o,width:n,stroke:"none",fill:s[h],fillOpacity:t,className:"recharts-cartesian-grid-bg"})});return a.createElement("g",{className:"recharts-cartesian-gridstripes-horizontal"},h)}function C(e){var s=e.vertical,t=void 0===s||s,l=e.verticalFill,i=e.fillOpacity,n=e.x,c=e.y,r=e.width,o=e.height,d=e.verticalPoints;if(!t||!l||!l.length)return null;var h=d.map(function(e){return Math.round(e+n-n)}).sort(function(e,s){return e-s});n!==h[0]&&h.unshift(0);var u=h.map(function(e,s){var t=!h[s+1]?n+r-e:h[s+1]-e;if(t<=0)return null;var d=s%l.length;return a.createElement("rect",{key:"react-".concat(s),x:e,y:c,width:t,height:o,stroke:"none",fill:l[d],fillOpacity:i,className:"recharts-cartesian-grid-bg"})});return a.createElement("g",{className:"recharts-cartesian-gridstripes-vertical"},u)}var S=function(e,s){var t=e.xAxis,a=e.width,l=e.height,i=e.offset;return(0,o.PW)((0,d.f)(j(j(j({},h.u.defaultProps),t),{},{ticks:(0,o.Rh)(t,!0),viewBox:{x:0,y:0,width:a,height:l}})),i.left,i.left+i.width,s)},q=function(e,s){var t=e.yAxis,a=e.width,l=e.height,i=e.offset;return(0,o.PW)((0,d.f)(j(j(j({},h.u.defaultProps),t),{},{ticks:(0,o.Rh)(t,!0),viewBox:{x:0,y:0,width:a,height:l}})),i.top,i.top+i.height,s)},I={horizontal:!0,vertical:!0,horizontalPoints:[],verticalPoints:[],stroke:"#ccc",fill:"none",verticalFill:[],horizontalFill:[]};function T(e){var s,t,l,r,o,d,h=(0,u.yi)(),m=(0,u.rY)(),x=(0,u.hj)(),v=j(j({},e),{},{stroke:null!==(s=e.stroke)&&void 0!==s?s:I.stroke,fill:null!==(t=e.fill)&&void 0!==t?t:I.fill,horizontal:null!==(l=e.horizontal)&&void 0!==l?l:I.horizontal,horizontalFill:null!==(r=e.horizontalFill)&&void 0!==r?r:I.horizontalFill,vertical:null!==(o=e.vertical)&&void 0!==o?o:I.vertical,verticalFill:null!==(d=e.verticalFill)&&void 0!==d?d:I.verticalFill,x:(0,c.Et)(e.x)?e.x:x.left,y:(0,c.Et)(e.y)?e.y:x.top,width:(0,c.Et)(e.width)?e.width:x.width,height:(0,c.Et)(e.height)?e.height:x.height}),y=v.x,g=v.y,w=v.width,T=v.height,E=v.syncWithTicks,L=v.horizontalValues,F=v.verticalValues,O=(0,u.pj)(),R=(0,u.$G)();if(!(0,c.Et)(w)||w<=0||!(0,c.Et)(T)||T<=0||!(0,c.Et)(y)||y!==+y||!(0,c.Et)(g)||g!==+g)return null;var A=v.verticalCoordinatesGenerator||S,M=v.horizontalCoordinatesGenerator||q,D=v.horizontalPoints,P=v.verticalPoints;if((!D||!D.length)&&i()(M)){var U=L&&L.length,z=M({yAxis:R?j(j({},R),{},{ticks:U?L:R.ticks}):void 0,width:h,height:m,offset:x},!!U||E);(0,n.R)(Array.isArray(z),"horizontalCoordinatesGenerator should return Array but instead it returned [".concat(p(z),"]")),Array.isArray(z)&&(D=z)}if((!P||!P.length)&&i()(A)){var Q=F&&F.length,G=A({xAxis:O?j(j({},O),{},{ticks:Q?F:O.ticks}):void 0,width:h,height:m,offset:x},!!Q||E);(0,n.R)(Array.isArray(G),"verticalCoordinatesGenerator should return Array but instead it returned [".concat(p(G),"]")),Array.isArray(G)&&(P=G)}return a.createElement("g",{className:"recharts-cartesian-grid"},a.createElement(N,{fill:v.fill,fillOpacity:v.fillOpacity,x:v.x,y:v.y,width:v.width,height:v.height,ry:v.ry}),a.createElement(_,f({},v,{offset:x,horizontalPoints:D,xAxis:O,yAxis:R})),a.createElement(b,f({},v,{offset:x,verticalPoints:P,xAxis:O,yAxis:R})),a.createElement(k,f({},v,{horizontalPoints:D})),a.createElement(C,f({},v,{verticalPoints:P})))}T.displayName="CartesianGrid"}}]);
//# sourceMappingURL=470.727dc161.chunk.js.map