"use strict";(self.webpackChunklars_ui=self.webpackChunklars_ui||[]).push([[479],{877:(e,t,a)=>{a.d(t,{Q:()=>i});var s=a(93014),n=a(13839),l=a(52185),r=a(6026),o=a(3831),i=(0,s.gu)({chartName:"AreaChart",GraphicalChild:n.G,axisComponents:[{axisType:"xAxis",AxisComp:l.W},{axisType:"yAxis",AxisComp:r.h}],formatAxisMap:o.pr})},26232:(e,t,a)=>{a.d(t,{I:()=>r});var s=a(89379),n=a(65043),l=a(64065);function r(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{enabled:t=!0,pollInterval:a=6e4,lowBalanceThreshold:r=5}=e,[o,i]=(0,n.useState)({balance:null,totalCredits:null,totalUsage:null,burnRate1h:null,burnRate24h:null,burnRate7d:null,runwayDays:null,delta24h:null,lowBalanceWarning:!1,lastUpdated:null,snapshotCount24h:null,loading:!0,error:null}),{showToast:c}=(0,l.dj)(),d=(0,n.useRef)(null),u=(0,n.useRef)(!1),h=(0,n.useRef)(!1),m=(0,n.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{const t=e?"http://localhost:5050/api/credits?refresh=true":"http://localhost:5050/api/credits",a=await fetch(t);if(!a.ok)throw new Error("Failed to fetch credits: ".concat(a.status));return await a.json()}catch(t){throw console.error("[useCredits] Fetch error:",t),t}},[]),p=(0,n.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{i(e=>(0,s.A)((0,s.A)({},e),{},{loading:!0,error:null}));const t=await m(e);if(t.error)return void i(e=>(0,s.A)((0,s.A)({},e),{},{loading:!1,error:t.error}));const a={balance:t.balance,totalCredits:t.total_credits,totalUsage:t.total_usage,burnRate1h:t.burn_rate_1h,burnRate24h:t.burn_rate_24h,burnRate7d:t.burn_rate_7d,runwayDays:t.runway_days,delta24h:t.delta_24h,lowBalanceWarning:t.low_balance_warning||null!==t.balance&&t.balance<r,lastUpdated:t.last_updated,snapshotCount24h:t.snapshot_count_24h,loading:!1,error:null};i(a);const n=a.lowBalanceWarning,l=u.current;!n||l||h.current||null===a.balance||(h.current=!0,c("Low OpenRouter Balance: $".concat(a.balance.toFixed(2),". Consider topping up."),{type:"warning",duration:1e4})),u.current=n}catch(t){i(e=>(0,s.A)((0,s.A)({},e),{},{loading:!1,error:t.message}))}},[m,r,c]);return(0,n.useEffect)(()=>{if(t)return p(),d.current=setInterval(()=>{p()},a),()=>{d.current&&(clearInterval(d.current),d.current=null)};i(e=>(0,s.A)((0,s.A)({},e),{},{loading:!1}))},[t,a,p]),(0,s.A)((0,s.A)({},o),{},{refetch:()=>p(!0)})}},55785:(e,t,a)=>{a.d(t,{A:()=>u});var s=a(65043),n=a(50108),l=a(877),r=a(52185),o=a(6026),i=a(86150),c=a(13839),d=a(70579);const u=function(e){let{cascadeFilter:t=null,cascadeIds:a=[]}=e;const[u,h]=(0,s.useState)(null),[m,p]=(0,s.useState)(!0),[x,k]=(0,s.useState)(null),[j,b]=(0,s.useState)(null),[v,y]=(0,s.useState)(()=>{try{return localStorage.getItem("lars_cost_analytics_granularity")||"day"}catch(e){return"day"}}),g=e=>{y(e);try{localStorage.setItem("lars_cost_analytics_granularity",e)}catch(t){console.error("Failed to save granularity preference:",t)}},f=a.join(",");(0,s.useEffect)(()=>{(async()=>{try{p(!0);const e=new URLSearchParams;a&&a.length>0?e.append("cascade_ids",a.join(",")):t&&e.append("cascade_id",t),e.append("limit","14"),e.append("granularity",v);const s=await fetch("http://localhost:5050/api/analytics/cost-timeline?".concat(e)),n=await s.json();if(n.error)return void k(n.error);h(n),k(null)}catch(e){k(e.message)}finally{p(!1)}})()},[t,f,v]);const N=(0,s.useMemo)(()=>({primary:["#00e5ff","#a78bfa","#ff006e","#34d399","#fbbf24","#60a5fa","#f472b6","#64748b"],gradient:{start:"rgba(0, 229, 255, 0.3)",end:"rgba(0, 229, 255, 0.01)"},tokens:{input:"#00e5ff",output:"#a78bfa"}}),[]),w=e=>{if(!e||"None"===e||"Other"===e)return"Other"===e?"Other":"Unknown";let t=e;t=t.replace(/^(openai|anthropic|google|x-ai)\//,"");const a=[[/claude-(\d+\.?\d*)-sonnet.*/,"Claude $1 Sonnet"],[/claude-sonnet-(\d+\.?\d*).*/,"Claude $1 Sonnet"],[/claude-(\d+\.?\d*)-opus.*/,"Claude $1 Opus"],[/claude-opus-(\d+\.?\d*).*/,"Claude $1 Opus"],[/claude-(\d+\.?\d*)-haiku.*/,"Claude $1 Haiku"],[/claude-haiku-(\d+\.?\d*).*/,"Claude $1 Haiku"],[/gpt-(\d+\.?\d*).*/,"GPT-$1"],[/gemini-(\d+\.?\d*)-pro.*/,"Gemini $1 Pro"],[/gemini-(\d+\.?\d*)-flash-lite.*/,"Gemini $1 Lite"],[/gemini-(\d+\.?\d*)-flash.*/,"Gemini $1 Flash"],[/grok-(\d+).*/,"Grok $1"],[/qwen.*embed.*/,"Qwen Embed"]];for(const[s,n]of a)if(s.test(t)){t=t.replace(s,n);break}return t.length>20&&(t=t.substring(0,18)+"\u2026"),t},_=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return"$".concat(e>=100?e.toFixed(0):e>=10?e.toFixed(1):e>=1?e.toFixed(t):e.toFixed(Math.min(t+2,4)))},A=e=>e>=1e6?"".concat((e/1e6).toFixed(1),"M"):e>=1e3?"".concat((e/1e3).toFixed(0),"K"):e.toString(),C=e=>{if(!u)return e;const t=u.bucket_type;let a;if(e.includes("T"))a=new Date(e);else{const t=e.split("-");a=new Date(t[0],t[1]-1,t[2])}return"hour"===t?a.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}):"day"===t||"week"===t?a.toLocaleDateString("en-US",{month:"short",day:"numeric"}):"month"===t?a.toLocaleDateString("en-US",{month:"short",year:"2-digit"}):e},S=(0,s.useMemo)(()=>{if(!u||!u.buckets)return{chartData:[],modelBreakdown:[],tokenData:[]};const e=Object.entries(u.model_totals||{}).map(e=>{let[t,a]=e;return{model:t,cost:a,displayName:w(t)}}).sort((e,t)=>t.cost-e.cost),t=e.slice(0,7),a=e.slice(7).reduce((e,t)=>e+t.cost,0),s=[...t];a>0&&s.push({model:"Other",cost:a,displayName:"Other"}),s.forEach((e,t)=>{e.color=N.primary[t]||N.primary[7]});return{chartData:u.buckets.map(e=>({time:e.time_bucket,total:e.total_cost,tokens_in:e.tokens_in||0,tokens_out:e.tokens_out||0,models:e.models})),modelBreakdown:s}},[u,N]),D=e=>{let{active:t,payload:a,label:s}=e;if(!t||!a||!a[0])return null;const n=a[0].payload,l=n.models||{},r=Object.entries(l).filter(e=>{let[,t]=e;return t>0}).sort((e,t)=>t[1]-e[1]).slice(0,5);return(0,d.jsxs)("div",{className:"cost-tooltip-v2",children:[(0,d.jsx)("div",{className:"tooltip-header-v2",children:C(s)}),(0,d.jsx)("div",{className:"tooltip-total-v2",children:_(n.total,3)}),r.length>0&&(0,d.jsx)("div",{className:"tooltip-models-v2",children:r.map(e=>{let[t,a]=e;return(0,d.jsxs)("div",{className:"tooltip-model-row",children:[(0,d.jsx)("span",{className:"tooltip-model-name",children:w(t)}),(0,d.jsx)("span",{className:"tooltip-model-cost",children:_(a,3)})]},t)})})]})},F=e=>{let{active:t,payload:a,label:s}=e;if(!t||!a||!a[0])return null;const n=a[0].payload;return(0,d.jsxs)("div",{className:"cost-tooltip-v2",children:[(0,d.jsx)("div",{className:"tooltip-header-v2",children:C(s)}),(0,d.jsxs)("div",{className:"tooltip-token-row",children:[(0,d.jsx)("span",{className:"token-label",style:{color:N.tokens.input},children:"Input"}),(0,d.jsx)("span",{className:"token-value",children:A(n.tokens_in)})]}),(0,d.jsxs)("div",{className:"tooltip-token-row",children:[(0,d.jsx)("span",{className:"token-label",style:{color:N.tokens.output},children:"Output"}),(0,d.jsx)("span",{className:"token-value",children:A(n.tokens_out)})]})]})};if(m)return(0,d.jsxs)("div",{className:"cost-analytics-v2 loading",children:[(0,d.jsx)("div",{className:"loading-pulse"}),(0,d.jsx)("span",{children:"Loading analytics..."})]});if(x)return(0,d.jsxs)("div",{className:"cost-analytics-v2 error",children:[(0,d.jsx)("span",{className:"error-icon",children:"\u25cb"}),(0,d.jsx)("span",{children:x})]});if(!u||!u.buckets||0===u.buckets.length)return(0,d.jsx)("div",{className:"cost-analytics-v2 empty",children:(0,d.jsx)("span",{children:"No cost data available"})});const{chartData:G,modelBreakdown:L}=S,W=u.total_cost||0,O=u.total_tokens_in||0,I=u.total_tokens_out||0,$=L.length>0?L[0].cost:0;return(0,d.jsxs)("div",{className:"cost-analytics-v2",children:[(0,d.jsxs)("div",{className:"analytics-header",children:[(0,d.jsxs)("div",{className:"header-primary",children:[(0,d.jsx)("h3",{className:"analytics-title",children:"Cost Analytics"}),(0,d.jsxs)("div",{className:"granularity-toggle",children:[(0,d.jsx)("button",{className:"granularity-btn ".concat("hour"===v?"active":""),onClick:()=>g("hour"),children:"Hourly"}),(0,d.jsx)("button",{className:"granularity-btn ".concat("day"===v?"active":""),onClick:()=>g("day"),children:"Daily"}),(0,d.jsx)("button",{className:"granularity-btn ".concat("week"===v?"active":""),onClick:()=>g("week"),children:"Weekly"}),(0,d.jsx)("button",{className:"granularity-btn ".concat("month"===v?"active":""),onClick:()=>g("month"),children:"Monthly"})]})]}),(0,d.jsxs)("div",{className:"header-stats",children:[(0,d.jsxs)("div",{className:"header-stat",children:[(0,d.jsx)("span",{className:"stat-label",children:"Total"}),(0,d.jsx)("span",{className:"stat-value cost",children:_(W,2)})]}),(0,d.jsxs)("div",{className:"header-stat",children:[(0,d.jsx)("span",{className:"stat-label",children:"Tokens"}),(0,d.jsx)("span",{className:"stat-value tokens",children:A(O+I)})]})]})]}),(0,d.jsxs)("div",{className:"analytics-content",children:[(0,d.jsxs)("div",{className:"charts-column",children:[(0,d.jsxs)("div",{className:"chart-section",children:[(0,d.jsx)("div",{className:"chart-label",children:(0,d.jsx)("span",{className:"chart-label-text",children:"Cost"})}),(0,d.jsx)("div",{className:"timeline-chart",children:(0,d.jsx)(n.u,{width:"100%",height:120,children:(0,d.jsxs)(l.Q,{data:G,margin:{top:4,right:8,left:0,bottom:0},children:[(0,d.jsx)("defs",{children:(0,d.jsxs)("linearGradient",{id:"costGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,d.jsx)("stop",{offset:"0%",stopColor:N.gradient.start}),(0,d.jsx)("stop",{offset:"100%",stopColor:N.gradient.end})]})}),(0,d.jsx)(r.W,{dataKey:"time",tickFormatter:C,stroke:"#3A4A5A",fontSize:9,tickLine:!1,axisLine:!1,dy:4,interval:"preserveStartEnd",hide:!0}),(0,d.jsx)(o.h,{stroke:"#3A4A5A",fontSize:9,tickFormatter:e=>_(e,0),tickLine:!1,axisLine:!1,width:44,dx:-4}),(0,d.jsx)(i.m,{content:(0,d.jsx)(D,{}),cursor:{stroke:"rgba(74, 158, 221, 0.3)",strokeWidth:1}}),(0,d.jsx)(c.G,{type:"monotone",dataKey:"total",stroke:"#4A9EDD",strokeWidth:2,fill:"url(#costGradient)",dot:!1,activeDot:{r:3,fill:"#4A9EDD",stroke:"#0B1219",strokeWidth:2}})]})})})]}),(0,d.jsxs)("div",{className:"chart-section token-section",children:[(0,d.jsxs)("div",{className:"chart-label",children:[(0,d.jsx)("span",{className:"chart-label-text",children:"Tokens"}),(0,d.jsxs)("div",{className:"token-legend",children:[(0,d.jsxs)("span",{className:"token-legend-item",children:[(0,d.jsx)("span",{className:"legend-dot",style:{background:N.tokens.input}}),"In"]}),(0,d.jsxs)("span",{className:"token-legend-item",children:[(0,d.jsx)("span",{className:"legend-dot",style:{background:N.tokens.output}}),"Out"]})]})]}),(0,d.jsx)("div",{className:"timeline-chart",children:(0,d.jsx)(n.u,{width:"100%",height:80,children:(0,d.jsxs)(l.Q,{data:G,margin:{top:4,right:8,left:0,bottom:0},children:[(0,d.jsxs)("defs",{children:[(0,d.jsxs)("linearGradient",{id:"tokensInGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,d.jsx)("stop",{offset:"0%",stopColor:"rgba(94, 234, 212, 0.35)"}),(0,d.jsx)("stop",{offset:"100%",stopColor:"rgba(94, 234, 212, 0.02)"})]}),(0,d.jsxs)("linearGradient",{id:"tokensOutGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,d.jsx)("stop",{offset:"0%",stopColor:"rgba(167, 139, 250, 0.35)"}),(0,d.jsx)("stop",{offset:"100%",stopColor:"rgba(167, 139, 250, 0.02)"})]})]}),(0,d.jsx)(r.W,{dataKey:"time",tickFormatter:C,stroke:"#3A4A5A",fontSize:9,tickLine:!1,axisLine:!1,dy:4,interval:"preserveStartEnd"}),(0,d.jsx)(o.h,{stroke:"#3A4A5A",fontSize:9,tickFormatter:A,tickLine:!1,axisLine:!1,width:44,dx:-4}),(0,d.jsx)(i.m,{content:(0,d.jsx)(F,{}),cursor:{stroke:"rgba(94, 234, 212, 0.3)",strokeWidth:1}}),(0,d.jsx)(c.G,{type:"monotone",dataKey:"tokens_in",stroke:N.tokens.input,strokeWidth:1.5,fill:"url(#tokensInGradient)",dot:!1,activeDot:{r:2,fill:N.tokens.input,stroke:"#0B1219",strokeWidth:1}}),(0,d.jsx)(c.G,{type:"monotone",dataKey:"tokens_out",stroke:N.tokens.output,strokeWidth:1.5,fill:"url(#tokensOutGradient)",dot:!1,activeDot:{r:2,fill:N.tokens.output,stroke:"#0B1219",strokeWidth:1}})]})})})]})]}),(0,d.jsxs)("div",{className:"model-breakdown",children:[(0,d.jsx)("div",{className:"breakdown-header",children:(0,d.jsx)("span",{className:"breakdown-title",children:"Model Distribution"})}),(0,d.jsx)("div",{className:"breakdown-bars",children:L.map((e,t)=>{const a=$>0?e.cost/W*100:0,s=$>0?e.cost/$*100:0,n=j===e.model;return(0,d.jsxs)("div",{className:"breakdown-row ".concat(n?"hovered":""),onMouseEnter:()=>b(e.model),onMouseLeave:()=>b(null),children:[(0,d.jsxs)("div",{className:"breakdown-label",children:[(0,d.jsx)("span",{className:"breakdown-dot",style:{background:e.color}}),(0,d.jsx)("span",{className:"breakdown-name",children:e.displayName})]}),(0,d.jsx)("div",{className:"breakdown-bar-container",children:(0,d.jsx)("div",{className:"breakdown-bar",style:{width:"".concat(s,"%"),background:e.color,opacity:n?1:.7}})}),(0,d.jsxs)("div",{className:"breakdown-values",children:[(0,d.jsx)("span",{className:"breakdown-cost",children:_(e.cost,2)}),(0,d.jsxs)("span",{className:"breakdown-percent",children:[a.toFixed(0),"%"]})]})]},e.model)})})]})]}),t&&(0,d.jsxs)("div",{className:"filter-indicator",children:["Filtered: ",(0,d.jsx)("span",{className:"filter-value",children:t})]})]})}},90628:(e,t,a)=>{a.d(t,{A:()=>o});var s=a(65043),n=a(5748),l=a(70579);const r=e=>{let{title:t,value:a,subtitle:s,trend:r,icon:o,color:i="#00e5ff"}=e;const c=r>0?"#ff006e":r<0?"#34d399":"#64748b",d=r>0?"mdi:trending-up":"mdi:trending-down";return(0,l.jsxs)("div",{className:"kpi-card",children:[(0,l.jsxs)("div",{className:"kpi-value-row",children:[(0,l.jsx)("span",{className:"kpi-value",style:{color:i},children:a}),void 0!==r&&0!==r&&(0,l.jsxs)("div",{className:"kpi-trend",style:{color:c},children:[(0,l.jsx)(n.In,{icon:d,width:12}),(0,l.jsxs)("span",{children:[Math.abs(r).toFixed(0),"%"]})]})]}),(0,l.jsxs)("div",{className:"kpi-label-row",children:[(0,l.jsx)(n.In,{icon:o,width:12,style:{color:"#475569"}}),(0,l.jsx)("span",{className:"kpi-label",children:t}),s&&(0,l.jsx)("span",{className:"kpi-unit",children:s})]})]})},o=(0,s.memo)(r)}}]);
//# sourceMappingURL=479.5c5edf35.chunk.js.map