"use strict";(self.webpackChunklars_ui=self.webpackChunklars_ui||[]).push([[479],{877:(e,t,a)=>{a.d(t,{Q:()=>i});var s=a(93014),n=a(13839),l=a(52185),r=a(6026),o=a(3831),i=(0,s.gu)({chartName:"AreaChart",GraphicalChild:n.G,axisComponents:[{axisType:"xAxis",AxisComp:l.W},{axisType:"yAxis",AxisComp:r.h}],formatAxisMap:o.pr})},26232:(e,t,a)=>{a.d(t,{I:()=>o});var s=a(89379),n=a(65043),l=a(64065),r=a(24227);function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{enabled:t=!0,pollInterval:a=6e4,lowBalanceThreshold:o=5}=e,[i,c]=(0,n.useState)({balance:null,totalCredits:null,totalUsage:null,burnRate1h:null,burnRate24h:null,burnRate7d:null,runwayDays:null,delta24h:null,lowBalanceWarning:!1,lastUpdated:null,snapshotCount24h:null,loading:!0,error:null}),{showToast:d}=(0,l.dj)(),u=(0,n.useRef)(null),h=(0,n.useRef)(!1),m=(0,n.useRef)(!1),p=(0,n.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{const t="".concat(r.J,e?"/api/credits?refresh=true":"/api/credits"),a=await fetch(t);if(!a.ok)throw new Error("Failed to fetch credits: ".concat(a.status));return await a.json()}catch(t){throw console.error("[useCredits] Fetch error:",t),t}},[]),x=(0,n.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{c(e=>(0,s.A)((0,s.A)({},e),{},{loading:!0,error:null}));const t=await p(e);if(t.error)return void c(e=>(0,s.A)((0,s.A)({},e),{},{loading:!1,error:t.error}));const a={balance:t.balance,totalCredits:t.total_credits,totalUsage:t.total_usage,burnRate1h:t.burn_rate_1h,burnRate24h:t.burn_rate_24h,burnRate7d:t.burn_rate_7d,runwayDays:t.runway_days,delta24h:t.delta_24h,lowBalanceWarning:t.low_balance_warning||null!==t.balance&&t.balance<o,lastUpdated:t.last_updated,snapshotCount24h:t.snapshot_count_24h,loading:!1,error:null};c(a);const n=a.lowBalanceWarning,l=h.current;!n||l||m.current||null===a.balance||(m.current=!0,d("Low OpenRouter Balance: $".concat(a.balance.toFixed(2),". Consider topping up."),{type:"warning",duration:1e4})),h.current=n}catch(t){c(e=>(0,s.A)((0,s.A)({},e),{},{loading:!1,error:t.message}))}},[p,o,d]);return(0,n.useEffect)(()=>{if(t)return x(),u.current=setInterval(()=>{x()},a),()=>{u.current&&(clearInterval(u.current),u.current=null)};c(e=>(0,s.A)((0,s.A)({},e),{},{loading:!1}))},[t,a,x]),(0,s.A)((0,s.A)({},i),{},{refetch:()=>x(!0)})}},55785:(e,t,a)=>{a.d(t,{A:()=>h});var s=a(65043),n=a(50108),l=a(877),r=a(52185),o=a(6026),i=a(86150),c=a(13839),d=a(24227),u=a(70579);const h=function(e){let{cascadeFilter:t=null,cascadeIds:a=[]}=e;const[h,m]=(0,s.useState)(null),[p,x]=(0,s.useState)(!0),[k,j]=(0,s.useState)(null),[b,v]=(0,s.useState)(null),[y,g]=(0,s.useState)(()=>{try{return localStorage.getItem("lars_cost_analytics_granularity")||"day"}catch(e){return"day"}}),f=e=>{g(e);try{localStorage.setItem("lars_cost_analytics_granularity",e)}catch(t){console.error("Failed to save granularity preference:",t)}},N=a.join(",");(0,s.useEffect)(()=>{(async()=>{try{x(!0);const e=new URLSearchParams;a&&a.length>0?e.append("cascade_ids",a.join(",")):t&&e.append("cascade_id",t),e.append("limit","14"),e.append("granularity",y);const s=await fetch("".concat(d.J,"/api/analytics/cost-timeline?").concat(e)),n=await s.json();if(n.error)return void j(n.error);m(n),j(null)}catch(e){j(e.message)}finally{x(!1)}})()},[t,N,y]);const w=(0,s.useMemo)(()=>({primary:["#00e5ff","#a78bfa","#ff006e","#34d399","#fbbf24","#60a5fa","#f472b6","#64748b"],gradient:{start:"rgba(0, 229, 255, 0.3)",end:"rgba(0, 229, 255, 0.01)"},tokens:{input:"#00e5ff",output:"#a78bfa"}}),[]),_=e=>{if(!e||"None"===e||"Other"===e)return"Other"===e?"Other":"Unknown";let t=e;t=t.replace(/^(openai|anthropic|google|x-ai)\//,"");const a=[[/claude-(\d+\.?\d*)-sonnet.*/,"Claude $1 Sonnet"],[/claude-sonnet-(\d+\.?\d*).*/,"Claude $1 Sonnet"],[/claude-(\d+\.?\d*)-opus.*/,"Claude $1 Opus"],[/claude-opus-(\d+\.?\d*).*/,"Claude $1 Opus"],[/claude-(\d+\.?\d*)-haiku.*/,"Claude $1 Haiku"],[/claude-haiku-(\d+\.?\d*).*/,"Claude $1 Haiku"],[/gpt-(\d+\.?\d*).*/,"GPT-$1"],[/gemini-(\d+\.?\d*)-pro.*/,"Gemini $1 Pro"],[/gemini-(\d+\.?\d*)-flash-lite.*/,"Gemini $1 Lite"],[/gemini-(\d+\.?\d*)-flash.*/,"Gemini $1 Flash"],[/grok-(\d+).*/,"Grok $1"],[/qwen.*embed.*/,"Qwen Embed"]];for(const[s,n]of a)if(s.test(t)){t=t.replace(s,n);break}return t.length>20&&(t=t.substring(0,18)+"\u2026"),t},A=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return"$".concat(e>=100?e.toFixed(0):e>=10?e.toFixed(1):e>=1?e.toFixed(t):e.toFixed(Math.min(t+2,4)))},C=e=>e>=1e6?"".concat((e/1e6).toFixed(1),"M"):e>=1e3?"".concat((e/1e3).toFixed(0),"K"):e.toString(),S=e=>{if(!h)return e;const t=h.bucket_type;let a;if(e.includes("T"))a=new Date(e);else{const t=e.split("-");a=new Date(t[0],t[1]-1,t[2])}return"hour"===t?a.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}):"day"===t||"week"===t?a.toLocaleDateString("en-US",{month:"short",day:"numeric"}):"month"===t?a.toLocaleDateString("en-US",{month:"short",year:"2-digit"}):e},D=(0,s.useMemo)(()=>{if(!h||!h.buckets)return{chartData:[],modelBreakdown:[],tokenData:[]};const e=Object.entries(h.model_totals||{}).map(e=>{let[t,a]=e;return{model:t,cost:a,displayName:_(t)}}).sort((e,t)=>t.cost-e.cost),t=e.slice(0,7),a=e.slice(7).reduce((e,t)=>e+t.cost,0),s=[...t];a>0&&s.push({model:"Other",cost:a,displayName:"Other"}),s.forEach((e,t)=>{e.color=w.primary[t]||w.primary[7]});return{chartData:h.buckets.map(e=>({time:e.time_bucket,total:e.total_cost,tokens_in:e.tokens_in||0,tokens_out:e.tokens_out||0,models:e.models})),modelBreakdown:s}},[h,w]),F=e=>{let{active:t,payload:a,label:s}=e;if(!t||!a||!a[0])return null;const n=a[0].payload,l=n.models||{},r=Object.entries(l).filter(e=>{let[,t]=e;return t>0}).sort((e,t)=>t[1]-e[1]).slice(0,5);return(0,u.jsxs)("div",{className:"cost-tooltip-v2",children:[(0,u.jsx)("div",{className:"tooltip-header-v2",children:S(s)}),(0,u.jsx)("div",{className:"tooltip-total-v2",children:A(n.total,3)}),r.length>0&&(0,u.jsx)("div",{className:"tooltip-models-v2",children:r.map(e=>{let[t,a]=e;return(0,u.jsxs)("div",{className:"tooltip-model-row",children:[(0,u.jsx)("span",{className:"tooltip-model-name",children:_(t)}),(0,u.jsx)("span",{className:"tooltip-model-cost",children:A(a,3)})]},t)})})]})},G=e=>{let{active:t,payload:a,label:s}=e;if(!t||!a||!a[0])return null;const n=a[0].payload;return(0,u.jsxs)("div",{className:"cost-tooltip-v2",children:[(0,u.jsx)("div",{className:"tooltip-header-v2",children:S(s)}),(0,u.jsxs)("div",{className:"tooltip-token-row",children:[(0,u.jsx)("span",{className:"token-label",style:{color:w.tokens.input},children:"Input"}),(0,u.jsx)("span",{className:"token-value",children:C(n.tokens_in)})]}),(0,u.jsxs)("div",{className:"tooltip-token-row",children:[(0,u.jsx)("span",{className:"token-label",style:{color:w.tokens.output},children:"Output"}),(0,u.jsx)("span",{className:"token-value",children:C(n.tokens_out)})]})]})};if(p)return(0,u.jsxs)("div",{className:"cost-analytics-v2 loading",children:[(0,u.jsx)("div",{className:"loading-pulse"}),(0,u.jsx)("span",{children:"Loading analytics..."})]});if(k)return(0,u.jsxs)("div",{className:"cost-analytics-v2 error",children:[(0,u.jsx)("span",{className:"error-icon",children:"\u25cb"}),(0,u.jsx)("span",{children:k})]});if(!h||!h.buckets||0===h.buckets.length)return(0,u.jsx)("div",{className:"cost-analytics-v2 empty",children:(0,u.jsx)("span",{children:"No cost data available"})});const{chartData:L,modelBreakdown:W}=D,O=h.total_cost||0,I=h.total_tokens_in||0,$=h.total_tokens_out||0,B=W.length>0?W[0].cost:0;return(0,u.jsxs)("div",{className:"cost-analytics-v2",children:[(0,u.jsxs)("div",{className:"analytics-header",children:[(0,u.jsxs)("div",{className:"header-primary",children:[(0,u.jsx)("h3",{className:"analytics-title",children:"Cost Analytics"}),(0,u.jsxs)("div",{className:"granularity-toggle",children:[(0,u.jsx)("button",{className:"granularity-btn ".concat("hour"===y?"active":""),onClick:()=>f("hour"),children:"Hourly"}),(0,u.jsx)("button",{className:"granularity-btn ".concat("day"===y?"active":""),onClick:()=>f("day"),children:"Daily"}),(0,u.jsx)("button",{className:"granularity-btn ".concat("week"===y?"active":""),onClick:()=>f("week"),children:"Weekly"}),(0,u.jsx)("button",{className:"granularity-btn ".concat("month"===y?"active":""),onClick:()=>f("month"),children:"Monthly"})]})]}),(0,u.jsxs)("div",{className:"header-stats",children:[(0,u.jsxs)("div",{className:"header-stat",children:[(0,u.jsx)("span",{className:"stat-label",children:"Total"}),(0,u.jsx)("span",{className:"stat-value cost",children:A(O,2)})]}),(0,u.jsxs)("div",{className:"header-stat",children:[(0,u.jsx)("span",{className:"stat-label",children:"Tokens"}),(0,u.jsx)("span",{className:"stat-value tokens",children:C(I+$)})]})]})]}),(0,u.jsxs)("div",{className:"analytics-content",children:[(0,u.jsxs)("div",{className:"charts-column",children:[(0,u.jsxs)("div",{className:"chart-section",children:[(0,u.jsx)("div",{className:"chart-label",children:(0,u.jsx)("span",{className:"chart-label-text",children:"Cost"})}),(0,u.jsx)("div",{className:"timeline-chart",children:(0,u.jsx)(n.u,{width:"100%",height:120,children:(0,u.jsxs)(l.Q,{data:L,margin:{top:4,right:8,left:0,bottom:0},children:[(0,u.jsx)("defs",{children:(0,u.jsxs)("linearGradient",{id:"costGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,u.jsx)("stop",{offset:"0%",stopColor:w.gradient.start}),(0,u.jsx)("stop",{offset:"100%",stopColor:w.gradient.end})]})}),(0,u.jsx)(r.W,{dataKey:"time",tickFormatter:S,stroke:"#3A4A5A",fontSize:9,tickLine:!1,axisLine:!1,dy:4,interval:"preserveStartEnd",hide:!0}),(0,u.jsx)(o.h,{stroke:"#3A4A5A",fontSize:9,tickFormatter:e=>A(e,0),tickLine:!1,axisLine:!1,width:44,dx:-4}),(0,u.jsx)(i.m,{content:(0,u.jsx)(F,{}),cursor:{stroke:"rgba(74, 158, 221, 0.3)",strokeWidth:1}}),(0,u.jsx)(c.G,{type:"monotone",dataKey:"total",stroke:"#4A9EDD",strokeWidth:2,fill:"url(#costGradient)",dot:!1,activeDot:{r:3,fill:"#4A9EDD",stroke:"#0B1219",strokeWidth:2}})]})})})]}),(0,u.jsxs)("div",{className:"chart-section token-section",children:[(0,u.jsxs)("div",{className:"chart-label",children:[(0,u.jsx)("span",{className:"chart-label-text",children:"Tokens"}),(0,u.jsxs)("div",{className:"token-legend",children:[(0,u.jsxs)("span",{className:"token-legend-item",children:[(0,u.jsx)("span",{className:"legend-dot",style:{background:w.tokens.input}}),"In"]}),(0,u.jsxs)("span",{className:"token-legend-item",children:[(0,u.jsx)("span",{className:"legend-dot",style:{background:w.tokens.output}}),"Out"]})]})]}),(0,u.jsx)("div",{className:"timeline-chart",children:(0,u.jsx)(n.u,{width:"100%",height:80,children:(0,u.jsxs)(l.Q,{data:L,margin:{top:4,right:8,left:0,bottom:0},children:[(0,u.jsxs)("defs",{children:[(0,u.jsxs)("linearGradient",{id:"tokensInGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,u.jsx)("stop",{offset:"0%",stopColor:"rgba(94, 234, 212, 0.35)"}),(0,u.jsx)("stop",{offset:"100%",stopColor:"rgba(94, 234, 212, 0.02)"})]}),(0,u.jsxs)("linearGradient",{id:"tokensOutGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,u.jsx)("stop",{offset:"0%",stopColor:"rgba(167, 139, 250, 0.35)"}),(0,u.jsx)("stop",{offset:"100%",stopColor:"rgba(167, 139, 250, 0.02)"})]})]}),(0,u.jsx)(r.W,{dataKey:"time",tickFormatter:S,stroke:"#3A4A5A",fontSize:9,tickLine:!1,axisLine:!1,dy:4,interval:"preserveStartEnd"}),(0,u.jsx)(o.h,{stroke:"#3A4A5A",fontSize:9,tickFormatter:C,tickLine:!1,axisLine:!1,width:44,dx:-4}),(0,u.jsx)(i.m,{content:(0,u.jsx)(G,{}),cursor:{stroke:"rgba(94, 234, 212, 0.3)",strokeWidth:1}}),(0,u.jsx)(c.G,{type:"monotone",dataKey:"tokens_in",stroke:w.tokens.input,strokeWidth:1.5,fill:"url(#tokensInGradient)",dot:!1,activeDot:{r:2,fill:w.tokens.input,stroke:"#0B1219",strokeWidth:1}}),(0,u.jsx)(c.G,{type:"monotone",dataKey:"tokens_out",stroke:w.tokens.output,strokeWidth:1.5,fill:"url(#tokensOutGradient)",dot:!1,activeDot:{r:2,fill:w.tokens.output,stroke:"#0B1219",strokeWidth:1}})]})})})]})]}),(0,u.jsxs)("div",{className:"model-breakdown",children:[(0,u.jsx)("div",{className:"breakdown-header",children:(0,u.jsx)("span",{className:"breakdown-title",children:"Model Distribution"})}),(0,u.jsx)("div",{className:"breakdown-bars",children:W.map((e,t)=>{const a=B>0?e.cost/O*100:0,s=B>0?e.cost/B*100:0,n=b===e.model;return(0,u.jsxs)("div",{className:"breakdown-row ".concat(n?"hovered":""),onMouseEnter:()=>v(e.model),onMouseLeave:()=>v(null),children:[(0,u.jsxs)("div",{className:"breakdown-label",children:[(0,u.jsx)("span",{className:"breakdown-dot",style:{background:e.color}}),(0,u.jsx)("span",{className:"breakdown-name",children:e.displayName})]}),(0,u.jsx)("div",{className:"breakdown-bar-container",children:(0,u.jsx)("div",{className:"breakdown-bar",style:{width:"".concat(s,"%"),background:e.color,opacity:n?1:.7}})}),(0,u.jsxs)("div",{className:"breakdown-values",children:[(0,u.jsx)("span",{className:"breakdown-cost",children:A(e.cost,2)}),(0,u.jsxs)("span",{className:"breakdown-percent",children:[a.toFixed(0),"%"]})]})]},e.model)})})]})]}),t&&(0,u.jsxs)("div",{className:"filter-indicator",children:["Filtered: ",(0,u.jsx)("span",{className:"filter-value",children:t})]})]})}},90628:(e,t,a)=>{a.d(t,{A:()=>o});var s=a(65043),n=a(5748),l=a(70579);const r=e=>{let{title:t,value:a,subtitle:s,trend:r,icon:o,color:i="#00e5ff"}=e;const c=r>0?"#ff006e":r<0?"#34d399":"#64748b",d=r>0?"mdi:trending-up":"mdi:trending-down";return(0,l.jsxs)("div",{className:"kpi-card",children:[(0,l.jsxs)("div",{className:"kpi-value-row",children:[(0,l.jsx)("span",{className:"kpi-value",style:{color:i},children:a}),void 0!==r&&0!==r&&(0,l.jsxs)("div",{className:"kpi-trend",style:{color:c},children:[(0,l.jsx)(n.In,{icon:d,width:12}),(0,l.jsxs)("span",{children:[Math.abs(r).toFixed(0),"%"]})]})]}),(0,l.jsxs)("div",{className:"kpi-label-row",children:[(0,l.jsx)(n.In,{icon:o,width:12,style:{color:"#475569"}}),(0,l.jsx)("span",{className:"kpi-label",children:t}),s&&(0,l.jsx)("span",{className:"kpi-unit",children:s})]})]})},o=(0,s.memo)(r)}}]);
//# sourceMappingURL=479.6e753d21.chunk.js.map