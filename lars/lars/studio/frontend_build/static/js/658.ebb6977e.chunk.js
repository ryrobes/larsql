"use strict";(self.webpackChunklars_ui=self.webpackChunklars_ui||[]).push([[658],{81658:(e,s,t)=>{t.r(s),t.d(s,{default:()=>X});var a=t(65043),l=t(5748),c=t(64065),n=t(24227),i=t(70579);const r=[{type:"image",icon:"mdi:image",color:"var(--color-accent-pink)",label:"Image"},{type:"chart",icon:"mdi:chart-line",color:"var(--color-accent-green)",label:"Chart"},{type:"table",icon:"mdi:table",color:"var(--color-accent-yellow)",label:"Table"},{type:"tool_call",icon:"mdi:tools",color:"var(--color-accent-orange)",label:"Tool Call",expandable:!0},{type:"markdown",icon:"mdi:language-markdown",color:"var(--color-accent-purple)",label:"Markdown"},{type:"json",icon:"mdi:code-json",color:"var(--color-accent-blue)",label:"JSON"},{type:"text",icon:"mdi:text",color:"var(--color-accent-cyan)",label:"Text"},{type:"error",icon:"mdi:alert-circle",color:"var(--color-error)",label:"Error"}],o=e=>e.replace(/_/g," "),d=e=>{let{timeFilter:s,onTimeFilterChange:t,allCascadeIds:c,selectedCascades:d,onSelectedCascadesChange:m,selectedTags:h,onSelectedTagsChange:u,availableTags:p,selectedContentTypes:x,onSelectedContentTypesChange:g}=e;const[j,v]=(0,a.useState)({}),[N,w]=(0,a.useState)([]),[f,y]=(0,a.useState)(!1);(0,a.useEffect)(()=>{(async()=>{try{const e=await fetch("".concat(n.J,"/api/outputs/content-types?time_filter=").concat(s)),t=await e.json();if(t.content_types){const e={},s=[];for(const a of t.content_types)e[a.type]=a.count,a.is_subtype&&"tool_call"===a.base_type&&s.push({type:a.type,toolName:a.type.split(":")[1],count:a.count});v(e),w(s)}}catch(e){console.error("[FilterPanel] Error fetching content type stats:",e)}})()},[s]);const b=e=>{if(x.includes(e))if("tool_call"===e){const s=x.filter(s=>s!==e&&!s.startsWith("tool_call:"));g(s)}else g(x.filter(s=>s!==e));else if(e.startsWith("tool_call:")){const s=x.filter(e=>"tool_call"!==e);g([...s,e])}else if("tool_call"===e){const s=x.filter(e=>!e.startsWith("tool_call:"));g([...s,e])}else g([...x,e])};return(0,i.jsxs)("div",{className:"outputs-filter-panel",children:[(0,i.jsxs)("div",{className:"filter-section",children:[(0,i.jsxs)("div",{className:"filter-section-header",children:[(0,i.jsx)(l.In,{icon:"mdi:clock-outline",width:"14"}),(0,i.jsx)("span",{children:"Time"})]}),(0,i.jsxs)("div",{className:"filter-options",children:[(0,i.jsx)("button",{className:"filter-chip ".concat("today"===s?"active":""),onClick:()=>t("today"),children:"Today"}),(0,i.jsx)("button",{className:"filter-chip ".concat("week"===s?"active":""),onClick:()=>t("week"),children:"This Week"}),(0,i.jsx)("button",{className:"filter-chip ".concat("month"===s?"active":""),onClick:()=>t("month"),children:"This Month"}),(0,i.jsx)("button",{className:"filter-chip ".concat("all"===s?"active":""),onClick:()=>t("all"),children:"All Time"})]})]}),(0,i.jsxs)("div",{className:"filter-section",children:[(0,i.jsxs)("div",{className:"filter-section-header",children:[(0,i.jsx)(l.In,{icon:"mdi:tag-multiple",width:"14"}),(0,i.jsx)("span",{children:"Tags"}),h.length>0&&(0,i.jsxs)("button",{className:"filter-clear-btn",onClick:()=>{u([])},children:["Clear (",h.length,")"]})]}),(0,i.jsx)("div",{className:"filter-tags-list",children:p&&0!==p.length?p.map(e=>(0,i.jsxs)("label",{className:"filter-tag-item ".concat(h.includes(e.tag_name)?"active":""),style:{"--tag-color":e.tag_color},children:[(0,i.jsx)("input",{type:"checkbox",checked:h.includes(e.tag_name),onChange:()=>{return s=e.tag_name,void(h.includes(s)?u(h.filter(e=>e!==s)):u([...h,s]));var s}}),(0,i.jsx)("div",{className:"tag-color-dot"}),(0,i.jsx)("span",{className:"tag-name",children:e.tag_name}),e.count>0&&(0,i.jsx)("span",{className:"tag-count",children:e.count})]},e.tag_name)):(0,i.jsx)("div",{className:"filter-empty",children:"No tags yet"})})]}),(0,i.jsxs)("div",{className:"filter-section",children:[(0,i.jsxs)("div",{className:"filter-section-header",children:[(0,i.jsx)(l.In,{icon:"mdi:palette",width:"14"}),(0,i.jsx)("span",{children:"Content Types"}),x.length>0&&(0,i.jsxs)("button",{className:"filter-clear-btn",onClick:()=>{g([])},children:["Clear (",x.length,")"]})]}),(0,i.jsx)("div",{className:"filter-content-types",children:r.map(e=>{let{type:s,icon:t,color:c,label:n,expandable:r}=e;const d=j[s]||0,m=x.includes(s),h="tool_call"===s,u=h&&N.length>0;return(0,i.jsxs)(a.Fragment,{children:[(0,i.jsxs)("label",{className:"content-type-item ".concat(m?"active":""," ").concat(0===d?"disabled":""),style:{"--type-color":c},children:[(0,i.jsx)("input",{type:"checkbox",checked:m,onChange:()=>b(s),disabled:0===d}),(0,i.jsx)("div",{className:"type-color-indicator"}),(0,i.jsx)(l.In,{icon:t,width:"12",className:"type-icon"}),(0,i.jsx)("span",{className:"type-label",children:n}),d>0&&(0,i.jsx)("span",{className:"type-count",children:d}),u&&(0,i.jsx)("button",{className:"type-expander ".concat(f?"expanded":""),onClick:e=>{e.preventDefault(),e.stopPropagation(),y(!f)},title:f?"Collapse tool types":"Expand tool types",children:(0,i.jsx)(l.In,{icon:"mdi:chevron-down",width:"14"})})]}),h&&f&&N.length>0&&(0,i.jsx)("div",{className:"tool-call-subtypes",children:N.map(e=>{let{type:s,toolName:t,count:a}=e;const l=x.includes(s);return(0,i.jsxs)("label",{className:"content-type-item subtype ".concat(l?"active":""),style:{"--type-color":c},children:[(0,i.jsx)("input",{type:"checkbox",checked:l,onChange:()=>b(s)}),(0,i.jsx)("div",{className:"type-color-indicator"}),(0,i.jsx)("span",{className:"type-label",children:o(t)}),(0,i.jsx)("span",{className:"type-count",children:a})]},s)})})]},s)})})]}),(0,i.jsxs)("div",{className:"filter-section cascades-filter",children:[(0,i.jsxs)("div",{className:"filter-section-header",children:[(0,i.jsx)(l.In,{icon:"mdi:sitemap",width:"14"}),(0,i.jsx)("span",{children:"Cascades"}),d.length>0&&(0,i.jsxs)("button",{className:"filter-clear-btn",onClick:()=>{m([])},children:["Clear (",d.length,")"]})]}),(0,i.jsx)("div",{className:"filter-cascades-list",children:0===c.length?(0,i.jsx)("div",{className:"filter-empty",children:"No cascades"}):c.map(e=>(0,i.jsxs)("label",{className:"filter-cascade-item",children:[(0,i.jsx)("input",{type:"checkbox",checked:d.includes(e),onChange:()=>(e=>{d.includes(e)?m(d.filter(s=>s!==e)):m([...d,e])})(e)}),(0,i.jsx)("span",{className:"cascade-name",children:e})]},e))})]})]})};var m=t(89379);const h=e=>e?e.includes(":")?e.split(":")[0]:e:"text",u=e=>e&&0!==e?"$".concat(e<.001?e.toFixed(5):e<.01?e.toFixed(4):e.toFixed(3)):"",p=e=>{if(!e||"string"!==typeof e)return e;return e.split("\n").slice(0,12).map((e,s)=>{if(e.startsWith("### "))return(0,i.jsx)("div",{className:"preview-h3",children:e.slice(4)},s);if(e.startsWith("## "))return(0,i.jsx)("div",{className:"preview-h2",children:e.slice(3)},s);if(e.startsWith("# "))return(0,i.jsx)("div",{className:"preview-h1",children:e.slice(2)},s);if(e.includes("**")){const t=e.split(/\*\*(.*?)\*\*/g);return(0,i.jsx)("div",{className:"preview-line",children:t.map((e,s)=>s%2===1?(0,i.jsx)("strong",{children:e},s):e)},s)}return e.startsWith("- ")||e.startsWith("* ")?(0,i.jsx)("div",{className:"preview-list-item",children:e.slice(2)},s):/^\d+\.\s/.test(e)?(0,i.jsx)("div",{className:"preview-list-item",children:e},s):e.startsWith("```")?(0,i.jsx)("div",{className:"preview-code-fence",children:"..."},s):""===e.trim()?(0,i.jsx)("div",{className:"preview-spacer"},s):(0,i.jsx)("div",{className:"preview-line",children:e},s)})},x=e=>{let{content:s,contentType:t,images:a}=e;const l=((e,s)=>{if(e&&e.length>0){const s=e[0];if("string"===typeof s)return s.startsWith("http")?s:"".concat(n.J).concat(s);if(s.url)return s.url.startsWith("http")?s.url:"".concat(n.J).concat(s.url)}return s&&"object"===typeof s&&s.url?s.url.startsWith("http")?s.url:"".concat(n.J).concat(s.url):null})(a,s);return l?(0,i.jsx)("div",{className:"preview-image",children:(0,i.jsx)("img",{src:l,alt:"preview"})}):"table"===t||s&&"object"===typeof s&&s.rows?(e=>{if(!e||"object"!==typeof e)return null;const{rows:s,columns:t}=e;if(!s||!t)return null;const a=s.slice(0,4),l=t.slice(0,4);return(0,i.jsxs)("div",{className:"preview-table",children:[(0,i.jsxs)("div",{className:"preview-table-header",children:[l.map((e,s)=>(0,i.jsx)("div",{className:"preview-table-cell header",children:e},s)),t.length>4&&(0,i.jsx)("div",{className:"preview-table-cell more",children:"..."})]}),a.map((e,s)=>(0,i.jsx)("div",{className:"preview-table-row",children:l.map((s,t)=>{var a;return(0,i.jsx)("div",{className:"preview-table-cell",children:String(Array.isArray(e)?e[t]:null!==(a=e[s])&&void 0!==a?a:"").slice(0,15)},t)})},s)),s.length>4&&(0,i.jsxs)("div",{className:"preview-table-more",children:["+",s.length-4," more rows"]})]})})(s):"json"===t||s&&"object"===typeof s&&!s.rows?(e=>{if(!e)return null;try{const s="string"===typeof e?JSON.parse(e):e,t=JSON.stringify(s,null,2),a=t.split("\n").slice(0,10);return(0,i.jsxs)("pre",{className:"preview-json",children:[a.join("\n"),t.split("\n").length>10&&"\n..."]})}catch(s){return(0,i.jsx)("pre",{className:"preview-json",children:String(e).slice(0,300)})}})(s):"string"===typeof s?(0,i.jsx)("div",{className:"preview-markdown",children:p(s)}):null},g=e=>{let{cell:s,onClick:t,compact:a=!1,outputCount:c=1}=e;const{cell_name:n,cell_index:r,content_type:o,content:d,preview:m,cost:p,starred:g,images:j}=s,v=c>1,N=(e=>{switch(h(e)){case"image":return"mdi:image";case"chart":return"mdi:chart-line";case"table":return"mdi:table";case"tool_call":return"mdi:tools";case"markdown":return"mdi:language-markdown";case"json":return"mdi:code-json";case"error":return"mdi:alert-circle";default:return"mdi:text"}})(o),w=(e=>{switch(h(e)){case"image":return"var(--color-accent-pink)";case"chart":return"var(--color-accent-green)";case"table":return"var(--color-accent-yellow)";case"tool_call":return"var(--color-accent-orange)";case"markdown":return"var(--color-accent-purple)";case"json":return"var(--color-accent-blue)";case"error":return"var(--color-error)";default:return"var(--color-accent-cyan)"}})(o),f=(y=o)&&y.startsWith("tool_call:")?y.split(":")[1]:null;var y;const b=d||j&&j.length>0;return(0,i.jsxs)("div",{className:"cell-tile ".concat(a?"compact":""," ").concat(g?"starred":""," ").concat(v?"has-stack":""),onClick:t,style:{"--tile-accent":w},children:[v&&(0,i.jsxs)("div",{className:"cell-tile-stack",title:"".concat(c," outputs"),children:[(0,i.jsx)("div",{className:"stack-layer"}),(0,i.jsx)("div",{className:"stack-layer"})]}),(0,i.jsxs)("div",{className:"cell-tile-header",children:[(0,i.jsx)("div",{className:"cell-tile-index",children:void 0!==r?r+1:"?"}),(0,i.jsx)(l.In,{icon:N,width:"14",className:"cell-tile-type-icon"}),(0,i.jsx)("span",{className:"cell-tile-name",title:n,children:n}),f&&(0,i.jsx)("span",{className:"cell-tile-tool-badge",title:"Tool: ".concat(f),children:f}),v&&(0,i.jsx)("span",{className:"cell-tile-output-count",title:"".concat(c," outputs from this cell"),children:c})]}),(0,i.jsx)("div",{className:"cell-tile-content",children:b?(0,i.jsx)(x,{content:d,contentType:o,images:j}):m?(0,i.jsx)("div",{className:"preview-text",children:m}):(0,i.jsx)("div",{className:"preview-empty",children:(0,i.jsx)(l.In,{icon:N,width:"24"})})}),p>0&&(0,i.jsx)("div",{className:"cell-tile-cost",children:u(p)}),g&&(0,i.jsx)("div",{className:"cell-tile-star",children:(0,i.jsx)(l.In,{icon:"mdi:star",width:"12"})})]})},j=e=>e?e.includes(":")?e.split(":")[0]:e:"text",v=e=>e&&e.startsWith("tool_call:")?e.split(":")[1]:null,N=e=>{switch(j(e)){case"image":return"mdi:image";case"chart":return"mdi:chart-line";case"table":return"mdi:table";case"tool_call":return"mdi:tools";case"markdown":return"mdi:language-markdown";case"json":return"mdi:code-json";case"error":return"mdi:alert-circle";default:return"mdi:text"}},w=e=>{switch(j(e)){case"image":return"var(--color-accent-pink)";case"chart":return"var(--color-accent-green)";case"table":return"var(--color-accent-yellow)";case"tool_call":return"var(--color-accent-orange)";case"markdown":return"var(--color-accent-purple)";case"json":return"var(--color-accent-blue)";case"error":return"var(--color-error)";default:return"var(--color-accent-cyan)"}},f=e=>e&&0!==e?"$".concat(e<.001?e.toFixed(5):e<.01?e.toFixed(4):e.toFixed(3)):"",y=e=>{let{cell:s,onClick:t,isFirst:a}=e;const{content_type:c,content:r,images:o,cost:d}=s,m=N(c),h=w(c),u=v(c),p=((e,s)=>{if(e&&e.length>0){const s=e[0];if("string"===typeof s)return s.startsWith("http")?s:"".concat(n.J).concat(s);if(s.url)return s.url.startsWith("http")?s.url:"".concat(n.J).concat(s.url)}return s&&"object"===typeof s&&s.url?s.url.startsWith("http")?s.url:"".concat(n.J).concat(s.url):null})(o,r),x=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:80;if(!e)return"";const t="string"===typeof e?e:JSON.stringify(e);return t.length<=s?t:t.slice(0,s)+"..."}(r);return(0,i.jsxs)("div",{className:"cell-group-mini-tile ".concat(a?"first":""),onClick:t,style:{"--tile-accent":h},children:[!a&&(0,i.jsx)("div",{className:"mini-tile-connector",children:(0,i.jsx)("div",{className:"connector-line"})}),(0,i.jsxs)("div",{className:"mini-tile-content",children:[(0,i.jsx)("div",{className:"mini-tile-left",children:p?(0,i.jsx)("img",{src:p,alt:"preview",className:"mini-tile-image"}):(0,i.jsx)(l.In,{icon:m,width:"14",className:"mini-tile-icon"})}),(0,i.jsx)("div",{className:"mini-tile-preview",children:u?(0,i.jsx)("span",{className:"mini-tile-tool",children:u}):(0,i.jsx)("span",{className:"mini-tile-text",children:x||"No content"})}),d>0&&(0,i.jsx)("span",{className:"mini-tile-cost",children:f(d)})]})]})},b=e=>{let{cellName:s,cellIndex:t,cells:a,onCellClick:c}=e;const n=a.length>1,r=a[0],o=w(null===r||void 0===r?void 0:r.content_type),d=N(null===r||void 0===r?void 0:r.content_type),m=v(null===r||void 0===r?void 0:r.content_type);return(0,i.jsxs)("div",{className:"cell-group ".concat(n?"has-multiple":""),style:{"--group-accent":o},children:[(0,i.jsxs)("div",{className:"cell-group-header",children:[(0,i.jsx)("div",{className:"cell-group-index",children:t+1}),(0,i.jsx)(l.In,{icon:d,width:"14",className:"cell-group-icon"}),(0,i.jsx)("span",{className:"cell-group-name",title:s,children:s}),m&&(0,i.jsx)("span",{className:"cell-group-tool-badge",children:m}),n&&(0,i.jsx)("span",{className:"cell-group-count",children:a.length})]}),(0,i.jsx)("div",{className:"cell-group-tiles",children:a.map((e,s)=>(0,i.jsx)(y,{cell:e,onClick:()=>c(e.message_id),isFirst:0===s},e.message_id))})]})};var _=t(45685),C=t(60263);const k=e=>{if(!e)return"";const s=new Date(e),t=new Date-s,a=Math.floor(t/6e4),l=Math.floor(t/36e5),c=Math.floor(t/864e5);return a<1?"now":a<60?"".concat(a,"m"):l<24?"".concat(l,"h"):c<7?"".concat(c,"d"):s.toLocaleDateString("en-US",{month:"short",day:"numeric"})},S=e=>{let{cellNames:s,runs:t,onCellClick:c}=e;const n=(0,_.Zp)(),r=(0,a.useRef)(null),[o,d]=(0,a.useState)(0),m=(0,a.useCallback)(e=>{d(e.target.scrollLeft)},[]);return t&&0!==t.length?(0,i.jsxs)("div",{className:"linked-scroll-grid",children:[(0,i.jsxs)("div",{className:"linked-scroll-header",children:[(0,i.jsx)("div",{className:"header-time-col",children:"Time"}),(0,i.jsx)("div",{className:"header-cells-row",style:{transform:"translateX(-".concat(o,"px)")},children:s.map((e,s)=>(0,i.jsxs)("div",{className:"header-cell",children:[(0,i.jsx)("span",{className:"header-cell-index",children:s+1}),(0,i.jsx)("span",{className:"header-cell-name",children:e})]},e))}),(0,i.jsx)("div",{className:"header-session-col",children:"Session"})]}),(0,i.jsx)("div",{className:"linked-scroll-rows",ref:r,onScroll:m,children:t.map(e=>{return(0,i.jsxs)("div",{className:"linked-scroll-row",children:[(0,i.jsxs)("div",{className:"row-time-col",children:[(0,i.jsx)("span",{className:"row-time",children:k(e.timestamp)}),(0,i.jsx)("span",{className:"row-cost",children:(t=e.cost,t&&0!==t?"$".concat(t<.01?t.toFixed(4):t.toFixed(2)):"$0.00")})]}),(0,i.jsx)("div",{className:"row-cells",children:s.map((s,t)=>{const a=e.cells[s];if(!a||0===a.length)return(0,i.jsx)("div",{className:"row-cell-empty",children:(0,i.jsx)(l.In,{icon:"mdi:minus",width:"14"})},s);const n=a.length>1;return(0,i.jsx)("div",{className:"row-cell",children:n?(0,i.jsx)(b,{cellName:s,cellIndex:t,cells:a,onCellClick:e=>c(e)}):(0,i.jsx)(g,{cell:a[0],compact:!0,onClick:()=>c(a[0].message_id)})},s)})}),(0,i.jsx)("div",{className:"row-session-col",children:(0,i.jsx)("span",{className:"row-session",onClick:()=>n(C.bw.studioWithSession(e.cascade_id,e.session_id)),title:"Open ".concat(e.session_id," in Studio"),children:e.session_id})})]},e.session_id);var t})}),(0,i.jsxs)("div",{className:"linked-scroll-indicator",children:[(0,i.jsx)(l.In,{icon:"mdi:gesture-swipe-horizontal",width:"14"}),(0,i.jsx)("span",{children:"Scroll to compare cells across runs"})]})]}):(0,i.jsxs)("div",{className:"linked-scroll-empty",children:[(0,i.jsx)(l.In,{icon:"mdi:inbox-outline",width:"24"}),(0,i.jsx)("span",{children:"No runs found"})]})},I=e=>{if(!e)return"";const s=new Date(e),t=new Date-s,a=Math.floor(t/6e4),l=Math.floor(t/36e5),c=Math.floor(t/864e5);return a<1?"just now":a<60?"".concat(a,"m ago"):l<24?"".concat(l,"h ago"):c<7?"".concat(c,"d ago"):s.toLocaleDateString()},T=e=>{let{cascade:s,isExpanded:t,expandedData:c,expandedLoading:n,onToggleExpand:r,onCellClick:o}=e;const{cascade_id:d,run_count:h,runs:u,total_cost:p}=s,x=u&&u.length>0?u[0]:null,j=x?(e=>{if(!e||0===e.length)return[];const s=[],t=new Map;for(const a of e){const e=a.cell_name;if(t.has(e))t.get(e).cells.push(a);else{const l={cell_name:e,cells:[a],cell_index:s.length};s.push(l),t.set(e,l)}}return s})(x.cells):[];return(0,i.jsxs)("div",{className:"cascade-swimlane ".concat(t?"expanded":""),children:[(0,i.jsxs)("div",{className:"swimlane-header",onClick:r,children:[(0,i.jsxs)("div",{className:"swimlane-header-left",children:[(0,i.jsx)(l.In,{icon:t?"mdi:chevron-down":"mdi:chevron-right",width:"18",className:"swimlane-chevron"}),(0,i.jsx)(l.In,{icon:"mdi:sitemap",width:"16",className:"swimlane-icon"}),(0,i.jsx)("span",{className:"swimlane-title",children:d}),(0,i.jsxs)("span",{className:"swimlane-run-count",children:[h," runs"]})]}),(0,i.jsx)("div",{className:"swimlane-header-right",children:(0,i.jsx)("span",{className:"swimlane-cost",children:(v=p,v&&0!==v?"$".concat(v<.01?v.toFixed(4):v.toFixed(2)):"$0.00")})})]}),(0,i.jsx)("div",{className:"swimlane-content",children:t?(0,i.jsx)("div",{className:"swimlane-expanded",children:n?(0,i.jsxs)("div",{className:"swimlane-loading",children:[(0,i.jsx)(l.In,{icon:"mdi:loading",className:"spinning",width:"20"}),(0,i.jsx)("span",{children:"Loading runs..."})]}):c?(0,i.jsx)(S,{cellNames:c.cell_names||[],runs:c.runs||[],onCellClick:o}):null}):(0,i.jsx)("div",{className:"swimlane-collapsed",children:x?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"swimlane-run-meta",children:[(0,i.jsx)("span",{className:"run-session",children:x.session_id}),(0,i.jsx)("span",{className:"run-time",children:I(x.timestamp)})]}),(0,i.jsx)("div",{className:"swimlane-filmstrip",children:j.map((e,s)=>{const t=e.cells.length>1;return(0,i.jsxs)(a.Fragment,{children:[t?(0,i.jsx)(b,{cellName:e.cell_name,cellIndex:e.cell_index,cells:e.cells,onCellClick:e=>o(e)}):(0,i.jsx)(g,{cell:(0,m.A)((0,m.A)({},e.cells[0]),{},{cell_index:e.cell_index}),onClick:()=>o(e.cells[0].message_id)}),s<j.length-1&&(0,i.jsx)("div",{className:"filmstrip-arrow",children:(0,i.jsx)(l.In,{icon:"mdi:arrow-right",width:"14"})})]},e.cell_name)})}),h>1&&(0,i.jsxs)("div",{className:"stack-indicator",title:"".concat(h," runs total"),children:[(0,i.jsx)("div",{className:"stack-layer"}),(0,i.jsx)("div",{className:"stack-layer"})]})]}):(0,i.jsx)("div",{className:"swimlane-empty",children:"No runs"})})})]});var v};var O=t(97950),J=t(44658),E=t(31915),F=t(53840);const q=["#a78bfa","#60a5fa","#34d399","#fbbf24","#f87171","#fb7185","#f97316","#06b6d4"],D=e=>{let{isOpen:s,onClose:t,outputInfo:c,availableTags:r=[],onTagAdded:o,onRefreshTags:d}=e;const[m,h]=(0,a.useState)("instance"),[u,p]=(0,a.useState)(""),[x,g]=(0,a.useState)(""),[j,v]=(0,a.useState)(q[0]),[N,w]=(0,a.useState)(""),[f,y]=(0,a.useState)(!1),[b,_]=(0,a.useState)(!1),[C,k]=(0,a.useState)(null);(0,a.useEffect)(()=>{s&&(h("instance"),p(""),g(""),v(q[0]),w(""),y(!1),k(null))},[s]);const S=async()=>{const e=f?x.trim():u;if(e)if(c){_(!0),k(null);try{const s={tag_name:e,tag_mode:m,note:N.trim()||null};"instance"===m?s.message_id=c.message_id:(s.cascade_id=c.cascade_id,s.cell_name=c.cell_name),f&&(s.tag_color=j);const a=await fetch("".concat(n.J,"/api/outputs/tags"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),l=await a.json();if(!a.ok)throw new Error(l.error||"Failed to add tag");d&&await d(),o&&o(l),t()}catch(s){k(s.message)}finally{_(!1)}}else k("No output information provided");else k("Please select or create a tag")};return(0,i.jsxs)(F.Ay,{isOpen:s,onClose:t,size:"sm",className:"tag-modal",children:[(0,i.jsx)(F.rQ,{title:"Tag Output",subtitle:null!==c&&void 0!==c&&c.cell_name?"".concat(c.cascade_id," / ").concat(c.cell_name):"",icon:"mdi:tag-plus"}),(0,i.jsxs)(F.$m,{children:[(0,i.jsxs)("div",{className:"tag-mode-section",children:[(0,i.jsx)("label",{className:"tag-section-label",children:"Tag Mode"}),(0,i.jsxs)("div",{className:"tag-mode-options",children:[(0,i.jsxs)("label",{className:"tag-mode-option ".concat("instance"===m?"active":""),children:[(0,i.jsx)("input",{type:"radio",name:"tagMode",value:"instance",checked:"instance"===m,onChange:e=>h(e.target.value)}),(0,i.jsx)(l.In,{icon:"mdi:pin",width:"18"}),(0,i.jsxs)("div",{className:"tag-mode-text",children:[(0,i.jsx)("span",{className:"tag-mode-title",children:"This Output"}),(0,i.jsx)("span",{className:"tag-mode-desc",children:"Tag this specific version"})]})]}),(0,i.jsxs)("label",{className:"tag-mode-option ".concat("dynamic"===m?"active":""),children:[(0,i.jsx)("input",{type:"radio",name:"tagMode",value:"dynamic",checked:"dynamic"===m,onChange:e=>h(e.target.value)}),(0,i.jsx)(l.In,{icon:"mdi:refresh-auto",width:"18"}),(0,i.jsxs)("div",{className:"tag-mode-text",children:[(0,i.jsx)("span",{className:"tag-mode-title",children:"Latest Output"}),(0,i.jsx)("span",{className:"tag-mode-desc",children:"Auto-updates to newest"})]})]})]})]}),(0,i.jsxs)("div",{className:"tag-selection-section",children:[(0,i.jsx)("label",{className:"tag-section-label",children:f?"New Tag":"Select Tag"}),f?(0,i.jsxs)("div",{className:"tag-create-controls",children:[(0,i.jsxs)("div",{className:"tag-create-row",children:[(0,i.jsx)("input",{type:"text",className:"tag-name-input",placeholder:"Tag name...",value:x,onChange:e=>g(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),S())},autoFocus:!0}),(0,i.jsx)("button",{type:"button",className:"tag-cancel-new-btn",onClick:()=>{y(!1),g("")},children:(0,i.jsx)(l.In,{icon:"mdi:close",width:"16"})})]}),(0,i.jsx)("div",{className:"tag-color-picker",children:q.map(e=>(0,i.jsx)("button",{type:"button",className:"tag-color-swatch ".concat(j===e?"active":""),style:{"--swatch-color":e},onClick:()=>v(e)},e))})]}):(0,i.jsxs)("div",{className:"tag-selection-controls",children:[(0,i.jsxs)("select",{className:"tag-select",value:u,onChange:e=>p(e.target.value),children:[(0,i.jsx)("option",{value:"",children:"Choose a tag..."}),r.map(e=>(0,i.jsxs)("option",{value:e.tag_name,children:[e.tag_name," (",e.count,")"]},e.tag_name))]}),(0,i.jsxs)("button",{type:"button",className:"tag-new-btn",onClick:()=>y(!0),children:[(0,i.jsx)(l.In,{icon:"mdi:plus",width:"16"}),"New"]})]})]}),(0,i.jsxs)("div",{className:"tag-note-section",children:[(0,i.jsx)("label",{className:"tag-section-label",children:"Note (optional)"}),(0,i.jsx)("textarea",{className:"tag-note-input",placeholder:"Why are you tagging this output?",value:N,onChange:e=>w(e.target.value),rows:2})]}),C&&(0,i.jsxs)("div",{className:"tag-error",children:[(0,i.jsx)(l.In,{icon:"mdi:alert-circle",width:"16"}),(0,i.jsx)("span",{children:C})]})]}),(0,i.jsxs)(F.jl,{children:[(0,i.jsx)("button",{type:"button",className:"tag-modal-btn tag-modal-btn-secondary",onClick:t,disabled:b,children:"Cancel"}),(0,i.jsx)("button",{type:"button",className:"tag-modal-btn tag-modal-btn-primary",onClick:S,disabled:b||!u&&!x.trim(),children:b?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(l.In,{icon:"mdi:loading",className:"spinning",width:"16"}),"Adding..."]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(l.In,{icon:"mdi:tag-plus",width:"16"}),"Add Tag"]})})]})]})},W=e=>{let{tagName:s,tagColor:t="#a78bfa",tagMode:a,removable:c=!1,onRemove:n,size:r="md",clickable:o=!1,onClick:d}=e;return(0,i.jsxs)("span",{className:"tag-chip tag-chip-".concat(r," ").concat(o?"tag-chip-clickable":""),style:{"--tag-color":t},onClick:()=>{o&&d&&d()},children:[(0,i.jsx)("span",{className:"tag-chip-dot"}),(0,i.jsx)("span",{className:"tag-chip-name",children:s}),"dynamic"===a&&(0,i.jsx)(l.In,{icon:"mdi:refresh-auto",className:"tag-chip-dynamic-icon",title:"Dynamic - auto-updates to latest"}),c&&(0,i.jsx)("button",{type:"button",className:"tag-chip-remove",onClick:e=>{e.stopPropagation(),n&&n()},title:"Remove tag",children:(0,i.jsx)(l.In,{icon:"mdi:close"})})]})},M=e=>{let{tags:s=[],removable:t=!1,onRemove:a,size:l="md",emptyMessage:c}=e;return 0===s.length&&c?(0,i.jsx)("span",{className:"tag-chip-list-empty",children:c}):(0,i.jsx)("div",{className:"tag-chip-list",children:s.map(e=>(0,i.jsx)(W,{tagName:e.tag_name,tagColor:e.tag_color,tagMode:e.tag_mode,removable:t,onRemove:a?()=>a(e.tag_id):void 0,size:l},e.tag_id||e.tag_name))})},A=e=>e?e.includes(":")?e.split(":")[0]:e:"text",R=e=>e&&e.startsWith("tool_call:")?e.split(":")[1]:null,L=e=>{switch(A(e)){case"image":return"mdi:image";case"chart":return"mdi:chart-line";case"table":return"mdi:table";case"markdown":return"mdi:language-markdown";case"json":return"mdi:code-json";case"tool_call":return"mdi:tools";case"render":return"mdi:monitor-screenshot";case"error":return"mdi:alert-circle";default:return"mdi:text"}},P=e=>{if(!e)return null;if("object"===typeof e&&e.tool)return e;if("string"===typeof e){let t=e;if(t.startsWith('"')&&t.endsWith('"'))try{t=JSON.parse(t)}catch(s){}const a=t.match(/```(?:json)?\s*\n?(\{[\s\S]*?\})\s*\n?```/);if(a)try{const e=JSON.parse(a[1]);if(e.tool)return e}catch(s){}try{const e=JSON.parse(t);if(e.tool)return e;if("string"===typeof e)return P(e)}catch(s){}const l=t.match(/\{[^{}]*"tool"\s*:\s*"[^"]+"\s*,\s*"arguments"\s*:\s*\{[\s\S]*?\}\s*\}/);if(l)try{const e=JSON.parse(l[0]);if(e.tool)return e}catch(s){}}return null},$=e=>{if(!e)return"";return new Date(e).toLocaleString()},z=e=>{let{content:s,contentType:t}=e;const a=P(s),c=R(t)||(null===a||void 0===a?void 0:a.tool);if("request_decision"===c&&a){const e=(e=>{if(null===e||void 0===e||!e.arguments)return null;const s=e.arguments,t=[];return s.context&&t.push({type:"text",content:s.context,style:"muted"}),s.question&&t.push({type:"header",text:s.question,level:3}),s.options&&s.options.length>0&&t.push({type:"choice",label:"Options",options:s.options.map(e=>({value:e.id||e.label,label:e.label,description:e.description}))}),{title:"Human Decision Request",sections:t}})(a);if(e)return(0,i.jsxs)("div",{className:"cell-detail-request-decision",children:[(0,i.jsxs)("div",{className:"request-decision-header",children:[(0,i.jsx)(l.In,{icon:"mdi:account-question",width:"20"}),(0,i.jsx)("span",{children:"Human Decision Request"})]}),(0,i.jsx)(E.A,{spec:e,onSubmit:()=>{},isLoading:!1}),(0,i.jsxs)("div",{className:"request-decision-note",children:[(0,i.jsx)(l.In,{icon:"mdi:information-outline",width:"14"}),(0,i.jsx)("span",{children:"This is a historical view of the decision request"})]})]})}return a?(0,i.jsxs)("div",{className:"cell-detail-tool-call",children:[(0,i.jsxs)("div",{className:"tool-call-header",children:[(0,i.jsx)(l.In,{icon:"mdi:tools",width:"16"}),(0,i.jsx)("span",{className:"tool-name",children:c||a.tool})]}),(0,i.jsxs)("div",{className:"tool-call-arguments",children:[(0,i.jsx)("div",{className:"arguments-label",children:"Arguments:"}),(0,i.jsx)("pre",{children:JSON.stringify(a.arguments,null,2)})]})]}):(0,i.jsx)("div",{className:"cell-detail-json",children:(0,i.jsx)("pre",{children:"string"===typeof s?s:JSON.stringify(s,null,2)})})},V=e=>{let{content:s,contentType:t,images:a,metadata:c,renderData:r}=e;const o=A(t);if(a&&a.length>0)return(0,i.jsx)("div",{className:"cell-detail-images",children:a.map((e,s)=>(0,i.jsx)("img",{src:"string"===typeof e?"".concat(n.J).concat(e):e.url,alt:"Output ".concat(s+1),className:"cell-detail-image"},s))});if("tool_call:request_decision"===t&&null!==r&&void 0!==r&&r.ui_spec){const e=r.ui_spec,s=r.screenshot_url,t=r.checkpoint_id;return(0,i.jsxs)("div",{className:"cell-detail-request-decision",children:[(0,i.jsxs)("div",{className:"request-decision-header",children:[(0,i.jsx)(l.In,{icon:"mdi:account-question",width:"20"}),(0,i.jsx)("span",{children:"Human Decision Request"}),t&&(0,i.jsx)("span",{className:"checkpoint-id-badge",children:t.slice(0,8)})]}),s&&(0,i.jsx)("div",{className:"request-decision-screenshot",children:(0,i.jsx)("img",{src:"".concat(n.J).concat(s),alt:"Decision UI Preview",className:"screenshot-preview",onError:e=>{e.target.style.display="none"}})}),e&&"object"===typeof e?(0,i.jsx)(E.A,{spec:e,onSubmit:()=>{},isLoading:!1}):(0,i.jsx)("div",{className:"cell-detail-json",children:(0,i.jsx)("pre",{children:JSON.stringify(e,null,2)})}),(0,i.jsxs)("div",{className:"request-decision-note",children:[(0,i.jsx)(l.In,{icon:"mdi:information-outline",width:"14"}),(0,i.jsx)("span",{children:"This is a historical view of the decision request"})]})]})}if("render:request_decision"===t){let e=s;if("string"===typeof s)try{e=JSON.parse(s)}catch(d){}const t=null===c||void 0===c?void 0:c.screenshot_url;return(0,i.jsxs)("div",{className:"cell-detail-request-decision",children:[(0,i.jsxs)("div",{className:"request-decision-header",children:[(0,i.jsx)(l.In,{icon:"mdi:account-question",width:"20"}),(0,i.jsx)("span",{children:"Human Decision Request"}),(null===c||void 0===c?void 0:c.checkpoint_id)&&(0,i.jsx)("span",{className:"checkpoint-id-badge",children:c.checkpoint_id.slice(0,8)})]}),t&&(0,i.jsx)("div",{className:"request-decision-screenshot",children:(0,i.jsx)("img",{src:"".concat(n.J).concat(t),alt:"Decision UI Preview",className:"screenshot-preview",onError:e=>{e.target.style.display="none"}})}),e&&"object"===typeof e?(0,i.jsx)(E.A,{spec:e,onSubmit:()=>{},isLoading:!1}):(0,i.jsx)("div",{className:"cell-detail-json",children:(0,i.jsx)("pre",{children:"string"===typeof s?s:JSON.stringify(s,null,2)})}),(0,i.jsxs)("div",{className:"request-decision-note",children:[(0,i.jsx)(l.In,{icon:"mdi:information-outline",width:"14"}),(0,i.jsx)("span",{children:"This is a historical view of the decision request"})]})]})}return"tool_call"===o?(0,i.jsx)(z,{content:s,contentType:t}):"string"===typeof s?"markdown"===t||s.includes("#")||s.includes("**")||s.includes("```")?(0,i.jsx)("div",{className:"cell-detail-markdown",children:(0,i.jsx)(J.A,{children:s})}):(0,i.jsx)("div",{className:"cell-detail-text",children:(0,i.jsx)("pre",{children:s})}):"object"===typeof s&&null!==s?s.rows&&s.columns?(0,i.jsxs)("div",{className:"cell-detail-table",children:[(0,i.jsxs)("div",{className:"table-meta",children:[s.rows.length," rows \xd7 ",s.columns.length," columns"]}),(0,i.jsxs)("div",{className:"table-scroll",children:[(0,i.jsxs)("table",{children:[(0,i.jsx)("thead",{children:(0,i.jsx)("tr",{children:s.columns.map((e,s)=>(0,i.jsx)("th",{children:e},s))})}),(0,i.jsx)("tbody",{children:s.rows.slice(0,50).map((e,t)=>(0,i.jsx)("tr",{children:Array.isArray(e)?e.map((e,s)=>(0,i.jsx)("td",{children:String(e)},s)):s.columns.map((s,t)=>{var a;return(0,i.jsx)("td",{children:String(null!==(a=e[s])&&void 0!==a?a:"")},t)})},t))})]}),s.rows.length>50&&(0,i.jsxs)("div",{className:"table-truncated",children:["Showing 50 of ",s.rows.length," rows"]})]})]}):(0,i.jsx)("div",{className:"cell-detail-json",children:(0,i.jsx)("pre",{children:JSON.stringify(s,null,2)})}):(0,i.jsxs)("div",{className:"cell-detail-empty",children:[(0,i.jsx)(l.In,{icon:"mdi:file-question",width:"32"}),(0,i.jsx)("span",{children:"No content to display"})]})},H=e=>{let{isOpen:s,onClose:t,cellDetail:c,loading:r,siblingCount:o=1,currentIndex:d=0,onNavigate:m,availableTags:h=[],onRefreshTags:u}=e;const p=(0,_.Zp)(),[x,g]=(0,a.useState)(!1),[j,v]=(0,a.useState)([]),N=(0,a.useCallback)(async()=>{if(null!==c&&void 0!==c&&c.message_id)try{const e=await fetch("".concat(n.J,"/api/outputs/tags/for/").concat(c.message_id)),s=await e.json();s.tags&&v(s.tags)}catch(e){console.error("[CellDetailModal] Error fetching tags:",e)}else v([])},[null===c||void 0===c?void 0:c.message_id]);(0,a.useEffect)(()=>{s&&null!==c&&void 0!==c&&c.message_id&&N()},[s,null===c||void 0===c?void 0:c.message_id,N]),(0,a.useEffect)(()=>{s||(v([]),g(!1))},[s]);if(!s)return null;const w=o>1,f=d>0,y=d<o-1,b=(0,i.jsxs)("div",{className:"cell-detail-overlay",onClick:e=>{e.target===e.currentTarget&&t()},children:[(0,i.jsxs)("div",{className:"cell-detail-modal",children:[(0,i.jsxs)("div",{className:"cell-detail-header",children:[(0,i.jsx)("div",{className:"cell-detail-header-left",children:c&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(l.In,{icon:L(c.content_type),width:"18",className:"header-type-icon ".concat("tool_call"===A(c.content_type)?"tool-call":"")}),(0,i.jsx)("span",{className:"header-cell-name",children:c.cell_name}),R(c.content_type)&&(0,i.jsx)("span",{className:"header-tool-badge",children:R(c.content_type).replace(/_/g," ")}),(0,i.jsx)("span",{className:"header-separator",children:"\u2022"}),(0,i.jsx)("span",{className:"header-cascade",children:c.cascade_id})]})}),w&&(0,i.jsxs)("div",{className:"cell-detail-nav",children:[(0,i.jsx)("button",{className:"nav-btn",onClick:()=>m("prev"),disabled:!f,title:"Previous output",children:(0,i.jsx)(l.In,{icon:"mdi:chevron-left",width:"20"})}),(0,i.jsxs)("span",{className:"nav-counter",children:[d+1," / ",o]}),(0,i.jsx)("button",{className:"nav-btn",onClick:()=>m("next"),disabled:!y,title:"Next output",children:(0,i.jsx)(l.In,{icon:"mdi:chevron-right",width:"20"})})]}),(0,i.jsx)("button",{className:"cell-detail-close",onClick:t,children:(0,i.jsx)(l.In,{icon:"mdi:close",width:"20"})})]}),c&&(0,i.jsxs)("div",{className:"cell-detail-meta",children:[(0,i.jsx)("span",{className:"meta-session",children:c.session_id}),(0,i.jsx)("span",{className:"meta-separator",children:"\u2022"}),(0,i.jsx)("span",{className:"meta-time",children:$(c.timestamp)}),(0,i.jsx)("span",{className:"meta-separator",children:"\u2022"}),(0,i.jsx)("span",{className:"meta-cost",children:(k=c.cost,k&&0!==k?"$".concat(k<.01?k.toFixed(4):k.toFixed(2)):"$0.00")}),c.model&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("span",{className:"meta-separator",children:"\u2022"}),(0,i.jsx)("span",{className:"meta-model",children:c.model})]})]}),(0,i.jsx)("div",{className:"cell-detail-content",children:r?(0,i.jsxs)("div",{className:"cell-detail-loading",children:[(0,i.jsx)(l.In,{icon:"mdi:loading",className:"spinning",width:"24"}),(0,i.jsx)("span",{children:"Loading content..."})]}):c?(0,i.jsx)(V,{content:c.content,contentType:c.content_type,images:c.images,metadata:c.metadata,renderData:c.render_data}):(0,i.jsxs)("div",{className:"cell-detail-empty",children:[(0,i.jsx)(l.In,{icon:"mdi:file-question",width:"32"}),(0,i.jsx)("span",{children:"No content available"})]})}),j.length>0&&(0,i.jsx)("div",{className:"cell-detail-tags",children:(0,i.jsx)(M,{tags:j,removable:!0,onRemove:async e=>{try{(await fetch("".concat(n.J,"/api/outputs/tags/").concat(e),{method:"DELETE"})).ok&&(N(),u&&u())}catch(s){console.error("[CellDetailModal] Error removing tag:",s)}},size:"md"})}),(0,i.jsxs)("div",{className:"cell-detail-actions",children:[(0,i.jsxs)("button",{className:"action-btn action-secondary",onClick:async()=>{if(null!==c&&void 0!==c&&c.content)try{const e="string"===typeof c.content?c.content:JSON.stringify(c.content,null,2);await navigator.clipboard.writeText(e)}catch(e){console.error("Failed to copy:",e)}},children:[(0,i.jsx)(l.In,{icon:"mdi:content-copy",width:"16"}),"Copy"]}),(0,i.jsxs)("button",{className:"action-btn action-secondary",onClick:()=>{c&&(p(C.bw.studioWithSession(c.cascade_id,c.session_id)),t())},children:[(0,i.jsx)(l.In,{icon:"mdi:open-in-new",width:"16"}),"Open in Studio"]}),(0,i.jsxs)("button",{className:"action-btn action-primary",onClick:()=>g(!0),children:[(0,i.jsx)(l.In,{icon:"mdi:tag-plus",width:"16"}),"Tag"]})]})]}),(0,i.jsx)(D,{isOpen:x,onClose:()=>g(!1),outputInfo:c?{message_id:c.message_id,cascade_id:c.cascade_id,cell_name:c.cell_name}:null,availableTags:h,onTagAdded:()=>{N(),u&&u()},onRefreshTags:u})]});var k;return(0,O.createPortal)(b,document.body)},U=e=>{switch((null===e||void 0===e?void 0:e.split(":")[0])||e){case"image":return"mdi:image";case"chart":return"mdi:chart-line";case"table":return"mdi:table";case"tool_call":return"mdi:tools";case"markdown":return"mdi:language-markdown";case"json":return"mdi:code-json";case"error":return"mdi:alert-circle";default:return"mdi:text"}},K=e=>{switch((null===e||void 0===e?void 0:e.split(":")[0])||e){case"image":return"var(--color-accent-pink)";case"chart":return"var(--color-accent-green)";case"table":return"var(--color-accent-yellow)";case"tool_call":return"var(--color-accent-orange)";case"markdown":return"var(--color-accent-purple)";case"json":return"var(--color-accent-blue)";case"error":return"var(--color-error)";default:return"var(--color-accent-cyan)"}},Z=e=>{let{selectedTags:s=[],onCellClick:t}=e;const[r,o]=(0,a.useState)([]),[d,m]=(0,a.useState)(!0),[h,u]=(0,a.useState)(null),p=(0,a.useCallback)(async()=>{m(!0),u(null);try{const e=s.length>0?"?tags=".concat(s.join(",")):"",t=await fetch("".concat(n.J,"/api/outputs/tagged").concat(e)),a=await t.json();if(a.error)throw new Error(a.error);o(a.tags||[])}catch(e){console.error("[TaggedView] Error fetching tagged data:",e),u(e.message)}finally{m(!1)}},[s]);return(0,a.useEffect)(()=>{p()},[p]),d?(0,i.jsx)(c.lp,{size:"medium",message:"Loading tagged outputs...",className:"video-loader--flex"}):h?(0,i.jsxs)("div",{className:"tagged-view-error",children:[(0,i.jsx)(l.In,{icon:"mdi:alert-circle",width:"32"}),(0,i.jsx)("h3",{children:"Error loading tagged outputs"}),(0,i.jsx)("p",{children:h}),(0,i.jsxs)("button",{onClick:p,children:[(0,i.jsx)(l.In,{icon:"mdi:refresh",width:"16"}),"Retry"]})]}):0===r.length?(0,i.jsxs)("div",{className:"tagged-view-empty",children:[(0,i.jsx)(l.In,{icon:"mdi:tag-off-outline",width:"48"}),(0,i.jsx)("h3",{children:"No tagged outputs"}),(0,i.jsx)("p",{children:s.length>0?"No outputs match the selected tags":"Tag some outputs to see them here"})]}):(0,i.jsx)("div",{className:"tagged-view",children:r.map(e=>(0,i.jsxs)("div",{className:"tag-group",children:[(0,i.jsxs)("div",{className:"tag-group-header",style:{"--tag-color":e.tag_color},children:[(0,i.jsx)("div",{className:"tag-color-bar"}),(0,i.jsx)(l.In,{icon:"mdi:tag",className:"tag-group-icon",width:"16"}),(0,i.jsx)("h3",{children:e.tag_name}),(0,i.jsxs)("span",{className:"tag-group-count",children:[e.outputs.length," output",1!==e.outputs.length?"s":""]}),e.description&&(0,i.jsx)("span",{className:"tag-group-description",children:e.description})]}),(0,i.jsx)("div",{className:"tag-group-outputs",children:e.outputs.map(e=>{var s;return(0,i.jsxs)("div",{className:"tagged-output-card",style:{"--type-color":K(e.content_type)},onClick:()=>t(e.message_id,[]),children:[(0,i.jsx)("div",{className:"tagged-output-preview",children:"image"===e.content_type&&null!==(s=e.images)&&void 0!==s&&s[0]?(0,i.jsx)("img",{src:"".concat(n.J).concat(e.images[0]),alt:e.cell_name}):"chart"===e.content_type?(0,i.jsxs)("div",{className:"preview-chart",children:[(0,i.jsx)(l.In,{icon:"mdi:chart-line",width:"64"}),(0,i.jsx)("span",{children:"Chart"})]}):"table"===e.content_type?(0,i.jsxs)("div",{className:"preview-table",children:[(0,i.jsx)(l.In,{icon:"mdi:table",width:"64"}),(0,i.jsx)("span",{children:e.preview})]}):(0,i.jsxs)("div",{className:"preview-text",children:[(0,i.jsx)(l.In,{icon:U(e.content_type),width:"24"}),(0,i.jsx)("span",{children:e.preview||"No preview"})]})}),(0,i.jsxs)("div",{className:"tagged-output-footer",children:[(0,i.jsxs)("div",{className:"tagged-output-info",children:[(0,i.jsx)("span",{className:"cascade-name",children:e.cascade_id}),(0,i.jsx)("span",{className:"cell-name",children:e.cell_name})]}),(0,i.jsxs)("div",{className:"tagged-output-meta",children:["dynamic"===e.tag_mode&&(0,i.jsx)("span",{className:"dynamic-badge",title:"Dynamic - auto-updates to latest",children:(0,i.jsx)(l.In,{icon:"mdi:refresh-auto",width:"12"})}),(0,i.jsx)("span",{className:"type-badge",style:{"--type-color":K(e.content_type)},children:(0,i.jsx)(l.In,{icon:U(e.content_type),width:"12"})})]})]}),e.note&&(0,i.jsx)("div",{className:"tagged-output-note",title:e.note,children:(0,i.jsx)(l.In,{icon:"mdi:note-text",width:"12"})})]},e.message_id)})})]},e.tag_name))})},Q="lars-outputs-filters",X=()=>{const[e,s]=(0,a.useState)([]),[t,r]=(0,a.useState)([]),[o,m]=(0,a.useState)(!0),[h,u]=(0,a.useState)(null),p=(0,a.useMemo)(()=>(()=>{try{const e=localStorage.getItem(Q);if(e)return JSON.parse(e)}catch(e){console.warn("[OutputsView] Error loading filters from storage:",e)}return null})(),[]),[x,g]=(0,a.useState)((null===p||void 0===p?void 0:p.timeFilter)||"all"),[j,v]=(0,a.useState)((null===p||void 0===p?void 0:p.selectedCascades)||[]),[N,w]=(0,a.useState)((null===p||void 0===p?void 0:p.selectedTags)||[]),[f,y]=(0,a.useState)((null===p||void 0===p?void 0:p.selectedContentTypes)||[]),[b,_]=(0,a.useState)([]),[C,k]=(0,a.useState)("swimlanes");(0,a.useEffect)(()=>{(e=>{try{localStorage.setItem(Q,JSON.stringify(e))}catch(s){console.warn("[OutputsView] Error saving filters to storage:",s)}})({timeFilter:x,selectedCascades:j,selectedTags:N,selectedContentTypes:f})},[x,j,N,f]);const S=(0,a.useCallback)(async()=>{try{const e=await fetch("".concat(n.J,"/api/outputs/tags")),s=await e.json();s.tags&&_(s.tags)}catch(e){console.error("[OutputsView] Error fetching tags:",e)}},[]);(0,a.useEffect)(()=>{S()},[S]);const[I,O]=(0,a.useState)(null),[J,E]=(0,a.useState)(null),[F,q]=(0,a.useState)(!1),[D,W]=(0,a.useState)(null),[M,A]=(0,a.useState)(null),[R,L]=(0,a.useState)(!1),[P,$]=(0,a.useState)([]),[z,V]=(0,a.useState)(0),U=(0,a.useCallback)(async()=>{m(!0),u(null);try{const e=new URLSearchParams;e.set("time_filter",x),j.length>0&&e.set("cascade_ids",j.join(",")),f.length>0&&e.set("content_types",f.join(","));const t=await fetch("".concat(n.J,"/api/outputs/swimlanes?").concat(e)),a=await t.json();if(a.error)throw new Error(a.error);s(a.cascades||[])}catch(e){console.error("[OutputsView] Fetch error:",e),u(e.message)}finally{m(!1)}},[x,j,f]);(0,a.useEffect)(()=>{U()},[U]),(0,a.useEffect)(()=>{(async()=>{try{const e=await fetch("".concat(n.J,"/api/outputs/cascade-ids")),s=await e.json();s.cascade_ids&&r(s.cascade_ids.map(e=>e.cascade_id))}catch(e){console.error("[OutputsView] Error fetching all cascade IDs:",e)}})()},[]);const K=(0,a.useCallback)(async e=>{if(e){q(!0);try{const s=await fetch("".concat(n.J,"/api/outputs/cascade/").concat(e,"/runs?limit=50")),t=await s.json();if(t.error)throw new Error(t.error);E(t)}catch(s){console.error("[OutputsView] Fetch expanded error:",s)}finally{q(!1)}}},[]),X=(0,a.useCallback)(e=>{I===e?(O(null),E(null)):(O(e),K(e))},[I,K]),B=(0,a.useCallback)(async e=>{L(!0);try{const s=await fetch("".concat(n.J,"/api/outputs/cell/").concat(e)),t=await s.json();if(t.error)throw new Error(t.error);A(t)}catch(s){console.error("[OutputsView] Fetch cell detail error:",s)}finally{L(!1)}},[]),G=(0,a.useCallback)(async function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[e];W(e),$(s),V(s.indexOf(e)),B(e)},[B]),Y=(0,a.useCallback)(e=>{if(P.length<=1)return;const s="next"===e?Math.min(z+1,P.length-1):Math.max(z-1,0);if(s!==z){const e=P[s];V(s),W(e),B(e)}},[P,z,B]),ee=(0,a.useCallback)(()=>{W(null),A(null),$([]),V(0)},[]),se=(0,a.useCallback)(e=>{g(e),O(null),E(null)},[]);return o&&0===e.length?(0,i.jsx)("div",{className:"outputs-view",children:(0,i.jsx)(c.lp,{size:"medium",message:"Loading outputs...",className:"video-loader--flex"})}):h&&0===e.length?(0,i.jsx)("div",{className:"outputs-view",children:(0,i.jsxs)("div",{className:"outputs-error",children:[(0,i.jsx)(l.In,{icon:"mdi:alert-circle",width:"32"}),(0,i.jsx)("h3",{children:"Error loading outputs"}),(0,i.jsx)("p",{children:h}),(0,i.jsxs)("button",{className:"outputs-retry-btn",onClick:U,children:[(0,i.jsx)(l.In,{icon:"mdi:refresh",width:"16"}),"Retry"]})]})}):(0,i.jsxs)("div",{className:"outputs-view",children:[(0,i.jsxs)("div",{className:"outputs-header",children:[(0,i.jsxs)("div",{className:"outputs-header-left",children:[(0,i.jsx)(l.In,{icon:"mdi:folder-multiple-image",width:"22"}),(0,i.jsx)("h1",{children:"Outputs"}),(0,i.jsxs)("div",{className:"outputs-tabs",children:[(0,i.jsxs)("button",{className:"outputs-tab ".concat("swimlanes"===C?"active":""),onClick:()=>k("swimlanes"),children:[(0,i.jsx)(l.In,{icon:"mdi:view-dashboard-outline",width:"14"}),"Swimlanes"]}),(0,i.jsxs)("button",{className:"outputs-tab ".concat("tagged"===C?"active":""),onClick:()=>k("tagged"),children:[(0,i.jsx)(l.In,{icon:"mdi:tag-multiple",width:"14"}),"Tagged"]})]})]}),(0,i.jsx)("div",{className:"outputs-header-right",children:(0,i.jsx)("button",{className:"outputs-refresh-btn",onClick:()=>{U(),S()},disabled:o,children:(0,i.jsx)(l.In,{icon:o?"mdi:loading":"mdi:refresh",width:"16",className:o?"spinning":""})})})]}),(0,i.jsxs)("div",{className:"outputs-layout",children:[(0,i.jsx)(d,{timeFilter:x,onTimeFilterChange:se,allCascadeIds:t,selectedCascades:j,onSelectedCascadesChange:v,selectedTags:N,onSelectedTagsChange:w,availableTags:b,selectedContentTypes:f,onSelectedContentTypesChange:y}),"swimlanes"===C?(0,i.jsx)("div",{className:"outputs-swimlanes",children:0===e.length?(0,i.jsxs)("div",{className:"outputs-empty",children:[(0,i.jsx)(l.In,{icon:"mdi:inbox-outline",width:"48"}),(0,i.jsx)("h3",{children:"No outputs found"}),(0,i.jsx)("p",{children:f.length>0||j.length>0?"No cascades match the selected filters":"Run some cascades to see their outputs here"})]}):e.map(e=>(0,i.jsx)(T,{cascade:e,isExpanded:I===e.cascade_id,expandedData:I===e.cascade_id?J:null,expandedLoading:I===e.cascade_id&&F,onToggleExpand:()=>X(e.cascade_id),onCellClick:G},e.cascade_id))}):(0,i.jsx)(Z,{selectedTags:N,onCellClick:G})]}),(0,i.jsx)(H,{isOpen:!!D,onClose:ee,cellDetail:M,loading:R,siblingCount:P.length,currentIndex:z,onNavigate:Y,availableTags:b,onRefreshTags:S})]})}}}]);
//# sourceMappingURL=658.ebb6977e.chunk.js.map