"use strict";(self.webpackChunklars_ui=self.webpackChunklars_ui||[]).push([[794],{24818:(e,s,t)=>{t.d(s,{D:()=>l});var n=t(89379),a=t(65043);function l(e){let s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const[t,l]=(0,a.useState)({budgetConfig:null,events:[],usageHistory:[],totalEnforcements:0,totalPruned:0,currentUsage:null,loading:!0,error:null}),o=(0,a.useRef)(null),c=(0,a.useRef)(0),i=(0,a.useCallback)(async()=>{if(!e||"null"===e||"undefined"===e||""===e)return null;try{const s=await fetch("/api/budget/".concat(e));if(!s.ok)throw new Error("Failed to fetch budget data: ".concat(s.status));return await s.json()}catch(s){throw console.error("Budget data fetch failed:",s),s}},[e]);return(0,a.useEffect)(()=>{if(!e||"null"===e||"undefined"===e||""===e)return void l({budgetConfig:null,events:[],usageHistory:[],totalEnforcements:0,totalPruned:0,currentUsage:null,loading:!1,error:null});let t=!0;c.current=0;const a=async()=>{try{const e=await i();if(!t)return;if(!e)return void l(e=>(0,n.A)((0,n.A)({},e),{},{loading:!1}));const s={budgetConfig:e.budget_config,events:e.enforcement_events||[],usageHistory:e.usage_history||[],totalEnforcements:e.total_enforcements||0,totalPruned:e.total_tokens_pruned||0,currentUsage:e.current_usage,loading:!1,error:null};l(s)}catch(e){console.error("[useBudgetData] Fetch error:",e),t&&l(s=>(0,n.A)((0,n.A)({},s),{},{loading:!1,error:e.message}))}};return a(),s&&(o.current=setInterval(()=>{c.current+=1,c.current>=300?o.current&&(clearInterval(o.current),o.current=null):a()},2e3)),()=>{t=!1,o.current&&(clearInterval(o.current),o.current=null)}},[e,s,i]),(0,a.useEffect)(()=>{!s&&o.current&&(clearInterval(o.current),o.current=null)},[s]),t}},60957:(e,s,t)=>{async function n(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"User requested cancellation",t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e)return{success:!1,error:"No session ID provided"};try{console.log("[cancelCascade] Requesting cancellation for:",e,{force:t});const n=await fetch("http://localhost:5050/api/cancel-cascade",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:e,reason:s,force:t})}),a=await n.json();return!n.ok||a.error?(console.error("[cancelCascade] Failed:",a.error),{success:!1,error:a.error||"HTTP ".concat(n.status)}):(console.log("[cancelCascade] Success:",a),a.verification&&console.log("[cancelCascade] DB Verification:",a.verification),a.verified_status&&"cancelled"!==a.verified_status&&console.warn("[cancelCascade] WARNING: Status in DB is",a.verified_status,'not "cancelled"'),{success:!0,forced:a.forced||!1,verified_status:a.verified_status,data:a})}catch(n){return console.error("[cancelCascade] Exception:",n),{success:!1,error:n.message}}}t.d(s,{tn:()=>n})},64745:(e,s,t)=>{t.d(s,{$B:()=>o,JJ:()=>c,TH:()=>n});const n="studio-dark";let a=!1;const l={base:"vs-dark",inherit:!0,rules:[{token:"key",foreground:"00e5ff"},{token:"key.json",foreground:"00e5ff"},{token:"string",foreground:"a78bfa"},{token:"string.yaml",foreground:"a78bfa"},{token:"string.json",foreground:"a78bfa"},{token:"string.sql",foreground:"a78bfa"},{token:"number",foreground:"34d399"},{token:"number.json",foreground:"34d399"},{token:"keyword",foreground:"f472b6"},{token:"keyword.sql",foreground:"f472b6"},{token:"predefined.sql",foreground:"00e5ff"},{token:"operator.sql",foreground:"cbd5e1"},{token:"keyword.python",foreground:"f472b6"},{token:"identifier.python",foreground:"cbd5e1"},{token:"keyword.js",foreground:"f472b6"},{token:"comment",foreground:"64748b",fontStyle:"italic"},{token:"type",foreground:"00e5ff"},{token:"delimiter.bracket",foreground:"fbbf24"}],colors:{"editor.background":"#050508","editor.foreground":"#cbd5e1","editor.lineHighlightBackground":"#0a0614","editor.selectionBackground":"#1a1628","editorLineNumber.foreground":"#64748b","editorLineNumber.activeForeground":"#cbd5e1","editorCursor.foreground":"#00e5ff","editor.inactiveSelectionBackground":"#0f0a1a","editorIndentGuide.background":"#1a1628","editorIndentGuide.activeBackground":"#2d2640","editorGutter.background":"#050508","minimap.background":"#050508","scrollbarSlider.background":"#1a162880","scrollbarSlider.hoverBackground":"#2d264080","scrollbarSlider.activeBackground":"#3d3650","editorWidget.background":"#0a0614","editorWidget.border":"#1a1628","editorSuggestWidget.background":"#0a0614","editorSuggestWidget.border":"#1a1628","editorSuggestWidget.selectedBackground":"#1a1628","editorHoverWidget.background":"#0a0614","editorHoverWidget.border":"#1a1628"}};function o(e){e.editor.defineTheme(n,l),a||"undefined"===typeof document||(a=!0,document.fonts.ready.then(()=>{document.fonts.check("12px 'Google Sans Code'")?e.editor.remeasureFonts():document.fonts.load("12px 'Google Sans Code'").then(()=>{e.editor.remeasureFonts()}).catch(()=>{console.warn("[Monaco] Google Sans Code font failed to load, using fallback")})}))}function c(e,s){"undefined"!==typeof document&&document.fonts&&document.fonts.ready.then(()=>{s.editor.remeasureFonts()})}},82172:(e,s,t)=>{t.d(s,{A:()=>m});var n=t(89379),a=t(65043),l=t(5748),o=t(70579);const c={assistant:"#a78bfa",user:"#34d399",system:"#fbbf24",tool:"#60a5fa",default:"#666666"};const i=function(e){var s,t,n;let{data:i,onMessageSelect:r,onHashSelect:d,onHashHover:m,selectedMessage:u=null,hoveredHash:h=null,compact:g=!1}=e;const p=(0,a.useRef)(null),x=(0,a.useRef)(null),[f,v]=(0,a.useState)(1),[b,j]=(0,a.useState)({x:0,y:0}),[y,k]=(0,a.useState)(null),[N,_]=(0,a.useState)(!1),[w,S]=(0,a.useState)({x:0,y:0}),[C,M]=(0,a.useState)(null),[I,T]=(0,a.useState)(null),[L,R]=(0,a.useState)("role"),[E,O]=(0,a.useState)(!1),A=(0,a.useCallback)((e,s)=>{if(!e||!s)return"#333333";const t=Math.min(e/s,1);if(t<.2){const e=t/.2;return"rgb(".concat(Math.round(30+30*e),", ").concat(Math.round(100+155*e),", ").concat(Math.round(200+55*e),")")}if(t<.4){const e=(t-.2)/.2;return"rgb(".concat(Math.round(60-10*e),", ").concat(Math.round(255-55*e),", ").concat(Math.round(255-155*e),")")}if(t<.6){const e=(t-.4)/.2;return"rgb(".concat(Math.round(50+205*e),", ").concat(Math.round(200+55*e),", ").concat(Math.round(100-50*e),")")}if(t<.8){const e=(t-.6)/.2;return"rgb(".concat(Math.round(255),", ").concat(Math.round(255-100*e),", ").concat(Math.round(50-50*e),")")}{const e=(t-.8)/.2;return"rgb(".concat(Math.round(255-30*e),", ").concat(Math.round(155-100*e),", ").concat(Math.round(0),")")}},[]),F=(0,a.useMemo)(()=>{if(null===i||void 0===i||!i.all_messages)return null;const e=i.all_messages.filter(e=>e.context_hashes&&e.context_hashes.length>0);if(0===e.length)return null;let s=null;null!==u&&void 0!==u&&u.message_id&&(s=e.findIndex(e=>e.message_id===u.message_id)),console.log("[ContextMatrix] Selected column mapping:",{selectedMessageId:null===u||void 0===u?void 0:u.message_id,selectedColumnIdx:s,llmCallsCount:e.length});const t={},n={};e.forEach((e,s)=>{e.context_hashes.forEach(e=>{if(!(e in t)){t[e]=s;const a=i.all_messages.find(s=>s.content_hash===e);n[e]=(null===a||void 0===a?void 0:a.role)||"default"}})});const a=Object.keys(t).sort((e,s)=>t[e]-t[s]),l=[];e.forEach((e,s)=>{const t=new Set(e.context_hashes);a.forEach((a,o)=>{t.has(a)&&l.push({msgIdx:s,hashIdx:o,hash:a,role:n[a]||"default",msgRole:e.role,cell:e.cell_name})})});const o={};let c=0;return a.forEach(e=>{const s=i.all_messages.find(s=>s.content_hash===e),t=(null===s||void 0===s?void 0:s.estimated_tokens)||0;t>c&&(c=t);const n=void 0!==(null===s||void 0===s?void 0:s._index)?s._index:i.all_messages.indexOf(s);o[e]={role:(null===s||void 0===s?void 0:s.role)||"unknown",cell:(null===s||void 0===s?void 0:s.cell_name)||"unknown",index:n,estimated_tokens:t,preview:"string"===typeof(null===s||void 0===s?void 0:s.content)?s.content.slice(0,300):JSON.stringify((null===s||void 0===s?void 0:s.content)||"").slice(0,300)}}),{llmCalls:e,uniqueHashes:a,cells:l,hashInfo:o,hashFirstSeen:t,hashRoles:n,maxTokens:c,selectedColumnIdx:s}},[i,u]),W=null!==(s=null===F||void 0===F?void 0:F.selectedColumnIdx)&&void 0!==s?s:C,H=6*f,P=30,D=50;(0,a.useEffect)(()=>{var e,s;if(!F||!p.current)return;const t=p.current,n=t.getContext("2d"),a=window.devicePixelRatio||1,l=(null===(e=x.current)||void 0===e?void 0:e.clientWidth)||800,o=(null===(s=x.current)||void 0===s?void 0:s.clientHeight)||600;t.width=l*a,t.height=o*a,t.style.width="".concat(l,"px"),t.style.height="".concat(o,"px"),n.scale(a,a),n.fillStyle="#050410",n.fillRect(0,0,l,o),n.fillStyle="#0a0818",n.fillRect(D,P,l-D,o-P),F.cells.forEach(e=>{let{msgIdx:s,hashIdx:t,role:a,hash:i}=e;const r=D+s*H+b.x,d=P+t*H+b.y;if(r<D-H||r>l||d<P-H||d>o)return;if("tokens"===L){var m;const e=(null===(m=F.hashInfo[i])||void 0===m?void 0:m.estimated_tokens)||0;n.fillStyle=A(e,F.maxTokens)}else n.fillStyle=c[a]||c.default;const u=W===s;n.globalAlpha=null===W||u?.85:.25,n.fillRect(r,d,H-1,H-1),n.globalAlpha=1}),n.fillStyle="#cbd5e1",n.font='bold 11px "Google Sans Code", monospace',n.textAlign="center";for(let c=0;c<F.llmCalls.length;c+=Math.max(1,Math.floor(10/f))){const e=D+c*H+b.x+H/2;e>D&&e<l&&n.fillText("".concat(c),e,24)}n.textAlign="right";const i=Math.max(1,Math.floor(15/f));for(let c=0;c<F.uniqueHashes.length;c+=i){const e=P+c*H+b.y+H/2+3;e>P&&e<o&&n.fillText("".concat(c),44,e)}if(null!==I){const e=P+I*H+b.y;n.strokeStyle="#a78bfa",n.lineWidth=2,n.strokeRect(D,e,l-D,H)}if(h&&F.uniqueHashes.includes(h)){const e=F.uniqueHashes.indexOf(h),s=P+e*H+b.y;n.strokeStyle="rgba(0, 229, 255, 0.6)",n.lineWidth=2,n.setLineDash([4,4]),n.strokeRect(D,s,l-D,H),n.setLineDash([])}if(y){n.strokeStyle="rgba(0, 229, 255, 0.5)",n.lineWidth=1,n.setLineDash([4,4]);const e=D+y.msgIdx*H+b.x+H/2;n.beginPath(),n.moveTo(e,P),n.lineTo(e,o),n.stroke();const s=P+y.hashIdx*H+b.y+H/2;n.beginPath(),n.moveTo(D,s),n.lineTo(l,s),n.stroke(),n.setLineDash([]),n.fillStyle="rgba(0, 229, 255, 0.3)",n.fillRect(D+y.msgIdx*H+b.x,P+y.hashIdx*H+b.y,H-1,H-1)}n.fillStyle="#94a3b8",n.font='11px "Google Sans", sans-serif',n.save(),n.translate(10,o/2),n.rotate(-Math.PI/2),n.textAlign="center",n.fillText("Context Items (hashes)",0,0),n.restore(),n.textAlign="center",n.fillText("LLM Calls (chronological)",D+(l-D)/2,14)},[F,f,b,y,W,I,H,L,A,h]);const B=(0,a.useCallback)(e=>{if(!F||!p.current)return;const s=p.current.getBoundingClientRect(),t=e.clientX-s.left,n=e.clientY-s.top;if(N)return O(!0),j(e=>({x:e.x+(t-w.x),y:e.y+(n-w.y)})),void S({x:t,y:n});if(t<D||n<P)return void k(null);const a=Math.floor((t-D-b.x)/H),l=Math.floor((n-P-b.y)/H);if(a>=0&&a<F.llmCalls.length&&l>=0&&l<F.uniqueHashes.length){var o;const e=F.uniqueHashes[l],s=F.llmCalls[a],t=null===(o=s.context_hashes)||void 0===o?void 0:o.includes(e);k({msgIdx:a,hashIdx:l,hash:e,msg:s,isInContext:t,hashInfo:F.hashInfo[e]}),m&&t&&m(e)}else k(null),m&&m(null)},[F,N,w,b,H,m]),z=(0,a.useCallback)(e=>{const s=p.current.getBoundingClientRect();_(!0),S({x:e.clientX-s.left,y:e.clientY-s.top})},[]),J=(0,a.useCallback)(()=>{_(!1)},[]),q=(0,a.useCallback)(e=>{if(y&&F)if(e.shiftKey){const e=C===y.msgIdx?null:y.msgIdx;M(e),r&&null!==e&&r(F.llmCalls[y.msgIdx])}else e.ctrlKey||e.metaKey?(T(e=>e===y.hashIdx?null:y.hashIdx),d&&d(y.hash,F.hashInfo[y.hash])):(M(y.msgIdx),r&&r(F.llmCalls[y.msgIdx]))},[y,F,C,r,d]);(0,a.useEffect)(()=>{const e=p.current;if(!e)return;const s=e=>{e.preventDefault(),e.stopPropagation(),O(!0);const s=e.deltaY>0?.9:1.1;v(e=>Math.max(.3,Math.min(5,e*s)))};return e.addEventListener("wheel",s,{passive:!1}),()=>e.removeEventListener("wheel",s)},[]);const U=(0,a.useCallback)(()=>{if(!F||!x.current)return;const e=x.current,s=e.clientWidth-D-20,t=e.clientHeight-P-20,n=F.llmCalls.length,a=F.uniqueHashes.length;if(0===n||0===a)return;const l=s/(6*n),o=t/(6*a),c=Math.min(l,o,5),i=Math.max(c,.3);v(i),j({x:0,y:0}),O(!1)},[F,D,P]);return(0,a.useCallback)(()=>{v(1),j({x:0,y:0}),M(null),T(null)},[]),(0,a.useEffect)(()=>{F&&x.current&&!E&&U()},[F,U,E]),(0,a.useEffect)(()=>{O(!1)},[null===i||void 0===i||null===(t=i.all_messages)||void 0===t?void 0:t.length]),F?(0,o.jsxs)("div",{className:"context-matrix-view ".concat(g?"compact":""),children:[!g&&(0,o.jsxs)("div",{className:"matrix-header",children:[(0,o.jsxs)("div",{className:"matrix-title",children:[(0,o.jsx)(l.In,{icon:"mdi:grid",width:"20"}),(0,o.jsx)("span",{children:"Context Matrix"})]}),(0,o.jsxs)("div",{className:"matrix-stats",children:[(0,o.jsxs)("span",{children:[F.llmCalls.length," LLM calls"]}),(0,o.jsxs)("span",{children:[F.uniqueHashes.length," unique contexts"]}),(0,o.jsxs)("span",{children:[F.cells.length," relationships"]})]})]}),(0,o.jsxs)("div",{className:"matrix-legend",children:[(0,o.jsxs)("div",{className:"color-mode-toggle",children:[(0,o.jsx)("button",{className:"mode-btn ".concat("role"===L?"active":""),onClick:()=>R("role"),"data-tooltip":"Color by message role",children:"Role"}),(0,o.jsx)("button",{className:"mode-btn ".concat("tokens"===L?"active":""),onClick:()=>R("tokens"),"data-tooltip":"Color by estimated tokens (heatmap)",children:"Tokens"})]}),(0,o.jsx)("div",{className:"legend-colors",children:"role"===L?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{className:"legend-dot",style:{background:c.system},title:"System"}),(0,o.jsx)("span",{className:"legend-dot",style:{background:c.user},title:"User"}),(0,o.jsx)("span",{className:"legend-dot",style:{background:c.assistant},title:"Assistant"}),(0,o.jsx)("span",{className:"legend-dot",style:{background:c.tool},title:"Tool"})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{className:"legend-dot",style:{background:"#1e64c8"},title:"Low"}),(0,o.jsx)("span",{className:"legend-dot",style:{background:"#32c8c8"}}),(0,o.jsx)("span",{className:"legend-dot",style:{background:"#50c850"},title:"Med"}),(0,o.jsx)("span",{className:"legend-dot",style:{background:"#ffff32"}}),(0,o.jsx)("span",{className:"legend-dot",style:{background:"#ff6432"},title:"High"}),(0,o.jsxs)("span",{className:"legend-token-max",children:[(null===(n=F.maxTokens)||void 0===n?void 0:n.toLocaleString())||0," tok"]})]})})]}),(0,o.jsx)("div",{className:"matrix-container",ref:x,children:(0,o.jsx)("canvas",{ref:p,onMouseMove:B,onMouseDown:z,onMouseUp:J,onMouseLeave:()=>{k(null),_(!1)},onClick:q,style:{cursor:N?"grabbing":"crosshair"}})})]}):(0,o.jsxs)("div",{className:"context-matrix-view empty",children:[(0,o.jsx)(l.In,{icon:"mdi:grid-off",width:"48"}),(0,o.jsx)("p",{children:"No context data available"}),(0,o.jsx)("p",{className:"hint",children:"Messages need context_hashes to build the matrix"})]})},r={assistant:"#a78bfa",user:"#34d399",system:"#fbbf24",tool:"#60a5fa",tool_call:"#60a5fa"},d=e=>{if(!e)return"";let s=e;if("object"===typeof s&&(s=JSON.stringify(s)),"string"===typeof s){try{const e=JSON.parse(s);s="string"===typeof e?e:JSON.stringify(e)}catch(t){}(s.startsWith('"')&&s.endsWith('"')||s.startsWith("'")&&s.endsWith("'"))&&(s=s.slice(1,-1)),s=s.replace(/\\n/g," ").replace(/\\t/g," ").replace(/\\r/g,"").replace(/\\"/g,'"').replace(/\\'/g,"'").replace(/\\\\/g,"\\").replace(/\s+/g," ").trim()}return s},m=e=>{var s,t;let{selectedMessage:c,allLogs:m,hoveredHash:u,onHoverHash:h,onClose:g,onNavigateToMessage:p,cascadeAnalytics:x,cellAnalytics:f,messageFilters:v}=e;const b=(0,a.useMemo)(()=>m?v&&v.winnersOnly?m.filter(e=>null===e.take_index||void 0===e.take_index||!0===e.is_winner):m:[],[m,v]),[j,y]=(0,a.useState)({}),[k,N]=(0,a.useState)(!1);(0,a.useEffect)(()=>{(async()=>{if(null!==c&&void 0!==c&&c.session_id&&null!==c&&void 0!==c&&c.cell_name){N(!0);try{const e="http://localhost:5050/api/receipts/context-breakdown?session_id=".concat(encodeURIComponent(c.session_id),"&cell_name=").concat(encodeURIComponent(c.cell_name)),s=await fetch(e);if(s.ok){const e=await s.json(),t={};e.messages&&e.messages.forEach(e=>{e.hash&&null!==e.relevance_score&&void 0!==e.relevance_score&&(t[e.hash]={score:e.relevance_score,reason:e.relevance_reason||null})}),y(t)}}catch(e){console.error("[ContextExplorer] Failed to fetch relevance scores:",e)}finally{N(!1)}}})()},[null===c||void 0===c?void 0:c.session_id,null===c||void 0===c?void 0:c.cell_name,null===c||void 0===c?void 0:c.content_hash]);const _=(0,a.useMemo)(()=>{if(!m)return{};const e={};return m.forEach((s,t)=>{s.content_hash&&(e[s.content_hash]||(e[s.content_hash]=[]),e[s.content_hash].push((0,n.A)((0,n.A)({},s),{},{_index:t})))}),e},[m]),w=(0,a.useMemo)(()=>{if(!b)return{};const e={};return b.forEach((s,t)=>{s.content_hash&&(e[s.content_hash]||(e[s.content_hash]=[]),e[s.content_hash].push((0,n.A)((0,n.A)({},s),{},{_index:t})))}),e},[b]),S=(0,a.useMemo)(()=>null!==c&&void 0!==c&&c.context_hashes&&_?c.context_hashes.map((e,s)=>{const t=(_[e]||[])[0];let n="";if(t){const e=t.content_json||t.content,s="string"===typeof e?e.slice(0,120):JSON.stringify(e).slice(0,120);n=d(s)}return{position:s,hash:e,role:(null===t||void 0===t?void 0:t.role)||"unknown",cell:(null===t||void 0===t?void 0:t.cell_name)||"unknown",index:null===t||void 0===t?void 0:t._index,estimated_tokens:(null===t||void 0===t?void 0:t.estimated_tokens)||0,content:(null===t||void 0===t?void 0:t.content_json)||(null===t||void 0===t?void 0:t.content),preview:n,hasMatch:!!t}}):[],[c,_]),C=(0,a.useMemo)(()=>null!==c&&void 0!==c&&c.content_hash&&b?b.filter(e=>{var s;return null===(s=e.context_hashes)||void 0===s?void 0:s.includes(c.content_hash)}).map((e,s)=>({_index:s,role:e.role,cell:e.cell_name,timestamp:e.timestamp,hasMatch:!0})):[],[c,b]),M=(0,a.useMemo)(()=>{var e;const s=S.reduce((e,s)=>e+(s.estimated_tokens||0),0),t=c.estimated_tokens||0,a=s+t,l=S.map(e=>(0,n.A)((0,n.A)({},e),{},{tokenPercentage:a>0?e.estimated_tokens/a*100:0})),o=[...l].sort((e,s)=>(s.estimated_tokens||0)-(e.estimated_tokens||0)),i=new Map;o.forEach((e,s)=>{i.set(e.hash,s+1)});const r=(null===(e=o[0])||void 0===e?void 0:e.estimated_tokens)||0,d=l.map(e=>(0,n.A)((0,n.A)({},e),{},{globalRank:i.get(e.hash),globalMaxTokens:r}));return{totalTokens:a,ancestorTokens:s,selectedTokens:t,selectedTokenPercentage:a>0?t/a*100:0,ancestorsWithPct:d,maxTokens:r}},[S,c]),I=c.cost||0,T=c.cell_name?null===f||void 0===f?void 0:f[c.cell_name]:null,L=(0,a.useMemo)(()=>{const e=[];if((null===x||void 0===x?void 0:x.context_cost_pct)>0){const s=x.context_cost_pct,t=s>70?"high":s>50?"medium":"low";e.push({type:"cascade_context",severity:t,label:"Session Context",value:"".concat(s.toFixed(0),"%"),detail:"".concat(s.toFixed(0),"% of session cost is context injection"),icon:"mdi:database-import"})}if((null===T||void 0===T?void 0:T.species_avg_cost)>0&&I>0){const s=I/T.species_avg_cost;if(Math.abs(s-1)>=.2){const t=s>=1.5?"high":s>=1.2?"medium":"low";e.push({type:"cost_comparison",severity:t,label:"vs Average",value:"".concat(s.toFixed(1),"x"),detail:"This call is ".concat(s.toFixed(1),"x the avg cost for this cell"),icon:s>1?"mdi:trending-up":"mdi:trending-down"})}}return null!==x&&void 0!==x&&x.is_cost_outlier&&e.push({type:"session_outlier",severity:"high",label:"Outlier",value:"\u26a0",detail:"This session is a statistical cost outlier",icon:"mdi:alert"}),e},[x,T,I]),R=(0,a.useMemo)(()=>{if(!m)return{wasteScore:0,wastedTokens:0,totalTokens:0,inputWaste:0,outputWaste:0,futureMessageCount:0};const e=c.timestamp||c.timestamp_iso,s=c.tokens_in||0,t=c.tokens_out||0,n=s+t,a=m.filter(s=>{var t;if(null===(t=s.context_hashes)||void 0===t||!t.length)return!1;return(s.timestamp||s.timestamp_iso)>e});if(0===a.length)return{wasteScore:null,wastedTokens:0,totalTokens:n,inputWaste:0,outputWaste:0,futureMessageCount:0};let l=0;if(c.context_hashes&&c.context_hashes.length>0){const e=c.context_hashes,t=new Set;a.forEach(s=>{s.context_hashes.forEach(s=>{e.includes(s)&&t.add(s)})});l=e.filter(e=>!t.has(e)).length/e.length*s}let o=0;if(c.content_hash){a.some(e=>{var s;return null===(s=e.context_hashes)||void 0===s?void 0:s.includes(c.content_hash)})||(o=t)}const i=l+o;return{wasteScore:n>0?Math.min(i/n*100,100):0,wastedTokens:Math.round(i),totalTokens:n,inputWaste:Math.round(l),outputWaste:Math.round(o),futureMessageCount:a.length}},[c,m,_]),E=(0,a.useMemo)(()=>{var e;const s=[],t=c.turn_number||0,n=(null===(e=c.context_hashes)||void 0===e?void 0:e.length)||0,a=S.filter(e=>"tool"===e.role&&e.estimated_tokens>5e3);if(a.length>0){const e=a[0];R.wasteScore>60?s.push({type:"TOOL SPEW",severity:"high",message:"".concat(e.cell||"tool"," result (").concat(e.estimated_tokens.toLocaleString()," tok) \u2014 massive but rarely referenced")}):R.wasteScore<20&&s.push({type:"TOOL SPEW",severity:"low",message:"".concat(e.cell||"tool"," result (").concat(e.estimated_tokens.toLocaleString()," tok) \u2014 large but efficiently re-used")})}t>=3&&n>10&&R.wasteScore>40&&s.push({type:"SNOWBALL DRIFT",severity:"medium",message:"Turn ".concat(t," with ").concat(n," messages \u2014 accumulating unused context")}),t>=5&&R.wasteScore>50&&s.push({type:"LOOP BLOAT",severity:"high",message:"Turn ".concat(t," carrying ").concat(n," messages \u2014 loop accumulating waste")});const l=S.filter(e=>"system"===e.role&&e.estimated_tokens>3e3);if(l.length>0){const e=l[0];s.push({type:"SYSTEM OVERLOAD",severity:"info",message:"".concat(e.cell||"system"," setup (").concat(e.estimated_tokens.toLocaleString()," tok) \u2014 consider trimming instructions")})}return s},[c,S,R]),O=(0,a.useMemo)(()=>{const e=c.tokens_in||0,s=c.tokens_out||0,t=e+s,n=[];if(I>0&&t>0){const a=(e/t*100).toFixed(0),l=(s/t*100).toFixed(0);n.push((0,o.jsxs)("div",{className:"ce-summary-block",children:[(0,o.jsxs)("div",{className:"ce-summary-text",children:["This call cost ",(0,o.jsxs)("span",{className:"ce-summary-cost",children:["$",I.toFixed(6)]}),"."," ",(0,o.jsxs)("span",{className:"ce-summary-pct",children:[a,"%"]})," was sent context,"," ",(0,o.jsxs)("span",{className:"ce-summary-pct",children:[l,"%"]})," was model output."]}),(0,o.jsxs)("div",{className:"ce-token-bar",children:[(0,o.jsx)("div",{className:"ce-token-bar-in",style:{width:"".concat(a,"%")},title:"".concat(e.toLocaleString()," tokens in")}),(0,o.jsx)("div",{className:"ce-token-bar-out",style:{width:"".concat(l,"%")},title:"".concat(s.toLocaleString()," tokens out")})]})]},"cost"))}else if(t>0){const a=(e/t*100).toFixed(0),l=(s/t*100).toFixed(0);n.push((0,o.jsxs)("div",{className:"ce-summary-block",children:[(0,o.jsxs)("div",{className:"ce-summary-text",children:["This call used ",(0,o.jsxs)("span",{className:"ce-summary-tokens",children:[t.toLocaleString()," tokens"]})," ","(",(0,o.jsx)("span",{className:"ce-summary-tokens",children:e.toLocaleString()})," in,"," ",(0,o.jsx)("span",{className:"ce-summary-tokens",children:s.toLocaleString()})," out)."]}),(0,o.jsxs)("div",{className:"ce-token-bar",children:[(0,o.jsx)("div",{className:"ce-token-bar-in",style:{width:"".concat(a,"%")}}),(0,o.jsx)("div",{className:"ce-token-bar-out",style:{width:"".concat(l,"%")}})]})]},"tokens"))}if(E.length>0&&n.push((0,o.jsx)("div",{className:"ce-pattern-warnings",children:E.map((e,s)=>(0,o.jsxs)("div",{className:"ce-pattern-warning severity-".concat(e.severity),children:[(0,o.jsxs)("span",{className:"ce-pattern-type",children:["\u26a0\ufe0f ",e.type]}),": ",e.message]},s))},"patterns")),null!==R.wasteScore&&R.futureMessageCount>0){const e=R.wasteScore<20?"green":R.wasteScore<40?"yellow":R.wasteScore<60?"orange":"red",s=R.wasteScore<20?"\ud83d\udfe2":R.wasteScore<40?"\ud83d\udfe1":R.wasteScore<60?"\ud83d\udfe7":"\ud83d\udd34";n.push((0,o.jsx)("div",{className:"ce-summary-block",children:(0,o.jsxs)("div",{className:"ce-summary-text",children:["Waste Score: ",(0,o.jsxs)("span",{className:"ce-waste-score ".concat(e),children:[s," ",R.wasteScore.toFixed(1),"%"]})," ","(",(0,o.jsxs)("span",{className:"ce-summary-tokens",children:[R.wastedTokens.toLocaleString()," tok"]})," never re-used)"]})},"waste"))}else 0===R.futureMessageCount&&n.push((0,o.jsx)("div",{className:"ce-summary-text",style:{opacity:.6,fontStyle:"italic"},children:"Terminal message \u2014 no future context to analyze for waste."},"waste"));if(S.length>0){const e=[...S].filter(e=>e.estimated_tokens>0).sort((e,s)=>s.estimated_tokens-e.estimated_tokens).slice(0,3);if(e.length>0){const s=1===e.length?"Top contributor":"Top contributors";n.push((0,o.jsxs)("div",{className:"ce-summary-text",children:[s,":"," ",e.map((e,s)=>{const t="system"===e.role?"system setup":"user"===e.role?"user input":"assistant"===e.role?"assistant response":"tool"===e.role?"tool output":e.role;return(0,o.jsxs)("span",{children:[s>0&&", ",(0,o.jsx)("span",{className:"ce-summary-role",children:t}),"unknown"!==e.cell&&(0,o.jsxs)("span",{className:"ce-summary-cell",children:[" (",e.cell,")"]})," ","(",(0,o.jsxs)("span",{className:"ce-summary-tokens",children:[e.estimated_tokens.toLocaleString()," tok"]}),")"]},s)}),"."]},"contributors"))}}else n.length>0&&n.push((0,o.jsx)("div",{className:"ce-summary-text",children:"No prior context."},"no-context"));return 0===n.length?(0,o.jsx)("div",{className:"ce-summary-text",children:"This message had no context or cost data."}):(0,o.jsx)(o.Fragment,{children:n})},[c,S,I,R,E]);return(0,o.jsxs)("div",{className:"context-explorer-sidebar",children:[(0,o.jsxs)("div",{className:"ce-header",children:[(0,o.jsxs)("div",{className:"ce-header-title",children:[(0,o.jsx)(l.In,{icon:"mdi:matrix",width:"16"}),(0,o.jsx)("span",{children:"Context Inspector"})]}),(0,o.jsx)("button",{className:"ce-close-btn",onClick:g,title:"Close",children:(0,o.jsx)(l.In,{icon:"mdi:close",width:"16"})})]}),(0,o.jsx)("div",{className:"ce-summary",children:O}),(0,o.jsxs)("div",{className:"ce-selected-message",children:[(0,o.jsxs)("div",{className:"ce-msg-role-badge",style:{borderColor:r[c.role]||"#64748b"},children:[(0,o.jsx)("span",{className:"ce-role-dot",style:{backgroundColor:r[c.role]||"#64748b"}}),(0,o.jsx)("span",{style:{color:r[c.role]||"#64748b"},children:null===(s=c.role)||void 0===s?void 0:s.toUpperCase()})]}),c.cell_name&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{className:"ce-separator",children:"\xb7"}),(0,o.jsx)("span",{className:"ce-msg-cell",children:c.cell_name})]}),c.content_hash&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{className:"ce-separator",children:"\xb7"}),(0,o.jsxs)("span",{className:"ce-msg-hash",children:[(0,o.jsx)(l.In,{icon:"mdi:fingerprint",width:"12"}),c.content_hash.slice(0,8)]})]})]}),(0,o.jsxs)("div",{className:"ce-stats",children:[(0,o.jsxs)("div",{className:"ce-stat",children:[(0,o.jsx)("span",{className:"ce-stat-label",children:"Ancestors"}),(0,o.jsx)("span",{className:"ce-stat-value",children:S.length})]}),(0,o.jsxs)("div",{className:"ce-stat",children:[(0,o.jsx)("span",{className:"ce-stat-label",children:"Descendants"}),(0,o.jsx)("span",{className:"ce-stat-value",children:C.length})]}),(0,o.jsxs)("div",{className:"ce-stat",children:[(0,o.jsx)("span",{className:"ce-stat-label",children:"Total Tokens"}),(0,o.jsx)("span",{className:"ce-stat-value cyan",children:M.totalTokens.toLocaleString()})]})]}),L.length>0&&(0,o.jsx)("div",{className:"ce-analytics-insights",children:L.map((e,s)=>(0,o.jsxs)("div",{className:"ce-insight ce-insight-".concat(e.severity),title:e.detail,children:[(0,o.jsx)(l.In,{icon:e.icon,width:"12"}),(0,o.jsx)("span",{className:"ce-insight-label",children:e.label}),(0,o.jsx)("span",{className:"ce-insight-value",children:e.value})]},s))}),(0,o.jsx)("div",{className:"ce-matrix-section",children:(0,o.jsx)(i,{data:{all_messages:b,hash_index:w},selectedMessage:c,hoveredHash:u,compact:!0,onMessageSelect:e=>{p&&p(e)},onHashHover:e=>{h&&h(e)}})}),(0,o.jsxs)("div",{className:"ce-context-list",children:[(0,o.jsxs)("div",{className:"ce-section-header",children:[(0,o.jsxs)("div",{className:"ce-section-title",children:[(0,o.jsx)(l.In,{icon:"mdi:package-variant",width:"12"}),(0,o.jsxs)("span",{children:["In Context (",S.length,")"]})]}),I>0&&(0,o.jsxs)("span",{className:"ce-section-cost",children:["$",I.toFixed(6)]})]}),(0,o.jsx)("div",{className:"ce-message-blocks",children:0===S.length&&0===M.selectedTokenPercentage?(0,o.jsxs)("div",{className:"ce-empty-state",children:[(0,o.jsx)(l.In,{icon:"mdi:package-variant-closed",width:"32",style:{opacity:.3}}),(0,o.jsx)("p",{children:"No context messages"})]}):(0,o.jsxs)(o.Fragment,{children:[M.ancestorsWithPct.map(e=>{const s=((e,s)=>{if(!e||!s)return"#333333";const t=Math.min(e/s,1);if(t<.2){const e=t/.2;return"rgb(".concat(Math.round(30+30*e),", ").concat(Math.round(100+155*e),", ").concat(Math.round(200+55*e),")")}if(t<.4){const e=(t-.2)/.2;return"rgb(".concat(Math.round(60-10*e),", ").concat(Math.round(255-55*e),", ").concat(Math.round(255-155*e),")")}if(t<.6){const e=(t-.4)/.2;return"rgb(".concat(Math.round(50+205*e),", ").concat(Math.round(200+55*e),", ").concat(Math.round(100-50*e),")")}if(t<.8){const e=(t-.6)/.2;return"rgb(".concat(Math.round(255),", ").concat(Math.round(255-100*e),", ").concat(Math.round(50-50*e),")")}{const e=(t-.8)/.2;return"rgb(".concat(Math.round(255-30*e),", ").concat(Math.round(155-100*e),", ").concat(Math.round(0),")")}})(e.estimated_tokens,e.globalMaxTokens);return(0,o.jsxs)("button",{className:"ce-message-block ".concat(u===e.hash?"highlighted":""," ").concat(e.hasMatch?"":"no-match"),style:{borderLeftColor:s,borderLeftWidth:"3px",borderLeftStyle:"solid"},onClick:()=>{e.hasMatch&&p&&m[e.index]&&p(m[e.index])},onMouseEnter:()=>h&&h(e.hash),onMouseLeave:()=>h&&h(null),disabled:!e.hasMatch,children:[(0,o.jsxs)("div",{className:"ce-block-header",children:[(0,o.jsxs)("span",{className:"ce-block-position",children:["#",e.position]}),(0,o.jsx)("span",{className:"ce-block-role",style:{color:r[e.role]||"#64748b"},children:e.role}),"unknown"!==e.cell&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{className:"ce-block-separator",children:"\xb7"}),(0,o.jsx)("span",{className:"ce-block-cell",children:e.cell})]}),e.globalRank&&(0,o.jsxs)("span",{className:"ce-block-rank",title:"#".concat(e.globalRank," largest by tokens"),children:["#",e.globalRank]})]}),e.preview&&(0,o.jsxs)("div",{className:"ce-block-preview",children:[e.preview,e.preview.length>=120?"...":""]}),(0,o.jsxs)("div",{className:"ce-block-footer",children:[(0,o.jsxs)("div",{className:"ce-block-meta",children:[(0,o.jsxs)("span",{className:"ce-block-hash",children:[(0,o.jsx)(l.In,{icon:"mdi:fingerprint",width:"10"}),e.hash.slice(0,8)]}),e.estimated_tokens>0&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("span",{className:"ce-block-tokens",children:[e.estimated_tokens.toLocaleString()," tok"]}),e.tokenPercentage>0&&(0,o.jsxs)("span",{className:"ce-block-percentage",children:[e.tokenPercentage.toFixed(1),"%"]})]}),j[e.hash]&&(0,o.jsxs)("span",{className:"ce-block-relevance ".concat(j[e.hash].score>=80?"high":j[e.hash].score>=50?"medium":"low"),title:j[e.hash].reason||"Relevance: ".concat(j[e.hash].score,"/100"),children:[(0,o.jsx)(l.In,{icon:"mdi:target",width:"10"}),j[e.hash].score]})]}),e.tokenPercentage>0&&(0,o.jsx)("div",{className:"ce-cost-bar-container",children:(0,o.jsx)("div",{className:"ce-cost-bar",style:{width:"".concat(e.tokenPercentage,"%")}})})]}),!e.hasMatch&&(0,o.jsxs)("div",{className:"ce-block-warning",children:[(0,o.jsx)(l.In,{icon:"mdi:alert-circle-outline",width:"10"}),"No match found"]})]},"".concat(e.position,"-").concat(e.hash))}),(0,o.jsxs)("div",{className:"ce-message-block ghost-block",children:[(0,o.jsxs)("div",{className:"ce-block-header",children:[(0,o.jsx)("span",{className:"ce-block-position",children:"CURRENT"}),(0,o.jsx)("span",{className:"ce-block-role",style:{color:r[c.role]||"#64748b"},children:c.role}),c.cell_name&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{className:"ce-block-separator",children:"\xb7"}),(0,o.jsx)("span",{className:"ce-block-cell",children:c.cell_name})]})]}),(()=>{const e=c.content_json||c.content,s="string"===typeof e?e.slice(0,120):JSON.stringify(e).slice(0,120),t=d(s);return t?(0,o.jsxs)("div",{className:"ce-block-preview",children:[t,t.length>=120?"...":""]}):null})(),(0,o.jsxs)("div",{className:"ce-block-footer",children:[(0,o.jsxs)("div",{className:"ce-block-meta",children:[(0,o.jsxs)("span",{className:"ce-block-hash",children:[(0,o.jsx)(l.In,{icon:"mdi:fingerprint",width:"10"}),(null===(t=c.content_hash)||void 0===t?void 0:t.slice(0,8))||"N/A"]}),M.selectedTokens>0&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("span",{className:"ce-block-tokens",children:[M.selectedTokens.toLocaleString()," tok"]}),M.selectedTokenPercentage>0&&(0,o.jsxs)("span",{className:"ce-block-percentage",children:[M.selectedTokenPercentage.toFixed(1),"%"]})]})]}),M.selectedTokenPercentage>0&&(0,o.jsx)("div",{className:"ce-cost-bar-container",children:(0,o.jsx)("div",{className:"ce-cost-bar",style:{width:"".concat(M.selectedTokenPercentage,"%")}})})]})]})]})})]}),C.length>0&&(0,o.jsxs)("details",{className:"ce-descendants",children:[(0,o.jsxs)("summary",{className:"ce-section-header",children:[(0,o.jsx)(l.In,{icon:"mdi:eye-outline",width:"12"}),(0,o.jsxs)("span",{children:["Seen By (",C.length,")"]})]}),(0,o.jsx)("div",{className:"ce-message-blocks",children:C.map(e=>(0,o.jsx)("button",{className:"ce-message-block",onClick:()=>p&&m[e._index]&&p(m[e._index]),children:(0,o.jsxs)("div",{className:"ce-block-header",children:[(0,o.jsxs)("span",{className:"ce-block-position",children:["#",e.index]}),(0,o.jsx)("span",{className:"ce-block-role",style:{color:r[e.role]||"#64748b"},children:e.role}),e.cell&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{className:"ce-block-separator",children:"\xb7"}),(0,o.jsx)("span",{className:"ce-block-cell",children:e.cell})]})]})},"".concat(e._index,"-").concat(e.timestamp)))})]})]})}},92667:(e,s,t)=>{t.d(s,{A:()=>j});var n=t(89379),a=t(65043),l=t(94424),o=t(87955),c=t(5748),i=t(24768),r=t(64065),d=t(77158),m=t(64745),u=t(70579);const h=e=>{let{content:s,className:t=""}=e;const{text:n,language:l}=(0,a.useMemo)(()=>{if(!s)return{text:"",language:"plaintext"};let e=s;if("object"===typeof s)return{text:JSON.stringify(s,null,2),language:"json"};if("string"===typeof s){try{const t=JSON.parse(s);if("string"!==typeof t)return{text:JSON.stringify(t,null,2),language:"json"};e=t}catch(t){e=s}let n=e;(n.startsWith('"')&&n.endsWith('"')||n.startsWith("'")&&n.endsWith("'"))&&(n=n.slice(1,-1)),n=n.replace(/\\n/g,"\n").replace(/\\t/g,"\t").replace(/\\r/g,"\r").replace(/\\"/g,'"').replace(/\\'/g,"'").replace(/\\\\/g,"\\");const a=function(e){if(!e||"string"!==typeof e)return"plaintext";const s=e.trim();if(s.startsWith("{")&&s.endsWith("}")||s.startsWith("[")&&s.endsWith("]"))try{return JSON.parse(s),"json"}catch(n){}const t=[/^#{1,6}\s/m,/^\*\*.*\*\*$/m,/^[-*+]\s/m,/^\d+\.\s/m,/\[.*\]\(.*\)/,/```/,/^>\s/m];for(const a of t)if(a.test(s))return"markdown";if(/^(SELECT|INSERT|UPDATE|DELETE|CREATE|DROP|ALTER)/i.test(s))return"sql";if(/^(def |class |import |from |if __name__|#!\/)/m.test(s))return"python";if(/^(function|const |let |var |=>|import |export |class )/m.test(s))return"javascript";return"plaintext"}(n);return{text:n,language:a}}return{text:String(s),language:"plaintext"}},[s]);return(0,u.jsx)("div",{className:"message-content-viewer ".concat(t),children:(0,u.jsx)(d.Ay,{height:"100%",language:l,value:n,theme:m.TH,beforeMount:m.$B,options:{readOnly:!0,minimap:{enabled:!1},scrollBeyondLastLine:!1,wordWrap:"on",fontSize:12,lineNumbers:"on",glyphMargin:!1,folding:!0,lineDecorationsWidth:0,lineNumbersMinChars:3,renderLineHighlight:"none",contextmenu:!1,scrollbar:{vertical:"auto",horizontal:"auto",verticalScrollbarSize:10,horizontalScrollbarSize:10},padding:{top:12,bottom:12}}})})};function g(e){return e?String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):""}const p=function(e){let{uiSpec:s,checkpointId:t,sessionId:n,compact:l=!1}=e;const o=(0,a.useRef)(null),[i,r]=(0,a.useState)(null),[d,m]=(0,a.useState)(l?"200px":"300px"),h=(0,a.useMemo)(()=>s?"string"===typeof s?s:s.content?s.content:s.html?s.html:s.question||s.options?function(e){const{question:s,options:t,html:n}=e;let a='<div class="hitl-display">';n&&(a+='<div class="hitl-custom-html">'.concat(n,"</div>"));s&&(a+='<h3 class="hitl-question">'.concat(g(s),"</h3>"));t&&t.length>0&&(a+='<div class="hitl-options">',t.forEach((e,s)=>{const t="string"===typeof e?e:e.label||e.id||"Option ".concat(s+1),n="object"===typeof e?e.description:null,l=e.selected||e.chosen;a+='\n        <div class="hitl-option '.concat(l?"selected":"",'">\n          <div class="hitl-option-label">').concat(g(t),"</div>\n          ").concat(n?'<div class="hitl-option-desc">'.concat(g(n),"</div>"):"","\n        </div>\n      ")}),a+="</div>");return a+="</div>",a}(s):"object"===typeof s?'<pre style="color: #94a3b8; font-size: 12px;">'.concat(JSON.stringify(s,null,2),"</pre>"):null:null,[s]);return(0,a.useEffect)(()=>{const e=o.current;if(e&&h)try{const s=function(e,s){const t="\n    :root {\n      --bg-primary: #0a0a0a;\n      --bg-secondary: #121212;\n      --bg-tertiary: #1a1a1a;\n      --text-primary: #f1f5f9;\n      --text-secondary: #94a3b8;\n      --text-muted: #64748b;\n      --accent-cyan: #00e5ff;\n      --accent-purple: #a78bfa;\n      --accent-green: #10b981;\n      --border-color: #333;\n    }\n\n    * {\n      box-sizing: border-box;\n      margin: 0;\n      padding: 0;\n    }\n\n    body {\n      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      font-size: ".concat(s?"12px":"13px",";\n      line-height: 1.6;\n      color: var(--text-primary);\n      background: var(--bg-primary);\n      padding: ").concat(s?"12px":"16px",";\n    }\n\n    h1, h2, h3, h4, h5, h6 {\n      color: var(--text-primary);\n      margin-bottom: 0.5em;\n      font-weight: 600;\n    }\n\n    h3 { font-size: 1.1em; }\n\n    p { margin-bottom: 0.75em; color: var(--text-secondary); }\n\n    a { color: var(--accent-cyan); text-decoration: none; }\n    a:hover { text-decoration: underline; }\n\n    code {\n      background: var(--bg-tertiary);\n      padding: 0.2em 0.4em;\n      border-radius: 4px;\n      font-family: 'JetBrains Mono', monospace;\n      font-size: 0.9em;\n      color: var(--accent-cyan);\n    }\n\n    pre {\n      background: var(--bg-tertiary);\n      padding: 12px;\n      border-radius: 8px;\n      overflow-x: auto;\n      margin-bottom: 1em;\n      border: 1px solid var(--border-color);\n    }\n\n    pre code {\n      background: none;\n      padding: 0;\n    }\n\n    /* HITL Display Styles */\n    .hitl-display {\n      padding: 8px 0;\n    }\n\n    .hitl-question {\n      color: var(--accent-purple);\n      margin-bottom: 12px;\n    }\n\n    .hitl-options {\n      display: flex;\n      flex-direction: column;\n      gap: 8px;\n    }\n\n    .hitl-option {\n      background: var(--bg-secondary);\n      border: 1px solid var(--border-color);\n      border-radius: 6px;\n      padding: 10px 14px;\n    }\n\n    .hitl-option.selected {\n      border-color: var(--accent-green);\n      background: rgba(16, 185, 129, 0.1);\n    }\n\n    .hitl-option-label {\n      font-weight: 500;\n      color: var(--text-primary);\n    }\n\n    .hitl-option-desc {\n      font-size: 0.9em;\n      color: var(--text-muted);\n      margin-top: 4px;\n    }\n\n    /* Form elements (disabled state) */\n    input, textarea, select {\n      background: var(--bg-tertiary);\n      border: 1px solid var(--border-color);\n      color: var(--text-primary);\n      padding: 8px 12px;\n      border-radius: 6px;\n      width: 100%;\n      margin-bottom: 8px;\n    }\n\n    button {\n      background: var(--accent-purple);\n      color: white;\n      border: none;\n      padding: 8px 16px;\n      border-radius: 6px;\n      font-weight: 500;\n      cursor: pointer;\n    }\n\n    /* Tables */\n    table {\n      width: 100%;\n      border-collapse: collapse;\n      margin-bottom: 1em;\n    }\n\n    th, td {\n      padding: 8px 12px;\n      text-align: left;\n      border-bottom: 1px solid var(--border-color);\n    }\n\n    th {\n      background: var(--bg-secondary);\n      color: var(--text-primary);\n      font-weight: 600;\n    }\n\n    /* Cards */\n    .card {\n      background: var(--bg-secondary);\n      border: 1px solid var(--border-color);\n      border-radius: 8px;\n      padding: 16px;\n      margin-bottom: 12px;\n    }\n\n    /* Mermaid diagrams */\n    .mermaid {\n      background: var(--bg-secondary);\n      border-radius: 8px;\n      padding: 16px;\n      margin: 12px 0;\n    }\n\n    /* Read-only overlay indicator */\n    .readonly-badge {\n      position: fixed;\n      bottom: 8px;\n      right: 8px;\n      background: rgba(100, 116, 139, 0.8);\n      color: white;\n      font-size: 10px;\n      padding: 4px 8px;\n      border-radius: 4px;\n      text-transform: uppercase;\n      letter-spacing: 0.5px;\n    }\n  ");return'\n    <!DOCTYPE html>\n    <html>\n    <head>\n      <meta charset="utf-8">\n      <meta name="viewport" content="width=device-width, initial-scale=1">\n      <style>'.concat(t,"</style>\n      \x3c!-- Mermaid.js for diagrams --\x3e\n      <script src=\"https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js\"><\/script>\n      <script>\n        if (typeof mermaid !== 'undefined') {\n          mermaid.initialize({\n            startOnLoad: true,\n            theme: 'dark',\n            themeVariables: {\n              primaryColor: '#1a1a2e',\n              primaryTextColor: '#f1f5f9',\n              primaryBorderColor: '#00e5ff',\n              lineColor: '#a78bfa',\n              secondaryColor: '#16213e',\n              tertiaryColor: '#0f3460'\n            },\n            fontFamily: \"'Inter', sans-serif\"\n          });\n        }\n      <\/script>\n    </head>\n    <body>\n      ").concat(e,'\n      <div class="readonly-badge">Read Only</div>\n    </body>\n    </html>\n  ')}(function(e,s){let t=e;for(const[n,a]of Object.entries(s)){const e=new RegExp("{{\\s*".concat(n,"\\s*}}"),"g");t=t.replace(e,a||"")}return t}(h,{checkpoint_id:t||"",session_id:n||""}),l);e.srcdoc=s;const a=()=>{var s;const t=e.contentDocument;if(!t)return void r("Failed to access iframe document");var n;(n=t).querySelectorAll("input, textarea, select").forEach(e=>{e.disabled=!0,e.style.opacity="0.7",e.style.cursor="not-allowed"}),n.querySelectorAll("button").forEach(e=>{e.disabled=!0,e.style.opacity="0.5",e.style.cursor="not-allowed"}),n.querySelectorAll("form").forEach(e=>{e.addEventListener("submit",e=>{e.preventDefault(),e.stopPropagation()})});let a=0;const o=()=>{if(!(a>=5)){a++;try{const e=t.body.offsetHeight,s=Math.min(Math.max(e+16,100),l?500:800);m("".concat(s,"px"))}catch(e){console.warn("[HITLContentRenderer] Could not resize iframe:",e)}}};if(setTimeout(o,100),setTimeout(o,300),null!==(s=e.contentWindow)&&void 0!==s&&s.mermaid)try{e.contentWindow.mermaid.run()}catch(c){console.warn("[HITLContentRenderer] Mermaid init failed:",c)}};return e.addEventListener("load",a),()=>{e.removeEventListener("load",a)}}catch(s){console.error("[HITLContentRenderer] iframe setup error:",s),r("Failed to render HITL content: ".concat(s.message))}},[h,t,n,l]),i?(0,u.jsxs)("div",{className:"hitl-renderer-error",children:[(0,u.jsx)(c.In,{icon:"mdi:alert-circle-outline",width:"16"}),(0,u.jsx)("span",{children:i})]}):h?(0,u.jsxs)("div",{className:"hitl-renderer-wrapper ".concat(l?"hitl-renderer-compact":""),children:[(0,u.jsxs)("div",{className:"hitl-renderer-badge",children:[(0,u.jsx)(c.In,{icon:"mdi:checkbox-marked-circle-outline",width:"12"}),(0,u.jsx)("span",{children:"Checkpoint (Read-Only)"})]}),(0,u.jsx)("iframe",{ref:o,className:"hitl-renderer-iframe",style:{height:d,width:"100%",border:"none",display:"block",backgroundColor:"transparent",borderRadius:"8px"},sandbox:"allow-same-origin allow-scripts",title:"HITL Checkpoint Content"})]}):(0,u.jsxs)("div",{className:"hitl-renderer-empty",children:[(0,u.jsx)(c.In,{icon:"mdi:file-document-outline",width:"16"}),(0,u.jsx)("span",{children:"No HITL content available"})]})};var x=t(24818);function f(e){let{sessionId:s,shouldPoll:t=!0}=e;const{budgetConfig:n,usageHistory:l,totalEnforcements:o,totalPruned:c,currentUsage:i,loading:r,error:d}=(0,x.D)(s,t),m=(0,a.useRef)(null),h=null!==m.current&&m.current!==i,g=h&&i>m.current,p=h&&i<m.current;if((0,a.useEffect)(()=>{m.current=i},[i]),!s)return null;if(r)return null;if(d)return null;if(!n)return null;const f=n.max_total||1e5,v=n.reserve_for_output||4e3,b=f-v,j=n.warning_threshold||.8,y=n.strategy||"sliding_window",k=i||0,N=b>0?k/b:0,_=(null===l||void 0===l?void 0:l.filter(e=>"llm_call"===e.event_type).length)||0,w=N>.95?"red":N>j?"yellow":"green",S=e=>null==e?"0":e.toLocaleString(),C=g?"usage-increased":p?"usage-decreased":"";return(0,u.jsxs)("div",{className:"budget-status-bar budget-".concat(w),children:[(0,u.jsxs)("div",{className:"budget-header",children:[(0,u.jsxs)("div",{className:"budget-header-main",children:[(0,u.jsx)("span",{className:"budget-title",children:"Token Budget:"}),(0,u.jsxs)("span",{className:"budget-percentage ".concat(C),children:[S(k)," / ",S(b)," tokens (",(100*N).toFixed(0),"%)"]})]}),(0,u.jsxs)("div",{className:"budget-header-stats",children:[_>0&&(0,u.jsxs)("div",{className:"llm-call-count",title:"Number of LLM calls in this session",children:["\ud83d\udd04 ",_," call",_>1?"s":""]}),o>0&&(0,u.jsxs)("div",{className:"enforcement-count",children:["\ud83d\udca5 ",o," enforcement",o>1?"s":""]})]})]}),(0,u.jsxs)("div",{className:"budget-progress-bar",children:[(0,u.jsx)("div",{className:"budget-progress-fill ".concat(C),style:{width:"".concat(Math.min(100*N,100),"%")}}),(0,u.jsx)("div",{className:"budget-threshold-marker",style:{left:"".concat(100*j,"%")},title:"Warning threshold: ".concat((100*j).toFixed(0),"%")})]}),(0,u.jsxs)("div",{className:"budget-details",children:[(0,u.jsxs)("div",{className:"budget-detail-item",children:[(0,u.jsx)("span",{className:"budget-detail-label",children:"Strategy:"}),(0,u.jsx)("span",{className:"budget-detail-value",children:y})]}),c>0&&(0,u.jsxs)("div",{className:"budget-detail-item budget-detail-pruned",children:[(0,u.jsx)("span",{className:"budget-detail-label",children:"Pruned:"}),(0,u.jsxs)("span",{className:"budget-detail-value",children:[S(c)," tokens"]})]}),(0,u.jsxs)("div",{className:"budget-detail-item",children:[(0,u.jsx)("span",{className:"budget-detail-label",children:"Reserve:"}),(0,u.jsxs)("span",{className:"budget-detail-value",children:[S(v)," tokens"]})]}),(0,u.jsxs)("div",{className:"budget-detail-item",children:[(0,u.jsx)("span",{className:"budget-detail-label",children:"Limit:"}),(0,u.jsxs)("span",{className:"budget-detail-value",children:[S(b)," tokens"]})]})]})]})}o.syG.registerModules([o.JKr]);const v=o.zl0.withParams({backgroundColor:"#000000",foregroundColor:"#cbd5e1",headerBackgroundColor:"#0a0510",headerTextColor:"#94a3b8",oddRowBackgroundColor:"#030308",borderColor:"#1a1628",rowBorder:!0,wrapperBorder:!1,headerFontSize:11,headerFontWeight:600,fontFamily:"'Google Sans Code', monospace",fontSize:12,accentColor:"#a78bfa",chromeBackgroundColor:"#000000",rowHoverColor:"#0a0815"}),b={assistant:{icon:"mdi:robot-outline",color:"#a78bfa",label:"Assistant"},user:{icon:"mdi:account-outline",color:"#34d399",label:"User"},system:{icon:"mdi:cog-outline",color:"#fbbf24",label:"System"},tool:{icon:"mdi:wrench-outline",color:"#60a5fa",label:"Tool"},tool_call:{icon:"mdi:arrow-right-bold",color:"#60a5fa",label:"Tool Call"},cell_start:{icon:"mdi:play-circle-outline",color:"#34d399",label:"Cell Start"},cell_complete:{icon:"mdi:check-circle-outline",color:"#34d399",label:"Cell Complete"},structure:{icon:"mdi:shape-outline",color:"#a78bfa",label:"Structure"},error:{icon:"mdi:alert-circle-outline",color:"#f87171",label:"Error"},evaluator:{icon:"mdi:scale-balance",color:"#f472b6",label:"Evaluator"},ward:{icon:"mdi:shield-outline",color:"#fb923c",label:"Ward"},render:{icon:"mdi:checkbox-marked-circle-outline",color:"#10b981",label:"Checkpoint"}},j=e=>{var s,t,o,d,m,g;let{logs:x=[],onSelectCell:j,onMessageClick:y,hoveredHash:k=null,onHoverHash:N,externalSelectedMessage:_=null,currentSessionId:w=null,showFilters:S=!0,filterByCell:C=null,filterByTake:M=null,showCellColumn:I=!0,compact:T=!1,className:L="",includeChildSessions:R=!0,shouldPollBudget:E=!0,onFiltersChange:O}=e;const A=(0,a.useRef)(null),[F,W]=(0,a.useState)(null);(0,a.useEffect)(()=>{if(null!==_&&void 0!==_&&_._scrollOnly){var e,s;const t=_,n=null===(e=A.current)||void 0===e||null===(s=e.api)||void 0===s?void 0:s.getRowNode(t.message_id);if(n){A.current.api.ensureNodeVisible(n,"middle");const e=document.querySelector('[row-id="'.concat(t.message_id,'"]'));e&&(e.classList.add("sml-row-flash"),setTimeout(()=>{e.classList.remove("sml-row-flash")},1500))}}},[_]);const H=_&&!_._scrollOnly?_:F,[P,D]=(0,a.useState)(null),[B,z]=(0,a.useState)({roles:new Set,cells:new Set,searchText:"",showToolCalls:!0,showErrors:!0,winnersOnly:!1});(0,a.useEffect)(()=>{O&&O(B)},[B,O]);const J=(0,a.useMemo)(()=>{const e=new Set,s=new Set;for(const t of x)t.cell_name&&e.add(t.cell_name),t.role&&s.add(t.role);return{cells:Array.from(e).sort(),roles:Array.from(s).sort()}},[x]),q=(0,a.useMemo)(()=>{let e=[...x];if(C&&(e=e.filter(e=>e.cell_name===C)),null!==M&&void 0!==M){const s=String(M);e=e.filter(e=>(null!==e.take_index&&void 0!==e.take_index?String(e.take_index):"main")===s)}if(B.winnersOnly&&(e=e.filter(e=>null===e.take_index||void 0===e.take_index||!0===e.is_winner)),B.roles.size>0&&(e=e.filter(e=>B.roles.has(e.role))),B.cells.size>0&&(e=e.filter(e=>B.cells.has(e.cell_name))),B.searchText){const s=B.searchText.toLowerCase();e=e.filter(e=>("string"===typeof e.content_json?e.content_json:JSON.stringify(e.content_json||"")).toLowerCase().includes(s)||(e.cell_name||"").toLowerCase().includes(s)||(e.role||"").toLowerCase().includes(s)||(e.model||"").toLowerCase().includes(s))}return e.sort((e,s)=>{const t=new Date(e.timestamp_iso||0).getTime();return new Date(s.timestamp_iso||0).getTime()-t}),e},[x,B,C,M]),U=(0,a.useCallback)(e=>{let{value:s,data:t}=e;const n=b[s]||{icon:"mdi:help-circle-outline",color:"#64748b",label:s},a=t.take_index,l=t.reforge_step,o=t.turn_number;let i="";return null!==a&&void 0!==a&&(i="C".concat(a," ")),null!==l&&void 0!==l&&l>0&&(i+="R".concat(l," ")),null!==o&&void 0!==o&&o>=1&&(i+="T".concat(o," ")),(0,u.jsxs)("div",{className:"sml-role-cell",style:{"--role-color":n.color},children:[(0,u.jsx)(c.In,{icon:n.icon,width:"14"}),(0,u.jsxs)("span",{children:[i,n.label]})]})},[]),G=(0,a.useCallback)(e=>{let{value:s,data:t}=e;return s?(0,u.jsx)("button",{className:"sml-cell-link",onClick:e=>{e.stopPropagation(),null===j||void 0===j||j(s)},children:s}):(0,u.jsx)("span",{className:"sml-null",children:"\u2014"})},[j]),$=(0,a.useCallback)(e=>{let{value:s}=e;if(!s)return(0,u.jsx)("span",{className:"sml-null",children:"\u2014"});const t=new Date(s),n=t.toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"}),a=String(t.getMilliseconds()).padStart(3,"0");return(0,u.jsxs)("span",{className:"sml-time",children:[n,(0,u.jsxs)("span",{className:"sml-time-ms",children:[".",a]})]})},[]),V=(0,a.useCallback)(e=>{let{value:s}=e;if(!s)return(0,u.jsx)("span",{className:"sml-null",children:"\u2014"});let t=s;"object"===typeof t&&(t=JSON.stringify(t));let n=t;if("string"===typeof n){try{const e=JSON.parse(n);n="string"===typeof e?e:JSON.stringify(e)}catch(l){}(n.startsWith('"')&&n.endsWith('"')||n.startsWith("'")&&n.endsWith("'"))&&(n=n.slice(1,-1)),n=n.replace(/\\n/g," ").replace(/\\t/g," ").replace(/\\r/g,"").replace(/\\"/g,'"').replace(/\\'/g,"'").replace(/\\\\/g,"\\").replace(/\s+/g," ").trim()}const a=n.length>200?n.substring(0,200)+"...":n;return(0,u.jsx)("span",{className:"sml-content",title:n,children:a})},[]),Y=(0,a.useCallback)(e=>{let{value:s,colDef:t}=e;return null===s||void 0===s||0===s?(0,u.jsx)("span",{className:"sml-null",children:"\u2014"}):"cost"===t.field?(0,u.jsxs)("span",{className:"sml-cost",children:["$",s.toFixed(4)]}):"duration_ms"===t.field?(0,u.jsxs)("span",{className:"sml-duration",children:[Math.round(s),"ms"]}):"tokens_in"===t.field||"tokens_out"===t.field?(0,u.jsx)("span",{className:"sml-tokens",children:s.toLocaleString()}):s},[]),K=(0,a.useCallback)(e=>{let{value:s}=e;if(!s)return(0,u.jsx)("span",{className:"sml-null",children:"\u2014"});const t=s.split("/").pop();return(0,u.jsx)("span",{className:"sml-model",title:s,children:t})},[]),X=(0,a.useCallback)(e=>{let{data:s}=e,t=0;const n=[];if(s.has_images&&s.images_json)try{const e="string"===typeof s.images_json?JSON.parse(s.images_json):s.images_json;Array.isArray(e)&&e.length>0&&(t+=e.length,n.push("".concat(e.length," image").concat(e.length>1?"s":"")))}catch(a){}if(s.metadata_json)try{const e="string"===typeof s.metadata_json?JSON.parse(s.metadata_json):s.metadata_json;if(e&&e.images&&Array.isArray(e.images)&&e.images.length>0){const a=e.images.length;s.has_images||(t+=a,n.push("".concat(a," image").concat(a>1?"s":"")))}}catch(l){}if(s.content_json&&!s.has_images)try{let e=s.content_json;if("string"===typeof e&&(e=JSON.parse(e)),e&&e.images&&Array.isArray(e.images)&&e.images.length>0){const s=e.images.length;t+=s,n.push("".concat(s," screenshot").concat(s>1?"s":""))}}catch(o){}if(s.has_audio&&s.audio_json)try{const e="string"===typeof s.audio_json?JSON.parse(s.audio_json):s.audio_json;Array.isArray(e)&&e.length>0&&(t+=e.length,n.push("".concat(e.length," audio")))}catch(i){}return 0===t?(0,u.jsx)("span",{className:"sml-null",children:"\u2014"}):(0,u.jsxs)("span",{className:"sml-media-count",title:n.join(", "),children:[(0,u.jsx)(c.In,{icon:"mdi:image-multiple",width:"14"}),t]})},[]),Q=(0,a.useMemo)(()=>{const e=[{field:"timestamp_iso",headerName:"Time",width:110,cellRenderer:$,sortable:!0,sort:"desc"},{field:"role",headerName:"Role",flex:1,minWidth:110,maxWidth:140,cellRenderer:U,sortable:!0,filter:!0}];return I&&e.push({field:"cell_name",headerName:"Cell",flex:1,minWidth:100,maxWidth:150,cellRenderer:G,sortable:!0,filter:!0}),e.push({field:"context_hashes",headerName:"Ctx",width:55,cellRenderer:e=>{var s;const t=(null===(s=e.value)||void 0===s?void 0:s.length)||0;return 0===t?null:(0,u.jsx)("div",{className:"sml-context-count","data-tooltip":"".concat(t," messages in context"),children:t})},sortable:!0,comparator:(e,s)=>((null===e||void 0===e?void 0:e.length)||0)-((null===s||void 0===s?void 0:s.length)||0),equals:(e,s)=>((null===e||void 0===e?void 0:e.length)||0)===((null===s||void 0===s?void 0:s.length)||0)}),e.push({field:"content_json",headerName:"Content",flex:3,minWidth:200,cellRenderer:V,suppressSizeToFit:!1},{field:"model",headerName:"Model",flex:1.5,minWidth:120,maxWidth:180,cellRenderer:K,sortable:!0},{field:"has_images",headerName:"Media",width:75,cellRenderer:X,sortable:!0},{field:"duration_ms",headerName:"Duration",width:90,cellRenderer:Y,sortable:!0},{field:"tokens_in",headerName:"In",width:70,cellRenderer:Y,sortable:!0},{field:"tokens_out",headerName:"Out",width:70,cellRenderer:Y,sortable:!0},{field:"cost",headerName:"Cost",width:80,cellRenderer:Y,sortable:!0}),e},[I,$,U,G,V,K,X,Y]),Z=(0,a.useMemo)(()=>({resizable:!0,suppressMovable:!0}),[]),ee=(0,a.useCallback)(e=>{z(s=>{const t=new Set(s.roles);return t.has(e)?t.delete(e):t.add(e),(0,n.A)((0,n.A)({},s),{},{roles:t})})},[]),se=(0,a.useCallback)(e=>{z(s=>{const t=new Set(s.cells);return t.has(e)?t.delete(e):t.add(e),(0,n.A)((0,n.A)({},s),{},{cells:t})})},[]),te=(0,a.useCallback)(()=>{z({roles:new Set,cells:new Set,searchText:"",showToolCalls:!0,showErrors:!0,winnersOnly:!1})},[]),ne=(0,a.useCallback)(e=>{const s=e.data;(null===H||void 0===H?void 0:H.message_id)===s.message_id?(W(null),y&&y(null)):(W(s),y&&y(s))},[H,y]),ae=(0,a.useCallback)(()=>{W(null),y&&y(null)},[y]);(0,a.useEffect)(()=>{var e;null!==(e=A.current)&&void 0!==e&&e.api&&A.current.api.redrawRows()},[H,k]);const le=(0,a.useMemo)(()=>{let e=0,s=0,t=0,n=null,a=0;for(const l of q)l.cost&&(e+=l.cost,l.cost>a&&(a=l.cost,n=l)),l.tokens_in&&(s+=l.tokens_in),l.tokens_out&&(t+=l.tokens_out);return{count:q.length,totalCount:x.length,cost:e,tokensIn:s,tokensOut:t,mostExpensiveMessage:n}},[q,x]),oe=(0,a.useCallback)(()=>{var e;if(!le.mostExpensiveMessage)return;const s=le.mostExpensiveMessage;if(W(s),y&&y(s),null!==(e=A.current)&&void 0!==e&&e.api){const e=A.current.api.getRowNode(s.message_id||"".concat(s.timestamp_iso,"-").concat(s.trace_id));e&&(A.current.api.ensureNodeVisible(e,"middle"),setTimeout(()=>{const e=document.querySelector('[row-id="'.concat(s.message_id,'"]'));e&&(e.classList.add("sml-row-flash"),setTimeout(()=>{e.classList.remove("sml-row-flash")},1500))},100))}},[le.mostExpensiveMessage,y]),ce=B.roles.size>0||B.cells.size>0||B.searchText||B.winnersOnly;return 0===x.length?(0,u.jsxs)("div",{className:"sml-empty",children:[(0,u.jsx)(c.In,{icon:"mdi:message-text-outline",width:"48"}),(0,u.jsx)("p",{children:"No messages yet"}),(0,u.jsx)("span",{children:"Run a cascade to see execution logs"})]}):(0,u.jsxs)("div",{className:"session-messages-log ".concat(T?"sml-compact":""," ").concat(L),children:[(0,u.jsxs)("div",{className:"sml-table-area ".concat(S?"":"sml-table-area-full"),children:[(0,u.jsx)(f,{sessionId:w,shouldPoll:E}),(0,u.jsxs)("div",{className:"sml-stats-bar",children:[(0,u.jsxs)("div",{className:"sml-stats-left",children:[(0,u.jsx)(c.In,{icon:"mdi:message-text-outline",width:"16"}),(0,u.jsx)("span",{className:"sml-stats-count",children:le.count===le.totalCount?"".concat(le.count," messages"):"".concat(le.count," of ").concat(le.totalCount," messages")}),le.mostExpensiveMessage&&(0,u.jsxs)("button",{className:"sml-stat sml-stat-expensive",onClick:oe,title:"Jump to most expensive: $".concat(null===(s=le.mostExpensiveMessage.cost)||void 0===s?void 0:s.toFixed(4)," (").concat(le.mostExpensiveMessage.role,")"),children:[(0,u.jsx)(c.In,{icon:"mdi:fire",width:"12"}),"$",null===(t=le.mostExpensiveMessage.cost)||void 0===t?void 0:t.toFixed(4)]})]}),(0,u.jsxs)("div",{className:"sml-stats-right",children:[le.tokensIn>0&&(0,u.jsxs)("span",{className:"sml-stat",children:[(0,u.jsx)(c.In,{icon:"mdi:arrow-down",width:"12"}),le.tokensIn.toLocaleString()," in"]}),le.tokensOut>0&&(0,u.jsxs)("span",{className:"sml-stat",children:[(0,u.jsx)(c.In,{icon:"mdi:arrow-up",width:"12"}),le.tokensOut.toLocaleString()," out"]}),le.cost>0&&(0,u.jsxs)("span",{className:"sml-stat sml-stat-cost",children:[(0,u.jsx)(c.In,{icon:"mdi:currency-usd",width:"12"}),le.cost.toFixed(4)]})]})]}),H?(0,u.jsxs)(i.A,{className:"sml-split-container",direction:"vertical",sizes:[60,40],minSize:[100,80],gutterSize:6,snapOffset:0,children:[(0,u.jsx)("div",{className:"sml-grid-container",children:(0,u.jsx)(l.W6,{ref:A,theme:v,rowData:q,columnDefs:Q,defaultColDef:Z,rowHeight:36,headerHeight:32,animateRows:!1,suppressCellFocus:!0,enableCellTextSelection:!0,suppressColumnVirtualisation:!0,suppressAnimationFrame:!0,getRowId:e=>e.data.message_id||"".concat(e.data.timestamp_iso,"-").concat(e.data.trace_id||e.node.id),onRowClicked:ne,rowSelection:"single",getRowClass:e=>{var s;const t=[];return e.data.message_id===(null===H||void 0===H?void 0:H.message_id)&&t.push("sml-row-selected"),w&&e.data.session_id&&e.data.session_id!==w&&t.push("sml-row-child-session"),"user"===e.data.role?(t.push("sml-row-llm-message"),t.push("sml-row-llm-sent")):"assistant"===e.data.role&&(t.push("sml-row-llm-message"),t.push("sml-row-llm-received")),k&&(e.data.content_hash===k||null!==(s=e.data.context_hashes)&&void 0!==s&&s.includes(k))&&t.push("sml-row-hover-highlighted"),t.join(" ")}})}),(0,u.jsxs)("div",{className:"sml-detail-panel",children:[(0,u.jsxs)("div",{className:"sml-detail-header",children:[(0,u.jsxs)("div",{className:"sml-detail-title",children:[(0,u.jsx)(c.In,{icon:(null===(o=b[H.role])||void 0===o?void 0:o.icon)||"mdi:help-circle-outline",width:"16",style:{color:(null===(d=b[H.role])||void 0===d?void 0:d.color)||"#64748b"}}),(0,u.jsx)("span",{className:"sml-detail-role",style:{color:null===(m=b[H.role])||void 0===m?void 0:m.color},children:(null===(g=b[H.role])||void 0===g?void 0:g.label)||H.role}),H.cell_name&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("span",{className:"sml-detail-sep",children:"\xb7"}),(0,u.jsx)("span",{className:"sml-detail-cell",children:H.cell_name})]}),H.model&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("span",{className:"sml-detail-sep",children:"\xb7"}),(0,u.jsx)("span",{className:"sml-detail-model",children:H.model})]})]}),(0,u.jsxs)("div",{className:"sml-detail-meta",children:[H.duration_ms>0&&(0,u.jsxs)("span",{className:"sml-detail-duration",children:[Math.round(H.duration_ms),"ms"]}),H.tokens_in>0&&(0,u.jsxs)("span",{className:"sml-detail-tokens",children:[H.tokens_in.toLocaleString()," in"]}),H.tokens_out>0&&(0,u.jsxs)("span",{className:"sml-detail-tokens",children:[H.tokens_out.toLocaleString()," out"]}),H.cost>0&&(0,u.jsxs)("span",{className:"sml-detail-cost",children:["$",H.cost.toFixed(4)]}),(0,u.jsx)("button",{className:"sml-detail-close",onClick:ae,children:(0,u.jsx)(c.In,{icon:"mdi:close",width:"16"})})]})]}),(0,u.jsxs)("div",{className:"sml-detail-body",children:[(0,u.jsxs)("div",{className:"sml-detail-section",children:[(0,u.jsxs)("div",{className:"sml-detail-section-header",children:[(0,u.jsx)(c.In,{icon:"render"===H.role?"mdi:checkbox-marked-circle-outline":"mdi:text",width:"14"}),(0,u.jsx)("span",{children:"render"===H.role?"Checkpoint Content":"Content"})]}),(0,u.jsx)("div",{className:"sml-detail-content-container",children:"render"===H.role?(e=>{let s=H.metadata_json;if("string"===typeof s)try{s=JSON.parse(s)}catch(t){s={}}return(0,u.jsx)(p,{uiSpec:H.content_json,checkpointId:(null===(e=s)||void 0===e?void 0:e.checkpoint_id)||H.trace_id,sessionId:H.session_id,compact:!0})})():(0,u.jsx)(h,{content:H.content_json})})]}),(()=>{const e=[];if(H.has_images&&H.images_json)try{const s="string"===typeof H.images_json?JSON.parse(H.images_json):H.images_json;Array.isArray(s)&&e.push(...s.map(e=>({path:e,source:"images_json"})))}catch(s){}if(H.metadata_json)try{const s="string"===typeof H.metadata_json?JSON.parse(H.metadata_json):H.metadata_json;s&&s.images&&Array.isArray(s.images)&&e.push(...s.images.map(e=>({path:e,source:"metadata"})))}catch(t){}if(H.content_json)try{let s=H.content_json;"string"===typeof s&&(s=JSON.parse(s)),s&&s.images&&Array.isArray(s.images)&&e.push(...s.images.map((e,s)=>({path:e,source:"content",label:"Screenshot ".concat(s+1)})))}catch(n){}return 0===e.length?null:(0,u.jsxs)("div",{className:"sml-detail-section sml-detail-section-images",children:[(0,u.jsxs)("div",{className:"sml-detail-section-header",children:[(0,u.jsx)(c.In,{icon:"mdi:image-multiple",width:"14"}),(0,u.jsxs)("span",{children:["Images (",e.length,")"]})]}),(0,u.jsx)("div",{className:"sml-detail-images-grid",children:e.map((e,s)=>{const t="string"===typeof e.path?e.path:"";if(!t)return null;let n,a;return t.startsWith("data:")?(n=t,a=e.label||"Screenshot ".concat(s+1)):t.startsWith("/api/")?(n=t,a=t):(n="/api/images/".concat(H.session_id,"/").concat(t),a=t),(0,u.jsxs)("div",{className:"sml-detail-image-item",children:[(0,u.jsx)("img",{src:n,alt:"Output ".concat(s+1),className:"sml-detail-image",loading:"lazy",onClick:()=>D({url:n,path:a}),title:"Click to view full size"}),(0,u.jsx)("div",{className:"sml-detail-image-label",children:a})]},s)})})]})})(),H.has_audio&&H.audio_json&&(()=>{try{const e="string"===typeof H.audio_json?JSON.parse(H.audio_json):H.audio_json;if(Array.isArray(e)&&e.length>0)return(0,u.jsxs)("div",{className:"sml-detail-section sml-detail-section-audio",children:[(0,u.jsxs)("div",{className:"sml-detail-section-header",children:[(0,u.jsx)(c.In,{icon:"mdi:music",width:"14"}),(0,u.jsxs)("span",{children:["Audio (",e.length,")"]})]}),(0,u.jsx)("div",{className:"sml-detail-audio-list",children:e.map((e,s)=>{const t="/api/audio/".concat(H.session_id,"/").concat(e);return(0,u.jsxs)("div",{className:"sml-detail-audio-item",children:[(0,u.jsxs)("audio",{controls:!0,className:"sml-detail-audio",children:[(0,u.jsx)("source",{src:t,type:"audio/mpeg"}),"Your browser does not support audio playback."]}),(0,u.jsx)("div",{className:"sml-detail-audio-label",children:e})]},s)})})]})}catch(e){console.error("[SessionMessagesLog] Error parsing audio:",e)}return null})(),H.metadata_json&&(0,u.jsxs)("div",{className:"sml-detail-section sml-detail-section-metadata",children:[(0,u.jsxs)("div",{className:"sml-detail-section-header",children:[(0,u.jsx)(c.In,{icon:"mdi:code-json",width:"14"}),(0,u.jsx)("span",{children:"Metadata"})]}),(0,u.jsx)("div",{className:"sml-detail-metadata-container",children:(0,u.jsx)(h,{content:H.metadata_json})})]})]})]})]}):(0,u.jsx)("div",{className:"sml-grid-container",children:(0,u.jsx)(l.W6,{ref:A,theme:v,rowData:q,columnDefs:Q,defaultColDef:Z,rowHeight:36,headerHeight:32,animateRows:!1,suppressCellFocus:!0,enableCellTextSelection:!0,suppressColumnVirtualisation:!0,suppressAnimationFrame:!0,getRowId:e=>e.data.message_id||"".concat(e.data.timestamp_iso,"-").concat(e.data.trace_id||e.node.id),onRowClicked:ne,rowSelection:"single",getRowClass:e=>{var s;const t=[];return e.data.message_id===(null===H||void 0===H?void 0:H.message_id)&&t.push("sml-row-selected"),w&&e.data.session_id&&e.data.session_id!==w&&t.push("sml-row-child-session"),"user"===e.data.role?(t.push("sml-row-llm-message"),t.push("sml-row-llm-sent")):"assistant"===e.data.role&&(t.push("sml-row-llm-message"),t.push("sml-row-llm-received")),k&&(e.data.content_hash===k||null!==(s=e.data.context_hashes)&&void 0!==s&&s.includes(k))&&t.push("sml-row-hover-highlighted"),t.join(" ")}})})]}),S&&(0,u.jsxs)("div",{className:"sml-filter-panel",children:[(0,u.jsxs)("div",{className:"sml-filter-header",children:[(0,u.jsx)(c.In,{icon:"mdi:filter-variant",width:"16"}),(0,u.jsx)("span",{children:"Filters"}),ce&&(0,u.jsx)("button",{className:"sml-filter-clear",onClick:te,children:"Clear"})]}),(0,u.jsx)("div",{className:"sml-filter-section",children:(0,u.jsxs)("div",{className:"sml-search-input",children:[(0,u.jsx)(c.In,{icon:"mdi:magnify",width:"14"}),(0,u.jsx)("input",{type:"text",placeholder:"Search...",value:B.searchText,onChange:e=>z(s=>(0,n.A)((0,n.A)({},s),{},{searchText:e.target.value}))}),B.searchText&&(0,u.jsx)("button",{className:"sml-search-clear",onClick:()=>z(e=>(0,n.A)((0,n.A)({},e),{},{searchText:""})),children:(0,u.jsx)(c.In,{icon:"mdi:close",width:"12"})})]})}),(0,u.jsx)("div",{className:"sml-filter-section",children:(0,u.jsxs)("button",{className:"sml-filter-toggle ".concat(B.winnersOnly?"active":""),onClick:()=>z(e=>(0,n.A)((0,n.A)({},e),{},{winnersOnly:!e.winnersOnly})),title:"Only show winning takes (hide losing take paths)",children:[(0,u.jsx)(c.In,{icon:B.winnersOnly?"mdi:trophy":"mdi:trophy-outline",width:"14"}),(0,u.jsx)("span",{children:"Winners Only"}),(0,u.jsx)(c.In,{icon:B.winnersOnly?"mdi:toggle-switch":"mdi:toggle-switch-off-outline",width:"18"})]})}),(0,u.jsxs)("div",{className:"sml-filter-section",children:[(0,u.jsx)("div",{className:"sml-filter-label",children:"Role"}),(0,u.jsx)("div",{className:"sml-filter-chips",children:J.roles.map(e=>{const s=b[e]||{icon:"mdi:help-circle-outline",color:"#64748b"},t=B.roles.has(e);return(0,u.jsxs)("button",{className:"sml-filter-chip ".concat(t?"active":""),style:{"--chip-color":s.color},onClick:()=>ee(e),children:[(0,u.jsx)(c.In,{icon:s.icon,width:"12"}),e]},e)})})]}),J.cells.length>0&&(0,u.jsxs)("div",{className:"sml-filter-section",children:[(0,u.jsx)("div",{className:"sml-filter-label",children:"Cell"}),(0,u.jsx)("div",{className:"sml-filter-chips sml-filter-chips-vertical",children:J.cells.map(e=>{const s=B.cells.has(e);return(0,u.jsxs)("button",{className:"sml-filter-chip sml-filter-chip-cell ".concat(s?"active":""),onClick:()=>se(e),children:[(0,u.jsx)(c.In,{icon:s?"mdi:checkbox-marked":"mdi:checkbox-blank-outline",width:"14"}),e]},e)})})]})]}),(0,u.jsx)(r.aF,{isOpen:!!P,onClose:()=>D(null),size:"full",closeOnBackdrop:!0,closeOnEscape:!0,className:"sml-image-modal",children:P&&(0,u.jsxs)("div",{className:"sml-modal-image-container",children:[(0,u.jsxs)("div",{className:"sml-modal-image-header",children:[(0,u.jsx)(c.In,{icon:"mdi:image",width:"20"}),(0,u.jsx)("span",{className:"sml-modal-image-title",children:P.path})]}),(0,u.jsx)("div",{className:"sml-modal-image-body",children:(0,u.jsx)("img",{src:P.url,alt:"Full size",className:"sml-modal-image",onClick:()=>D(null)})})]})})]})}}}]);
//# sourceMappingURL=794.1f7afc5e.chunk.js.map