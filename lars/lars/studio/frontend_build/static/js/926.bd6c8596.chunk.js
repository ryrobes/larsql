"use strict";(self.webpackChunklars_ui=self.webpackChunklars_ui||[]).push([[926],{25926:(e,s,a)=>{a.r(s),a.d(s,{default:()=>Se});var l=a(65043),n=a(45685),i=a(5748),t=a(64065),c=a(90628),r=a(10777),o=a(60263),d=a(24227),h=a(70579);const m=e=>{let{insight:s}=e;const a=(0,n.Zp)(),[t,c]=(0,l.useState)(null),[m,x]=(0,l.useState)(!1),[u,v]=(0,l.useState)(!1),j={critical:{icon:"mdi:alert-circle",color:"#ff006e"},warning:{icon:"mdi:alert",color:"#fbbf24"},major:{icon:"mdi:alert",color:"#fbbf24"},info:{icon:"mdi:information",color:"#60a5fa"}},p=j[s.severity]||j.info;(0,l.useEffect)(()=>{var e;if("context_hotspot"===s.type&&null!==(e=s.action)&&void 0!==e&&e.cell_name&&u){(async()=>{x(!0);try{const e=s.message.match(/in '([^']+)'/),a=e?e[1]:null;if(!a)return void x(!1);const l=new URLSearchParams({days:"7",cascade_id:a,cell_name:s.action.cell_name}),n=await fetch("".concat(d.J,"/api/receipts/context-breakdown?").concat(l)),i=await n.json();i.breakdown&&i.breakdown.length>0&&c(i.breakdown[0])}catch(e){console.error("Failed to fetch context breakdown:",e)}finally{x(!1)}})()}},[s,u]);const g="context_hotspot"===s.type;return(0,h.jsxs)("div",{className:"insight-card insight-".concat(s.severity),children:[(0,h.jsxs)("div",{className:"insight-main",onClick:g?()=>v(!u):void 0,children:[(0,h.jsx)(i.In,{icon:p.icon,width:12,style:{color:p.color},className:"insight-icon"}),(0,h.jsx)("span",{className:"insight-message",children:s.message}),s.action&&(0,h.jsx)("button",{className:"insight-action",onClick:e=>{e.stopPropagation(),(()=>{var e,l;if("view_session"===(null===(e=s.action)||void 0===e?void 0:e.type)||"view_context"===(null===(l=s.action)||void 0===l?void 0:l.type)){const e=s.action.cascade_id,l=s.action.session_id;a(e&&l?o.bw.studioWithSession(e,l):e?o.bw.studioWithCascade(e):o.bw.STUDIO)}})()},children:(0,h.jsx)(i.In,{icon:"mdi:arrow-right",width:12})}),g&&(0,h.jsx)(i.In,{icon:u?"mdi:chevron-up":"mdi:chevron-down",width:14,className:"insight-expand"})]}),u&&"context_hotspot"===s.type&&(0,h.jsxs)("div",{className:"insight-context-breakdown",children:[m&&(0,h.jsxs)("div",{className:"insight-context-loading",children:[(0,h.jsx)(i.In,{icon:"mdi:loading",className:"spin",width:14}),(0,h.jsx)("span",{children:"Loading breakdown..."})]}),t&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)("div",{className:"insight-context-header",children:[(0,h.jsx)("span",{className:"insight-context-session",children:t.session_id}),(0,h.jsx)("span",{className:"insight-context-model",children:t.model}),null!==t.take_index&&(0,h.jsxs)(r.A,{variant:"label",color:"purple",size:"sm",children:["#",t.take_index]})]}),(0,h.jsx)("div",{className:"insight-context-messages",children:t.messages.map((e,s)=>(0,h.jsxs)("div",{className:"insight-context-message",children:[(0,h.jsx)("span",{className:"msg-hash",children:e.hash.substring(0,8)}),(0,h.jsx)("span",{className:"msg-source",children:e.source_cell}),(0,h.jsx)("span",{className:"msg-role msg-role-".concat(e.role),children:e.role}),(0,h.jsx)("span",{className:"msg-tokens",children:e.tokens.toLocaleString()}),(0,h.jsxs)("span",{className:"msg-cost",children:["$",e.cost.toFixed(6)]}),(0,h.jsxs)("div",{className:"msg-pct",children:[(0,h.jsx)("div",{className:"msg-pct-bar",style:{width:"".concat(Math.min(e.pct,100),"%"),backgroundColor:e.pct>50?"#ff006e":e.pct>20?"#fbbf24":"#34d399"}}),(0,h.jsxs)("span",{children:[e.pct.toFixed(1),"%"]})]})]},s))})]})]})]})},x=(0,l.memo)(m);var u=a(89379),v=a(50108),j=a(877),p=a(87734),g=a(52185),N=a(6026),f=a(86150),w=a(73243),b=a(13839);const _=e=>{let{data:s=[],loading:a=!1,granularity:n="daily",onPointClick:c=null}=e;const r=(0,l.useMemo)(()=>s&&0!==s.length?s.map(e=>{const s=new Date(e.date);let a;return a="hourly"===n?s.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}):"weekly"===n?"Wk ".concat(Math.ceil(s.getDate()/7)):"monthly"===n?s.toLocaleDateString("en-US",{month:"short"}):s.toLocaleDateString("en-US",{month:"short",day:"numeric"}),(0,u.A)((0,u.A)({},e),{},{label:a,displayCost:e.cost,displayContextCost:e.context_cost||0,newCost:(e.cost||0)-(e.context_cost||0)})}):[],[s,n]),o=(0,l.useMemo)(()=>0===r.length?0:r.reduce((e,s)=>e+s.displayCost,0)/r.length,[r]),d=e=>"$".concat(e>=1?e.toFixed(2):e>=.01?e.toFixed(3):e.toFixed(4)),m=e=>{let{active:s,payload:a}=e;if(s&&a&&a.length){const e=a[0].payload;return(0,h.jsxs)("div",{className:"cost-trend-tooltip",children:[(0,h.jsx)("div",{className:"tooltip-header",children:e.label}),(0,h.jsxs)("div",{className:"tooltip-row highlight",children:[(0,h.jsx)("span",{children:"Total:"}),(0,h.jsx)("span",{children:d(e.displayCost)})]}),(0,h.jsxs)("div",{className:"tooltip-row",children:[(0,h.jsx)("span",{children:"Context:"}),(0,h.jsx)("span",{className:"context",children:d(e.displayContextCost)})]}),(0,h.jsxs)("div",{className:"tooltip-row",children:[(0,h.jsx)("span",{children:"New:"}),(0,h.jsx)("span",{className:"new",children:d(e.newCost)})]}),(0,h.jsxs)("div",{className:"tooltip-row",children:[(0,h.jsx)("span",{children:"Runs:"}),(0,h.jsx)("span",{children:e.runs})]})]})}return null};return a?(0,h.jsx)("div",{className:"cost-trend-chart loading",children:(0,h.jsx)(t.lp,{size:"small",showMessage:!1})}):0===r.length?(0,h.jsx)("div",{className:"cost-trend-chart empty",children:(0,h.jsxs)("div",{className:"chart-empty",children:[(0,h.jsx)(i.In,{icon:"mdi:chart-line",width:24}),(0,h.jsx)("span",{children:"No data"})]})}):(0,h.jsxs)("div",{className:"cost-trend-chart",children:[(0,h.jsx)("div",{className:"chart-container",children:(0,h.jsx)(v.u,{width:"100%",height:120,children:(0,h.jsxs)(j.Q,{data:r,margin:{top:8,right:8,left:0,bottom:0},children:[(0,h.jsxs)("defs",{children:[(0,h.jsxs)("linearGradient",{id:"costGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,h.jsx)("stop",{offset:"5%",stopColor:"#00e5ff",stopOpacity:.25}),(0,h.jsx)("stop",{offset:"95%",stopColor:"#00e5ff",stopOpacity:0})]}),(0,h.jsxs)("linearGradient",{id:"contextGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,h.jsx)("stop",{offset:"5%",stopColor:"#a78bfa",stopOpacity:.25}),(0,h.jsx)("stop",{offset:"95%",stopColor:"#a78bfa",stopOpacity:0})]})]}),(0,h.jsx)(p.d,{strokeDasharray:"3 3",stroke:"rgba(100, 116, 139, 0.1)",vertical:!1}),(0,h.jsx)(g.W,{dataKey:"label",tick:{fill:"#64748b",fontSize:9},axisLine:{stroke:"rgba(100, 116, 139, 0.15)"},tickLine:!1,interval:"preserveStartEnd"}),(0,h.jsx)(N.h,{tick:{fill:"#64748b",fontSize:9},tickFormatter:d,axisLine:!1,tickLine:!1,width:50}),(0,h.jsx)(f.m,{content:(0,h.jsx)(m,{})}),(0,h.jsx)(w.e,{y:o,stroke:"#475569",strokeDasharray:"3 3"}),(0,h.jsx)(b.G,{type:"monotone",dataKey:"displayContextCost",stackId:"1",stroke:"#a78bfa",strokeWidth:0,fill:"url(#contextGradient)"}),(0,h.jsx)(b.G,{type:"monotone",dataKey:"newCost",stackId:"1",stroke:"#00e5ff",strokeWidth:1.5,fill:"url(#costGradient)",activeDot:{r:4,fill:"#00e5ff",stroke:"#0a0a0a",strokeWidth:2,cursor:c?"pointer":"default"}})]})})}),(0,h.jsxs)("div",{className:"chart-legend",children:[(0,h.jsxs)("span",{className:"legend-item",children:[(0,h.jsx)("span",{className:"legend-dot",style:{background:"#00e5ff"}}),"New Content"]}),(0,h.jsxs)("span",{className:"legend-item",children:[(0,h.jsx)("span",{className:"legend-dot",style:{background:"#a78bfa"}}),"Context"]}),(0,h.jsxs)("span",{className:"legend-item",children:[(0,h.jsx)("span",{className:"legend-line"}),"Avg"]})]})]})},k=(0,l.memo)(_);var y=a(82291),C=a(38643),S=a(17869),I=a(60163),A=a(4240);const F=["#00e5ff","#a78bfa","#34d399","#fbbf24","#ff006e","#60a5fa","#f472b6","#4ade80","#fb923c","#818cf8"],M=e=>{let{data:s=[],type:a="cascade",chartType:n="bar",loading:c=!1,onItemClick:r=null,grandTotal:o=0}=e;const[d,m]=(0,l.useState)(null),x=(0,l.useMemo)(()=>s&&0!==s.length?s.slice(0,8).map((e,s)=>{const l="cascade"===a?e.cascade_id:e.display_name||e.model,n=l.length>25?l.substring(0,22)+"...":l;return(0,u.A)((0,u.A)({},e),{},{name:n,fullName:l,cost:e.total_cost,pct:e.pct_of_total,color:F[s%F.length]})}):[],[s,a]),j=function(e){return"$".concat(arguments.length>1&&void 0!==arguments[1]&&arguments[1]?e.toFixed(4):e>=1?e.toFixed(2):e>=.01?e.toFixed(3):e.toFixed(4))},w=e=>{let{active:s,payload:a}=e;if(s&&a&&a.length){const e=a[0].payload;return(0,h.jsxs)("div",{className:"breakdown-tooltip",children:[(0,h.jsx)("div",{className:"tooltip-header",children:e.fullName}),(0,h.jsxs)("div",{className:"tooltip-row highlight",children:[(0,h.jsx)("span",{children:"Total Cost:"}),(0,h.jsx)("span",{children:j(e.cost)})]}),(0,h.jsxs)("div",{className:"tooltip-row",children:[(0,h.jsx)("span",{children:"% of Total:"}),(0,h.jsxs)("span",{children:[e.pct.toFixed(1),"%"]})]}),(0,h.jsxs)("div",{className:"tooltip-row",children:[(0,h.jsx)("span",{children:"Runs:"}),(0,h.jsx)("span",{children:e.run_count})]}),(0,h.jsxs)("div",{className:"tooltip-row",children:[(0,h.jsx)("span",{children:"Avg per Run:"}),(0,h.jsx)("span",{children:j(e.avg_cost)})]}),e.outlier_count>0&&(0,h.jsxs)("div",{className:"tooltip-row warning",children:[(0,h.jsx)("span",{children:"Outliers:"}),(0,h.jsx)("span",{children:e.outlier_count})]})]})}return null},b=e=>{let{active:s,payload:a}=e;if(s&&a&&a.length){const e=a[0].payload;return(0,h.jsxs)("div",{className:"breakdown-tooltip",children:[(0,h.jsx)("div",{className:"tooltip-header",children:e.fullName}),(0,h.jsxs)("div",{className:"tooltip-row highlight",children:[(0,h.jsx)("span",{children:"Total Cost:"}),(0,h.jsx)("span",{children:j(e.cost)})]}),(0,h.jsxs)("div",{className:"tooltip-row",children:[(0,h.jsx)("span",{children:"% of Total:"}),(0,h.jsxs)("span",{children:[e.pct.toFixed(1),"%"]})]}),(0,h.jsxs)("div",{className:"tooltip-row",children:[(0,h.jsx)("span",{children:"Runs:"}),(0,h.jsx)("span",{children:e.run_count})]}),e.total_tokens&&(0,h.jsxs)("div",{className:"tooltip-row",children:[(0,h.jsx)("span",{children:"Tokens:"}),(0,h.jsx)("span",{children:e.total_tokens.toLocaleString()})]})]})}return null},_="cascade"===a?"Cost by Cascade":"Cost by Model",k="cascade"===a?"mdi:sitemap":"mdi:chip";return c?(0,h.jsxs)("div",{className:"cost-breakdown-chart loading",children:[(0,h.jsx)("div",{className:"chart-header",children:(0,h.jsxs)("span",{className:"chart-title",children:[(0,h.jsx)(i.In,{icon:k,width:14}),_]})}),(0,h.jsx)(t.lp,{size:"small",showMessage:!1})]}):0===x.length?(0,h.jsxs)("div",{className:"cost-breakdown-chart empty",children:[(0,h.jsx)("div",{className:"chart-header",children:(0,h.jsxs)("span",{className:"chart-title",children:[(0,h.jsx)(i.In,{icon:k,width:14}),_]})}),(0,h.jsxs)("div",{className:"chart-empty",children:[(0,h.jsx)(i.In,{icon:"pie"===n?"mdi:chart-pie":"mdi:chart-bar",width:24}),(0,h.jsx)("span",{children:"No data"})]})]}):(0,h.jsxs)("div",{className:"cost-breakdown-chart",children:[(0,h.jsxs)("div",{className:"chart-header",children:[(0,h.jsxs)("span",{className:"chart-title",children:[(0,h.jsx)(i.In,{icon:k,width:14}),_]}),(0,h.jsxs)("span",{className:"chart-subtitle",children:[s.length," ","cascade"===a?"cascades":"models"," \xb7 ",j(o)," total"]})]}),(0,h.jsx)("div",{className:"chart-container",children:"bar"===n?(0,h.jsx)(v.u,{width:"100%",height:140,children:(0,h.jsxs)(y.E,{data:x,layout:"vertical",margin:{top:5,right:10,left:0,bottom:5},children:[(0,h.jsx)(p.d,{strokeDasharray:"3 3",stroke:"rgba(100, 116, 139, 0.1)",horizontal:!0,vertical:!1}),(0,h.jsx)(g.W,{type:"number",tick:{fill:"#64748b",fontSize:9},tickFormatter:j,axisLine:{stroke:"rgba(100, 116, 139, 0.15)"},tickLine:!1}),(0,h.jsx)(N.h,{type:"category",dataKey:"name",tick:{fill:"#94a3b8",fontSize:10},axisLine:!1,tickLine:!1,width:110}),(0,h.jsx)(f.m,{content:(0,h.jsx)(w,{}),cursor:{fill:"rgba(255, 255, 255, 0.03)"}}),(0,h.jsx)(C.y,{dataKey:"cost",radius:[0,3,3,0],onClick:e=>r&&r(e),onMouseEnter:(e,s)=>m(s),onMouseLeave:()=>m(null),style:{cursor:r?"pointer":"default"},children:x.map((e,s)=>(0,h.jsx)(S.f,{fill:e.color,opacity:null===d?.85:d===s?1:.5},"cell-".concat(s)))})]})}):(0,h.jsx)(v.u,{width:"100%",height:140,children:(0,h.jsxs)(I.r,{children:[(0,h.jsx)(A.F,{data:x,cx:"50%",cy:"50%",innerRadius:45,outerRadius:70,paddingAngle:2,dataKey:"cost",labelLine:!1,label:e=>{let{name:s,pct:a,cx:l,cy:n,midAngle:i,innerRadius:t,outerRadius:c}=e;if(a<5)return null;const r=Math.PI/180,o=t+.5*(c-t),d=l+o*Math.cos(-i*r),m=n+o*Math.sin(-i*r);return(0,h.jsxs)("text",{x:d,y:m,fill:"#fff",textAnchor:"middle",dominantBaseline:"central",fontSize:10,fontWeight:500,children:[a.toFixed(0),"%"]})},onClick:e=>r&&r(e),onMouseEnter:(e,s)=>m(s),onMouseLeave:()=>m(null),style:{cursor:r?"pointer":"default"},children:x.map((e,s)=>(0,h.jsx)(S.f,{fill:e.color,opacity:null===d?.85:d===s?1:.5,stroke:d===s?"#fff":"transparent",strokeWidth:2},"cell-".concat(s)))}),(0,h.jsx)(f.m,{content:(0,h.jsx)(b,{})})]})})}),"bar"===n&&(0,h.jsxs)("div",{className:"chart-data-grid",children:[(0,h.jsxs)("div",{className:"grid-header",children:[(0,h.jsx)("span",{className:"grid-col col-name",children:"Name"}),(0,h.jsx)("span",{className:"grid-col col-cost",children:"Cost"}),(0,h.jsx)("span",{className:"grid-col col-pct",children:"%"})]}),(0,h.jsx)("div",{className:"grid-body",children:x.map((e,s)=>(0,h.jsxs)("div",{className:"grid-row ".concat(d===s?"hovered":""),onMouseEnter:()=>m(s),onMouseLeave:()=>m(null),onClick:()=>r&&r(e),children:[(0,h.jsxs)("span",{className:"grid-col col-name",children:[(0,h.jsx)("span",{className:"legend-dot",style:{background:e.color}}),e.name]}),(0,h.jsx)("span",{className:"grid-col col-cost",children:j(e.cost,!0)}),(0,h.jsxs)("span",{className:"grid-col col-pct",children:[e.pct.toFixed(1),"%"]})]},s))})]}),"pie"===n&&(0,h.jsxs)("div",{className:"chart-data-grid",children:[(0,h.jsxs)("div",{className:"grid-header",children:[(0,h.jsx)("span",{className:"grid-col col-name",children:"Model"}),(0,h.jsx)("span",{className:"grid-col col-cost",children:"Cost"}),(0,h.jsx)("span",{className:"grid-col col-pct",children:"%"})]}),(0,h.jsx)("div",{className:"grid-body",children:x.map((e,s)=>(0,h.jsxs)("div",{className:"grid-row ".concat(d===s?"hovered":""),onMouseEnter:()=>m(s),onMouseLeave:()=>m(null),onClick:()=>r&&r(e),children:[(0,h.jsxs)("span",{className:"grid-col col-name",children:[(0,h.jsx)("span",{className:"legend-dot",style:{background:e.color}}),e.name]}),(0,h.jsx)("span",{className:"grid-col col-cost",children:j(e.cost,!0)}),(0,h.jsxs)("span",{className:"grid-col col-pct",children:[e.pct.toFixed(1),"%"]})]},s))})]})]})},T=(0,l.memo)(M);var L=a(16350),z=a(90168);const E=e=>{let{data:s=[],loading:a=!1,granularity:n="daily"}=e;const c=(0,l.useMemo)(()=>s&&0!==s.length?s.map(e=>{const s=new Date(e.date);let a;return a="hourly"===n?s.toLocaleTimeString("en-US",{hour:"numeric"}):"weekly"===n?"W".concat(Math.ceil(s.getDate()/7)):"monthly"===n?s.toLocaleDateString("en-US",{month:"short"}):s.toLocaleDateString("en-US",{month:"short",day:"numeric"}),{label:a,runs:e.runs||0,avgCost:e.avg_cost||0,contextPct:e.context_pct||0}}):[],[s,n]),r=(0,l.useMemo)(()=>{if(0===c.length)return{totalRuns:0,avgPerPeriod:0,avgCostPerRun:0};const e=c.reduce((e,s)=>e+s.runs,0);return{totalRuns:e,avgPerPeriod:e/c.length,avgCostPerRun:c.reduce((e,s)=>e+s.avgCost,0)/c.length}},[c]),o=function(e){return"$".concat(arguments.length>1&&void 0!==arguments[1]&&arguments[1]?e.toFixed(4):e>=.01?e.toFixed(3):e.toFixed(4))},d=e=>{let{active:s,payload:a}=e;if(s&&a&&a.length){const e=a[0].payload;return(0,h.jsxs)("div",{className:"runs-tooltip",children:[(0,h.jsx)("div",{className:"tooltip-header",children:e.label}),(0,h.jsxs)("div",{className:"tooltip-row",children:[(0,h.jsx)("span",{children:"Runs:"}),(0,h.jsx)("span",{className:"runs",children:e.runs})]}),(0,h.jsxs)("div",{className:"tooltip-row",children:[(0,h.jsx)("span",{children:"Avg Cost:"}),(0,h.jsx)("span",{className:"cost",children:o(e.avgCost)})]}),(0,h.jsxs)("div",{className:"tooltip-row",children:[(0,h.jsx)("span",{children:"Context %:"}),(0,h.jsxs)("span",{children:[e.contextPct.toFixed(1),"%"]})]})]})}return null};return a?(0,h.jsxs)("div",{className:"runs-activity-chart loading",children:[(0,h.jsxs)("div",{className:"chart-header",children:[(0,h.jsx)(i.In,{icon:"mdi:chart-line-variant",width:14}),(0,h.jsx)("span",{className:"chart-title",children:"Runs & Efficiency"})]}),(0,h.jsx)(t.lp,{size:"small",showMessage:!1})]}):0===c.length?(0,h.jsxs)("div",{className:"runs-activity-chart empty",children:[(0,h.jsxs)("div",{className:"chart-header",children:[(0,h.jsx)(i.In,{icon:"mdi:chart-line-variant",width:14}),(0,h.jsx)("span",{className:"chart-title",children:"Runs & Efficiency"})]}),(0,h.jsxs)("div",{className:"chart-empty",children:[(0,h.jsx)(i.In,{icon:"mdi:chart-line",width:24}),(0,h.jsx)("span",{children:"No data"})]})]}):(0,h.jsxs)("div",{className:"runs-activity-chart",children:[(0,h.jsxs)("div",{className:"chart-header",children:[(0,h.jsx)(i.In,{icon:"mdi:chart-line-variant",width:14}),(0,h.jsx)("span",{className:"chart-title",children:"Runs & Efficiency"}),(0,h.jsxs)("div",{className:"chart-stats",children:[(0,h.jsxs)("span",{className:"stat",children:[(0,h.jsx)("span",{className:"stat-value runs",children:r.totalRuns}),(0,h.jsx)("span",{className:"stat-label",children:"runs"})]}),(0,h.jsxs)("span",{className:"stat",children:[(0,h.jsx)("span",{className:"stat-value cost",children:o(r.avgCostPerRun)}),(0,h.jsx)("span",{className:"stat-label",children:"/run"})]})]})]}),(0,h.jsx)("div",{className:"chart-container",children:(0,h.jsx)(v.u,{width:"100%",height:100,children:(0,h.jsxs)(L.X,{data:c,margin:{top:5,right:5,left:0,bottom:0},children:[(0,h.jsx)("defs",{children:(0,h.jsxs)("linearGradient",{id:"runsGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,h.jsx)("stop",{offset:"5%",stopColor:"#a78bfa",stopOpacity:.3}),(0,h.jsx)("stop",{offset:"95%",stopColor:"#a78bfa",stopOpacity:0})]})}),(0,h.jsx)(g.W,{dataKey:"label",tick:{fill:"#64748b",fontSize:8},axisLine:{stroke:"rgba(100, 116, 139, 0.15)"},tickLine:!1,interval:"preserveStartEnd"}),(0,h.jsx)(N.h,{yAxisId:"runs",tick:{fill:"#64748b",fontSize:8},axisLine:!1,tickLine:!1,width:30}),(0,h.jsx)(N.h,{yAxisId:"cost",orientation:"right",tick:{fill:"#64748b",fontSize:8},tickFormatter:o,axisLine:!1,tickLine:!1,width:40}),(0,h.jsx)(f.m,{content:(0,h.jsx)(d,{})}),(0,h.jsx)(b.G,{yAxisId:"runs",type:"monotone",dataKey:"runs",stroke:"#a78bfa",strokeWidth:1.5,fill:"url(#runsGradient)"}),(0,h.jsx)(z.N,{yAxisId:"cost",type:"monotone",dataKey:"avgCost",stroke:"#00e5ff",strokeWidth:1.5,dot:!1,strokeDasharray:"3 3"})]})})}),(0,h.jsxs)("div",{className:"chart-legend",children:[(0,h.jsxs)("span",{className:"legend-item",children:[(0,h.jsx)("span",{className:"legend-dot",style:{background:"#a78bfa"}}),"Runs"]}),(0,h.jsxs)("span",{className:"legend-item",children:[(0,h.jsx)("span",{className:"legend-line"}),"Avg Cost/Run"]})]}),(0,h.jsxs)("div",{className:"chart-data-grid",children:[(0,h.jsxs)("div",{className:"grid-header",children:[(0,h.jsx)("span",{className:"grid-col col-period",children:"Period"}),(0,h.jsx)("span",{className:"grid-col col-runs",children:"Runs"}),(0,h.jsx)("span",{className:"grid-col col-avg",children:"Avg Cost"}),(0,h.jsx)("span",{className:"grid-col col-ctx",children:"Ctx %"})]}),(0,h.jsx)("div",{className:"grid-body",children:c.slice(0,8).map((e,s)=>(0,h.jsxs)("div",{className:"grid-row",children:[(0,h.jsx)("span",{className:"grid-col col-period",children:e.label}),(0,h.jsx)("span",{className:"grid-col col-runs",children:e.runs}),(0,h.jsx)("span",{className:"grid-col col-avg",children:o(e.avgCost,!0)}),(0,h.jsxs)("span",{className:"grid-col col-ctx",children:[e.contextPct.toFixed(0),"%"]})]},s))})]})]})},R=(0,l.memo)(E),W=e=>{let{data:s=null,loading:a=!1}=e;const n=(0,l.useMemo)(()=>null!==s&&void 0!==s&&s.distribution?s.distribution.map(e=>(0,u.A)((0,u.A)({},e),{},{name:e.label})):[],[s]),c=(0,l.useMemo)(()=>{if(!s)return{useful:0,wasted:0,efficiency:0};return{useful:(s.high_value_cost||0)+(s.medium_value_cost||0),wasted:s.wasted_cost||0,efficiency:s.efficiency_score||0,wastedPct:s.wasted_pct||0}},[s]),r=e=>"$".concat(e>=1?e.toFixed(2):e>=.01?e.toFixed(3):e.toFixed(4)),o=e=>{let{active:s,payload:a}=e;if(s&&a&&a.length){const e=a[0].payload;return(0,h.jsxs)("div",{className:"context-value-tooltip",children:[(0,h.jsxs)("div",{className:"tooltip-header",children:[e.label," (",e.tier,")"]}),(0,h.jsxs)("div",{className:"tooltip-row",children:[(0,h.jsx)("span",{children:"Cost:"}),(0,h.jsx)("span",{className:"value",children:r(e.cost)})]}),(0,h.jsxs)("div",{className:"tooltip-row",children:[(0,h.jsx)("span",{children:"Messages:"}),(0,h.jsx)("span",{children:e.count})]}),(0,h.jsxs)("div",{className:"tooltip-row",children:[(0,h.jsx)("span",{children:"% of Context:"}),(0,h.jsxs)("span",{children:[e.pct.toFixed(1),"%"]})]})]})}return null};return a?(0,h.jsxs)("div",{className:"context-value-chart loading",children:[(0,h.jsxs)("div",{className:"chart-header",children:[(0,h.jsx)(i.In,{icon:"mdi:target",width:14}),(0,h.jsx)("span",{className:"chart-title",children:"Context Value"})]}),(0,h.jsx)(t.lp,{size:"small",showMessage:!1})]}):s&&0!==n.length?(0,h.jsxs)("div",{className:"context-value-chart",children:[(0,h.jsxs)("div",{className:"chart-header",children:[(0,h.jsx)(i.In,{icon:"mdi:target",width:14}),(0,h.jsx)("span",{className:"chart-title",children:"Context Value"}),(0,h.jsxs)("div",{className:"chart-stats",children:[(0,h.jsxs)("span",{className:"stat useful",children:[(0,h.jsx)("span",{className:"stat-value",children:r(c.useful)}),(0,h.jsx)("span",{className:"stat-label",children:"useful"})]}),(0,h.jsxs)("span",{className:"stat wasted",children:[(0,h.jsx)("span",{className:"stat-value",children:r(c.wasted)}),(0,h.jsx)("span",{className:"stat-label",children:"wasted"})]})]})]}),(0,h.jsx)("div",{className:"chart-container",children:(0,h.jsx)(v.u,{width:"100%",height:100,children:(0,h.jsxs)(y.E,{data:n,layout:"vertical",margin:{top:5,right:5,left:0,bottom:5},children:[(0,h.jsx)(g.W,{type:"number",tick:{fill:"#64748b",fontSize:8},tickFormatter:e=>"".concat(e.toFixed(0),"%"),axisLine:{stroke:"rgba(100, 116, 139, 0.15)"},tickLine:!1,domain:[0,"dataMax"]}),(0,h.jsx)(N.h,{type:"category",dataKey:"name",tick:{fill:"#94a3b8",fontSize:9},axisLine:!1,tickLine:!1,width:55}),(0,h.jsx)(f.m,{content:(0,h.jsx)(o,{}),cursor:{fill:"rgba(255, 255, 255, 0.03)"}}),(0,h.jsx)(C.y,{dataKey:"pct",radius:[0,3,3,0],children:n.map((e,s)=>(0,h.jsx)(S.f,{fill:e.color,opacity:.85},"cell-".concat(s)))})]})})}),(0,h.jsxs)("div",{className:"chart-data-grid",children:[(0,h.jsxs)("div",{className:"grid-header",children:[(0,h.jsx)("span",{className:"grid-col col-tier",children:"Tier"}),(0,h.jsx)("span",{className:"grid-col col-cost",children:"Cost"}),(0,h.jsx)("span",{className:"grid-col col-msgs",children:"Msgs"}),(0,h.jsx)("span",{className:"grid-col col-pct",children:"%"})]}),(0,h.jsx)("div",{className:"grid-body",children:n.map((e,s)=>(0,h.jsxs)("div",{className:"grid-row",children:[(0,h.jsxs)("span",{className:"grid-col col-tier",children:[(0,h.jsx)("span",{className:"tier-dot",style:{background:e.color}}),e.label]}),(0,h.jsx)("span",{className:"grid-col col-cost",children:r(e.cost)}),(0,h.jsx)("span",{className:"grid-col col-msgs",children:e.count}),(0,h.jsxs)("span",{className:"grid-col col-pct",children:[e.pct.toFixed(1),"%"]})]},s))})]})]}):(0,h.jsxs)("div",{className:"context-value-chart empty",children:[(0,h.jsxs)("div",{className:"chart-header",children:[(0,h.jsx)(i.In,{icon:"mdi:target",width:14}),(0,h.jsx)("span",{className:"chart-title",children:"Context Value"})]}),(0,h.jsxs)("div",{className:"chart-empty",children:[(0,h.jsx)(i.In,{icon:"mdi:database-off",width:24}),(0,h.jsx)("span",{children:"No relevance data"})]})]})},P=(0,l.memo)(W),D=e=>{let{sessions:s=[],loading:a=!1,onSessionClick:n=null}=e;const[c,r]=(0,l.useState)(null),o=e=>{if(!e)return"-";return new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},d=e=>{if(!e)return"-";const s=e.includes("/")?e.split("/").pop():e;return s.length>18?s.substring(0,15)+"...":s};return a?(0,h.jsxs)("div",{className:"top-expensive-list loading",children:[(0,h.jsx)("div",{className:"list-header",children:(0,h.jsxs)("span",{className:"list-title",children:[(0,h.jsx)(i.In,{icon:"mdi:podium",width:16}),"Top Expensive Runs"]})}),(0,h.jsx)(t.lp,{size:"small",showMessage:!1})]}):0===s.length?(0,h.jsxs)("div",{className:"top-expensive-list empty",children:[(0,h.jsx)("div",{className:"list-header",children:(0,h.jsxs)("span",{className:"list-title",children:[(0,h.jsx)(i.In,{icon:"mdi:podium",width:16}),"Top Expensive Runs"]})}),(0,h.jsxs)("div",{className:"list-empty",children:[(0,h.jsx)(i.In,{icon:"mdi:trophy-outline",width:32}),(0,h.jsx)("span",{children:"No sessions yet"})]})]}):(0,h.jsxs)("div",{className:"top-expensive-list",children:[(0,h.jsxs)("div",{className:"list-header",children:[(0,h.jsxs)("span",{className:"list-title",children:[(0,h.jsx)(i.In,{icon:"mdi:podium",width:16}),"Top Expensive Runs"]}),(0,h.jsxs)("span",{className:"list-subtitle",children:[s.length," sessions"]})]}),(0,h.jsx)("div",{className:"list-content",children:s.map((e,s)=>{var a,l,t;return(0,h.jsxs)("div",{className:"list-item ".concat(c===s?"hovered":""," ").concat(e.is_outlier?"outlier":""),onMouseEnter:()=>r(s),onMouseLeave:()=>r(null),onClick:()=>n&&n(e),children:[(0,h.jsxs)("div",{className:"item-rank",children:[0===s&&(0,h.jsx)(i.In,{icon:"mdi:medal",className:"gold",width:16}),1===s&&(0,h.jsx)(i.In,{icon:"mdi:medal",className:"silver",width:16}),2===s&&(0,h.jsx)(i.In,{icon:"mdi:medal",className:"bronze",width:16}),s>2&&(0,h.jsxs)("span",{className:"rank-number",children:["#",s+1]})]}),(0,h.jsxs)("div",{className:"item-main",children:[(0,h.jsxs)("div",{className:"item-top-row",children:[(0,h.jsx)("span",{className:"item-cascade",children:e.cascade_id}),e.is_outlier&&(0,h.jsxs)("span",{className:"outlier-badge",title:"Z-score: ".concat(null===(a=e.z_score)||void 0===a?void 0:a.toFixed(1)),children:[(0,h.jsx)(i.In,{icon:"mdi:alert-circle",width:12}),"Outlier"]})]}),(0,h.jsxs)("div",{className:"item-meta",children:[(0,h.jsxs)("span",{className:"meta-item",children:[(0,h.jsx)(i.In,{icon:"mdi:chip",width:12}),d(e.model)]}),(0,h.jsxs)("span",{className:"meta-item",children:[(0,h.jsx)(i.In,{icon:"mdi:clock-outline",width:12}),(t=e.duration_ms,t?t>=6e4?"".concat((t/6e4).toFixed(1),"m"):t>=1e3?"".concat((t/1e3).toFixed(1),"s"):"".concat(t.toFixed(0),"ms"):"-")]}),e.takes>0&&(0,h.jsxs)("span",{className:"meta-item",children:[(0,h.jsx)(i.In,{icon:"mdi:source-branch",width:12}),e.takes," takes"]})]})]}),(0,h.jsxs)("div",{className:"item-cost",children:[(0,h.jsx)("span",{className:"cost-value",children:(l=e.cost,"$".concat(l>=1?l.toFixed(2):l>=.01?l.toFixed(3):l.toFixed(4)))}),e.context_pct>50&&(0,h.jsxs)("span",{className:"context-indicator",title:"".concat(e.context_pct.toFixed(0),"% context"),children:[(0,h.jsx)(i.In,{icon:"mdi:file-document-multiple",width:10}),e.context_pct.toFixed(0),"%"]})]}),(0,h.jsx)("div",{className:"item-time",children:o(e.created_at)}),(0,h.jsx)("div",{className:"item-action",children:(0,h.jsx)(i.In,{icon:"mdi:chevron-right",width:16})})]},e.session_id)})})]})},B=(0,l.memo)(D);var O=a(26232);const J=e=>{var s,a,n,r;let{data:o,timeSeriesData:d=[],cascadeData:m={cascades:[],grand_total:0},modelData:u={models:[],grand_total:0},topExpensive:v=[],contextEfficiency:j=null,chartsLoading:p=!1,onSessionClick:g=null,granularity:N="daily",onGranularityChange:f=null}=e;const[w,b]=(0,l.useState)(!1),_=(0,O.I)({pollInterval:6e4});if(!o)return(0,h.jsx)("div",{className:"overview-panel",children:(0,h.jsx)(t.lp,{size:"small",message:"Loading overview data...",className:"video-loader--inline"})});const{kpis:y,trends:C,insights:S}=o,I=[...S||[]].sort((e,s)=>{const a={critical:0,warning:1,major:2,info:3,normal:4};return(a[e.severity]||4)-(a[s.severity]||4)}),A=w?I:I.slice(0,3),F=I.length>3;return(0,h.jsxs)("div",{className:"overview-panel",children:[(0,h.jsxs)("div",{className:"overview-kpi-row",children:[(0,h.jsx)(c.A,{title:"Total Cost",value:"$".concat((null===(s=y.total_cost)||void 0===s?void 0:s.toFixed(4))||"0.0000"),trend:null===C||void 0===C?void 0:C.cost_change_pct,icon:"mdi:currency-usd",color:"#34d399"}),(0,h.jsx)(c.A,{title:"Avg per Run",value:"$".concat((null===(a=y.avg_cost)||void 0===a?void 0:a.toFixed(6))||"0.000000"),subtitle:"".concat(y.session_count||0," sessions"),icon:"mdi:chart-line",color:"#60a5fa"}),(0,h.jsx)(c.A,{title:"Context Cost",value:"".concat((null===(n=y.avg_context_pct)||void 0===n?void 0:n.toFixed(1))||"0.0","%"),subtitle:"hidden overhead",trend:null===C||void 0===C?void 0:C.context_change_pct,icon:"mdi:file-document-multiple",color:"#a78bfa"}),(0,h.jsx)(c.A,{title:"Context Efficiency",value:null!==j&&void 0!==j&&j.efficiency_score?"".concat(j.efficiency_score.toFixed(0),"%"):"\u2014",subtitle:null!==j&&void 0!==j&&j.wasted_cost?"$".concat(j.wasted_cost.toFixed(4)," wasted"):"no data",trend:null===j||void 0===j?void 0:j.efficiency_trend,icon:"mdi:target",color:(null===j||void 0===j?void 0:j.efficiency_score)>=60?"#34d399":(null===j||void 0===j?void 0:j.efficiency_score)>=40?"#fbbf24":"#ff006e"}),(0,h.jsx)(c.A,{title:"Outliers",value:y.outlier_count||0,subtitle:"anomalies",icon:"mdi:alert-circle",color:y.outlier_count>0?"#ff006e":"#34d399"}),(0,h.jsx)(c.A,{title:"OR Balance",value:null!==_.balance?"$".concat(_.balance.toFixed(2)):"\u2014",subtitle:null!==_.runwayDays?"~".concat(_.runwayDays,"d runway"):_.loading?"loading...":null,trend:null!==_.delta24h?_.delta24h/(_.balance||1)*100:void 0,icon:"mdi:wallet",color:null===_.balance?"#64748b":_.balance>20?"#34d399":_.balance>5?"#fbbf24":"#f87171"})]}),(0,h.jsxs)("div",{className:"overview-section",children:[(0,h.jsxs)("div",{className:"overview-section-header",children:[(0,h.jsx)(i.In,{icon:"mdi:chart-box",width:14}),(0,h.jsx)("span",{className:"section-title",children:"Cost Analytics"})]}),(0,h.jsxs)("div",{className:"overview-trend-section",children:[(0,h.jsxs)("div",{className:"trend-header",children:[(0,h.jsx)(i.In,{icon:"mdi:chart-timeline-variant",width:14}),(0,h.jsx)("span",{className:"trend-title",children:"Cost Trend"}),(0,h.jsx)("div",{className:"granularity-selector",children:[{value:"hourly",label:"Hourly"},{value:"daily",label:"Daily"},{value:"weekly",label:"Weekly"},{value:"monthly",label:"Monthly"}].map(e=>(0,h.jsx)("button",{className:"granularity-btn ".concat(N===e.value?"active":""),onClick:()=>f&&f(e.value),children:e.label},e.value))}),(0,h.jsxs)("div",{className:"trend-stats",children:[(0,h.jsxs)("span",{className:"trend-stat",children:[(0,h.jsx)("span",{className:"stat-label",children:"Total:"}),(0,h.jsxs)("span",{className:"stat-value",children:["$",(null===(r=y.total_cost)||void 0===r?void 0:r.toFixed(2))||"0.00"]})]}),(0,h.jsxs)("span",{className:"trend-stat",children:[(0,h.jsxs)("span",{className:"stat-label",children:["Avg/","hourly"===N?"Hr":"daily"===N?"Day":"weekly"===N?"Wk":"Mo",":"]}),(0,h.jsxs)("span",{className:"stat-value",children:["$",(y.total_cost/(d.length||1)).toFixed(2)]})]})]})]}),(0,h.jsx)(k,{data:d,loading:p,granularity:N})]}),(0,h.jsxs)("div",{className:"overview-breakdown-grid",children:[(0,h.jsx)("div",{className:"breakdown-cell",children:(0,h.jsx)(T,{data:m.cascades,type:"cascade",chartType:"bar",loading:p,grandTotal:m.grand_total})}),(0,h.jsx)("div",{className:"breakdown-cell",children:(0,h.jsx)(T,{data:u.models,type:"model",chartType:"pie",loading:p,grandTotal:u.grand_total})}),(0,h.jsx)("div",{className:"breakdown-cell",children:(0,h.jsx)(R,{data:d,loading:p,granularity:N})}),(0,h.jsx)("div",{className:"breakdown-cell",children:(0,h.jsx)(P,{data:j,loading:p})})]}),(0,h.jsx)(B,{sessions:v,loading:p,onSessionClick:g})]}),S&&S.length>0&&(0,h.jsxs)("div",{className:"overview-section",children:[(0,h.jsxs)("div",{className:"overview-section-header clickable",onClick:()=>b(!w),children:[(0,h.jsx)(i.In,{icon:"mdi:lightbulb-on",width:14}),(0,h.jsx)("span",{className:"section-title",children:"Operational Intelligence"}),(0,h.jsxs)("span",{className:"section-count",children:[S.length," insights"]}),(0,h.jsx)(i.In,{icon:w?"mdi:chevron-up":"mdi:chevron-down",width:14,className:"expand-icon"})]}),(0,h.jsx)("div",{className:"overview-insights-list",children:A.map((e,s)=>(0,h.jsx)(x,{insight:e},s))}),!w&&F&&(0,h.jsxs)("div",{className:"insights-more",children:["+",I.length-3," more"]})]}),(!S||0===S.length)&&(0,h.jsxs)("div",{className:"overview-section",children:[(0,h.jsxs)("div",{className:"overview-section-header",children:[(0,h.jsx)(i.In,{icon:"mdi:lightbulb-on",width:14}),(0,h.jsx)("span",{className:"section-title",children:"Operational Intelligence"})]}),(0,h.jsxs)("div",{className:"overview-empty",children:[(0,h.jsx)(i.In,{icon:"mdi:check-circle",width:16,style:{color:"#34d399"}}),(0,h.jsx)("span",{children:"No anomalies detected"})]})]})]})};var H=a(94424),U=a(87955);U.syG.registerModules([U.JKr]);const $=U.zl0.withParams({backgroundColor:"#000000",foregroundColor:"#cbd5e1",headerBackgroundColor:"#0a0510",headerTextColor:"#f0f4f8",oddRowBackgroundColor:"#050410",borderColor:"#1a1628",rowBorder:!0,wrapperBorder:!1,headerFontSize:12,headerFontWeight:600,fontFamily:"'Google Sans Code', monospace",fontSize:13,accentColor:"#00e5ff",chromeBackgroundColor:"#000000"}),G=e=>{let{alerts:s=[]}=e;const a=(0,n.Zp)(),t=(0,l.useMemo)(()=>[{field:"severity",headerName:"Severity",width:120,cellRenderer:e=>{const s={critical:"#ff006e",major:"#fbbf24",warning:"#fbbf24",minor:"#60a5fa",info:"#34d399"}[e.value]||"#64748b",a={critical:"mdi:alert-circle",major:"mdi:alert",warning:"mdi:alert",minor:"mdi:information",info:"mdi:information"}[e.value]||"mdi:information";return(0,h.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[(0,h.jsx)(i.In,{icon:a,style:{color:s}}),(0,h.jsx)("span",{style:{color:s,fontWeight:600,textTransform:"uppercase",fontSize:"11px"},children:e.value})]})}},{field:"type",headerName:"Type",width:160,valueFormatter:e=>{var s;return{cost_outlier:"Cost Outlier",context_hotspot:"Context Hotspot",regression:"Regression",duration_outlier:"Duration Outlier"}[e.value]||(null===(s=e.value)||void 0===s?void 0:s.replace(/_/g," "))||"-"}},{field:"cascade_id",headerName:"Cascade",flex:1,minWidth:150},{field:"cell_name",headerName:"Cell",width:140,valueFormatter:e=>e.value||"-"},{field:"message",headerName:"Description",flex:2,minWidth:300,cellStyle:{fontSize:"12px",lineHeight:"1.4"},wrapText:!0,autoHeight:!0},{field:"z_score",headerName:"Deviation",width:110,headerTooltip:"Standard deviations from average (\u03c3)",valueFormatter:e=>{if(!e.value)return"-";const s=Math.abs(e.value);return s>=4?"Very High":s>=3?"High":s>=2?"Elevated":"Normal"},cellStyle:e=>{if(!e.value)return{};const s=Math.abs(e.value);return{color:s>3?"#ff006e":s>2?"#fbbf24":"#cbd5e1",fontWeight:600}},tooltipValueGetter:e=>e.value?"".concat(e.value.toFixed(1),"\u03c3 (").concat(Math.abs(e.value).toFixed(1)," standard deviations)"):""},{field:"timestamp",headerName:"Time",width:170,valueFormatter:e=>{if(!e.value)return"-";return new Date(e.value).toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}}],[]);return(0,h.jsxs)("div",{className:"alerts-panel",children:[(0,h.jsxs)("div",{className:"alerts-panel-header",children:[(0,h.jsx)(i.In,{icon:"mdi:alert-circle",width:20}),(0,h.jsx)("h2",{children:"Alerts & Anomalies"}),(0,h.jsxs)("span",{className:"alerts-count",children:[s.length," alert",1!==s.length?"s":""]})]}),(0,h.jsx)("div",{className:"alerts-grid-container",children:0===s.length?(0,h.jsxs)("div",{className:"alerts-empty-state",children:[(0,h.jsx)(i.In,{icon:"mdi:check-circle",width:48,style:{color:"#34d399"}}),(0,h.jsx)("p",{children:"No alerts detected"}),(0,h.jsx)("span",{children:"All systems operating within normal parameters"})]}):(0,h.jsx)(H.W6,{theme:$,rowData:s,columnDefs:t,domLayout:"autoHeight",suppressCellFocus:!0,enableCellTextSelection:!0,rowHeight:40,onRowClicked:e=>{const{cascade_id:s,session_id:l}=e.data;l&&s?a(o.bw.studioWithSession(s,l)):s&&a(o.bw.studioWithCascade(s))},rowStyle:{cursor:"pointer"}})})]})},K=e=>{let{timeFilter:s,onTimeFilterChange:a,allCascadeIds:l,selectedCascades:n,onSelectedCascadesChange:t,analyzedOnly:c,onAnalyzedOnlyChange:r}=e;return(0,h.jsxs)("div",{className:"context-breakdown-filter-panel",children:[(0,h.jsxs)("div",{className:"filter-section",children:[(0,h.jsxs)("div",{className:"filter-section-header",children:[(0,h.jsx)(i.In,{icon:"mdi:clock-outline",width:"14"}),(0,h.jsx)("span",{children:"Time"})]}),(0,h.jsxs)("div",{className:"filter-options",children:[(0,h.jsx)("button",{className:"filter-chip ".concat("today"===s?"active":""),onClick:()=>a("today"),children:"Today"}),(0,h.jsx)("button",{className:"filter-chip ".concat("week"===s?"active":""),onClick:()=>a("week"),children:"This Week"}),(0,h.jsx)("button",{className:"filter-chip ".concat("month"===s?"active":""),onClick:()=>a("month"),children:"This Month"}),(0,h.jsx)("button",{className:"filter-chip ".concat("all"===s?"active":""),onClick:()=>a("all"),children:"All Time"})]})]}),(0,h.jsxs)("div",{className:"filter-section",children:[(0,h.jsxs)("div",{className:"filter-section-header",children:[(0,h.jsx)(i.In,{icon:"mdi:check-decagram",width:"14"}),(0,h.jsx)("span",{children:"Analysis"})]}),(0,h.jsx)("div",{className:"filter-options",children:(0,h.jsxs)("button",{className:"filter-chip analyzed-chip ".concat(c?"active":""),onClick:()=>r(!c),children:[(0,h.jsx)(i.In,{icon:c?"mdi:check-decagram":"mdi:check-decagram-outline",width:"12"}),"Analyzed Only"]})})]}),(0,h.jsxs)("div",{className:"filter-section cascades-filter",children:[(0,h.jsxs)("div",{className:"filter-section-header",children:[(0,h.jsx)(i.In,{icon:"mdi:sitemap",width:"14"}),(0,h.jsx)("span",{children:"Cascades"}),n.length>0&&(0,h.jsxs)("button",{className:"filter-clear-btn",onClick:()=>{t([])},children:["Clear (",n.length,")"]})]}),(0,h.jsx)("div",{className:"filter-cascades-list",children:0===l.length?(0,h.jsx)("div",{className:"filter-empty",children:"No cascades"}):l.map(e=>(0,h.jsxs)("label",{className:"filter-cascade-item",children:[(0,h.jsx)("input",{type:"checkbox",checked:n.includes(e),onChange:()=>(e=>{n.includes(e)?t(n.filter(s=>s!==e)):t([...n,e])})(e)}),(0,h.jsx)("span",{className:"cascade-name",children:e})]},e))})]})]})},V="contextBreakdown_timeFilter",Z="contextBreakdown_selectedCascades",Y="contextBreakdown_analyzedOnly",q=()=>{try{const e=localStorage.getItem(V);if(e&&["today","week","month","all"].includes(e))return e}catch(e){}return"week"},X=()=>{try{const e=localStorage.getItem(Z);if(e)return JSON.parse(e)}catch(e){}return[]},Q=()=>{try{return"true"===localStorage.getItem(Y)}catch(e){}return!1},ee=e=>{switch(e){case"today":return 1;case"week":default:return 7;case"month":return 30;case"all":return 365}},se=()=>{const e=(0,n.Zp)(),[s,a]=(0,l.useState)(q),[t,c]=(0,l.useState)(X),[m,x]=(0,l.useState)(Q),[v,j]=(0,l.useState)([]),[p,g]=(0,l.useState)([]),[N,f]=(0,l.useState)(!0),[w,b]=(0,l.useState)(null),[_,k]=(0,l.useState)(new Set),[y,C]=(0,l.useState)(new Set),[S,I]=(0,l.useState)({}),[A,F]=(0,l.useState)(new Set),M=(0,l.useCallback)(e=>{a(e);try{localStorage.setItem(V,e)}catch(s){}},[]),T=(0,l.useCallback)(e=>{c(e);try{localStorage.setItem(Z,JSON.stringify(e))}catch(s){}},[]),L=(0,l.useCallback)(e=>{x(e);try{localStorage.setItem(Y,String(e))}catch(s){}},[]),z=(0,l.useCallback)(async()=>{f(!0);try{const e=ee(s),a=await fetch("".concat(d.J,"/api/receipts/context-breakdown-by-cascade?days=").concat(e)),l=await a.json();if(l.error)return void b(l.error);j(l.cascades||[]),g(l.all_cascade_ids||[]),b(null)}catch(e){b(e.message)}finally{f(!1)}},[s]);(0,l.useEffect)(()=>{z()},[z]);const E=(0,l.useCallback)(async(e,a)=>{if(!S[e]&&!A.has(e)){F(s=>new Set([...s,e]));try{const l=ee(s),n=await fetch("".concat(d.J,"/api/receipts/context-breakdown?days=").concat(l,"&session_id=").concat(e,"&cascade_id=").concat(a)),i=await n.json();i.breakdown&&I(s=>(0,u.A)((0,u.A)({},s),{},{[e]:i.breakdown}))}catch(l){console.error("Failed to fetch cell details:",l)}finally{F(s=>{const a=new Set(s);return a.delete(e),a})}}},[s,S,A]),R=(0,l.useMemo)(()=>{let e=v;return t.length>0&&(e=e.filter(e=>t.includes(e.cascade_id))),m&&(e=e.filter(e=>e.analyzed_msg_count>0)),e},[v,t,m]),W=e=>{if(!e)return"Unknown";return new Date(e).toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},P=e=>"$".concat(e>=1?e.toFixed(2):e>=.01?e.toFixed(4):e.toFixed(6)),D=function(e){if(null===e||void 0===e)return null;const s="small"===(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"normal")?{width:4,height:10}:{width:5,height:12};return(0,h.jsx)("div",{className:"relevance-bar",children:[...Array(10)].map((a,l)=>{const n=e/10>l;return(0,h.jsx)("div",{className:"bar-block ".concat(n?"filled":"empty"),style:{width:s.width,height:s.height,backgroundColor:n?e>=70?"#34d399":e>=40?"#fbbf24":"#f87171":"rgba(30, 30, 35, 0.6)"}},l)})})},B=(e,s,a,n)=>{var i,t;return(0,h.jsxs)("div",{className:"cell-block ".concat(a&&n?"winner":""),children:[(0,h.jsxs)("div",{className:"cell-header",children:[(0,h.jsxs)("div",{className:"cell-left",children:[(0,h.jsx)("span",{className:"cell-name",children:e.cell_name}),e.model&&(0,h.jsx)("span",{className:"cell-model",children:e.model}),null!==e.take_index&&void 0!==e.take_index&&(0,h.jsxs)("span",{className:"take-tag",children:["#",e.take_index]}),a&&n&&(0,h.jsx)(r.A,{variant:"subtle",color:"green",size:"sm",children:"winner"})]}),(0,h.jsxs)("div",{className:"cell-right",children:[(0,h.jsx)("span",{className:"cell-cost",children:P(e.cell_cost)}),(0,h.jsxs)("span",{className:"cell-msgs",children:[(null===(t=e.messages)||void 0===t?void 0:t.length)||0," msgs"]})]})]}),e.messages&&e.messages.length>0&&(0,h.jsxs)("div",{className:"messages-table",children:[(0,h.jsxs)("div",{className:"messages-header",children:[(0,h.jsx)("span",{className:"msg-col hash",children:"Hash"}),(0,h.jsx)("span",{className:"msg-col source",children:"Source"}),(0,h.jsx)("span",{className:"msg-col role",children:"Role"}),(0,h.jsx)("span",{className:"msg-col tokens",children:"Tokens"}),(0,h.jsx)("span",{className:"msg-col cost",children:"Cost"}),(0,h.jsx)("span",{className:"msg-col pct",children:"% of Cell"}),(0,h.jsx)("span",{className:"msg-col relevance",children:"Relevance"})]}),e.messages.map((e,s)=>{var a,n,i,t;return(0,h.jsxs)(l.Fragment,{children:[(0,h.jsxs)("div",{className:"message-row",children:[(0,h.jsx)("span",{className:"msg-col hash",title:e.hash,children:null===(a=e.hash)||void 0===a?void 0:a.substring(0,8)}),(0,h.jsx)("span",{className:"msg-col source",title:e.source_cell||"N/A",children:e.source_cell||"\u2014"}),(0,h.jsx)("span",{className:"msg-col role",children:(0,h.jsx)("span",{className:"role-tag ".concat(e.role),children:e.role})}),(0,h.jsx)("span",{className:"msg-col tokens",children:null===(n=e.tokens)||void 0===n?void 0:n.toLocaleString()}),(0,h.jsx)("span",{className:"msg-col cost",children:P(e.cost)}),(0,h.jsxs)("span",{className:"msg-col pct",children:[(0,h.jsx)("div",{className:"pct-bar-container",children:(0,h.jsx)("div",{className:"pct-bar",style:{width:"".concat(Math.min(e.pct,100),"%")}})}),(0,h.jsxs)("span",{children:[null===(i=e.pct)||void 0===i?void 0:i.toFixed(1),"%"]})]}),(0,h.jsx)("span",{className:"msg-col relevance",children:null!==e.relevance_score&&void 0!==e.relevance_score?(0,h.jsxs)("div",{className:"relevance-display",children:[D(e.relevance_score,"small"),(0,h.jsx)("span",{style:{color:(t=e.relevance_score,t>=70?"#34d399":t>=40?"#fbbf24":"#f87171")},children:e.relevance_score.toFixed(0)})]}):(0,h.jsx)("span",{className:"not-analyzed",children:"\u2014"})})]}),e.relevance_reason&&(0,h.jsxs)("div",{className:"message-evidence",children:[(0,h.jsx)("span",{className:"evidence-label",children:"Evidence:"})," ",e.relevance_reason]})]},"".concat(e.hash,"-").concat(s))})]})]},"".concat(e.cell_name,"-").concat(null!==(i=e.take_index)&&void 0!==i?i:s))};return N&&0===v.length?(0,h.jsxs)("div",{className:"context-breakdown-panel-container",children:[(0,h.jsx)(K,{timeFilter:s,onTimeFilterChange:M,allCascadeIds:p,selectedCascades:t,onSelectedCascadesChange:T,analyzedOnly:m,onAnalyzedOnlyChange:L}),(0,h.jsx)("div",{className:"context-breakdown-panel",children:(0,h.jsxs)("div",{className:"context-breakdown-loading",children:[(0,h.jsx)(i.In,{icon:"mdi:loading",className:"spin",width:18}),(0,h.jsx)("span",{children:"Loading context breakdown..."})]})})]}):w?(0,h.jsxs)("div",{className:"context-breakdown-panel-container",children:[(0,h.jsx)(K,{timeFilter:s,onTimeFilterChange:M,allCascadeIds:p,selectedCascades:t,onSelectedCascadesChange:T,analyzedOnly:m,onAnalyzedOnlyChange:L}),(0,h.jsx)("div",{className:"context-breakdown-panel",children:(0,h.jsxs)("div",{className:"context-breakdown-error",children:[(0,h.jsx)("span",{className:"error-title",children:"Error loading data"}),(0,h.jsx)("span",{className:"error-message",children:w})]})})]}):(0,h.jsxs)("div",{className:"context-breakdown-panel-container",children:[(0,h.jsx)(K,{timeFilter:s,onTimeFilterChange:M,allCascadeIds:p,selectedCascades:t,onSelectedCascadesChange:T,analyzedOnly:m,onAnalyzedOnlyChange:L}),(0,h.jsxs)("div",{className:"context-breakdown-panel",children:[(0,h.jsxs)("div",{className:"context-breakdown-header",children:[(0,h.jsx)("h2",{children:"Context Breakdown"}),(0,h.jsxs)("span",{className:"context-breakdown-count",children:[R.length," cascade",1!==R.length?"s":""]})]}),0===R.length?(0,h.jsxs)("div",{className:"context-breakdown-empty",children:[(0,h.jsx)("span",{className:"empty-title",children:"No context breakdown data"}),(0,h.jsx)("span",{className:"empty-message",children:"Context attribution data will appear here once cascades with context injection are executed"})]}):(0,h.jsx)("div",{className:"context-breakdown-cascades",children:R.map(s=>{var a;const l=_.has(s.cascade_id);return(0,h.jsxs)("div",{className:"cascade-group",children:[(0,h.jsxs)("div",{className:"cascade-rollup-row ".concat(l?"expanded":""),onClick:()=>{return e=s.cascade_id,void k(s=>{const a=new Set(s);return a.has(e)?a.delete(e):a.add(e),a});var e},children:[(0,h.jsxs)("div",{className:"cascade-left",children:[(0,h.jsx)("span",{className:"expand-indicator ".concat(l?"expanded":"")}),(0,h.jsx)("span",{className:"cascade-name",children:s.cascade_id}),(0,h.jsxs)("span",{className:"cascade-runs",children:[s.run_count," run",1!==s.run_count?"s":""]})]}),(0,h.jsxs)("div",{className:"cascade-right",children:[(0,h.jsxs)("div",{className:"cascade-stat",children:[(0,h.jsx)("span",{className:"stat-label",children:"Cost"}),(0,h.jsx)("span",{className:"stat-value cost",children:P(s.total_context_cost)})]}),(0,h.jsxs)("div",{className:"cascade-stat",children:[(0,h.jsx)("span",{className:"stat-label",children:"Wasted"}),(0,h.jsxs)("span",{className:"stat-value wasted ".concat(s.wasted_pct>30?"high":""),children:[s.wasted_pct.toFixed(0),"%"]})]}),(0,h.jsxs)("div",{className:"cascade-stat efficiency",children:[(0,h.jsx)("span",{className:"stat-label",children:"Efficiency"}),D(s.efficiency_score,"small"),(0,h.jsx)("span",{className:"stat-value",children:(null===(a=s.efficiency_score)||void 0===a?void 0:a.toFixed(0))||"\u2014"})]}),s.analysis_coverage>0&&(0,h.jsxs)("span",{className:"analysis-coverage",children:[s.analysis_coverage.toFixed(0),"% analyzed"]})]})]}),l&&s.sessions&&s.sessions.length>0&&(0,h.jsx)("div",{className:"cascade-sessions",children:s.sessions.map(a=>{const l=y.has(a.session_id),n=S[a.session_id]||[],t=A.has(a.session_id),c=(e=>{const s={};return e.forEach(e=>{const a=e.cell_name;s[a]||(s[a]=[]),s[a].push(e)}),Object.entries(s).map(e=>{let[s,a]=e;const l=a.sort((e,s)=>{var a,l;return(null!==(a=e.take_index)&&void 0!==a?a:0)-(null!==(l=s.take_index)&&void 0!==l?l:0)}),n=l.length>1,i=l.some(e=>!0===e.is_winner||!1===e.is_winner);return{cellName:s,takes:l.map((e,s)=>(0,u.A)((0,u.A)({},e),{},{_isWinner:n&&(i?!0===e.is_winner:0===s)})),hasMultipleTakes:n}})})(n);return(0,h.jsxs)("div",{className:"session-group",children:[(0,h.jsxs)("div",{className:"session-header ".concat(l?"expanded":""),onClick:()=>{return e=a.session_id,l=s.cascade_id,void C(s=>{const a=new Set(s);return a.has(e)?a.delete(e):(a.add(e),E(e,l)),a});var e,l},children:[(0,h.jsxs)("div",{className:"session-left",children:[(0,h.jsx)("span",{className:"expand-indicator ".concat(l?"expanded":"")}),(0,h.jsx)("span",{className:"session-time",children:W(a.timestamp)}),(0,h.jsx)("span",{className:"session-id",children:a.session_id})]}),(0,h.jsxs)("div",{className:"session-right",children:[(0,h.jsxs)("span",{className:"session-cells",children:[a.cell_count," cell",1!==a.cell_count?"s":""]}),(0,h.jsx)("span",{className:"session-cost",children:P(a.cost)}),a.avg_relevance?(0,h.jsxs)("div",{className:"session-relevance",children:[D(a.avg_relevance,"small"),(0,h.jsx)("span",{children:a.avg_relevance.toFixed(0)})]}):(0,h.jsx)("span",{className:"session-not-analyzed",children:"Not analyzed"}),(0,h.jsx)("button",{className:"view-session-btn",onClick:l=>{var n,i;l.stopPropagation(),n=a.session_id,i=s.cascade_id,e(o.bw.studioWithSession(i,n))},title:"View in Studio",children:(0,h.jsx)(i.In,{icon:"mdi:open-in-new",width:11})})]})]}),l&&(0,h.jsx)("div",{className:"session-cells-container",children:t?(0,h.jsxs)("div",{className:"cells-loading",children:[(0,h.jsx)(i.In,{icon:"mdi:loading",className:"spin",width:14}),(0,h.jsx)("span",{children:"Loading cells..."})]}):0===c.length?(0,h.jsx)("div",{className:"cells-empty",children:"No cell data available"}):c.map(e=>{if(e.hasMultipleTakes)return(0,h.jsxs)("div",{className:"take-group",children:[(0,h.jsxs)("div",{className:"take-group-header",children:[(0,h.jsx)("span",{className:"take-group-name",children:e.cellName}),(0,h.jsxs)("span",{className:"take-count",children:[e.takes.length," takes"]})]}),(0,h.jsx)("div",{className:"take-group-cells",children:e.takes.map((e,s)=>B(e,s,e._isWinner,!0))})]},e.cellName);{const s=e.takes[0];return B(s,0,!1,!1)}})})]},a.session_id)})})]},s.cascade_id)})})]})]})},ae=e=>{var s;let{sessionId:a}=e;const[n,c]=(0,l.useState)(null),[r,o]=(0,l.useState)(!0),[m,x]=(0,l.useState)(null),[u,v]=(0,l.useState)(null),[j,p]=(0,l.useState)(null),[g,N]=(0,l.useState)("rank"),[f,w]=(0,l.useState)(!1);(0,l.useEffect)(()=>{if(!a)return;(async()=>{o(!0);try{var e;const l=await fetch("".concat(d.J,"/api/context-assessment/budget-simulation/").concat(a));if(!l.ok)throw new Error("Failed to fetch budget simulation data");const n=await l.json();if(c(n),(null===(e=n.cells)||void 0===e?void 0:e.length)>0){var s;const e=n.cells[0];if(u||v(e.cell_name),(null===(s=e.budgets)||void 0===s?void 0:s.length)>0&&!j){const s=Math.floor(e.budgets.length/2);p(e.budgets[s].budget)}}}catch(l){x(l.message)}finally{o(!1)}})()},[a]);const b=(0,l.useMemo)(()=>{var e;if(null===n||void 0===n||!n.cells||!u)return[];const s=n.cells.find(e=>e.cell_name===u);return(null===s||void 0===s||null===(e=s.budgets)||void 0===e?void 0:e.map(e=>e.budget).sort((e,s)=>e-s))||[]},[n,u]),_=(0,l.useMemo)(()=>{if(null===n||void 0===n||!n.cells||!u)return null;const e=n.cells.find(e=>e.cell_name===u);if(null===e||void 0===e||!e.budgets)return null;return e.budgets.find(e=>e.budget===j)},[n,u,j]),k=(0,l.useMemo)(()=>{if(null===_||void 0===_||!_.messages)return[];let e=[..._.messages];switch(f&&(e=e.filter(e=>e.would_include)),g){case"score":e.sort((e,s)=>s.score-e.score);break;case"tokens":e.sort((e,s)=>s.tokens-e.tokens);break;default:e.sort((e,s)=>e.rank-s.rank)}return e},[_,g,f]),y=(0,l.useMemo)(()=>{if(!_)return null;const e=_.messages.filter(e=>e.would_include),s=_.messages.filter(e=>!e.would_include),a=_.messages.filter(e=>e.was_included).filter(e=>!e.would_include);return{totalMessages:_.messages.length,includedCount:e.length,excludedCount:s.length,tokensIncluded:e.reduce((e,s)=>e+s.tokens,0),tokensExcluded:s.reduce((e,s)=>e+s.tokens,0),wouldPruneCount:a.length,wouldPruneTokens:a.reduce((e,s)=>e+s.tokens,0)}},[_]),C=e=>e>=70?"#34d399":e>=40?"#fbbf24":"#f87171";return r?(0,h.jsx)("div",{className:"inter-cell-explorer loading",children:(0,h.jsx)(t.lp,{size:"small",message:"Loading budget simulation..."})}):m?(0,h.jsxs)("div",{className:"inter-cell-explorer error",children:[(0,h.jsx)(i.In,{icon:"mdi:alert-circle",width:24}),(0,h.jsx)("span",{children:m})]}):null!==n&&void 0!==n&&null!==(s=n.cells)&&void 0!==s&&s.length?(0,h.jsxs)("div",{className:"inter-cell-explorer",children:[(0,h.jsx)("div",{className:"explorer-header",children:(0,h.jsxs)("div",{className:"cell-selector",children:[(0,h.jsx)("label",{children:"Target Cell:"}),(0,h.jsx)("select",{value:u||"",onChange:e=>v(e.target.value),children:n.cells.map(e=>(0,h.jsx)("option",{value:e.cell_name,children:e.cell_name},e.cell_name))})]})}),b.length>0&&(0,h.jsxs)("div",{className:"budget-selector",children:[(0,h.jsxs)("div",{className:"budget-header",children:[(0,h.jsx)("span",{className:"budget-label",children:"Token Budget"}),(0,h.jsxs)("span",{className:"budget-value",children:[(null===j||void 0===j?void 0:j.toLocaleString())||"\u2014"," tokens"]})]}),(0,h.jsx)("div",{className:"budget-buttons",children:b.map(e=>(0,h.jsx)("button",{className:j===e?"active":"",onClick:()=>p(e),children:e>=1e3?"".concat(e/1e3,"k"):e},e))})]}),y&&(0,h.jsxs)("div",{className:"budget-summary",children:[(0,h.jsxs)("div",{className:"summary-stat included",children:[(0,h.jsx)("div",{className:"stat-icon",children:(0,h.jsx)(i.In,{icon:"mdi:check-circle",width:16})}),(0,h.jsxs)("div",{className:"stat-content",children:[(0,h.jsx)("span",{className:"stat-value",children:y.includedCount}),(0,h.jsx)("span",{className:"stat-label",children:"included"}),(0,h.jsxs)("span",{className:"stat-tokens",children:[y.tokensIncluded.toLocaleString()," tokens"]})]})]}),(0,h.jsxs)("div",{className:"summary-stat excluded",children:[(0,h.jsx)("div",{className:"stat-icon",children:(0,h.jsx)(i.In,{icon:"mdi:close-circle",width:16})}),(0,h.jsxs)("div",{className:"stat-content",children:[(0,h.jsx)("span",{className:"stat-value",children:y.excludedCount}),(0,h.jsx)("span",{className:"stat-label",children:"excluded"}),(0,h.jsxs)("span",{className:"stat-tokens",children:[y.tokensExcluded.toLocaleString()," tokens"]})]})]}),y.wouldPruneCount>0&&(0,h.jsxs)("div",{className:"summary-stat savings",children:[(0,h.jsx)("div",{className:"stat-icon",children:(0,h.jsx)(i.In,{icon:"mdi:content-cut",width:16})}),(0,h.jsxs)("div",{className:"stat-content",children:[(0,h.jsx)("span",{className:"stat-value",children:y.wouldPruneCount}),(0,h.jsx)("span",{className:"stat-label",children:"would prune"}),(0,h.jsxs)("span",{className:"stat-tokens",children:[y.wouldPruneTokens.toLocaleString()," tokens saved"]})]})]})]}),(0,h.jsxs)("div",{className:"explorer-controls",children:[(0,h.jsxs)("div",{className:"sort-controls",children:[(0,h.jsx)("label",{children:"Sort by:"}),(0,h.jsxs)("div",{className:"sort-buttons",children:[(0,h.jsx)("button",{className:"rank"===g?"active":"",onClick:()=>N("rank"),children:"Rank"}),(0,h.jsx)("button",{className:"score"===g?"active":"",onClick:()=>N("score"),children:"Score"}),(0,h.jsx)("button",{className:"tokens"===g?"active":"",onClick:()=>N("tokens"),children:"Tokens"})]})]}),(0,h.jsxs)("label",{className:"filter-checkbox",children:[(0,h.jsx)("input",{type:"checkbox",checked:f,onChange:e=>w(e.target.checked)}),(0,h.jsx)("span",{children:"Only show included"})]})]}),(0,h.jsx)("div",{className:"messages-list",children:k.map((e,s)=>(0,h.jsxs)("div",{className:"message-row ".concat(e.would_include?"included":"excluded"," ").concat(e.was_included&&!e.would_include?"would-prune":""),children:[(0,h.jsxs)("div",{className:"message-rank",children:["#",e.rank]}),(0,h.jsx)("div",{className:"message-status",children:e.would_include?(0,h.jsx)(i.In,{icon:"mdi:check-circle",width:16,className:"status-included"}):(0,h.jsx)(i.In,{icon:"mdi:close-circle",width:16,className:"status-excluded"})}),(0,h.jsx)("div",{className:"message-role",children:(0,h.jsx)("span",{className:"role-badge ".concat(e.role),children:e.role})}),(0,h.jsxs)("div",{className:"message-content",children:[(0,h.jsxs)("div",{className:"message-source",children:["from ",(0,h.jsx)("strong",{children:e.source_cell})]}),(0,h.jsx)("div",{className:"message-preview",children:e.preview})]}),(0,h.jsxs)("div",{className:"message-score",children:[(0,h.jsx)("div",{className:"score-bar",style:{width:"".concat(e.score,"%"),background:C(e.score)}}),(0,h.jsx)("span",{className:"score-value",style:{color:C(e.score)},children:Math.round(e.score)})]}),(0,h.jsxs)("div",{className:"message-tokens",children:[(0,h.jsx)("span",{className:"token-count",children:e.tokens.toLocaleString()}),(0,h.jsx)("span",{className:"token-label",children:"tokens"})]}),(0,h.jsxs)("div",{className:"message-cumulative",children:[(0,h.jsx)("span",{className:"cumulative-count",children:e.cumulative_tokens.toLocaleString()}),(0,h.jsx)("span",{className:"cumulative-label",children:"cumulative"})]}),e.was_included&&!e.would_include&&(0,h.jsxs)("div",{className:"prune-badge",children:[(0,h.jsx)(i.In,{icon:"mdi:content-cut",width:12}),"would prune"]})]},"".concat(e.content_hash,"-").concat(s)))})]}):(0,h.jsxs)("div",{className:"inter-cell-explorer empty",children:[(0,h.jsx)(i.In,{icon:"mdi:swap-horizontal",width:32}),(0,h.jsx)("span",{children:"No inter-cell context data available"})]})},le=e=>{let{turns:s,config:a,height:n=200}=e;const i=(0,l.useRef)(null),t=(0,l.useMemo)(()=>s&&0!==s.length?s.map(e=>{var s;const l=null===(s=e.configs)||void 0===s?void 0:s.find(e=>e.window===a.window&&e.mask_after===a.mask_after&&e.min_size===a.min_size);return{turn:e.turn_number,before:(null===l||void 0===l?void 0:l.tokens_before)||e.full_history_size||0,after:(null===l||void 0===l?void 0:l.tokens_after)||e.full_history_size||0,saved:(null===l||void 0===l?void 0:l.tokens_saved)||0,ratio:(null===l||void 0===l?void 0:l.compression_ratio)||1}}).sort((e,s)=>e.turn-s.turn):[],[s,a]),c=(0,l.useMemo)(()=>{const e=t.reduce((e,s)=>e+s.before,0),s=t.reduce((e,s)=>e+s.after,0);return{totalBefore:e,totalAfter:s,totalSaved:e-s,avgRatio:e>0?s/e:1}},[t]);if((0,l.useEffect)(()=>{if(!i.current||0===t.length)return;const e=i.current,s=e.getContext("2d"),a=window.devicePixelRatio||1,l=e.getBoundingClientRect().width,c=n;e.width=l*a,e.height=c*a,s.scale(a,a),s.fillStyle="#0a0a0a",s.fillRect(0,0,l,c);const r=20,o=20,d=35,h=55,m=l-h-o,x=c-r-d,u=Math.max(...t.flatMap(e=>[e.before,e.after]),1e3),v=e=>h+e/Math.max(t.length-1,1)*m,j=e=>r+x-e/u*x;s.strokeStyle="#1e1e24",s.lineWidth=1;for(let n=0;n<=4;n++){const e=r+n/4*x;s.beginPath(),s.moveTo(h,e),s.lineTo(l-o,e),s.stroke()}if(t.length>1){s.beginPath(),s.fillStyle="rgba(0, 229, 255, 0.1)",t.forEach((e,a)=>{0===a?s.moveTo(v(a),j(e.before)):s.lineTo(v(a),j(e.before))});for(let e=t.length-1;e>=0;e--)s.lineTo(v(e),j(t[e].after));s.closePath(),s.fill()}s.beginPath(),s.strokeStyle="#64748b",s.lineWidth=2,s.setLineDash([5,5]),t.forEach((e,a)=>{0===a?s.moveTo(v(a),j(e.before)):s.lineTo(v(a),j(e.before))}),s.stroke(),s.setLineDash([]),s.beginPath(),s.strokeStyle="#00e5ff",s.lineWidth=2,t.forEach((e,a)=>{0===a?s.moveTo(v(a),j(e.after)):s.lineTo(v(a),j(e.after))}),s.stroke(),t.forEach((e,a)=>{s.beginPath(),s.fillStyle="#64748b",s.arc(v(a),j(e.before),3,0,2*Math.PI),s.fill(),s.beginPath(),s.fillStyle="#00e5ff",s.arc(v(a),j(e.after),4,0,2*Math.PI),s.fill(),s.beginPath(),s.strokeStyle="#00e5ff",s.lineWidth=2,s.arc(v(a),j(e.after),4,0,2*Math.PI),s.stroke()}),s.strokeStyle="#2a2a32",s.lineWidth=1,s.beginPath(),s.moveTo(h,r),s.lineTo(h,c-d),s.lineTo(l-o,c-d),s.stroke(),s.fillStyle="#64748b",s.font="10px Inter, system-ui, sans-serif",s.textAlign="right",s.textBaseline="middle";for(let n=0;n<=4;n++){const e=Math.round(u*(1-n/4)),a=r+n/4*x;s.fillText(e>=1e3?"".concat((e/1e3).toFixed(1),"k"):e.toString(),h-8,a)}s.textAlign="center",s.textBaseline="top";const p=Math.max(1,Math.floor(t.length/8));t.forEach((e,a)=>{a%p!==0&&a!==t.length-1||s.fillText("T".concat(e.turn),v(a),c-d+8)}),s.fillStyle="#94a3b8",s.font="11px Inter, system-ui, sans-serif",s.textAlign="center",s.fillText("Turn",l/2,c-5),s.save(),s.translate(12,c/2),s.rotate(-Math.PI/2),s.fillText("Tokens",0,0),s.restore()},[t,n]),0===t.length)return(0,h.jsx)("div",{className:"compression-timeline empty",children:(0,h.jsx)("span",{children:"No compression data available for this configuration"})});const r=c.totalBefore>0?Math.round(100*(1-c.avgRatio)):0;return(0,h.jsxs)("div",{className:"compression-timeline",children:[(0,h.jsxs)("div",{className:"timeline-header",children:[(0,h.jsxs)("div",{className:"timeline-legend",children:[(0,h.jsxs)("span",{className:"legend-item before",children:[(0,h.jsx)("span",{className:"legend-line dashed"}),"Before"]}),(0,h.jsxs)("span",{className:"legend-item after",children:[(0,h.jsx)("span",{className:"legend-line solid"}),"After (w=",a.window,", m=",a.mask_after,")"]})]}),(0,h.jsxs)("div",{className:"timeline-summary",children:[(0,h.jsxs)("span",{className:"summary-savings",children:[r,"% savings"]}),(0,h.jsxs)("span",{className:"summary-tokens",children:[c.totalSaved.toLocaleString()," tokens saved"]})]})]}),(0,h.jsx)("canvas",{ref:i,style:{width:"100%",height:n}})]})},ne=e=>{var s,a;let{sessionId:n}=e;const[c,r]=(0,l.useState)(null),[o,m]=(0,l.useState)(!0),[x,v]=(0,l.useState)(null),[j,p]=(0,l.useState)(null),[g,N]=(0,l.useState)(null),[f,w]=(0,l.useState)(null),[b,_]=(0,l.useState)("timeline");(0,l.useEffect)(()=>{if(!n)return;(async()=>{m(!0);try{var e;const i=await fetch("".concat(d.J,"/api/context-assessment/intra-cell/").concat(n));if(!i.ok)throw new Error("Failed to fetch intra-cell data");const t=await i.json();if(r(t),(null===(e=t.cells)||void 0===e?void 0:e.length)>0){var s;const e=t.cells[0];if(p(e.cell_name),(null===(s=e.takes)||void 0===s?void 0:s.length)>0){var a,l;const s=e.takes[0];if(N(s.take_index),(null===(a=s.turns)||void 0===a?void 0:a.length)>0&&(null===(l=s.turns[0].configs)||void 0===l?void 0:l.length)>0){const e=s.turns[0].configs[0];w({window:e.window,mask_after:e.mask_after,min_size:e.min_size})}}}}catch(i){v(i.message)}finally{m(!1)}})()},[n]);const k=(0,l.useMemo)(()=>{if(null===c||void 0===c||!c.cells)return{windows:[],mask_afters:[],min_sizes:[]};const e=new Set,s=new Set,a=new Set;return c.cells.forEach(l=>{var n;null===(n=l.takes)||void 0===n||n.forEach(l=>{var n;null===(n=l.turns)||void 0===n||n.forEach(l=>{var n;null===(n=l.configs)||void 0===n||n.forEach(l=>{e.add(l.window),s.add(l.mask_after),a.add(l.min_size)})})})}),{windows:Array.from(e).sort((e,s)=>e-s),mask_afters:Array.from(s).sort((e,s)=>e-s),min_sizes:Array.from(a).sort((e,s)=>e-s)}},[c]),y=(0,l.useMemo)(()=>null!==c&&void 0!==c&&c.cells&&j?c.cells.find(e=>e.cell_name===j):null,[c,j]),C=(0,l.useMemo)(()=>{if(null===y||void 0===y||!y.takes)return[];const e=y.takes.find(e=>e.take_index===g);return(null===e||void 0===e?void 0:e.turns)||[]},[y,g]),S=(0,l.useMemo)(()=>{if(!C.length)return null;let e=0,s=0,a=0;C.forEach(l=>{var n;const i=null===(n=l.configs)||void 0===n?void 0:n.find(e=>e.window===f.window&&e.mask_after===f.mask_after&&e.min_size===f.min_size);i&&(e+=i.tokens_before,s+=i.tokens_after,a++)});const l=e-s,n=e>0?s/e:1,i=e>0?Math.round(100*(1-n)):0;return{totalBefore:e,totalAfter:s,totalSaved:l,avgCompression:n,savingsPercent:i,turnsAnalyzed:a}},[C,f]);return o?(0,h.jsx)("div",{className:"intra-cell-explorer loading",children:(0,h.jsx)(t.lp,{size:"small",message:"Loading intra-cell data..."})}):x?(0,h.jsxs)("div",{className:"intra-cell-explorer error",children:[(0,h.jsx)(i.In,{icon:"mdi:alert-circle",width:24}),(0,h.jsx)("span",{children:x})]}):null!==c&&void 0!==c&&null!==(s=c.cells)&&void 0!==s&&s.length?(0,h.jsxs)("div",{className:"intra-cell-explorer",children:[(0,h.jsxs)("div",{className:"explorer-header",children:[(0,h.jsxs)("div",{className:"selector-group",children:[(0,h.jsxs)("div",{className:"cell-selector",children:[(0,h.jsx)("label",{children:"Cell:"}),(0,h.jsx)("select",{value:j||"",onChange:e=>{var s;p(e.target.value);const a=c.cells.find(s=>s.cell_name===e.target.value);(null===a||void 0===a||null===(s=a.takes)||void 0===s?void 0:s.length)>0&&N(a.takes[0].take_index)},children:c.cells.map(e=>(0,h.jsx)("option",{value:e.cell_name,children:e.cell_name},e.cell_name))})]}),(null===y||void 0===y||null===(a=y.takes)||void 0===a?void 0:a.length)>1&&(0,h.jsxs)("div",{className:"take-selector",children:[(0,h.jsx)("label",{children:"Take:"}),(0,h.jsx)("select",{value:null!==g&&void 0!==g?g:"",onChange:e=>N(""===e.target.value?null:parseInt(e.target.value)),children:y.takes.map(e=>{var s,a;return(0,h.jsx)("option",{value:null!==(a=e.take_index)&&void 0!==a?a:"",children:null===e.take_index?"Main":"Take ".concat(e.take_index)},null!==(s=e.take_index)&&void 0!==s?s:"main")})})]})]}),(0,h.jsxs)("div",{className:"view-toggle",children:[(0,h.jsxs)("button",{className:"timeline"===b?"active":"",onClick:()=>_("timeline"),children:[(0,h.jsx)(i.In,{icon:"mdi:chart-line",width:14}),"Timeline"]}),(0,h.jsxs)("button",{className:"breakdown"===b?"active":"",onClick:()=>_("breakdown"),children:[(0,h.jsx)(i.In,{icon:"mdi:format-list-bulleted",width:14}),"Breakdown"]})]})]}),f&&(0,h.jsxs)("div",{className:"config-selector-panel",children:[(0,h.jsxs)("div",{className:"config-row",children:[(0,h.jsx)("span",{className:"config-label",children:"Window"}),(0,h.jsx)("span",{className:"config-desc",children:"Recent turns to keep"}),(0,h.jsx)("div",{className:"config-buttons",children:k.windows.map(e=>(0,h.jsx)("button",{className:f.window===e?"active":"",onClick:()=>w((0,u.A)((0,u.A)({},f),{},{window:e})),children:e},e))})]}),(0,h.jsxs)("div",{className:"config-row",children:[(0,h.jsx)("span",{className:"config-label",children:"Mask After"}),(0,h.jsx)("span",{className:"config-desc",children:"Turns before masking"}),(0,h.jsx)("div",{className:"config-buttons",children:k.mask_afters.map(e=>(0,h.jsx)("button",{className:f.mask_after===e?"active":"",onClick:()=>w((0,u.A)((0,u.A)({},f),{},{mask_after:e})),children:e},e))})]}),(0,h.jsxs)("div",{className:"config-row",children:[(0,h.jsx)("span",{className:"config-label",children:"Min Size"}),(0,h.jsx)("span",{className:"config-desc",children:"Chars to trigger mask"}),(0,h.jsx)("div",{className:"config-buttons",children:k.min_sizes.map(e=>(0,h.jsx)("button",{className:f.min_size===e?"active":"",onClick:()=>w((0,u.A)((0,u.A)({},f),{},{min_size:e})),children:e},e))})]})]}),S&&(0,h.jsxs)("div",{className:"config-summary",children:[(0,h.jsxs)("div",{className:"summary-card savings",children:[(0,h.jsxs)("div",{className:"card-value",children:[S.savingsPercent,"%"]}),(0,h.jsx)("div",{className:"card-label",children:"savings"})]}),(0,h.jsxs)("div",{className:"summary-card",children:[(0,h.jsx)("div",{className:"card-value",children:S.totalSaved.toLocaleString()}),(0,h.jsx)("div",{className:"card-label",children:"tokens saved"})]}),(0,h.jsxs)("div",{className:"summary-card",children:[(0,h.jsx)("div",{className:"card-value",children:S.totalBefore.toLocaleString()}),(0,h.jsx)("div",{className:"card-label",children:"before"})]}),(0,h.jsxs)("div",{className:"summary-card",children:[(0,h.jsx)("div",{className:"card-value",children:S.totalAfter.toLocaleString()}),(0,h.jsx)("div",{className:"card-label",children:"after"})]}),(0,h.jsxs)("div",{className:"summary-card",children:[(0,h.jsx)("div",{className:"card-value",children:S.turnsAnalyzed}),(0,h.jsx)("div",{className:"card-label",children:"turns"})]})]}),"timeline"===b&&C.length>0&&(0,h.jsx)(le,{turns:C,config:f,height:220}),"breakdown"===b&&(0,h.jsx)("div",{className:"breakdown-view",children:C.map(e=>{var s;const a=(e=>{var s;const a=null===(s=e.configs)||void 0===s?void 0:s.find(e=>e.window===f.window&&e.mask_after===f.mask_after&&e.min_size===f.min_size);return(null===a||void 0===a?void 0:a.message_breakdown)||[]})(e),l=null===(s=e.configs)||void 0===s?void 0:s.find(e=>e.window===f.window&&e.mask_after===f.mask_after&&e.min_size===f.min_size);return l?(0,h.jsxs)("div",{className:"turn-breakdown",children:[(0,h.jsxs)("div",{className:"turn-header",children:[(0,h.jsxs)("span",{className:"turn-number",children:["Turn ",e.turn_number]}),(0,h.jsxs)("span",{className:"turn-stats",children:[l.tokens_before.toLocaleString()," \u2192 ",l.tokens_after.toLocaleString(),(0,h.jsxs)("span",{className:"turn-saved",children:["(-",l.tokens_saved.toLocaleString(),")"]})]})]}),a.length>0&&(0,h.jsx)("div",{className:"message-actions",children:a.map((e,s)=>{var a;return(0,h.jsxs)("div",{className:"action-row ".concat((null===(a=e.action)||void 0===a?void 0:a.toLowerCase())||"keep"),children:[(0,h.jsx)("div",{className:"action-role",children:(0,h.jsx)("span",{className:"role-badge ".concat(e.role),children:e.role})}),(0,h.jsxs)("div",{className:"action-type",children:["keep"===e.action&&(0,h.jsx)(i.In,{icon:"mdi:check",width:14}),"mask"===e.action&&(0,h.jsx)(i.In,{icon:"mdi:eye-off",width:14}),"truncate"===e.action&&(0,h.jsx)(i.In,{icon:"mdi:content-cut",width:14}),e.action||"keep"]}),(0,h.jsxs)("div",{className:"action-tokens",children:[e.original_tokens," \u2192 ",e.result_tokens]}),e.reason&&(0,h.jsx)("div",{className:"action-reason",children:e.reason})]},s)})})]},e.turn_number):null})}),(0,h.jsxs)("div",{className:"yaml-preview",children:[(0,h.jsxs)("div",{className:"yaml-header",children:[(0,h.jsx)(i.In,{icon:"mdi:code-braces",width:14}),(0,h.jsx)("span",{children:"Recommended Configuration"}),(0,h.jsxs)("button",{className:"copy-button",onClick:()=>{const e="intra_context:\n  enabled: true\n  window: ".concat(f.window,"\n  mask_observations_after: ").concat(f.mask_after,"\n  min_masked_size: ").concat(f.min_size);navigator.clipboard.writeText(e)},children:[(0,h.jsx)(i.In,{icon:"mdi:content-copy",width:12}),"Copy"]})]}),(0,h.jsx)("pre",{className:"yaml-code",children:"intra_context:\n  enabled: true\n  window: ".concat(f.window,"\n  mask_observations_after: ").concat(f.mask_after,"\n  min_masked_size: ").concat(f.min_size)})]})]}):(0,h.jsxs)("div",{className:"intra-cell-explorer empty",children:[(0,h.jsx)(i.In,{icon:"mdi:rotate-right",width:32}),(0,h.jsx)("span",{children:"No intra-cell compression data available"})]})},ie=e=>{var s;let{sessionId:a,onMessageSelect:n}=e;const c=(0,l.useRef)(null),[r,o]=(0,l.useState)(null),[m,x]=(0,l.useState)(!0),[u,v]=(0,l.useState)(null),[j,p]=(0,l.useState)(null),[g,N]=(0,l.useState)(40);(0,l.useEffect)(()=>{if(!a)return;(async()=>{x(!0);try{const e=await fetch("".concat(d.J,"/api/context-assessment/relevance-scatter/").concat(a));if(!e.ok)throw new Error("Failed to fetch scatter data");const s=await e.json();o(s)}catch(e){v(e.message)}finally{x(!1)}})()},[a]);const f=(0,l.useMemo)(()=>{var e,s;if(null===r||void 0===r||!r.messages)return null;const a=r.messages.filter(e=>e.was_included&&e.composite_score<g),l=a.reduce((e,s)=>e+s.tokens,0),n=r.messages.reduce((e,s)=>e+s.tokens,0),i=(null===(e=r.waste_summary)||void 0===e?void 0:e.estimated_cost)||0,t=(null===(s=r.waste_summary)||void 0===s?void 0:s.tokens)||1,c=t>0?i/t:3e-6;return{wasteCount:a.length,wasteTokens:l,wastePct:n>0?l/n*100:0,estimatedSavings:l*c,modelUsed:r.model_used}},[r,g]);(0,l.useEffect)(()=>{var e;if(!c.current||null===r||void 0===r||null===(e=r.messages)||void 0===e||!e.length)return;const s=c.current,a=s.getContext("2d"),l=window.devicePixelRatio||1,n=s.getBoundingClientRect(),i=n.width,t=n.height;s.width=i*l,s.height=t*l,a.scale(l,l),a.fillStyle="#0a0a0a",a.fillRect(0,0,i,t);const o=30,d=30,h=50,m=60,x=i-m-d,u=t-o-h,v=Math.max(...r.messages.map(e=>e.tokens),100),p=e=>o+u-e/100*u;a.fillStyle="rgba(248, 113, 113, 0.08)",a.fillRect(m,p(g),x,u-(u-(p(g)-o))),a.strokeStyle="rgba(248, 113, 113, 0.5)",a.lineWidth=1,a.setLineDash([4,4]),a.beginPath(),a.moveTo(m,p(g)),a.lineTo(i-d,p(g)),a.stroke(),a.setLineDash([]),a.fillStyle="#f87171",a.font="10px Inter, sans-serif",a.textAlign="right",a.fillText("Waste threshold: ".concat(g),i-d-5,p(g)-5),a.strokeStyle="#1e1e24",a.lineWidth=1;for(let c=0;c<=4;c++){const e=o+c/4*u;a.beginPath(),a.moveTo(m,e),a.lineTo(i-d,e),a.stroke()}r.messages.forEach((e,s)=>{const l=(n=e.tokens,m+n/v*x);var n;const i=p(e.composite_score),t=e.was_included&&e.composite_score<g,c=j===s,r=Math.max(3,Math.min(8,e.tokens/200)),o=c?r+2:r;let d;d=t?"rgba(248, 113, 113, 0.8)":e.was_included?"rgba(52, 211, 153, 0.7)":"rgba(100, 116, 139, 0.5)",a.beginPath(),a.fillStyle=d,a.arc(l,i,o,0,2*Math.PI),a.fill(),c&&(a.strokeStyle="#fff",a.lineWidth=2,a.stroke())}),a.strokeStyle="#2a2a32",a.lineWidth=1,a.beginPath(),a.moveTo(m,o),a.lineTo(m,t-h),a.lineTo(i-d,t-h),a.stroke(),a.fillStyle="#64748b",a.font="10px Inter, sans-serif",a.textAlign="right",a.textBaseline="middle";for(let c=0;c<=4;c++){const e=100-25*c,s=o+c/4*u;a.fillText(e.toString(),m-8,s)}a.textAlign="center",a.textBaseline="top";for(let c=0;c<=4;c++){const e=Math.round(v*c/4),s=m+c/4*x;a.fillText(e>=1e3?"".concat((e/1e3).toFixed(1),"k"):e.toString(),s,t-h+8)}a.fillStyle="#94a3b8",a.font="11px Inter, sans-serif",a.textAlign="center",a.fillText("Tokens (Cost)",i/2,t-10),a.save(),a.translate(15,t/2),a.rotate(-Math.PI/2),a.fillText("Relevance Score",0,0),a.restore()},[r,j,g]);if(m)return(0,h.jsx)("div",{className:"waste-scatter loading",children:(0,h.jsx)(t.lp,{size:"small",message:"Loading scatter data..."})});if(u)return(0,h.jsxs)("div",{className:"waste-scatter error",children:[(0,h.jsx)(i.In,{icon:"mdi:alert-circle",width:24}),(0,h.jsx)("span",{children:u})]});if(null===r||void 0===r||null===(s=r.messages)||void 0===s||!s.length)return(0,h.jsxs)("div",{className:"waste-scatter empty",children:[(0,h.jsx)(i.In,{icon:"mdi:scatter-plot",width:32}),(0,h.jsx)("span",{children:"No message data available for scatter plot"})]});const w=null!==j?r.messages[j]:null;return(0,h.jsxs)("div",{className:"waste-scatter",children:[(0,h.jsxs)("div",{className:"scatter-header",children:[(0,h.jsxs)("div",{className:"header-left",children:[(0,h.jsx)("h4",{children:"Relevance vs. Cost Analysis"}),(0,h.jsx)("p",{children:"Identify waste: high-cost messages with low relevance"})]}),(0,h.jsxs)("div",{className:"threshold-control",children:[(0,h.jsx)("label",{children:"Waste threshold:"}),(0,h.jsx)("input",{type:"range",min:10,max:70,value:g,onChange:e=>N(parseInt(e.target.value))}),(0,h.jsx)("span",{children:g})]})]}),f&&(0,h.jsxs)("div",{className:"waste-summary",children:[(0,h.jsxs)("div",{className:"summary-item waste",children:[(0,h.jsx)(i.In,{icon:"mdi:alert-circle",width:16}),(0,h.jsx)("span",{className:"value",children:f.wasteCount}),(0,h.jsx)("span",{className:"label",children:"waste messages"})]}),(0,h.jsxs)("div",{className:"summary-item tokens",children:[(0,h.jsx)(i.In,{icon:"mdi:text",width:16}),(0,h.jsx)("span",{className:"value",children:f.wasteTokens.toLocaleString()}),(0,h.jsx)("span",{className:"label",children:"wasted tokens"})]}),(0,h.jsxs)("div",{className:"summary-item pct",children:[(0,h.jsx)(i.In,{icon:"mdi:percent",width:16}),(0,h.jsxs)("span",{className:"value",children:[f.wastePct.toFixed(1),"%"]}),(0,h.jsx)("span",{className:"label",children:"of context"})]}),(0,h.jsxs)("div",{className:"summary-item savings",children:[(0,h.jsx)(i.In,{icon:"mdi:currency-usd",width:16}),(0,h.jsxs)("span",{className:"value",children:["$",f.estimatedSavings.toFixed(6)]}),(0,h.jsx)("span",{className:"label",children:"potential savings"})]}),f.modelUsed&&(0,h.jsxs)("div",{className:"summary-item model",title:"Pricing based on ".concat(f.modelUsed),children:[(0,h.jsx)(i.In,{icon:"mdi:chip",width:16}),(0,h.jsx)("span",{className:"label",children:f.modelUsed.split("/").pop()})]})]}),(0,h.jsx)("div",{className:"scatter-container",children:(0,h.jsx)("canvas",{ref:c,onMouseMove:e=>{var s;if(null===r||void 0===r||null===(s=r.messages)||void 0===s||!s.length||!c.current)return;const a=c.current.getBoundingClientRect(),l=e.clientX-a.left,n=e.clientY-a.top,i=30,t=30,o=50,d=60,h=a.width-d-t,m=a.height-i-o,x=Math.max(...r.messages.map(e=>e.tokens),100);let u=null,v=20;r.messages.forEach((e,s)=>{const a=d+e.tokens/x*h,t=i+m-e.composite_score/100*m,c=Math.sqrt((l-a)**2+(n-t)**2);c<v&&(v=c,u=s)}),p(u)},onMouseLeave:()=>p(null),onClick:()=>{null!==j&&n&&n(r.messages[j])},style:{width:"100%",height:300,cursor:null!==j?"pointer":"default"}})}),w&&(0,h.jsxs)("div",{className:"hover-tooltip",children:[(0,h.jsxs)("div",{className:"tooltip-role",children:[(0,h.jsx)("span",{className:"role-badge ".concat(w.role),children:w.role}),(0,h.jsxs)("span",{className:"source",children:["from ",w.source_cell]})]}),(0,h.jsxs)("div",{className:"tooltip-stats",children:[(0,h.jsxs)("span",{children:[(0,h.jsx)("strong",{children:w.tokens})," tokens"]}),(0,h.jsxs)("span",{children:[(0,h.jsx)("strong",{children:Math.round(w.composite_score)})," relevance"]}),(0,h.jsx)("span",{className:w.was_included?"included":"excluded",children:w.was_included?"Included":"Excluded"})]}),(0,h.jsx)("div",{className:"tooltip-preview",children:w.preview})]}),(0,h.jsxs)("div",{className:"scatter-legend",children:[(0,h.jsxs)("span",{className:"legend-item included",children:[(0,h.jsx)("span",{className:"dot"})," High relevance (keep)"]}),(0,h.jsxs)("span",{className:"legend-item waste",children:[(0,h.jsx)("span",{className:"dot"})," Low relevance (waste)"]}),(0,h.jsxs)("span",{className:"legend-item excluded",children:[(0,h.jsx)("span",{className:"dot"})," Already excluded"]})]})]})},te=e=>{var s,a,n,c,r,o,m,x,u,v,j,p,g,N,f,w,b,_,k,y,C,S;let{cascadeId:I}=e;const[A,F]=(0,l.useState)(null),[M,T]=(0,l.useState)(!0),[L,z]=(0,l.useState)(null),[E,R]=(0,l.useState)(30);if((0,l.useEffect)(()=>{if(!I)return;(async()=>{T(!0);try{const e=await fetch("".concat(d.J,"/api/context-assessment/cascade-aggregate/").concat(I,"?days=").concat(E));if(!e.ok)throw new Error("Failed to fetch aggregate data");const s=await e.json();F(s)}catch(e){z(e.message)}finally{T(!1)}})()},[I,E]),M)return(0,h.jsx)("div",{className:"cascade-aggregate loading",children:(0,h.jsx)(t.lp,{size:"small",message:"Analyzing ".concat(E," days of runs...")})});if(L)return(0,h.jsxs)("div",{className:"cascade-aggregate error",children:[(0,h.jsx)(i.In,{icon:"mdi:alert-circle",width:24}),(0,h.jsx)("span",{children:L})]});if(null!==A&&void 0!==A&&A.insufficient_data)return(0,h.jsxs)("div",{className:"cascade-aggregate insufficient",children:[(0,h.jsx)(i.In,{icon:"mdi:chart-timeline-variant",width:48}),(0,h.jsx)("h3",{children:"Need More Data"}),(0,h.jsx)("p",{children:A.message}),(0,h.jsx)("p",{className:"hint",children:"Run more sessions with shadow assessment enabled to unlock multi-run analysis."})]});if(!A)return(0,h.jsxs)("div",{className:"cascade-aggregate empty",children:[(0,h.jsx)(i.In,{icon:"mdi:chart-timeline-variant",width:32}),(0,h.jsx)("span",{children:"No aggregate data available"})]});return(0,h.jsxs)("div",{className:"cascade-aggregate",children:[(0,h.jsxs)("div",{className:"aggregate-header",children:[(0,h.jsxs)("div",{className:"header-left",children:[(0,h.jsxs)("h3",{children:[(0,h.jsx)(i.In,{icon:"mdi:chart-timeline-variant",width:20}),"Multi-Run Analysis"]}),(0,h.jsxs)("p",{children:["Aggregated insights from ",A.session_count," sessions"]})]}),(0,h.jsxs)("div",{className:"header-controls",children:[(0,h.jsx)("label",{children:"Time range:"}),(0,h.jsxs)("select",{value:E,onChange:e=>R(parseInt(e.target.value)),children:[(0,h.jsx)("option",{value:7,children:"Last 7 days"}),(0,h.jsx)("option",{value:14,children:"Last 14 days"}),(0,h.jsx)("option",{value:30,children:"Last 30 days"}),(0,h.jsx)("option",{value:60,children:"Last 60 days"})]})]})]}),(0,h.jsxs)("div",{className:"confidence-badge",style:{borderColor:{high:"#34d399",medium:"#fbbf24",low:"#f87171"}[null===(s=A.recommendations)||void 0===s?void 0:s.confidence]},children:[(0,h.jsx)(i.In,{icon:"mdi:shield-check",width:16}),(0,h.jsxs)("span",{className:"confidence-level",children:[null===(a=A.recommendations)||void 0===a?void 0:a.confidence," confidence"]}),(0,h.jsxs)("span",{className:"confidence-detail",children:["(",A.session_count," sessions analyzed)"]})]}),A.model_used&&(0,h.jsxs)("div",{className:"model-badge",title:"Pricing based on ".concat(A.model_used),children:[(0,h.jsx)(i.In,{icon:"mdi:chip",width:14}),(0,h.jsx)("span",{children:A.model_used})]}),(0,h.jsxs)("div",{className:"summary-cards",children:[(0,h.jsxs)("div",{className:"summary-card savings",children:[(0,h.jsx)("div",{className:"card-icon",children:(0,h.jsx)(i.In,{icon:"mdi:piggy-bank",width:24})}),(0,h.jsxs)("div",{className:"card-content",children:[(0,h.jsxs)("div",{className:"card-value",children:["$",(null===(n=A.recommendations)||void 0===n||null===(c=n.estimated_monthly_savings)||void 0===c?void 0:c.toFixed(4))||"0.0000"]}),(0,h.jsx)("div",{className:"card-label",children:"Est. Monthly Savings"}),(0,h.jsxs)("div",{className:"card-detail",children:["$",(null===(r=A.recommendations)||void 0===r||null===(o=r.estimated_savings_per_run)||void 0===o?void 0:o.toFixed(6))||"0","/run"]})]})]}),(0,h.jsxs)("div",{className:"summary-card waste",children:[(0,h.jsx)("div",{className:"card-icon",children:(0,h.jsx)(i.In,{icon:"mdi:delete-outline",width:24})}),(0,h.jsxs)("div",{className:"card-content",children:[(0,h.jsxs)("div",{className:"card-value",children:["$",(null===(m=A.inter_cell)||void 0===m||null===(x=m.estimated_waste_cost)||void 0===x?void 0:x.toFixed(4))||"0.0000"]}),(0,h.jsx)("div",{className:"card-label",children:"Wasted on Low-Relevance"}),(0,h.jsxs)("div",{className:"card-detail",children:[(null===(u=A.inter_cell)||void 0===u||null===(v=u.total_waste_pct)||void 0===v?void 0:v.toFixed(1))||0,"% (",(null===(j=A.inter_cell)||void 0===j||null===(p=j.total_waste_tokens)||void 0===p?void 0:p.toLocaleString())||0," tokens)"]})]})]}),(0,h.jsxs)("div",{className:"summary-card compression",children:[(0,h.jsx)("div",{className:"card-icon",children:(0,h.jsx)(i.In,{icon:"mdi:compress",width:24})}),(0,h.jsxs)("div",{className:"card-content",children:[(0,h.jsxs)("div",{className:"card-value",children:[(null===(g=A.intra_cell)||void 0===g||null===(N=g.best_config)||void 0===N?void 0:N.avg_savings_pct)||0,"%"]}),(0,h.jsx)("div",{className:"card-label",children:"Best Compression"}),(0,h.jsxs)("div",{className:"card-detail",children:[(null===(f=A.intra_cell)||void 0===f||null===(w=f.best_config)||void 0===w||null===(b=w.avg_tokens_saved)||void 0===b?void 0:b.toLocaleString())||0," tokens/run"]})]})]})]}),(null===(_=A.intra_cell)||void 0===_?void 0:_.best_config)&&(0,h.jsxs)("div",{className:"best-config-card",children:[(0,h.jsxs)("div",{className:"config-header",children:[(0,h.jsx)(i.In,{icon:"mdi:star",width:16}),(0,h.jsx)("span",{children:"Recommended Configuration"}),(0,h.jsxs)("span",{className:"consistency-badge",title:"Consistency across runs",children:[A.intra_cell.best_config.consistency,"% consistent"]})]}),(0,h.jsxs)("div",{className:"config-body",children:[(0,h.jsxs)("div",{className:"config-params",children:[(0,h.jsxs)("div",{className:"param",children:[(0,h.jsx)("span",{className:"param-label",children:"window"}),(0,h.jsx)("span",{className:"param-value",children:A.intra_cell.best_config.window})]}),(0,h.jsxs)("div",{className:"param",children:[(0,h.jsx)("span",{className:"param-label",children:"mask_after"}),(0,h.jsx)("span",{className:"param-value",children:A.intra_cell.best_config.mask_after})]}),(0,h.jsxs)("div",{className:"param",children:[(0,h.jsx)("span",{className:"param-label",children:"min_size"}),(0,h.jsx)("span",{className:"param-value",children:A.intra_cell.best_config.min_size})]})]}),(0,h.jsxs)("div",{className:"config-stats",children:[(0,h.jsxs)("span",{children:[(0,h.jsxs)("strong",{children:[A.intra_cell.best_config.avg_savings_pct,"%"]})," avg savings"]}),(0,h.jsxs)("span",{children:[(0,h.jsx)("strong",{children:A.intra_cell.best_config.sessions_analyzed})," sessions tested"]})]})]}),(0,h.jsx)("div",{className:"config-footer",children:(0,h.jsxs)("button",{className:"copy-yaml-btn",onClick:()=>{const e="intra_context:\n  enabled: true\n  window: ".concat(A.intra_cell.best_config.window,"\n  mask_observations_after: ").concat(A.intra_cell.best_config.mask_after,"\n  min_masked_size: ").concat(A.intra_cell.best_config.min_size);navigator.clipboard.writeText(e)},children:[(0,h.jsx)(i.In,{icon:"mdi:content-copy",width:14}),"Copy YAML"]})})]}),(null===(k=A.inter_cell)||void 0===k||null===(y=k.cells)||void 0===y?void 0:y.length)>0&&(0,h.jsxs)("div",{className:"cell-waste-section",children:[(0,h.jsx)("h4",{children:"Waste by Cell"}),(0,h.jsx)("p",{children:"Cells with consistently low-relevance context"}),(0,h.jsxs)("div",{className:"cell-waste-table",children:[(0,h.jsxs)("div",{className:"table-header",children:[(0,h.jsx)("span",{children:"Cell"}),(0,h.jsx)("span",{children:"Avg Relevance"}),(0,h.jsx)("span",{children:"Waste %"}),(0,h.jsx)("span",{children:"Waste Tokens"}),(0,h.jsx)("span",{children:"Sessions"})]}),A.inter_cell.cells.map(e=>(0,h.jsxs)("div",{className:"table-row",children:[(0,h.jsx)("span",{className:"cell-name",children:e.cell_name}),(0,h.jsxs)("span",{className:"relevance",children:[(0,h.jsx)("span",{className:"relevance-bar",style:{width:"".concat(e.avg_relevance,"%"),background:e.avg_relevance>=70?"#34d399":e.avg_relevance>=40?"#fbbf24":"#f87171"}}),Math.round(e.avg_relevance)]}),(0,h.jsxs)("span",{className:"waste-pct ".concat(e.waste_pct>20?"high":""),children:[e.waste_pct.toFixed(1),"%"]}),(0,h.jsx)("span",{className:"waste-tokens",children:e.waste_tokens.toLocaleString()}),(0,h.jsx)("span",{className:"sessions",children:e.sessions_seen})]},e.cell_name))]})]}),(null===(C=A.intra_cell)||void 0===C||null===(S=C.all_configs)||void 0===S?void 0:S.length)>1&&(0,h.jsxs)("div",{className:"all-configs-section",children:[(0,h.jsx)("h4",{children:"Alternative Configurations"}),(0,h.jsx)("div",{className:"configs-grid",children:A.intra_cell.all_configs.slice(1).map((e,s)=>(0,h.jsxs)("div",{className:"config-option",children:[(0,h.jsxs)("div",{className:"option-params",children:["w=",e.window," m=",e.mask_after," s=",e.min_size]}),(0,h.jsxs)("div",{className:"option-savings",children:[e.avg_savings_pct,"% savings"]}),(0,h.jsxs)("div",{className:"option-sessions",children:[e.sessions," runs"]})]},s))})]})]})},ce=()=>{const[e,s]=(0,l.useState)(!1);return(0,h.jsxs)("div",{className:"explainer-banner ".concat(e?"expanded":""),children:[(0,h.jsxs)("div",{className:"explainer-header",onClick:()=>s(!e),children:[(0,h.jsx)(i.In,{icon:"mdi:information-outline",width:14}),(0,h.jsx)("span",{children:"What is Shadow Assessment?"}),(0,h.jsx)(i.In,{icon:e?"mdi:chevron-up":"mdi:chevron-down",width:14})]}),e&&(0,h.jsxs)("div",{className:"explainer-content",children:[(0,h.jsxs)("div",{className:"explainer-section",children:[(0,h.jsxs)("h4",{children:[(0,h.jsx)(i.In,{icon:"mdi:swap-horizontal",width:14})," Inter-Cell Context"]}),(0,h.jsxs)("p",{children:["Analyzes which messages from ",(0,h.jsx)("strong",{children:"other cells"})," should be included when entering a new cell. Uses three strategies: ",(0,h.jsx)("strong",{children:"heuristic"})," (keyword matching, recency),",(0,h.jsx)("strong",{children:"semantic"})," (embedding similarity), and ",(0,h.jsx)("strong",{children:"LLM"})," (model-based selection)."]})]}),(0,h.jsxs)("div",{className:"explainer-section",children:[(0,h.jsxs)("h4",{children:[(0,h.jsx)(i.In,{icon:"mdi:rotate-right",width:14})," Intra-Cell Compression"]}),(0,h.jsxs)("p",{children:["Evaluates how to compress the conversation ",(0,h.jsx)("strong",{children:"within a cell"})," as turns accumulate. Tests different ",(0,h.jsx)("strong",{children:"window"})," sizes (how many recent turns to keep) and",(0,h.jsx)("strong",{children:"mask_after"})," settings (when to start hiding tool results)."]})]}),(0,h.jsxs)("div",{className:"explainer-section",children:[(0,h.jsxs)("h4",{children:[(0,h.jsx)(i.In,{icon:"mdi:eye-outline",width:14})," Shadow Mode"]}),(0,h.jsxs)("p",{children:["These assessments run in the ",(0,h.jsx)("strong",{children:"background"})," without affecting actual execution. They show what ",(0,h.jsx)("em",{children:"would"})," happen with different context strategies, helping you tune settings before enabling them."]})]})]})]})},re=e=>{var s,a;let{overview:l}=e;return(0,h.jsxs)("div",{className:"overview-summary",children:[l.best_intra_config&&(0,h.jsxs)("div",{className:"recommendation-card",children:[(0,h.jsxs)("div",{className:"recommendation-header",children:[(0,h.jsx)(i.In,{icon:"mdi:lightbulb",width:16,style:{color:"#fbbf24"}}),(0,h.jsx)("span",{children:"Recommended Intra-Context Config"})]}),(0,h.jsxs)("div",{className:"recommendation-content",children:[(0,h.jsx)("div",{className:"config-explainer",children:(0,h.jsx)("p",{children:"Based on shadow assessment of this session, enabling intra-context compression with these settings would reduce token usage:"})}),(0,h.jsxs)("div",{className:"config-grid",children:[(0,h.jsxs)("div",{className:"config-item",children:[(0,h.jsx)("span",{className:"config-label",children:"Window"}),(0,h.jsx)("span",{className:"config-value",children:l.best_intra_config.window}),(0,h.jsx)("span",{className:"config-help",children:"turns to keep in full"})]}),(0,h.jsxs)("div",{className:"config-item",children:[(0,h.jsx)("span",{className:"config-label",children:"Mask After"}),(0,h.jsx)("span",{className:"config-value",children:l.best_intra_config.mask_after}),(0,h.jsx)("span",{className:"config-help",children:"turns before masking tool results"})]}),(0,h.jsxs)("div",{className:"config-item",children:[(0,h.jsx)("span",{className:"config-label",children:"Min Size"}),(0,h.jsx)("span",{className:"config-value",children:l.best_intra_config.min_size}),(0,h.jsx)("span",{className:"config-help",children:"chars before masking applies"})]}),(0,h.jsxs)("div",{className:"config-item highlight",children:[(0,h.jsx)("span",{className:"config-label",children:"Tokens Saved"}),(0,h.jsx)("span",{className:"config-value",children:(null===(s=l.best_intra_config.total_saved)||void 0===s?void 0:s.toLocaleString())||"\u2014"}),(0,h.jsx)("span",{className:"config-help",children:"total across all turns"})]})]}),(0,h.jsxs)("div",{className:"yaml-snippet",children:[(0,h.jsxs)("div",{className:"yaml-header",children:[(0,h.jsx)("span",{children:"Add to your cascade YAML:"}),(0,h.jsxs)("button",{className:"copy-btn",onClick:()=>{const e="intra_context:\n  enabled: true\n  window: ".concat(l.best_intra_config.window,"\n  mask_observations_after: ").concat(l.best_intra_config.mask_after,"\n  min_masked_size: ").concat(l.best_intra_config.min_size);navigator.clipboard.writeText(e)},children:[(0,h.jsx)(i.In,{icon:"mdi:content-copy",width:12}),"Copy"]})]}),(0,h.jsx)("pre",{children:"intra_context:\n  enabled: true\n  window: ".concat(l.best_intra_config.window,"\n  mask_observations_after: ").concat(l.best_intra_config.mask_after,"\n  min_masked_size: ").concat(l.best_intra_config.min_size)})]})]})]}),(0,h.jsxs)("div",{className:"stats-summary",children:[l.inter_cell&&(0,h.jsxs)("div",{className:"stats-section",children:[(0,h.jsxs)("div",{className:"stats-header",children:[(0,h.jsx)(i.In,{icon:"mdi:swap-horizontal",width:16}),(0,h.jsx)("h4",{children:"Inter-Cell Context Analysis"})]}),(0,h.jsxs)("div",{className:"stats-body",children:[(0,h.jsxs)("p",{children:["Analyzed ",(0,h.jsx)("strong",{children:l.inter_cell.messages_assessed})," take messages across ",(0,h.jsx)("strong",{children:l.inter_cell.cells_assessed})," cell transitions."]}),l.inter_cell.would_prune_count>0?(0,h.jsxs)("div",{className:"stats-insight warning",children:[(0,h.jsx)(i.In,{icon:"mdi:scissors-cutting",width:14}),(0,h.jsxs)("span",{children:["Auto-context would prune ",(0,h.jsx)("strong",{children:l.inter_cell.would_prune_count})," messages that are currently included, saving ~",null===(a=l.inter_cell.potential_token_savings)||void 0===a?void 0:a.toLocaleString()," tokens."]})]}):(0,h.jsxs)("div",{className:"stats-insight success",children:[(0,h.jsx)(i.In,{icon:"mdi:check-circle",width:14}),(0,h.jsx)("span",{children:"Current context selection appears optimal - no unnecessary messages detected."})]})]})]}),l.intra_cell&&(0,h.jsxs)("div",{className:"stats-section",children:[(0,h.jsxs)("div",{className:"stats-header",children:[(0,h.jsx)(i.In,{icon:"mdi:rotate-right",width:16}),(0,h.jsx)("h4",{children:"Intra-Cell Compression Analysis"})]}),(0,h.jsxs)("div",{className:"stats-body",children:[(0,h.jsxs)("p",{children:["Evaluated ",(0,h.jsx)("strong",{children:l.intra_cell.total_config_rows})," configuration scenarios across ",(0,h.jsx)("strong",{children:l.intra_cell.turns_assessed})," turns."]}),(0,h.jsxs)("div",{className:"compression-summary",children:[(0,h.jsxs)("div",{className:"compression-bar",children:[(0,h.jsx)("div",{className:"compression-fill",style:{width:"".concat(100*(l.intra_cell.avg_compression_ratio||1),"%")}}),(0,h.jsxs)("span",{className:"compression-label",children:[(100*(l.intra_cell.avg_compression_ratio||1)).toFixed(0),"% retention"]})]}),(0,h.jsx)("p",{className:"compression-note",children:l.intra_cell.avg_compression_ratio<.8?"Compression could reduce context by ~".concat((100*(1-l.intra_cell.avg_compression_ratio)).toFixed(0),"%"):"Context is already fairly compact, limited compression available"})]})]})]}),!l.inter_cell&&!l.intra_cell&&(0,h.jsxs)("div",{className:"stats-section empty",children:[(0,h.jsx)(i.In,{icon:"mdi:clipboard-text-off-outline",width:32}),(0,h.jsx)("p",{children:"No assessment data available for this session."}),(0,h.jsx)("p",{className:"help-text",children:"Shadow assessment only runs when context selection is being evaluated."})]})]})]})},oe=e=>{var s;let{data:a,selectedCell:n,onCellSelect:t,selectedMessage:c,onMessageSelect:r}=e;const[o,d]=(0,l.useState)("all"),[m,x]=(0,l.useState)("rank");if(null===a||void 0===a||null===(s=a.cells)||void 0===s||!s.length)return(0,h.jsxs)("div",{className:"empty-content",children:[(0,h.jsx)(i.In,{icon:"mdi:information-outline",width:24}),(0,h.jsx)("p",{children:"No inter-cell assessment data available"}),(0,h.jsx)("p",{className:"help-text",children:"Inter-cell assessment requires multiple cells with context dependencies."})]});const u=a.cells.map(e=>e.cell_name),v=a.cells.flatMap(e=>e.messages),j=ue(v);return(0,h.jsxs)("div",{className:"inter-cell-content",children:[(0,h.jsxs)("div",{className:"strategy-legend",children:[(0,h.jsx)("div",{className:"legend-title",children:"Scoring Strategies:"}),(0,h.jsxs)("div",{className:"legend-items",children:[(0,h.jsxs)("div",{className:"legend-item",children:[(0,h.jsx)("span",{className:"legend-dot heuristic"}),(0,h.jsx)("span",{children:"Heuristic"}),(0,h.jsx)("span",{className:"legend-desc",children:"(keywords, recency)"})]}),(0,h.jsxs)("div",{className:"legend-item",children:[(0,h.jsx)("span",{className:"legend-dot semantic"}),(0,h.jsx)("span",{children:"Semantic"}),(0,h.jsx)("span",{className:"legend-desc",children:"(embedding similarity)"})]}),(0,h.jsxs)("div",{className:"legend-item",children:[(0,h.jsx)("span",{className:"legend-dot composite"}),(0,h.jsx)("span",{children:"Composite"}),(0,h.jsx)("span",{className:"legend-desc",children:"(weighted combination)"})]})]})]}),(0,h.jsxs)("div",{className:"score-distribution",children:[(0,h.jsxs)("div",{className:"distribution-header",children:[(0,h.jsx)("span",{children:"Relevance Score Distribution"}),(0,h.jsxs)("span",{className:"distribution-count",children:[v.length," messages"]})]}),(0,h.jsx)(xe,{data:j})]}),(0,h.jsxs)("div",{className:"inter-cell-filters",children:[(0,h.jsxs)("div",{className:"filter-group",children:[(0,h.jsx)("label",{children:"Target Cell:"}),(0,h.jsxs)("select",{value:n||"",onChange:e=>t(e.target.value||null),children:[(0,h.jsx)("option",{value:"",children:"All Cells"}),u.map(e=>(0,h.jsx)("option",{value:e,children:e},e))]})]}),(0,h.jsxs)("div",{className:"filter-group",children:[(0,h.jsx)("label",{children:"Strategy:"}),(0,h.jsxs)("select",{value:o,onChange:e=>d(e.target.value),children:[(0,h.jsx)("option",{value:"all",children:"All Strategies"}),(0,h.jsx)("option",{value:"would-include",children:"Would Include"}),(0,h.jsx)("option",{value:"would-exclude",children:"Would Exclude"}),(0,h.jsx)("option",{value:"mismatch",children:"Actual vs Shadow Mismatch"})]})]}),(0,h.jsxs)("div",{className:"filter-group",children:[(0,h.jsx)("label",{children:"Sort:"}),(0,h.jsxs)("select",{value:m,onChange:e=>x(e.target.value),children:[(0,h.jsx)("option",{value:"rank",children:"By Rank"}),(0,h.jsx)("option",{value:"score-desc",children:"Score (High to Low)"}),(0,h.jsx)("option",{value:"tokens-desc",children:"Tokens (High to Low)"}),(0,h.jsx)("option",{value:"source",children:"By Source Cell"})]})]})]}),(0,h.jsx)("div",{className:"messages-table-container",children:a.cells.map(e=>(0,h.jsx)(de,{cell:e,strategyFilter:o,sortBy:m,selectedMessage:c,onMessageSelect:r},e.cell_name))})]})},de=e=>{let{cell:s,strategyFilter:a,sortBy:n,selectedMessage:t,onMessageSelect:c}=e;const[r,o]=(0,l.useState)(!0);let d=[...s.messages];"would-include"===a?d=d.filter(e=>{var s;return null===(s=e.would_include)||void 0===s?void 0:s.hybrid}):"would-exclude"===a?d=d.filter(e=>{var s;return!(null!==(s=e.would_include)&&void 0!==s&&s.hybrid)}):"mismatch"===a&&(d=d.filter(e=>{var s;return e.was_actually_included!==(null===(s=e.would_include)||void 0===s?void 0:s.hybrid)})),"score-desc"===n?d.sort((e,s)=>{var a,l;return((null===(a=s.scores)||void 0===a?void 0:a.composite)||0)-((null===(l=e.scores)||void 0===l?void 0:l.composite)||0)}):"tokens-desc"===n?d.sort((e,s)=>(s.tokens||0)-(e.tokens||0)):"source"===n&&d.sort((e,s)=>(e.source_cell||"").localeCompare(s.source_cell||""));const m=s.messages.filter(e=>{var s;return e.was_actually_included!==(null===(s=e.would_include)||void 0===s?void 0:s.hybrid)}).length;return(0,h.jsxs)("div",{className:"cell-section",children:[(0,h.jsxs)("div",{className:"cell-header",onClick:()=>o(!r),children:[(0,h.jsx)(i.In,{icon:r?"mdi:chevron-down":"mdi:chevron-right",width:14}),(0,h.jsx)(i.In,{icon:"mdi:target",width:14,style:{color:"#00e5ff"}}),(0,h.jsx)("span",{className:"cell-name",children:s.cell_name}),(0,h.jsxs)("span",{className:"message-count",children:[d.length," messages"]}),m>0&&(0,h.jsxs)("span",{className:"mismatch-badge",children:[(0,h.jsx)(i.In,{icon:"mdi:alert",width:12}),m," mismatches"]})]}),r&&(0,h.jsxs)(h.Fragment,{children:[s.instructions_preview&&(0,h.jsxs)("div",{className:"cell-instructions",children:[(0,h.jsx)(i.In,{icon:"mdi:text",width:12}),(0,h.jsxs)("span",{children:[s.instructions_preview,"..."]})]}),(0,h.jsxs)("table",{className:"messages-table",children:[(0,h.jsx)("thead",{children:(0,h.jsxs)("tr",{children:[(0,h.jsx)("th",{className:"th-rank",children:"#"}),(0,h.jsx)("th",{className:"th-source",children:"Source"}),(0,h.jsx)("th",{className:"th-role",children:"Role"}),(0,h.jsx)("th",{className:"th-preview",children:"Content Preview"}),(0,h.jsx)("th",{className:"th-tokens",children:"Tokens"}),(0,h.jsx)("th",{className:"th-scores",children:"Scores"}),(0,h.jsx)("th",{className:"th-decision",children:"Decision"})]})}),(0,h.jsx)("tbody",{children:d.map((e,s)=>(0,h.jsx)(he,{msg:e,isSelected:(null===t||void 0===t?void 0:t.content_hash)===e.content_hash,onClick:()=>c(e)},s))})]})]})]})},he=e=>{var s,a,l,n,t,c,r;let{msg:o,isSelected:d,onClick:m}=e;const x=o.was_actually_included!==(null===(s=o.would_include)||void 0===s?void 0:s.hybrid);return(0,h.jsxs)("tr",{className:"\n        ".concat(o.was_actually_included?"included":"excluded","\n        ").concat(x?"mismatch":"","\n        ").concat(d?"selected":"","\n      "),onClick:m,children:[(0,h.jsxs)("td",{className:"rank",children:["#",(null===(a=o.ranks)||void 0===a?void 0:a.composite)||"\u2014"]}),(0,h.jsx)("td",{className:"source-cell",children:(0,h.jsx)("span",{className:"source-name",children:o.source_cell||"\u2014"})}),(0,h.jsx)("td",{className:"role",children:(0,h.jsx)("span",{className:"role-badge ".concat(o.role),children:o.role})}),(0,h.jsx)("td",{className:"preview",title:o.preview,children:(0,h.jsxs)("span",{className:"preview-text",children:[null===(l=o.preview)||void 0===l?void 0:l.slice(0,80),"..."]})}),(0,h.jsx)("td",{className:"tokens",children:(null===(n=o.tokens)||void 0===n?void 0:n.toLocaleString())||"\u2014"}),(0,h.jsx)("td",{className:"scores",children:(0,h.jsx)(me,{scores:o.scores})}),(0,h.jsx)("td",{className:"decision",children:(0,h.jsxs)("div",{className:"decision-badges",children:[(0,h.jsxs)("span",{className:"decision-badge ".concat(null!==(t=o.would_include)&&void 0!==t&&t.hybrid?"include":"exclude"),title:null!==(c=o.would_include)&&void 0!==c&&c.hybrid?"Shadow would include":"Shadow would exclude",children:[null!==(r=o.would_include)&&void 0!==r&&r.hybrid?(0,h.jsx)(i.In,{icon:"mdi:check",width:12}):(0,h.jsx)(i.In,{icon:"mdi:close",width:12}),"Shadow"]}),(0,h.jsxs)("span",{className:"decision-badge actual ".concat(o.was_actually_included?"include":"exclude"),title:o.was_actually_included?"Actually included":"Actually excluded",children:[o.was_actually_included?(0,h.jsx)(i.In,{icon:"mdi:check",width:12}):(0,h.jsx)(i.In,{icon:"mdi:close",width:12}),"Actual"]})]})})]})},me=e=>{var s,a,l,n;let{scores:i}=e;if(!i)return(0,h.jsx)("span",{className:"no-scores",children:"\u2014"});const t=e=>null===e||void 0===e?"#333":e>=70?"#34d399":e>=40?"#fbbf24":"#f87171";return(0,h.jsxs)("div",{className:"score-bar-container",children:[(0,h.jsxs)("div",{className:"score-bars",children:[(0,h.jsx)("div",{className:"score-bar heuristic",style:{width:"".concat(Math.min(i.heuristic||0,100),"%"),backgroundColor:t(i.heuristic)},title:"Heuristic: ".concat((null===(s=i.heuristic)||void 0===s?void 0:s.toFixed(0))||"\u2014")}),null!==i.semantic&&void 0!==i.semantic&&(0,h.jsx)("div",{className:"score-bar semantic",style:{width:"".concat(Math.min(i.semantic||0,100),"%"),backgroundColor:t(i.semantic)},title:"Semantic: ".concat((null===(a=i.semantic)||void 0===a?void 0:a.toFixed(0))||"\u2014")}),(0,h.jsx)("div",{className:"score-bar composite",style:{width:"".concat(Math.min(i.composite||0,100),"%"),backgroundColor:t(i.composite)},title:"Composite: ".concat((null===(l=i.composite)||void 0===l?void 0:l.toFixed(0))||"\u2014")})]}),(0,h.jsx)("span",{className:"score-value",children:(null===(n=i.composite)||void 0===n?void 0:n.toFixed(0))||"\u2014"})]})},xe=e=>{let{data:s}=e;const a=Math.max(...s.map(e=>e.count),1);return(0,h.jsx)("div",{className:"distribution-chart",children:s.map((e,s)=>(0,h.jsxs)("div",{className:"distribution-bucket",children:[(0,h.jsx)("div",{className:"bucket-bar",style:{height:"".concat(e.count/a*100,"%"),backgroundColor:e.color},title:"".concat(e.label,": ").concat(e.count," messages")}),(0,h.jsx)("span",{className:"bucket-label",children:e.label})]},s))})},ue=e=>{const s=[{min:0,max:20,label:"0-20",color:"#f87171",count:0},{min:20,max:40,label:"20-40",color:"#fb923c",count:0},{min:40,max:60,label:"40-60",color:"#fbbf24",count:0},{min:60,max:80,label:"60-80",color:"#a3e635",count:0},{min:80,max:100,label:"80-100",color:"#34d399",count:0}];return e.forEach(e=>{var a;const l=(null===(a=e.scores)||void 0===a?void 0:a.composite)||0;(s.find(e=>l>=e.min&&l<e.max)||s[s.length-1]).count++}),s},ve=e=>{var s;let{data:a,selectedCell:n,onCellSelect:t}=e;const[c,r]=(0,l.useState)({window:5,mask_after:3}),[o,d]=(0,l.useState)("cards");if(null===a||void 0===a||null===(s=a.cells)||void 0===s||!s.length)return(0,h.jsxs)("div",{className:"empty-content",children:[(0,h.jsx)(i.In,{icon:"mdi:information-outline",width:24}),(0,h.jsx)("p",{children:"No intra-cell assessment data available"}),(0,h.jsx)("p",{className:"help-text",children:"Intra-cell assessment requires multi-turn cells."})]});const m=a.cells.map(e=>e.cell_name),x=pe(a);return(0,h.jsxs)("div",{className:"intra-cell-content",children:[(0,h.jsxs)("div",{className:"config-explanation",children:[(0,h.jsx)(i.In,{icon:"mdi:information-outline",width:14}),(0,h.jsxs)("p",{children:[(0,h.jsx)("strong",{children:"Window"})," = number of recent turns kept in full.",(0,h.jsx)("strong",{children:"Mask After"})," = after this many turns, tool results are compressed. Lower values = more aggressive compression = more token savings."]})]}),(0,h.jsxs)("div",{className:"config-comparison",children:[(0,h.jsxs)("div",{className:"comparison-header",children:[(0,h.jsx)("span",{children:"Config Comparison"}),(0,h.jsx)("span",{className:"comparison-subtitle",children:"Token savings by configuration"})]}),(0,h.jsx)(je,{data:x,selectedConfig:c,onSelectConfig:r})]}),(0,h.jsxs)("div",{className:"config-selector",children:[(0,h.jsxs)("div",{className:"selector-group",children:[(0,h.jsx)("label",{children:"Window:"}),(0,h.jsx)("div",{className:"button-group",children:[3,5,7,10,15].map(e=>(0,h.jsx)("button",{className:c.window===e?"active":"",onClick:()=>r((0,u.A)((0,u.A)({},c),{},{window:e})),children:e},e))})]}),(0,h.jsxs)("div",{className:"selector-group",children:[(0,h.jsx)("label",{children:"Mask After:"}),(0,h.jsx)("div",{className:"button-group",children:[2,3,5,7].map(e=>(0,h.jsx)("button",{className:c.mask_after===e?"active":"",onClick:()=>r((0,u.A)((0,u.A)({},c),{},{mask_after:e})),children:e},e))})]}),(0,h.jsxs)("div",{className:"selector-group",children:[(0,h.jsx)("label",{children:"Cell:"}),(0,h.jsxs)("select",{value:n||"",onChange:e=>t(e.target.value||null),children:[(0,h.jsx)("option",{value:"",children:"All Cells"}),m.map(e=>(0,h.jsx)("option",{value:e,children:e},e))]})]}),(0,h.jsxs)("div",{className:"selector-group view-toggle",children:[(0,h.jsx)("button",{className:"cards"===o?"active":"",onClick:()=>d("cards"),children:(0,h.jsx)(i.In,{icon:"mdi:view-grid",width:14})}),(0,h.jsx)("button",{className:"timeline"===o?"active":"",onClick:()=>d("timeline"),children:(0,h.jsx)(i.In,{icon:"mdi:chart-timeline",width:14})})]})]}),"cards"===o?(0,h.jsx)(ge,{data:a,selectedConfig:c}):(0,h.jsx)(Ne,{data:a,selectedConfig:c})]})},je=e=>{let{data:s,selectedConfig:a,onSelectConfig:l}=e;const n=Math.max(...s.map(e=>e.total_saved),1);return(0,h.jsx)("div",{className:"config-chart",children:s.slice(0,10).map((e,s)=>{const i=e.window===a.window&&e.mask_after===a.mask_after;return(0,h.jsxs)("div",{className:"config-bar-container ".concat(i?"selected":""),onClick:()=>l({window:e.window,mask_after:e.mask_after}),children:[(0,h.jsxs)("div",{className:"config-bar-label",children:["w",e.window,"/m",e.mask_after]}),(0,h.jsx)("div",{className:"config-bar-wrapper",children:(0,h.jsx)("div",{className:"config-bar",style:{width:"".concat(e.total_saved/n*100,"%"),backgroundColor:i?"#00e5ff":"#60a5fa"}})}),(0,h.jsxs)("div",{className:"config-bar-value",children:[(e.total_saved/1e3).toFixed(1),"k"]})]},s)})})},pe=e=>{const s={};return e.cells.forEach(e=>{e.takes.forEach(e=>{e.turns.forEach(e=>{e.configs.forEach(e=>{const a="".concat(e.window,"-").concat(e.mask_after);s[a]||(s[a]={window:e.window,mask_after:e.mask_after,total_saved:0,turns:0}),s[a].total_saved+=e.tokens_saved||0,s[a].turns++})})})}),Object.values(s).sort((e,s)=>s.total_saved-e.total_saved)},ge=e=>{let{data:s,selectedConfig:a}=e;return(0,h.jsx)("div",{className:"compression-results",children:s.cells.map(e=>(0,h.jsxs)("div",{className:"cell-section",children:[(0,h.jsxs)("div",{className:"cell-header",children:[(0,h.jsx)(i.In,{icon:"mdi:function",width:14}),(0,h.jsx)("span",{className:"cell-name",children:e.cell_name})]}),e.takes.map(e=>{var s;return(0,h.jsxs)("div",{className:"take-section",children:[null!==e.take_index&&(0,h.jsxs)("div",{className:"take-header",children:["Take ",e.take_index]}),(0,h.jsx)("div",{className:"turns-grid",children:e.turns.map(e=>{const s=e.configs.find(e=>e.window===a.window&&e.mask_after===a.mask_after);if(!s)return null;const l=s.tokens_before>0?(s.tokens_saved/s.tokens_before*100).toFixed(0):0;return(0,h.jsxs)("div",{className:"turn-card",children:[(0,h.jsxs)("div",{className:"turn-header",children:[(0,h.jsxs)("span",{className:"turn-label",children:["Turn ",e.turn_number]}),e.is_loop_retry&&(0,h.jsx)("span",{className:"retry-badge",children:"retry"})]}),(0,h.jsxs)("div",{className:"turn-metrics",children:[(0,h.jsxs)("div",{className:"metric",children:[(0,h.jsx)("span",{className:"metric-label",children:"Before"}),(0,h.jsx)("span",{className:"metric-value",children:s.tokens_before.toLocaleString()})]}),(0,h.jsxs)("div",{className:"metric",children:[(0,h.jsx)("span",{className:"metric-label",children:"After"}),(0,h.jsx)("span",{className:"metric-value",children:s.tokens_after.toLocaleString()})]}),(0,h.jsxs)("div",{className:"metric ".concat(parseInt(l)>0?"highlight":""),children:[(0,h.jsx)("span",{className:"metric-label",children:"Saved"}),(0,h.jsxs)("span",{className:"metric-value",children:[s.tokens_saved.toLocaleString(),parseInt(l)>0&&" (".concat(l,"%)")]})]})]}),(0,h.jsxs)("div",{className:"turn-actions",children:[(0,h.jsxs)("span",{className:"action-stat",children:[(0,h.jsx)(i.In,{icon:"mdi:eye-off",width:12}),s.messages_masked," masked"]}),(0,h.jsxs)("span",{className:"action-stat",children:[(0,h.jsx)(i.In,{icon:"mdi:eye",width:12}),s.messages_preserved," kept"]})]})]},e.turn_number)})})]},null!==(s=e.take_index)&&void 0!==s?s:"main")})]},e.cell_name))})},Ne=e=>{let{data:s,selectedConfig:a}=e;const l=[];s.cells.forEach(e=>{e.takes.forEach(s=>{s.turns.forEach(n=>{const i=n.configs.find(e=>e.window===a.window&&e.mask_after===a.mask_after);i&&l.push({cell:e.cell_name,take:s.take_index,turn:n.turn_number,before:i.tokens_before,after:i.tokens_after,saved:i.tokens_saved})})})});const n=Math.max(...l.map(e=>e.before),1);return(0,h.jsxs)("div",{className:"compression-timeline",children:[(0,h.jsxs)("div",{className:"timeline-header",children:[(0,h.jsx)("span",{children:"Token Usage Over Turns"}),(0,h.jsxs)("div",{className:"timeline-legend",children:[(0,h.jsxs)("span",{className:"legend-item",children:[(0,h.jsx)("span",{className:"legend-bar before"}),"Before Compression"]}),(0,h.jsxs)("span",{className:"legend-item",children:[(0,h.jsx)("span",{className:"legend-bar after"}),"After Compression"]})]})]}),(0,h.jsx)("div",{className:"timeline-chart",children:l.map((e,s)=>(0,h.jsxs)("div",{className:"timeline-point",children:[(0,h.jsxs)("div",{className:"timeline-bars",children:[(0,h.jsx)("div",{className:"timeline-bar before",style:{height:"".concat(e.before/n*100,"%")},title:"Before: ".concat(e.before.toLocaleString()," tokens")}),(0,h.jsx)("div",{className:"timeline-bar after",style:{height:"".concat(e.after/n*100,"%")},title:"After: ".concat(e.after.toLocaleString()," tokens")})]}),(0,h.jsxs)("div",{className:"timeline-label",children:[(0,h.jsxs)("span",{className:"timeline-turn",children:["T",e.turn]}),e.saved>0&&(0,h.jsxs)("span",{className:"timeline-saved",children:["-",(e.saved/1e3).toFixed(1),"k"]})]})]},s))})]})},fe=e=>{var s,a,l,n,t,c,r,o,d,m,x,u,v,j,p,g,N,f,w,b,_,k,y,C,S;let{message:I,onClose:A}=e;const F=e=>null===e||void 0===e?"#64748b":e>=70?"#34d399":e>=40?"#fbbf24":"#f87171";return(0,h.jsxs)("div",{className:"message-detail-sidebar",children:[(0,h.jsxs)("div",{className:"sidebar-header",children:[(0,h.jsx)("h3",{children:"Message Details"}),(0,h.jsx)("button",{className:"close-btn",onClick:A,children:(0,h.jsx)(i.In,{icon:"mdi:close",width:18})})]}),(0,h.jsxs)("div",{className:"sidebar-content",children:[(0,h.jsxs)("div",{className:"detail-section",children:[(0,h.jsx)("h4",{children:"Source"}),(0,h.jsxs)("div",{className:"detail-row",children:[(0,h.jsx)("span",{className:"detail-label",children:"Cell:"}),(0,h.jsx)("span",{className:"detail-value",children:I.source_cell||"\u2014"})]}),(0,h.jsxs)("div",{className:"detail-row",children:[(0,h.jsx)("span",{className:"detail-label",children:"Role:"}),(0,h.jsx)("span",{className:"role-badge ".concat(I.role),children:I.role})]}),(0,h.jsxs)("div",{className:"detail-row",children:[(0,h.jsx)("span",{className:"detail-label",children:"Tokens:"}),(0,h.jsx)("span",{className:"detail-value",children:(null===(s=I.tokens)||void 0===s?void 0:s.toLocaleString())||"\u2014"})]}),(0,h.jsxs)("div",{className:"detail-row",children:[(0,h.jsx)("span",{className:"detail-label",children:"Turn:"}),(0,h.jsx)("span",{className:"detail-value",children:null!==(a=I.turn_number)&&void 0!==a?a:"\u2014"})]})]}),(0,h.jsxs)("div",{className:"detail-section",children:[(0,h.jsx)("h4",{children:"Relevance Scores"}),(0,h.jsxs)("div",{className:"score-details",children:[(0,h.jsxs)("div",{className:"score-detail-row",children:[(0,h.jsx)("span",{className:"score-label",children:"Heuristic"}),(0,h.jsx)("div",{className:"score-bar-full",children:(0,h.jsx)("div",{className:"score-fill",style:{width:"".concat((null===(l=I.scores)||void 0===l?void 0:l.heuristic)||0,"%"),backgroundColor:F(null===(n=I.scores)||void 0===n?void 0:n.heuristic)}})}),(0,h.jsx)("span",{className:"score-num",children:(null===(t=I.scores)||void 0===t||null===(c=t.heuristic)||void 0===c?void 0:c.toFixed(0))||"\u2014"})]}),(0,h.jsxs)("div",{className:"score-detail-row",children:[(0,h.jsx)("span",{className:"score-label",children:"Semantic"}),(0,h.jsx)("div",{className:"score-bar-full",children:(0,h.jsx)("div",{className:"score-fill",style:{width:"".concat((null===(r=I.scores)||void 0===r?void 0:r.semantic)||0,"%"),backgroundColor:F(null===(o=I.scores)||void 0===o?void 0:o.semantic)}})}),(0,h.jsx)("span",{className:"score-num",children:(null===(d=I.scores)||void 0===d||null===(m=d.semantic)||void 0===m?void 0:m.toFixed(0))||"\u2014"})]}),(0,h.jsxs)("div",{className:"score-detail-row",children:[(0,h.jsx)("span",{className:"score-label",children:"Composite"}),(0,h.jsx)("div",{className:"score-bar-full",children:(0,h.jsx)("div",{className:"score-fill",style:{width:"".concat((null===(x=I.scores)||void 0===x?void 0:x.composite)||0,"%"),backgroundColor:F(null===(u=I.scores)||void 0===u?void 0:u.composite)}})}),(0,h.jsx)("span",{className:"score-num",children:(null===(v=I.scores)||void 0===v||null===(j=v.composite)||void 0===j?void 0:j.toFixed(0))||"\u2014"})]})]})]}),I.heuristic_details&&(0,h.jsxs)("div",{className:"detail-section",children:[(0,h.jsx)("h4",{children:"Heuristic Breakdown"}),(0,h.jsxs)("div",{className:"detail-row",children:[(0,h.jsx)("span",{className:"detail-label",children:"Keyword Overlap:"}),(0,h.jsxs)("span",{className:"detail-value",children:[I.heuristic_details.keyword_overlap||0," keywords"]})]}),(0,h.jsxs)("div",{className:"detail-row",children:[(0,h.jsx)("span",{className:"detail-label",children:"Recency Score:"}),(0,h.jsxs)("span",{className:"detail-value",children:[(null===(p=100*I.heuristic_details.recency_score)||void 0===p?void 0:p.toFixed(0))||0,"%"]})]})]}),I.llm_reasoning&&(0,h.jsxs)("div",{className:"detail-section",children:[(0,h.jsx)("h4",{children:"LLM Reasoning"}),(0,h.jsx)("p",{className:"llm-reasoning",children:I.llm_reasoning})]}),(0,h.jsxs)("div",{className:"detail-section",children:[(0,h.jsx)("h4",{children:"Strategy Decisions"}),(0,h.jsxs)("div",{className:"decision-grid",children:[(0,h.jsxs)("div",{className:"decision-cell ".concat(null!==(g=I.would_include)&&void 0!==g&&g.heuristic?"include":"exclude"),children:[(0,h.jsx)(i.In,{icon:null!==(N=I.would_include)&&void 0!==N&&N.heuristic?"mdi:check":"mdi:close",width:14}),(0,h.jsx)("span",{children:"Heuristic"})]}),(0,h.jsxs)("div",{className:"decision-cell ".concat(null!==(f=I.would_include)&&void 0!==f&&f.semantic?"include":"exclude"),children:[(0,h.jsx)(i.In,{icon:null!==(w=I.would_include)&&void 0!==w&&w.semantic?"mdi:check":"mdi:close",width:14}),(0,h.jsx)("span",{children:"Semantic"})]}),(0,h.jsxs)("div",{className:"decision-cell ".concat(null!==(b=I.would_include)&&void 0!==b&&b.llm?"include":"exclude"),children:[(0,h.jsx)(i.In,{icon:null!==(_=I.would_include)&&void 0!==_&&_.llm?"mdi:check":"mdi:close",width:14}),(0,h.jsx)("span",{children:"LLM"})]}),(0,h.jsxs)("div",{className:"decision-cell ".concat(null!==(k=I.would_include)&&void 0!==k&&k.hybrid?"include":"exclude"),children:[(0,h.jsx)(i.In,{icon:null!==(y=I.would_include)&&void 0!==y&&y.hybrid?"mdi:check":"mdi:close",width:14}),(0,h.jsx)("span",{children:"Hybrid"})]})]})]}),I.budget&&(0,h.jsxs)("div",{className:"detail-section",children:[(0,h.jsx)("h4",{children:"Budget Context"}),(0,h.jsxs)("div",{className:"detail-row",children:[(0,h.jsx)("span",{className:"detail-label",children:"Budget:"}),(0,h.jsxs)("span",{className:"detail-value",children:[(null===(C=I.budget.total)||void 0===C?void 0:C.toLocaleString())||"\u2014"," tokens"]})]}),(0,h.jsxs)("div",{className:"detail-row",children:[(0,h.jsx)("span",{className:"detail-label",children:"Cumulative at Rank:"}),(0,h.jsx)("span",{className:"detail-value",children:(null===(S=I.budget.cumulative_at_rank)||void 0===S?void 0:S.toLocaleString())||"\u2014"})]}),(0,h.jsxs)("div",{className:"detail-row",children:[(0,h.jsx)("span",{className:"detail-label",children:"Would Fit:"}),(0,h.jsx)("span",{className:"detail-value ".concat(I.budget.would_fit?"success":"warning"),children:I.budget.would_fit?"Yes":"No"})]})]}),(0,h.jsxs)("div",{className:"detail-section",children:[(0,h.jsx)("h4",{children:"Content Preview"}),(0,h.jsx)("pre",{className:"content-preview",children:I.preview||"No preview available"})]})]})]})},we=e=>{var s,a,n,c,r,o;let{timeRange:m}=e;const[x,u]=(0,l.useState)([]),[v,j]=(0,l.useState)(null),[p,g]=(0,l.useState)(null),[N,f]=(0,l.useState)(null),[w,b]=(0,l.useState)(null),[_,k]=(0,l.useState)(null),[y,C]=(0,l.useState)(!0),[S,I]=(0,l.useState)(null),[A,F]=(0,l.useState)("overview"),[M,T]=(0,l.useState)(null),[L,z]=(0,l.useState)(null),[E,R]=(0,l.useState)("explorer"),[W,P]=(0,l.useState)("explorer");(0,l.useEffect)(()=>{(async()=>{try{const e=await fetch("".concat(d.J,"/api/context-assessment/table-status")),s=await e.json();k(s)}catch(e){console.error("Failed to check table status:",e)}})()},[]),(0,l.useEffect)(()=>{(async()=>{try{var e;C(!0);const s=await fetch("".concat(d.J,"/api/context-assessment/sessions?days=").concat(m)),a=await s.json();if(a.error)return void I(a.error);u(a.sessions||[]),(null===(e=a.sessions)||void 0===e?void 0:e.length)>0&&!v&&j(a.sessions[0].session_id)}catch(s){console.error("Failed to fetch sessions:",s),I(s.message)}finally{C(!1)}})()},[m]),(0,l.useEffect)(()=>{if(!v)return;(async()=>{try{const e=await fetch("".concat(d.J,"/api/context-assessment/overview/").concat(v)),s=await e.json();if(s.error)return void console.error("Overview error:",s.error);g(s)}catch(e){console.error("Failed to fetch overview:",e)}})()},[v]),(0,l.useEffect)(()=>{if(!v||"inter-cell"!==A)return;(async()=>{try{const e=M?"".concat(d.J,"/api/context-assessment/inter-cell/").concat(v,"?cell=").concat(M):"".concat(d.J,"/api/context-assessment/inter-cell/").concat(v),s=await fetch(e),a=await s.json();if(a.error)return void console.error("Inter-cell error:",a.error);f(a)}catch(e){console.error("Failed to fetch inter-cell:",e)}})()},[v,A,M]),(0,l.useEffect)(()=>{if(!v||"intra-cell"!==A)return;(async()=>{try{const e=M?"".concat(d.J,"/api/context-assessment/intra-cell/").concat(v,"?cell=").concat(M):"".concat(d.J,"/api/context-assessment/intra-cell/").concat(v),s=await fetch(e),a=await s.json();if(a.error)return void console.error("Intra-cell error:",a.error);b(a)}catch(e){console.error("Failed to fetch intra-cell:",e)}})()},[v,A,M]);const D=e=>{var s;return null!==(s=null===e||void 0===e?void 0:e.toLocaleString())&&void 0!==s?s:"\u2014"};return!_||null!==(s=_.context_shadow_assessments)&&void 0!==s&&s.exists||null!==(a=_.intra_context_shadow_assessments)&&void 0!==a&&a.exists?y||0!==x.length?y?(0,h.jsx)("div",{className:"context-assessment-panel",children:(0,h.jsx)(t.lp,{size:"medium",message:"Loading assessment data...",className:"video-loader--flex"})}):(0,h.jsxs)("div",{className:"context-assessment-panel",children:[(0,h.jsxs)("div",{className:"assessment-header",children:[(0,h.jsxs)("div",{className:"header-left",children:[(0,h.jsx)(i.In,{icon:"mdi:clipboard-check-outline",width:16,style:{color:"#00e5ff"}}),(0,h.jsx)("span",{className:"header-title",children:"Context Assessment"}),(0,h.jsx)("span",{className:"header-subtitle",children:"Shadow analysis of context selection decisions"})]}),(0,h.jsx)("div",{className:"header-right",children:(0,h.jsxs)("div",{className:"session-selector",children:[(0,h.jsx)("label",{children:"Session:"}),(0,h.jsx)("select",{value:v||"",onChange:e=>{j(e.target.value),T(null),z(null)},children:x.map(e=>(0,h.jsxs)("option",{value:e.session_id,children:[e.cascade_id," / ",e.session_id.slice(0,12),"..."]},e.session_id))})]})})]}),(0,h.jsx)(ce,{}),p&&(0,h.jsxs)("div",{className:"assessment-overview-cards",children:[(0,h.jsxs)("div",{className:"overview-card ".concat(p.inter_cell?"":"disabled"),children:[(0,h.jsx)("div",{className:"card-icon",children:(0,h.jsx)(i.In,{icon:"mdi:swap-horizontal",width:18})}),(0,h.jsxs)("div",{className:"card-content",children:[(0,h.jsx)("div",{className:"card-value",children:p.inter_cell?D(p.inter_cell.cells_assessed):"\u2014"}),(0,h.jsx)("div",{className:"card-label",children:"Inter-Cell Cells"}),p.inter_cell?(0,h.jsxs)("div",{className:"card-detail",children:[D(p.inter_cell.messages_assessed)," messages assessed"]}):(0,h.jsx)("div",{className:"card-detail muted",children:"No cross-cell context data"})]})]}),(0,h.jsxs)("div",{className:"overview-card ".concat(p.intra_cell?"":"disabled"),children:[(0,h.jsx)("div",{className:"card-icon",children:(0,h.jsx)(i.In,{icon:"mdi:rotate-right",width:18})}),(0,h.jsxs)("div",{className:"card-content",children:[(0,h.jsx)("div",{className:"card-value",children:p.intra_cell?D(p.intra_cell.turns_assessed):"\u2014"}),(0,h.jsx)("div",{className:"card-label",children:"Intra-Cell Turns"}),p.intra_cell?(0,h.jsxs)("div",{className:"card-detail",children:[D(p.intra_cell.total_config_rows)," config scenarios"]}):(0,h.jsx)("div",{className:"card-detail muted",children:"No within-cell compression data"})]})]}),(0,h.jsxs)("div",{className:"overview-card",children:[(0,h.jsx)("div",{className:"card-icon",children:(0,h.jsx)(i.In,{icon:"mdi:gauge",width:18})}),(0,h.jsxs)("div",{className:"card-content",children:[(0,h.jsx)("div",{className:"card-value",style:{color:(O=null===(n=p.inter_cell)||void 0===n?void 0:n.avg_composite_score,null===O||void 0===O?"#64748b":O>=70?"#34d399":O>=40?"#fbbf24":"#f87171")},children:null!==(c=null===(r=p.inter_cell)||void 0===r||null===(o=r.avg_composite_score)||void 0===o?void 0:o.toFixed(0))&&void 0!==c?c:"\u2014"}),(0,h.jsx)("div",{className:"card-label",children:"Avg Relevance"}),(0,h.jsx)("div",{className:"card-detail",children:"composite score (0-100)"})]})]}),(0,h.jsxs)("div",{className:"overview-card highlight ".concat(p.potential_savings?"":"disabled"),children:[(0,h.jsx)("div",{className:"card-icon",children:(0,h.jsx)(i.In,{icon:"mdi:piggy-bank",width:18})}),(0,h.jsxs)("div",{className:"card-content",children:[(0,h.jsx)("div",{className:"card-value",children:p.potential_savings?(B=p.potential_savings.tokens,null!=B?"".concat((B/1e3).toFixed(1),"k"):"\u2014"):"\u2014"}),(0,h.jsx)("div",{className:"card-label",children:"Potential Savings"}),p.best_intra_config?(0,h.jsxs)("div",{className:"card-detail",children:["window=",p.best_intra_config.window,", mask_after=",p.best_intra_config.mask_after]}):(0,h.jsx)("div",{className:"card-detail muted",children:"Enable intra-context to see savings"})]})]})]}),(0,h.jsxs)("div",{className:"assessment-tabs",children:[(0,h.jsxs)("button",{className:"assessment-tab ".concat("overview"===A?"active":""),onClick:()=>F("overview"),children:[(0,h.jsx)(i.In,{icon:"mdi:view-dashboard",width:14}),(0,h.jsx)("span",{children:"Summary"})]}),(0,h.jsxs)("button",{className:"assessment-tab ".concat("inter-cell"===A?"active":""),onClick:()=>F("inter-cell"),disabled:!(null!==p&&void 0!==p&&p.inter_cell),title:null!==p&&void 0!==p&&p.inter_cell?"":"No inter-cell context data available for this session",children:[(0,h.jsx)(i.In,{icon:"mdi:swap-horizontal",width:14}),(0,h.jsx)("span",{children:"Inter-Cell"}),!(null!==p&&void 0!==p&&p.inter_cell)&&(0,h.jsx)(i.In,{icon:"mdi:lock",width:10,className:"tab-lock"})]}),(0,h.jsxs)("button",{className:"assessment-tab ".concat("intra-cell"===A?"active":""),onClick:()=>F("intra-cell"),disabled:!(null!==p&&void 0!==p&&p.intra_cell),title:null!==p&&void 0!==p&&p.intra_cell?"":"No intra-cell compression data available for this session",children:[(0,h.jsx)(i.In,{icon:"mdi:rotate-right",width:14}),(0,h.jsx)("span",{children:"Intra-Cell"}),!(null!==p&&void 0!==p&&p.intra_cell)&&(0,h.jsx)(i.In,{icon:"mdi:lock",width:10,className:"tab-lock"})]}),(0,h.jsxs)("button",{className:"assessment-tab ".concat("waste"===A?"active":""),onClick:()=>F("waste"),disabled:!v,children:[(0,h.jsx)(i.In,{icon:"mdi:chart-scatter-plot",width:14}),(0,h.jsx)("span",{children:"Waste Analysis"})]}),(0,h.jsxs)("button",{className:"assessment-tab ".concat("cascade"===A?"active":""),onClick:()=>F("cascade"),disabled:!(null!==p&&void 0!==p&&p.cascade_id),title:"Analyze patterns across multiple runs of this cascade",children:[(0,h.jsx)(i.In,{icon:"mdi:chart-timeline-variant",width:14}),(0,h.jsx)("span",{children:"Multi-Run"})]})]}),(0,h.jsxs)("div",{className:"assessment-content-wrapper ".concat(L?"with-sidebar":""),children:[(0,h.jsxs)("div",{className:"assessment-content",children:["overview"===A&&p&&(0,h.jsx)(re,{overview:p}),"inter-cell"===A&&(0,h.jsxs)("div",{className:"cell-content-wrapper",children:[(0,h.jsxs)("div",{className:"view-mode-toggle",children:[(0,h.jsxs)("button",{className:"explorer"===E?"active":"",onClick:()=>R("explorer"),children:[(0,h.jsx)(i.In,{icon:"mdi:tune-variant",width:14}),"Interactive Explorer"]}),(0,h.jsxs)("button",{className:"table"===E?"active":"",onClick:()=>R("table"),children:[(0,h.jsx)(i.In,{icon:"mdi:table",width:14}),"Table View"]})]}),"explorer"===E?(0,h.jsx)(ae,{sessionId:v}):N&&(0,h.jsx)(oe,{data:N,selectedCell:M,onCellSelect:T,selectedMessage:L,onMessageSelect:z})]}),"intra-cell"===A&&(0,h.jsxs)("div",{className:"cell-content-wrapper",children:[(0,h.jsxs)("div",{className:"view-mode-toggle",children:[(0,h.jsxs)("button",{className:"explorer"===W?"active":"",onClick:()=>P("explorer"),children:[(0,h.jsx)(i.In,{icon:"mdi:tune-variant",width:14}),"Interactive Explorer"]}),(0,h.jsxs)("button",{className:"table"===W?"active":"",onClick:()=>P("table"),children:[(0,h.jsx)(i.In,{icon:"mdi:view-grid",width:14}),"Cards View"]})]}),"explorer"===W?(0,h.jsx)(ne,{sessionId:v}):w&&(0,h.jsx)(ve,{data:w,selectedCell:M,onCellSelect:T})]}),"waste"===A&&v&&(0,h.jsx)(ie,{sessionId:v,onMessageSelect:z}),"cascade"===A&&(null===p||void 0===p?void 0:p.cascade_id)&&(0,h.jsx)(te,{cascadeId:p.cascade_id})]}),L&&(0,h.jsx)(fe,{message:L,onClose:()=>z(null)})]})]}):(0,h.jsx)("div",{className:"context-assessment-panel",children:(0,h.jsxs)("div",{className:"assessment-empty-state",children:[(0,h.jsx)(i.In,{icon:"mdi:clipboard-check-outline",width:48,style:{color:"#475569"}}),(0,h.jsx)("h3",{children:"No Shadow Assessment Data"}),(0,h.jsxs)("p",{children:["No context shadow assessments found in the last ",m," days."]}),(0,h.jsxs)("p",{className:"help-text",children:["Run cascades with ",(0,h.jsx)("code",{children:"LARS_SHADOW_ASSESSMENT_ENABLED=true"})," to collect context assessment data for analysis."]})]})}):(0,h.jsx)("div",{className:"context-assessment-panel",children:(0,h.jsxs)("div",{className:"assessment-empty-state",children:[(0,h.jsx)(i.In,{icon:"mdi:clipboard-off-outline",width:48,style:{color:"#475569"}}),(0,h.jsx)("h3",{children:"Shadow Assessment Tables Not Found"}),(0,h.jsx)("p",{children:"Shadow assessment tables haven't been created yet. Run the migrations to create the tables:"}),(0,h.jsx)("code",{children:"lars db init"}),(0,h.jsxs)("p",{className:"help-text",children:["Then run cascades with ",(0,h.jsx)("code",{children:"LARS_SHADOW_ASSESSMENT_ENABLED=true"})," to collect data."]})]})});var B,O},be=(e,s)=>e===s||!(!e||!s)&&JSON.stringify(e)===JSON.stringify(s),_e="receipts_timeRange",ke="receipts_granularity",ye=()=>{try{const e=localStorage.getItem(_e);if(e){const s=Number(e);if([1,7,30,90].includes(s))return s}}catch(e){}return 7},Ce=()=>{try{const e=localStorage.getItem(ke);if(e&&["hourly","daily","weekly","monthly"].includes(e))return e}catch(e){}return"daily"},Se=()=>{const e=(0,n.Zp)(),[s,a]=(0,l.useState)("overview"),[c,r]=(0,l.useState)(ye),[m,x]=(0,l.useState)(Ce),[u,v]=(0,l.useState)(null),[j,p]=(0,l.useState)([]),[g,N]=(0,l.useState)([]),[f,w]=(0,l.useState)([]),[b,_]=(0,l.useState)({cascades:[],grand_total:0}),[k,y]=(0,l.useState)({models:[],grand_total:0}),[C,S]=(0,l.useState)([]),[I,A]=(0,l.useState)(null),[F,M]=(0,l.useState)(!0),[T,L]=(0,l.useState)(!0),[z,E]=(0,l.useState)(null),R=async()=>{try{const e=await fetch("".concat(d.J,"/api/receipts/overview?days=").concat(c)),s=await e.json();if(s.error)return void E(s.error);v(e=>be(e,s)?e:s),E(null)}catch(e){E(e.message)}finally{M(!1)}},W=async()=>{try{const e=await fetch("".concat(d.J,"/api/receipts/alerts?days=").concat(c)),s=await e.json();if(s.error)return void E(s.error);const a=s.alerts||[];p(e=>be(e,a)?e:a)}catch(e){E(e.message)}},P=async()=>{try{const e=await fetch("".concat(d.J,"/api/receipts/context-breakdown?days=").concat(c)),s=await e.json();if(s.error)return void E(s.error);const a=s.breakdown||[];N(e=>be(e,a)?e:a)}catch(e){E(e.message)}},D=async()=>{try{const e=await fetch("".concat(d.J,"/api/receipts/time-series?days=").concat(c,"&granularity=").concat(m)),s=await e.json();if(!s.error){const e=s.series||[];w(s=>be(s,e)?s:e)}}catch(e){console.error("Failed to fetch time series:",e)}},B=async()=>{try{const e=await fetch("".concat(d.J,"/api/receipts/by-cascade?days=").concat(c,"&limit=10")),s=await e.json();if(!s.error){const e={cascades:s.cascades||[],grand_total:s.grand_total||0};_(s=>be(s,e)?s:e)}}catch(e){console.error("Failed to fetch cascade breakdown:",e)}},O=async()=>{try{const e=await fetch("".concat(d.J,"/api/receipts/by-model?days=").concat(c)),s=await e.json();if(!s.error){const e={models:s.models||[],grand_total:s.grand_total||0};y(s=>be(s,e)?s:e)}}catch(e){console.error("Failed to fetch model breakdown:",e)}},H=async()=>{try{const e=await fetch("".concat(d.J,"/api/receipts/top-expensive?days=").concat(c,"&limit=8")),s=await e.json();if(!s.error){const e=s.sessions||[];S(s=>be(s,e)?s:e)}}catch(e){console.error("Failed to fetch top expensive:",e)}},U=async()=>{try{const e=await fetch("".concat(d.J,"/api/receipts/context-efficiency?days=").concat(c)),s=await e.json();s.error||A(e=>be(e,s)?e:s)}catch(e){console.error("Failed to fetch context efficiency:",e)}},$=(0,l.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e||L(!0),await Promise.all([D(),B(),O(),H(),U()]),e||L(!1)},[c,m]),K=(0,l.useCallback)(s=>{s.session_id&&e(o.bw.studioWithSession(s.cascade_id,s.session_id))},[e]),V=(0,l.useCallback)(e=>{x(e);try{localStorage.setItem(ke,e)}catch(s){}},[]),Z=(0,l.useCallback)(e=>{r(e);try{localStorage.setItem(_e,String(e))}catch(s){}},[]);return(0,l.useEffect)(()=>{R(),W(),P()},[c]),(0,l.useEffect)(()=>{$()},[c,m]),(0,l.useEffect)(()=>{const e=setInterval(()=>{R(),W(),P(),$(!0)},3e4);return()=>clearInterval(e)},[c,m]),(0,h.jsxs)("div",{className:"receipts-view",children:[(0,h.jsxs)("div",{className:"receipts-header",children:[(0,h.jsxs)("div",{className:"receipts-header-left",children:[(0,h.jsx)(i.In,{icon:"mdi:receipt-text",width:20,style:{color:"#00e5ff"}}),(0,h.jsx)("h1",{children:"Receipts"}),(0,h.jsx)("span",{className:"receipts-subtitle",children:"Cost & Reliability Explorer"})]}),(0,h.jsx)("div",{className:"receipts-header-right",children:(0,h.jsxs)("select",{value:c,onChange:e=>Z(Number(e.target.value)),className:"receipts-time-select",children:[(0,h.jsx)("option",{value:1,children:"Last 24 Hours"}),(0,h.jsx)("option",{value:7,children:"Last 7 Days"}),(0,h.jsx)("option",{value:30,children:"Last 30 Days"}),(0,h.jsx)("option",{value:90,children:"Last 90 Days"})]})})]}),(0,h.jsxs)("div",{className:"receipts-tabs",children:[(0,h.jsxs)("button",{className:"receipts-tab ".concat("overview"===s?"active":""),onClick:()=>a("overview"),children:[(0,h.jsx)(i.In,{icon:"mdi:view-dashboard",width:14}),(0,h.jsx)("span",{children:"Overview"})]}),(0,h.jsxs)("button",{className:"receipts-tab ".concat("alerts"===s?"active":""),onClick:()=>a("alerts"),children:[(0,h.jsx)(i.In,{icon:"mdi:alert-circle",width:14}),(0,h.jsx)("span",{children:"Alerts"}),j.length>0&&(0,h.jsx)("span",{className:"receipts-tab-badge",children:j.length})]}),(0,h.jsxs)("button",{className:"receipts-tab ".concat("breakdown"===s?"active":""),onClick:()=>a("breakdown"),children:[(0,h.jsx)(i.In,{icon:"mdi:file-tree",width:14}),(0,h.jsx)("span",{children:"Context Breakdown"}),g.length>0&&(0,h.jsx)("span",{className:"receipts-tab-badge",children:g.length})]}),(0,h.jsxs)("button",{className:"receipts-tab ".concat("assessment"===s?"active":""),onClick:()=>a("assessment"),children:[(0,h.jsx)(i.In,{icon:"mdi:clipboard-check-outline",width:14}),(0,h.jsx)("span",{children:"Context Assessment"})]})]}),(0,h.jsxs)("div",{className:"receipts-content",children:[z&&(0,h.jsxs)("div",{className:"receipts-error",children:[(0,h.jsx)(i.In,{icon:"mdi:alert-circle",width:20}),(0,h.jsxs)("div",{children:[(0,h.jsx)("strong",{children:"Error loading data"}),(0,h.jsx)("p",{children:z})]})]}),F&&!u&&(0,h.jsx)(t.lp,{size:"medium",message:"Loading receipts data...",className:"video-loader--flex"}),!F&&!z&&(0,h.jsxs)(h.Fragment,{children:["overview"===s&&(0,h.jsx)(J,{data:u,timeSeriesData:f,cascadeData:b,modelData:k,topExpensive:C,contextEfficiency:I,chartsLoading:T,onSessionClick:K,granularity:m,onGranularityChange:V}),"alerts"===s&&(0,h.jsx)(G,{alerts:j}),"breakdown"===s&&(0,h.jsx)(se,{breakdown:g}),"assessment"===s&&(0,h.jsx)(we,{timeRange:c})]})]})]})}},26232:(e,s,a)=>{a.d(s,{I:()=>c});var l=a(89379),n=a(65043),i=a(64065),t=a(24227);function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{enabled:s=!0,pollInterval:a=6e4,lowBalanceThreshold:c=5}=e,[r,o]=(0,n.useState)({balance:null,totalCredits:null,totalUsage:null,burnRate1h:null,burnRate24h:null,burnRate7d:null,runwayDays:null,delta24h:null,lowBalanceWarning:!1,lastUpdated:null,snapshotCount24h:null,loading:!0,error:null}),{showToast:d}=(0,i.dj)(),h=(0,n.useRef)(null),m=(0,n.useRef)(!1),x=(0,n.useRef)(!1),u=(0,n.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{const s="".concat(t.J,e?"/api/credits?refresh=true":"/api/credits"),a=await fetch(s);if(!a.ok)throw new Error("Failed to fetch credits: ".concat(a.status));return await a.json()}catch(s){throw console.error("[useCredits] Fetch error:",s),s}},[]),v=(0,n.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{o(e=>(0,l.A)((0,l.A)({},e),{},{loading:!0,error:null}));const s=await u(e);if(s.error)return void o(e=>(0,l.A)((0,l.A)({},e),{},{loading:!1,error:s.error}));const a={balance:s.balance,totalCredits:s.total_credits,totalUsage:s.total_usage,burnRate1h:s.burn_rate_1h,burnRate24h:s.burn_rate_24h,burnRate7d:s.burn_rate_7d,runwayDays:s.runway_days,delta24h:s.delta_24h,lowBalanceWarning:s.low_balance_warning||null!==s.balance&&s.balance<c,lastUpdated:s.last_updated,snapshotCount24h:s.snapshot_count_24h,loading:!1,error:null};o(a);const n=a.lowBalanceWarning,i=m.current;!n||i||x.current||null===a.balance||(x.current=!0,d("Low OpenRouter Balance: $".concat(a.balance.toFixed(2),". Consider topping up."),{type:"warning",duration:1e4})),m.current=n}catch(s){o(e=>(0,l.A)((0,l.A)({},e),{},{loading:!1,error:s.message}))}},[u,c,d]);return(0,n.useEffect)(()=>{if(s)return v(),h.current=setInterval(()=>{v()},a),()=>{h.current&&(clearInterval(h.current),h.current=null)};o(e=>(0,l.A)((0,l.A)({},e),{},{loading:!1}))},[s,a,v]),(0,l.A)((0,l.A)({},r),{},{refetch:()=>v(!0)})}},90628:(e,s,a)=>{a.d(s,{A:()=>c});var l=a(65043),n=a(5748),i=a(70579);const t=e=>{let{title:s,value:a,subtitle:l,trend:t,icon:c,color:r="#00e5ff"}=e;const o=t>0?"#ff006e":t<0?"#34d399":"#64748b",d=t>0?"mdi:trending-up":"mdi:trending-down";return(0,i.jsxs)("div",{className:"kpi-card",children:[(0,i.jsxs)("div",{className:"kpi-value-row",children:[(0,i.jsx)("span",{className:"kpi-value",style:{color:r},children:a}),void 0!==t&&0!==t&&(0,i.jsxs)("div",{className:"kpi-trend",style:{color:o},children:[(0,i.jsx)(n.In,{icon:d,width:12}),(0,i.jsxs)("span",{children:[Math.abs(t).toFixed(0),"%"]})]})]}),(0,i.jsxs)("div",{className:"kpi-label-row",children:[(0,i.jsx)(n.In,{icon:c,width:12,style:{color:"#475569"}}),(0,i.jsx)("span",{className:"kpi-label",children:s}),l&&(0,i.jsx)("span",{className:"kpi-unit",children:l})]})]})},c=(0,l.memo)(t)}}]);
//# sourceMappingURL=926.bd6c8596.chunk.js.map