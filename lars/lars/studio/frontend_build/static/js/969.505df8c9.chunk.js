"use strict";(self.webpackChunklars_ui=self.webpackChunklars_ui||[]).push([[969],{49969:(e,a,s)=>{s.r(a),s.d(a,{default:()=>_});var t=s(65043),c=s(94424),l=s(87955),i=s(5748),n=s(64065),r=s(45685),o=s(60263),d=s(70579);const h={enabled:{icon:"mdi:play-circle",color:"#34d399"},disabled:{icon:"mdi:pause-circle",color:"#64748b"},error:{icon:"mdi:alert-circle",color:"#f87171"}},u={cascade:"#a78bfa",signal:"#818cf8",sql:"#f59e0b",default:"#94a3b8"},m={success:"#34d399",failed:"#f87171",running:"#fbbf24",skipped:"#64748b"},w=e=>null===e||void 0===e?"-":e<1e3?"".concat(e,"ms"):e<6e4?"".concat((e/1e3).toFixed(1),"s"):"".concat((e/6e4).toFixed(1),"m"),x=e=>{if(!e)return"-";const a=new Date(e),s=new Date-a,t=Math.floor(s/1e3),c=Math.floor(t/60),l=Math.floor(c/60),i=Math.floor(l/24);return t<60?"".concat(t,"s ago"):c<60?"".concat(c,"m ago"):l<24?"".concat(l,"h ago"):"".concat(i,"d ago")},j=e=>{let{watch:a,detailData:s,loading:t,onClose:c,onToggle:l,onTrigger:j,onDelete:p}=e;const f=(0,r.Zp)();if(!a)return null;const v=h[a.status]||h.disabled,g=u[a.action_type]||u.default,N=(null===s||void 0===s?void 0:s.stats)||{},b=(null===s||void 0===s?void 0:s.executions)||[],y=(null===s||void 0===s?void 0:s.watch)||a,_=N.success_rate||0,S="cascade"===a.action_type?(e=>{if(!e)return null;const a=e.split("/").pop();return(null===a||void 0===a?void 0:a.replace(/\.(yaml|yml|json)$/i,""))||null})(a.action_spec):null;return(0,d.jsxs)("div",{className:"watch-detail",children:[(0,d.jsxs)("div",{className:"watch-detail-header",children:[(0,d.jsxs)("div",{className:"watch-detail-header-left",children:[(0,d.jsx)(i.In,{icon:v.icon,width:18,style:{color:v.color}}),(0,d.jsx)("span",{className:"watch-detail-status",style:{color:v.color},children:a.status})]}),(0,d.jsxs)("div",{className:"watch-detail-header-actions",children:[(0,d.jsx)("button",{className:"watch-detail-action-btn",onClick:j,title:"Trigger now",children:(0,d.jsx)(i.In,{icon:"mdi:play",width:16})}),(0,d.jsx)("button",{className:"watch-detail-action-btn",onClick:l,title:a.enabled?"Disable":"Enable",children:(0,d.jsx)(i.In,{icon:a.enabled?"mdi:pause":"mdi:play-circle-outline",width:16})}),(0,d.jsx)("button",{className:"watch-detail-action-btn watch-detail-action-btn--danger",onClick:p,title:"Delete watch",children:(0,d.jsx)(i.In,{icon:"mdi:delete",width:16})}),(0,d.jsx)("button",{className:"watch-detail-close",onClick:c,children:(0,d.jsx)(i.In,{icon:"mdi:close",width:18})})]})]}),(0,d.jsx)("div",{className:"watch-detail-content",children:t?(0,d.jsx)("div",{className:"watch-detail-loading",children:(0,d.jsx)(n.lp,{size:"small",message:"Loading details..."})}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("div",{className:"watch-detail-title-section",children:[(0,d.jsx)("h2",{className:"watch-detail-title",children:a.name}),(0,d.jsx)("span",{className:"watch-detail-action-type",style:{color:g,background:"".concat(g,"15")},children:a.action_type})]}),a.description&&(0,d.jsx)("p",{className:"watch-detail-description",children:a.description}),(0,d.jsxs)("div",{className:"watch-detail-stats",children:[(0,d.jsxs)("div",{className:"watch-detail-stat",children:[(0,d.jsx)("span",{className:"watch-detail-stat-value",children:N.total_executions||0}),(0,d.jsx)("span",{className:"watch-detail-stat-label",children:"Total Runs"})]}),(0,d.jsxs)("div",{className:"watch-detail-stat",children:[(0,d.jsx)("span",{className:"watch-detail-stat-value",style:{color:"#34d399"},children:N.success_count||0}),(0,d.jsx)("span",{className:"watch-detail-stat-label",children:"Success"})]}),(0,d.jsxs)("div",{className:"watch-detail-stat",children:[(0,d.jsx)("span",{className:"watch-detail-stat-value",style:{color:"#f87171"},children:N.failed_count||0}),(0,d.jsx)("span",{className:"watch-detail-stat-label",children:"Failed"})]}),(0,d.jsxs)("div",{className:"watch-detail-stat",children:[(0,d.jsx)("span",{className:"watch-detail-stat-value",children:w(N.avg_duration_ms)}),(0,d.jsx)("span",{className:"watch-detail-stat-label",children:"Avg Duration"})]})]}),N.total_executions>0&&(0,d.jsxs)("div",{className:"watch-detail-success-bar",children:[(0,d.jsxs)("div",{className:"watch-detail-success-bar-label",children:[(0,d.jsx)("span",{children:"Success Rate"}),(0,d.jsxs)("span",{children:[_.toFixed(1),"%"]})]}),(0,d.jsx)("div",{className:"watch-detail-success-bar-track",children:(0,d.jsx)("div",{className:"watch-detail-success-bar-fill",style:{width:"".concat(_,"%")}})})]}),(0,d.jsxs)("div",{className:"watch-detail-section",children:[(0,d.jsx)("h3",{className:"watch-detail-section-title",children:"Configuration"}),(0,d.jsxs)("div",{className:"watch-detail-fields",children:[(0,d.jsxs)("div",{className:"watch-detail-field",children:[(0,d.jsx)("span",{className:"watch-detail-field-label",children:"Poll Interval"}),(0,d.jsxs)("span",{className:"watch-detail-field-value",children:[y.poll_interval_seconds,"s"]})]}),(0,d.jsxs)("div",{className:"watch-detail-field",children:[(0,d.jsx)("span",{className:"watch-detail-field-label",children:"Last Checked"}),(0,d.jsx)("span",{className:"watch-detail-field-value",children:x(y.last_checked_at)})]}),(0,d.jsxs)("div",{className:"watch-detail-field",children:[(0,d.jsx)("span",{className:"watch-detail-field-label",children:"Last Triggered"}),(0,d.jsx)("span",{className:"watch-detail-field-value",children:x(y.last_triggered_at)})]}),(0,d.jsxs)("div",{className:"watch-detail-field",children:[(0,d.jsx)("span",{className:"watch-detail-field-label",children:"Total Triggers"}),(0,d.jsx)("span",{className:"watch-detail-field-value",style:{color:"#34d399"},children:y.trigger_count||0})]}),y.consecutive_errors>0&&(0,d.jsxs)("div",{className:"watch-detail-field",children:[(0,d.jsx)("span",{className:"watch-detail-field-label",children:"Consecutive Errors"}),(0,d.jsx)("span",{className:"watch-detail-field-value",style:{color:"#f87171"},children:y.consecutive_errors})]})]})]}),(0,d.jsxs)("div",{className:"watch-detail-section",children:[(0,d.jsx)("h3",{className:"watch-detail-section-title",children:"Query"}),(0,d.jsx)("pre",{className:"watch-detail-code",children:y.query})]}),(0,d.jsxs)("div",{className:"watch-detail-section",children:[(0,d.jsx)("h3",{className:"watch-detail-section-title",children:"Action"}),(0,d.jsx)("pre",{className:"watch-detail-code",children:y.action_spec})]}),y.last_error&&(0,d.jsxs)("div",{className:"watch-detail-section",children:[(0,d.jsxs)("h3",{className:"watch-detail-section-title",style:{color:"#f87171"},children:[(0,d.jsx)(i.In,{icon:"mdi:alert-circle",width:14}),"Last Error"]}),(0,d.jsx)("div",{className:"watch-detail-error",children:y.last_error})]}),(0,d.jsxs)("div",{className:"watch-detail-section",children:[(0,d.jsxs)("h3",{className:"watch-detail-section-title",children:["Recent Executions (",b.length,")"]}),0===b.length?(0,d.jsx)("div",{className:"watch-detail-empty",children:"No executions yet"}):(0,d.jsx)("div",{className:"watch-detail-executions",children:b.slice(0,20).map((e,a)=>(0,d.jsxs)("div",{className:"watch-detail-execution",children:[(0,d.jsxs)("div",{className:"watch-detail-execution-header",children:[(0,d.jsxs)("span",{className:"watch-detail-execution-status",style:{color:m[e.status]||m.skipped},children:[(0,d.jsx)(i.In,{icon:"success"===e.status?"mdi:check-circle":"mdi:close-circle",width:12}),e.status]}),(0,d.jsx)("span",{className:"watch-detail-execution-time",children:x(e.triggered_at)})]}),(0,d.jsxs)("div",{className:"watch-detail-execution-details",children:[null!==e.row_count&&(0,d.jsxs)("span",{className:"watch-detail-execution-detail",children:[(0,d.jsx)(i.In,{icon:"mdi:table",width:12}),e.row_count," rows"]}),null!==e.duration_ms&&(0,d.jsxs)("span",{className:"watch-detail-execution-detail",children:[(0,d.jsx)(i.In,{icon:"mdi:timer",width:12}),w(e.duration_ms)]}),e.cascade_session_id&&S&&(0,d.jsxs)("button",{className:"watch-detail-execution-link",onClick:()=>{return a=e.cascade_session_id,void(S&&a&&f(o.bw.studioWithSession(S,a)));var a},title:"Open session ".concat(e.cascade_session_id),children:[(0,d.jsx)(i.In,{icon:"mdi:open-in-new",width:12}),e.cascade_session_id.substring(0,12),"..."]}),e.cascade_session_id&&!S&&(0,d.jsxs)("span",{className:"watch-detail-execution-detail",children:[(0,d.jsx)(i.In,{icon:"mdi:file-tree",width:12}),e.cascade_session_id.substring(0,8),"..."]}),e.signal_fired&&(0,d.jsxs)("span",{className:"watch-detail-execution-detail",style:{color:"#818cf8"},children:[(0,d.jsx)(i.In,{icon:"mdi:broadcast",width:12}),"signal fired"]})]}),e.error_message&&(0,d.jsx)("div",{className:"watch-detail-execution-error",children:e.error_message}),e.session_output&&(0,d.jsxs)("div",{className:"watch-detail-execution-output",children:[(0,d.jsxs)("div",{className:"watch-detail-execution-output-header",children:[(0,d.jsx)(i.In,{icon:"mdi:message-text",width:12}),(0,d.jsxs)("span",{children:[e.session_output.cell_name||"Output",e.session_output.role&&" (".concat(e.session_output.role,")")]})]}),(0,d.jsx)("pre",{className:"watch-detail-execution-output-content",children:e.session_output.content})]}),e.result_preview&&!e.session_output&&(0,d.jsx)("div",{className:"watch-detail-execution-preview",children:(0,d.jsx)("pre",{children:e.result_preview})})]},e.execution_id||a))})]})]})})]})};var p=s(24227);l.syG.registerModules([l.JKr]);const f=l.zl0.withParams({backgroundColor:"#000000",foregroundColor:"#cbd5e1",headerBackgroundColor:"#0a0510",headerTextColor:"#f0f4f8",oddRowBackgroundColor:"#050410",borderColor:"#1a1628",rowBorder:!0,wrapperBorder:!1,headerFontSize:12,headerFontWeight:600,fontFamily:"'Google Sans Code', monospace",fontSize:13,accentColor:"#00e5ff",chromeBackgroundColor:"#000000"}),v=(e,a)=>e===a||!(!e||!a)&&JSON.stringify(e)===JSON.stringify(a),g={all:{label:"All",icon:"mdi:view-grid",color:"#94a3b8"},enabled:{label:"Enabled",icon:"mdi:play-circle",color:"#34d399"},disabled:{label:"Disabled",icon:"mdi:pause-circle",color:"#64748b"},error:{label:"Error",icon:"mdi:alert-circle",color:"#f87171"}},N={cascade:"#a78bfa",signal:"#818cf8",sql:"#f59e0b",default:"#94a3b8"},b="watchers_status",y=()=>{try{const e=localStorage.getItem(b);if(e&&g[e])return e}catch(e){}return"all"},_=()=>{const[e,a]=(0,t.useState)(y),[s,l]=(0,t.useState)(""),[r,o]=(0,t.useState)([]),[h,u]=(0,t.useState)({}),[m,w]=(0,t.useState)({}),[x,_]=(0,t.useState)(0),[S,C]=(0,t.useState)(!0),[k,I]=(0,t.useState)(null),[T,E]=(0,t.useState)(null),[D,F]=(0,t.useState)(!1),[R,z]=(0,t.useState)(null),L=(0,t.useCallback)(async()=>{try{const a=new URLSearchParams;"all"!==e&&a.set("status",e),s.trim()&&a.set("search",s.trim()),a.set("limit","500");const t=await fetch("".concat(p.J,"/api/watchers?").concat(a.toString())),c=await t.json();if(c.error)return void I(c.error);o(e=>v(e,c.watches)?e:c.watches),u(e=>v(e,c.status_counts)?e:c.status_counts),w(e=>v(e,c.action_type_counts)?e:c.action_type_counts),_(c.total||0),I(null)}catch(a){I(a.message)}finally{C(!1)}},[e,s]),M=(0,t.useCallback)(async e=>{if(e){F(!0);try{const a=await fetch("".concat(p.J,"/api/watchers/").concat(encodeURIComponent(e))),s=await a.json();s.error?(console.error("Error fetching watch detail:",s.error),z(null)):z(s)}catch(a){console.error("Error fetching watch detail:",a),z(null)}finally{F(!1)}}else z(null)},[]),O=(0,t.useCallback)(async e=>{try{const a=await fetch("".concat(p.J,"/api/watchers/").concat(encodeURIComponent(e),"/toggle"),{method:"POST"}),s=await a.json();s.success?(L(),(null===T||void 0===T?void 0:T.name)===e&&M(e)):console.error("Failed to toggle watch:",s.error)}catch(a){console.error("Error toggling watch:",a)}},[L,M,T]),W=(0,t.useCallback)(async e=>{try{const a=await fetch("".concat(p.J,"/api/watchers/").concat(encodeURIComponent(e),"/trigger"),{method:"POST"}),s=await a.json();s.success?(null===T||void 0===T?void 0:T.name)===e&&M(e):console.error("Failed to trigger watch:",s.error)}catch(a){console.error("Error triggering watch:",a)}},[M,T]),J=(0,t.useCallback)(async e=>{if(window.confirm('Are you sure you want to delete watch "'.concat(e,'"?')))try{const a=await fetch("".concat(p.J,"/api/watchers/").concat(encodeURIComponent(e)),{method:"DELETE"}),s=await a.json();s.success?((null===T||void 0===T?void 0:T.name)===e&&(E(null),z(null)),L()):console.error("Failed to delete watch:",s.error)}catch(a){console.error("Error deleting watch:",a)}},[L,T]),A=(0,t.useCallback)(e=>{a(e),E(null),z(null);try{localStorage.setItem(b,e)}catch(s){}},[]),B=(0,t.useCallback)(e=>{l(e.target.value)},[]),P=(0,t.useCallback)(e=>{const a=e.data;E(a),M(a.name)},[M]),U=(0,t.useCallback)(()=>{E(null),z(null)},[]);(0,t.useEffect)(()=>{L()},[e]),(0,t.useEffect)(()=>{const e=setTimeout(()=>{L()},300);return()=>clearTimeout(e)},[s]),(0,t.useEffect)(()=>{const e=setInterval(()=>{L(),T&&M(T.name)},3e4);return()=>clearInterval(e)},[e,s,L,M,T]);const q=(0,t.useMemo)(()=>[{field:"status",headerName:"Status",width:100,cellRenderer:e=>{const a=g[e.value]||g.disabled;return(0,d.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[(0,d.jsx)(i.In,{icon:a.icon,width:14,style:{color:a.color}}),(0,d.jsx)("span",{style:{color:a.color,textTransform:"capitalize",fontSize:"11px"},children:e.value})]})}},{field:"name",headerName:"Name",flex:1,minWidth:180,cellStyle:{color:"#f1f5f9",fontWeight:500}},{field:"action_type",headerName:"Action",width:100,cellRenderer:e=>{const a=N[e.value]||N.default;return(0,d.jsx)("span",{style:{color:a,fontSize:"11px",padding:"2px 6px",borderRadius:"4px",background:"".concat(a,"15")},children:e.value})}},{field:"description",headerName:"Description",flex:2,minWidth:200,cellStyle:{fontSize:"12px",color:"#94a3b8"},valueFormatter:e=>{const a=e.value||"";return a.length>100?a.substring(0,100)+"...":a}},{field:"poll_interval_seconds",headerName:"Interval",width:90,valueFormatter:e=>{const a=e.value||0;return a<60?"".concat(a,"s"):a<3600?"".concat(Math.floor(a/60),"m"):"".concat(Math.floor(a/3600),"h")},cellStyle:{fontSize:"11px",color:"#64748b"}},{field:"trigger_count",headerName:"Triggers",width:90,cellStyle:{fontSize:"11px",color:"#34d399",textAlign:"right"}},{field:"consecutive_errors",headerName:"Errors",width:80,cellRenderer:e=>{const a=e.value||0,s=a>0?"#f87171":"#64748b";return(0,d.jsx)("span",{style:{color:s,fontSize:"11px"},children:a})}},{field:"last_checked_at",headerName:"Last Check",width:140,valueFormatter:e=>{if(!e.value)return"-";return new Date(e.value).toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit",second:"2-digit"})},cellStyle:{fontSize:"11px",color:"#64748b"}},{field:"next_due",headerName:"Next Due",width:140,valueFormatter:e=>{if(!e.value)return"-";const a=new Date(e.value),s=a-new Date;return s<0?"Overdue":s<6e4?"".concat(Math.floor(s/1e3),"s"):s<36e5?"".concat(Math.floor(s/6e4),"m"):a.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"})},cellStyle:{fontSize:"11px",color:"#64748b"}}],[]);return(0,d.jsxs)("div",{className:"watchers-view ".concat(T?"with-detail":""),children:[(0,d.jsxs)("div",{className:"watchers-header",children:[(0,d.jsxs)("div",{className:"watchers-header-left",children:[(0,d.jsx)(i.In,{icon:"mdi:eye-circle",width:20,style:{color:"#00e5ff"}}),(0,d.jsx)("h1",{children:"Watchers"}),(0,d.jsx)("span",{className:"watchers-subtitle",children:"SQL Watch Subscriptions"})]}),(0,d.jsxs)("div",{className:"watchers-header-right",children:[(0,d.jsxs)("div",{className:"watchers-search",children:[(0,d.jsx)(i.In,{icon:"mdi:magnify",width:16,style:{color:"#64748b"}}),(0,d.jsx)("input",{type:"text",placeholder:"Search by name, description...",value:s,onChange:B,className:"watchers-search-input"}),s&&(0,d.jsx)("button",{className:"watchers-search-clear",onClick:()=>l(""),children:(0,d.jsx)(i.In,{icon:"mdi:close",width:14})})]}),(0,d.jsx)("div",{className:"watchers-stats",children:(0,d.jsxs)("span",{className:"watchers-stat",children:[(0,d.jsx)(i.In,{icon:"mdi:counter",width:14}),x," watches"]})})]})]}),(0,d.jsxs)("div",{className:"watchers-tabs",children:[Object.entries(g).map(a=>{let[s,t]=a;const c="all"===s?Object.values(h).reduce((e,a)=>e+a,0):h[s]||0;return(0,d.jsxs)("button",{className:"watchers-tab ".concat(e===s?"active":""),onClick:()=>A(s),children:[(0,d.jsx)(i.In,{icon:t.icon,width:14,style:{color:e===s?t.color:void 0}}),(0,d.jsx)("span",{children:t.label}),(0,d.jsx)("span",{className:"watchers-tab-count",children:c})]},s)}),(0,d.jsx)("div",{className:"watchers-action-counts",children:Object.entries(m).map(e=>{let[a,s]=e;return(0,d.jsxs)("span",{className:"watchers-action-count",children:[(0,d.jsx)("span",{className:"watchers-action-dot",style:{background:N[a]||N.default}}),a,": ",s]},a)})})]}),(0,d.jsxs)("div",{className:"watchers-content",children:[k&&(0,d.jsxs)("div",{className:"watchers-error",children:[(0,d.jsx)(i.In,{icon:"mdi:alert-circle",width:20}),(0,d.jsxs)("div",{children:[(0,d.jsx)("strong",{children:"Error loading watchers"}),(0,d.jsx)("p",{children:k})]})]}),S&&!r.length&&(0,d.jsx)(n.lp,{size:"medium",message:"Loading watchers...",className:"video-loader--flex"}),!S&&!k&&(0,d.jsxs)("div",{className:"watchers-grid-wrapper",children:[(0,d.jsx)("div",{className:"watchers-grid-container",children:0===r.length?(0,d.jsxs)("div",{className:"watchers-empty-state",children:[(0,d.jsx)(i.In,{icon:"mdi:eye-off",width:48,style:{color:"#64748b"}}),(0,d.jsx)("p",{children:"No watches found"}),(0,d.jsx)("span",{children:s?"Try adjusting your search":"Create a watch using the WATCH SQL command"})]}):(0,d.jsx)(c.W6,{theme:f,rowData:r,columnDefs:q,domLayout:"normal",suppressCellFocus:!0,enableCellTextSelection:!0,rowHeight:44,headerHeight:40,onRowClicked:P,rowStyle:{cursor:"pointer"},rowSelection:"single",getRowId:e=>e.data.watch_id,rowClass:e=>(null===T||void 0===T?void 0:T.watch_id)===e.data.watch_id?"watchers-row-selected":""})}),T&&(0,d.jsx)(j,{watch:T,detailData:R,loading:D,onClose:U,onToggle:()=>O(T.name),onTrigger:()=>W(T.name),onDelete:()=>J(T.name)})]})]})]})}}}]);
//# sourceMappingURL=969.505df8c9.chunk.js.map