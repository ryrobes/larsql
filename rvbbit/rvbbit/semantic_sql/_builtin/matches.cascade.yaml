# MEANS / MATCHES - Semantic boolean filter
# Returns TRUE if text semantically matches the criterion
#
# SQL Usage:
#   SELECT * FROM docs WHERE title MEANS 'happened at night'
#   SELECT * FROM docs WHERE NOT (description MEANS 'hoax or prank')
#
# Direct Function:
#   SELECT semantic_matches(title, 'nighttime event') FROM docs

cascade_id: semantic_matches

description: |
  Semantic boolean filter - returns TRUE if text semantically matches the criterion.
  Used for WHERE clauses with natural language conditions.

inputs_schema:
  text: The text to evaluate
  criterion: The semantic criterion to match against

sql_function:
  name: semantic_matches
  description: Returns TRUE if text semantically matches the criterion
  args:
    - name: text
      type: VARCHAR
    - name: criterion
      type: VARCHAR
  returns: BOOLEAN
  shape: SCALAR
  operators:
    - "{{ text }} MEANS {{ criterion }}"
    - "{{ text }} MATCHES {{ criterion }}"
  cache: true

cells:
  - name: evaluate
    model: google/gemini-2.5-flash-lite
    instructions: |
      Does this text match the semantic criterion?

      TEXT: {{ input.text }}

      CRITERION: {{ input.criterion }}

      Respond with ONLY "true" or "false" - no explanation, no other text.

      Think about whether the text's meaning, topic, or sentiment aligns with the criterion.
      Be generous in interpretation - if there's a reasonable semantic connection, answer "true".
    rules:
      max_turns: 1
    output_schema:
      type: boolean
