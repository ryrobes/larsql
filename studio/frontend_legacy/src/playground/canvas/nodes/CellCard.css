/* CellCard - Two-sided card with CCG-inspired styling */

/* =============================================================================
   CSS Custom Properties (Model Elements & Rarity)
   ============================================================================= */

.cell-card {
  /* Model element colors (border/frame) */
  --element-anthropic: #8B5CF6;  /* Purple */
  --element-openai: #10B981;     /* Green */
  --element-google: #3B82F6;     /* Blue */
  --element-mistral: #F59E0B;    /* Orange */
  --element-xai: #EF4444;        /* Red */
  --element-local: #6B7280;      /* Silver */

  /* Default to local */
  --frame-color: var(--element-local);
  --frame-color-light: #9CA3AF;

  /* Default card dimensions for CSS calculations */
  --card-width: 320px;
  --card-height: 288px;

  /* Card structure */
  position: relative;
  display: flex;
  flex-direction: column;
  perspective: 800px;
  transform-style: preserve-3d;

  /* Base transition for status changes (tap/untap, etc.) */
  transition: transform 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
}

/* Model element border colors */
.cell-card.model-anthropic { --frame-color: var(--element-anthropic); --frame-color-light: #A78BFA; }
.cell-card.model-openai { --frame-color: var(--element-openai); --frame-color-light: #34D399; }
.cell-card.model-google { --frame-color: var(--element-google); --frame-color-light: #60A5FA; }
.cell-card.model-mistral { --frame-color: var(--element-mistral); --frame-color-light: #FBBF24; }
.cell-card.model-xai { --frame-color: var(--element-xai); --frame-color-light: #F87171; }
.cell-card.model-local { --frame-color: var(--element-local); --frame-color-light: #9CA3AF; }

/* =============================================================================
   Stacked Deck Edges
   ============================================================================= */

.stack-edge {
  position: absolute;
  width: 100%;
  height: 100%;
  background: var(--bg-card);
  border: 1px solid var(--frame-color);
  border-radius: 8px;
  pointer-events: none;
  overflow: hidden;
  transform-style: preserve-3d;
  backface-visibility: hidden;
}

/* Dynamic stack positioning - cards fan out behind */
.stack-edge-1  { transform: translate(3px, 3px);   z-index: -1;  opacity: 0.7; }
.stack-edge-2  { transform: translate(6px, 6px);   z-index: -2;  opacity: 0.6; }
.stack-edge-3  { transform: translate(9px, 9px);   z-index: -3;  opacity: 0.5; }
.stack-edge-4  { transform: translate(12px, 12px); z-index: -4;  opacity: 0.4; }
.stack-edge-5  { transform: translate(15px, 15px); z-index: -5;  opacity: 0.35; }
.stack-edge-6  { transform: translate(18px, 18px); z-index: -6;  opacity: 0.3; }
.stack-edge-7  { transform: translate(21px, 21px); z-index: -7;  opacity: 0.25; }
.stack-edge-8  { transform: translate(24px, 24px); z-index: -8;  opacity: 0.2; }
.stack-edge-9  { transform: translate(27px, 27px); z-index: -9;  opacity: 0.18; }
.stack-edge-10 { transform: translate(30px, 30px); z-index: -10; opacity: 0.15; }

/* Reforge cards have vertical emphasis */
.stack-edge.reforge-card {
  border-color: #a78bfa;
}

/* Sounding cards have horizontal emphasis */
.stack-edge.sounding-card {
  border-color: var(--frame-color);
}

/* Placeholder content inside stacked cards */
.stack-card-preview {
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
}

.stack-card-header {
  padding: 4px 8px;
  font-size: 10px;
  font-weight: 600;
  color: var(--text-muted);
  background: rgba(0, 0, 0, 0.3);
  border-bottom: 1px solid var(--border-default);
}

/* Reforge card headers are purple-tinted */
.reforge-card .stack-card-header {
  color: #a78bfa;
  background: rgba(167, 139, 250, 0.1);
}

/* Sounding card headers are yellow-tinted */
.sounding-card .stack-card-header {
  color: #fbbf24;
  background: rgba(251, 191, 36, 0.1);
}

/* Winner star in stack header */
.stack-card-header .winner-star {
  margin-left: 4px;
  color: #10b981;
  text-shadow: 0 0 4px rgba(16, 185, 129, 0.5);
}

/* Winner styling for stack cards */
.stack-edge.is-winner {
  border-color: #10b981 !important;
}

.stack-edge.is-winner .stack-card-header {
  color: #10b981;
  background: rgba(16, 185, 129, 0.2);
  font-weight: 600;
}

.stack-edge.is-winner .stack-card-header::after {
  content: ' ★';
}

/* Loser styling - dimmed */
.stack-edge.is-loser {
  opacity: 0.4 !important;
  filter: grayscale(0.5);
}

.stack-edge.is-loser .stack-card-header {
  text-decoration: line-through;
  opacity: 0.7;
}

/* Content preview inside stacked cards */
.stack-card-content {
  flex: 1;
  padding: 6px 8px;
  font-size: 10px;
  line-height: 1.4;
  color: var(--text-secondary);
  overflow-y: auto;
}

.stack-card-content .rich-markdown {
  font-size: inherit;
}

.stack-card-content .rich-markdown p {
  margin: 0;
}

.stack-card-content .rich-markdown h1,
.stack-card-content .rich-markdown h2,
.stack-card-content .rich-markdown h3 {
  font-size: 9px;
  margin: 0 0 2px 0;
}

/* Stack click zone - hit area for fan toggle */
.stack-click-zone {
  position: absolute;
  top: 0;
  right: -16px;
  bottom: 0;
  width: 24px;
  z-index: 10;
  cursor: pointer;
}

/* Add transition to stack edges for smooth fan animation */
.stack-edge {
  transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.3s ease;
}

/* =============================================================================
   Fan Out Animation - Soundings (Horizontal Peacock)
   ============================================================================= */

/* Soundings fan: cards spread right with rotation like a peacock tail */
.cell-card.is-fanned .sounding-card.stack-edge-1  { transform: translate(55px, -8px) rotate(6deg);   opacity: 0.85; }
.cell-card.is-fanned .sounding-card.stack-edge-2  { transform: translate(105px, -12px) rotate(11deg); opacity: 0.8; }
.cell-card.is-fanned .sounding-card.stack-edge-3  { transform: translate(150px, -14px) rotate(15deg); opacity: 0.75; }
.cell-card.is-fanned .sounding-card.stack-edge-4  { transform: translate(190px, -14px) rotate(18deg); opacity: 0.7; }
.cell-card.is-fanned .sounding-card.stack-edge-5  { transform: translate(225px, -12px) rotate(20deg); opacity: 0.65; }
.cell-card.is-fanned .sounding-card.stack-edge-6  { transform: translate(255px, -8px) rotate(21deg);  opacity: 0.6; }
.cell-card.is-fanned .sounding-card.stack-edge-7  { transform: translate(280px, -2px) rotate(21deg);  opacity: 0.55; }
.cell-card.is-fanned .sounding-card.stack-edge-8  { transform: translate(300px, 6px) rotate(20deg);   opacity: 0.5; }
.cell-card.is-fanned .sounding-card.stack-edge-9  { transform: translate(315px, 16px) rotate(18deg);  opacity: 0.45; }
.cell-card.is-fanned .sounding-card.stack-edge-10 { transform: translate(325px, 28px) rotate(15deg);  opacity: 0.4; }

/* =============================================================================
   Fan Out Animation - Reforge (Vertical Slide Down)
   ============================================================================= */

/* Reforge fan: cards slide down to reveal their tops (evolution preview) */
.cell-card.is-fanned .reforge-card.stack-edge-1  { transform: translate(-5px, 45px);  opacity: 0.9; }
.cell-card.is-fanned .reforge-card.stack-edge-2  { transform: translate(-8px, 88px);  opacity: 0.85; }
.cell-card.is-fanned .reforge-card.stack-edge-3  { transform: translate(-10px, 128px); opacity: 0.8; }
.cell-card.is-fanned .reforge-card.stack-edge-4  { transform: translate(-11px, 165px); opacity: 0.75; }
.cell-card.is-fanned .reforge-card.stack-edge-5  { transform: translate(-11px, 200px); opacity: 0.7; }
.cell-card.is-fanned .reforge-card.stack-edge-6  { transform: translate(-10px, 232px); opacity: 0.65; }
.cell-card.is-fanned .reforge-card.stack-edge-7  { transform: translate(-8px, 262px);  opacity: 0.6; }
.cell-card.is-fanned .reforge-card.stack-edge-8  { transform: translate(-5px, 290px);  opacity: 0.55; }
.cell-card.is-fanned .reforge-card.stack-edge-9  { transform: translate(-2px, 315px);  opacity: 0.5; }
.cell-card.is-fanned .reforge-card.stack-edge-10 { transform: translate(0px, 338px);   opacity: 0.45; }

/* Main card lifts slightly when fanned */
.cell-card.is-fanned .card-scene {
  transform: translateY(-8px);
  box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.5);
}

/* Hide handles during fan */
.cell-card.is-fanned .card-handle {
  opacity: 0 !important;
  pointer-events: none !important;
}

/* Stack cards become more visible when fanned */
.cell-card.is-fanned .stack-edge {
  pointer-events: auto;
  cursor: pointer;
}

/* =============================================================================
   Rarity Frames
   ============================================================================= */

/* Common - Plain border (on card-face to preserve 3D flip) */
.cell-card.rarity-common .card-face {
  border: 2px solid var(--frame-color);
}

/* Uncommon - Slightly brighter border */
.cell-card.rarity-uncommon .card-face {
  border: 2px solid var(--frame-color-light);
}

/* Rare - Purple border */
.cell-card.rarity-rare .card-face {
  border: 2px solid #8B5CF6;
}

/* Legendary - Gold border */
.cell-card.rarity-legendary .card-face {
  border: 2px solid #FFD700;
}

/* Broken - Red border */
.cell-card.rarity-broken .card-face {
  border: 2px solid #EF4444;
}

.cell-card.rarity-broken::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background:
    linear-gradient(45deg, transparent 45%, rgba(239, 68, 68, 0.1) 50%, transparent 55%),
    linear-gradient(-45deg, transparent 45%, rgba(239, 68, 68, 0.1) 50%, transparent 55%);
  pointer-events: none;
  border-radius: 8px;
  z-index: 10;
}

/* =============================================================================
   3D Card Flip Scene
   ============================================================================= */

.card-scene {
  flex: 1;
  position: relative;
  perspective: 1000px;
  overflow: visible;
  /* Tilt animation - pivot from top so bottom lifts up for peeking */
  transition: transform 0.35s cubic-bezier(0.4, 0.0, 0.2, 1), box-shadow 0.35s ease;
  transform-origin: center top;
}

.card-flipper {
  width: 100%;
  height: 100%;
  position: relative;
  transform-style: preserve-3d;
  transition: transform 0.6s cubic-bezier(0.4, 0.0, 0.2, 1);
}

.card-flipper.is-flipped {
  transform: rotateY(180deg);
}

/* Hide handles during flip animation */
.cell-card.is-flipping .card-handle {
  opacity: 0;
  transition: opacity 0.08s ease;
}

.cell-card:not(.is-flipping) .card-handle {
  opacity: 1;
  transition: opacity 0.12s ease 0.5s; /* Reappear after flip settles */
}

/* Hide resize handle during animations (flip or tilt) - use !important to override hover */
.cell-card.is-flipping .card-resize-handle,
.cell-card.is-tilted .card-resize-handle,
.cell-card.is-fanned .card-resize-handle {
  opacity: 0 !important;
  pointer-events: none !important;
}

.cell-card:not(.is-flipping):not(.is-tilted):not(.is-fanned) .card-resize-handle {
  transition: opacity 0.15s ease 0.3s;
}

/* Suppress border glow effects during flip */
.cell-card.is-flipping .card-face {
  box-shadow: none !important;
  border-color: transparent !important;
  transition: box-shadow 0.1s ease, border-color 0.1s ease;
}

.cell-card:not(.is-flipping) .card-face {
  transition: box-shadow 0.15s ease 0.5s, border-color 0.15s ease 0.5s;
}

.cell-card:hover .card-flipper {
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4);
}

.cell-card.selected .card-face {
  box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.3);
}

/* =============================================================================
   Card Faces (Front & Back)
   ============================================================================= */

.card-face {
  position: absolute;
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
  border-radius: 6px;
  overflow: hidden;
  /* Smooth transitions for status changes */
  transition: border-color 0.3s ease, box-shadow 0.3s ease;
}

.card-front {
  background: var(--bg-card);
}

.card-back {
  background: linear-gradient(180deg, #0a0a0a 0%, var(--bg-card) 100%);
  transform: rotateY(180deg);
}

/* =============================================================================
   Card Header
   ============================================================================= */

.card-header {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 6px 10px;
  background: rgba(0, 0, 0, 0.3);
  border-bottom: 1px solid var(--border-default);
  flex-shrink: 0;
}

.card-header-back {
  background: rgba(0, 0, 0, 0.5);
}

.card-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--frame-color);
  flex-shrink: 0;
}

.card-title {
  flex: 1;
  font-size: 12px;
  font-weight: 600;
  color: var(--text-primary);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  cursor: pointer;
}

.card-title:hover {
  color: var(--frame-color);
}

.card-name-input {
  flex: 1;
  min-width: 0;
  padding: 2px 6px;
  font-size: 12px;
  font-weight: 600;
  font-family: inherit;
  background: var(--bg-main);
  border: 1px solid var(--frame-color);
  border-radius: 3px;
  color: var(--text-primary);
  outline: none;
}

.card-status {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 20px;
  height: 20px;
  border-radius: 50%;
  flex-shrink: 0;
}

.card-status.idle { color: var(--text-muted); }
.card-status.pending { color: var(--text-secondary); }
.card-status.running { color: #fbbf24; }
.card-status.completed { color: #10b981; }
.card-status.error { color: #ef4444; }

.card-parse-error {
  color: #ef4444;
  display: flex;
  align-items: center;
}

/* =============================================================================
   Mutation Trait Icons
   ============================================================================= */

.card-traits {
  display: flex;
  align-items: center;
  gap: 2px;
  margin-left: auto;
  margin-right: 4px;
}

.trait-icon {
  font-size: 11px;
  line-height: 1;
  cursor: help;
  opacity: 0.8;
  transition: opacity 0.15s ease, transform 0.15s ease;
}

.trait-icon:hover {
  opacity: 1;
  transform: scale(1.15);
}

/* Mutation mode specific colors */
.trait-icon.trait-rewrite {
  filter: hue-rotate(-20deg) saturate(1.2);
}

.trait-icon.trait-augment {
  filter: brightness(1.1);
}

.trait-icon.trait-approach {
  filter: hue-rotate(20deg) saturate(1.1);
}

.trait-icon.trait-multimodel {
  opacity: 0.9;
}

.trait-icon.trait-default {
  opacity: 0.7;
}

/* =============================================================================
   Card Content (Front)
   ============================================================================= */

.card-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 12px;
  min-height: 0;
  overflow: hidden;
}

.card-idle-state,
.card-running-state,
.card-waiting-state,
.card-error-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 8px;
  color: var(--text-muted);
  height: 100%;
}

.card-running-state {
  color: #fbbf24;
}

.card-waiting-state {
  color: #6b7280;
}

.card-error-state {
  color: #ef4444;
}

/* Live log during execution - simple scrolling log */
.card-live-log {
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  background: rgba(0, 0, 0, 0.3);
  border-radius: 4px;
}

.card-live-log .card-running-state {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 4px;
}

/* Simple scrolling log - newest first */
.live-log-scroll {
  flex: 1;
  overflow-y: auto;
  padding: 6px;
  font-family: 'Google Sans Code', 'Menlo', 'Ubuntu Mono', monospace;
  font-size: 10px;
  line-height: 1.5;
}

.log-row {
  display: flex;
  gap: 6px;
  padding: 2px 0;
  border-bottom: 1px solid rgba(255, 255, 255, 0.05);
  animation: log-row-in 0.2s ease-out;
}

@keyframes log-row-in {
  from { opacity: 0; transform: translateY(-4px); }
  to { opacity: 1; transform: translateY(0); }
}

.log-row.winner {
  background: rgba(251, 191, 36, 0.1);
}

.log-label {
  flex-shrink: 0;
  width: 28px;
  color: var(--text-muted);
  font-weight: 600;
}

.log-row.winner .log-label {
  color: #fbbf24;
}

.log-text {
  flex: 1;
  color: var(--text-secondary);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.card-output-preview {
  width: 100%;
  height: 100%;
  font-size: 11px;
  line-height: 1.4;
  color: var(--text-secondary);
  overflow: auto;
  word-break: break-word;
  background: rgba(0, 0, 0, 0.2);
  border-radius: 4px;
  padding: 8px;
}

/* Compact markdown in card output */
.card-output-preview .rich-markdown {
  font-size: inherit;
  line-height: inherit;
}

.card-output-preview .rich-markdown p {
  margin: 0 0 0.4em 0;
}

.card-output-preview .rich-markdown p:last-child {
  margin-bottom: 0;
}

.card-output-preview .rich-markdown h1,
.card-output-preview .rich-markdown h2,
.card-output-preview .rich-markdown h3,
.card-output-preview .rich-markdown h4 {
  font-size: 12px;
  margin: 0.4em 0 0.2em 0;
  line-height: 1.3;
}

.card-output-preview .rich-markdown h1:first-child,
.card-output-preview .rich-markdown h2:first-child,
.card-output-preview .rich-markdown h3:first-child {
  margin-top: 0;
}

.card-output-preview .rich-markdown ul,
.card-output-preview .rich-markdown ol {
  margin: 0.25em 0;
  padding-left: 1.25em;
}

.card-output-preview .rich-markdown li {
  margin: 0.1em 0;
}

.card-output-preview .rich-markdown pre {
  margin: 0.4em 0;
  padding: 0.4em;
  font-size: 10px;
}

.card-output-preview .rich-markdown code {
  font-size: 10px;
}

.card-output-preview .rich-markdown blockquote {
  margin: 0.4em 0;
  padding-left: 0.75em;
  border-left: 2px solid var(--border-default);
}

.card-output-preview::-webkit-scrollbar {
  width: 6px;
}

.card-output-preview::-webkit-scrollbar-track {
  background: transparent;
}

.card-output-preview::-webkit-scrollbar-thumb {
  background: var(--border-default);
  border-radius: 3px;
}

/* =============================================================================
   Card Editor (Back)
   ============================================================================= */

.card-editor-container {
  flex: 1;
  min-height: 0;
  overflow: hidden;
  background: #000000;
}

.card-editor-container .monaco-editor {
  border-radius: 0;
}

.card-editor-container .monaco-editor .margin {
  background: transparent !important;
}

.editor-loading {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100%;
  color: var(--text-muted);
}

/* =============================================================================
   Card Footer
   ============================================================================= */

.card-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 6px 10px;
  border-top: 1px solid var(--border-default);
  background: rgba(0, 0, 0, 0.3);
  flex-shrink: 0;
  position: relative; /* For centered status message */
}

.footer-left,
.footer-right {
  display: flex;
  align-items: center;
  gap: 8px;
}

.footer-indicator {
  font-size: 11px;
  font-weight: 600;
  padding: 2px 6px;
  border-radius: 4px;
  background: rgba(0, 0, 0, 0.3);
}

.footer-indicator.soundings-indicator {
  color: #fbbf24;
  background: rgba(251, 191, 36, 0.15);
  display: flex;
  align-items: center;
  gap: 4px;
}

.footer-indicator.reforge-indicator {
  color: #a78bfa;
  background: rgba(167, 139, 250, 0.15);
}

/* Evaluating indicator */
.footer-indicator.evaluating-indicator {
  color: #6366f1;
  background: rgba(99, 102, 241, 0.15);
  display: flex;
  align-items: center;
  gap: 4px;
}

/* Winner indicator */
.footer-indicator.winner-indicator {
  color: #10b981;
  background: rgba(16, 185, 129, 0.15);
  font-weight: 700;
}

/* Reforge running indicator */
.footer-indicator.reforge-running-indicator {
  color: #a78bfa;
  background: rgba(167, 139, 250, 0.15);
  display: flex;
  align-items: center;
  gap: 4px;
}

/* Aggregate indicator */
.footer-indicator.aggregate-indicator {
  color: #FFD700;
  background: rgba(255, 215, 0, 0.15);
  display: flex;
  align-items: center;
  gap: 4px;
}

/* Status message - short status messages during execution */
.footer-indicator.status-message {
  color: var(--text-secondary);
  background: rgba(107, 114, 128, 0.15);
  font-weight: 500;
  font-size: 10px;
  max-width: 140px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  /* Center in footer when present */
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
}

.footer-stat {
  display: flex;
  align-items: center;
  gap: 3px;
  font-size: 10px;
  color: var(--text-muted);
}

.footer-stat.duration {
  color: var(--text-secondary);
}

.footer-stat.cost {
  color: #10b981;
  font-weight: 600;
}

/* =============================================================================
   Handles
   ============================================================================= */

.card-handle {
  width: 12px !important;
  height: 12px !important;
  border: 2px solid var(--bg-card) !important;
  transition: all 0.15s ease;
  z-index: 20 !important;
}

.card-handle.input-handle {
  left: -6px !important;
}

.card-handle.output-handle {
  right: -6px !important;
}

.card-handle.handle-text {
  background: #10b981 !important;
}

.card-handle.handle-text:hover {
  background: #34d399 !important;
}

.card-handle.handle-image {
  background: #a78bfa !important;
}

.card-handle.handle-image:hover {
  background: #c4b5fd !important;
}

/* =============================================================================
   Buttons
   ============================================================================= */

.card-delete-button,
.card-play-button,
.card-flip-button {
  position: absolute;
  border-radius: 50%;
  border: 2px solid var(--bg-card);
  color: white;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 30;
  transition: all 0.15s ease;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
}

/* Delete button - top left */
.card-delete-button {
  top: -8px;
  left: -8px;
  width: 18px;
  height: 18px;
  background: #ef4444;
  opacity: 0;
}

.cell-card:hover .card-delete-button {
  opacity: 1;
}

.card-delete-button:hover {
  transform: scale(1.15);
  background: #dc2626;
}

/* Play button - top right */
.card-play-button {
  top: -8px;
  right: -8px;
  width: 22px;
  height: 22px;
  background: #10b981;
}

.card-play-button:hover {
  transform: scale(1.15);
  background: #059669;
}

/* Header cursor hint for right-click to flip */
.card-header {
  cursor: context-menu;
}

/* =============================================================================
   Resize Handle
   ============================================================================= */

.card-resize-handle {
  position: absolute;
  bottom: -2px;
  right: -2px;
  width: 20px;
  height: 20px;
  cursor: nwse-resize;
  opacity: 0;
  transition: opacity 0.15s ease;
  z-index: 20;
}

.card-resize-handle::before {
  content: '';
  position: absolute;
  bottom: 5px;
  right: 5px;
  width: 8px;
  height: 8px;
  border-right: 2px solid var(--frame-color);
  border-bottom: 2px solid var(--frame-color);
  border-radius: 0 0 2px 0;
  pointer-events: none;
}

.cell-card:hover .card-resize-handle {
  opacity: 1;
}

/* =============================================================================
   Status-based Styling
   ============================================================================= */

/* Pending = Muted border */
.cell-card.status-pending .card-face {
  border-color: var(--text-muted);
}

/* Main card stays untapped - only stack edges animate */
.cell-card {
  transform: rotate(0deg);
}

/* Running = Cyan pulsing glow (cyberpunk style) */
.cell-card.status-running .card-face {
  border-color: #00e5ff;
  box-shadow:
    0 0 8px rgba(0, 229, 255, 0.4),
    0 0 16px rgba(0, 229, 255, 0.2);
  animation: playground-running-pulse 2s ease-in-out infinite;
}

@keyframes playground-running-pulse {
  0%, 100% {
    box-shadow:
      0 0 8px rgba(0, 229, 255, 0.4),
      0 0 16px rgba(0, 229, 255, 0.2);
  }
  50% {
    box-shadow:
      0 0 12px rgba(0, 229, 255, 0.6),
      0 0 24px rgba(0, 229, 255, 0.35);
  }
}

/* Completed = Green border with settle glow */
.cell-card.status-completed .card-face {
  border-color: #10b981;
  box-shadow:
    0 0 6px rgba(16, 185, 129, 0.4),
    0 0 12px rgba(16, 185, 129, 0.2);
  animation: playground-complete-pop 0.5s ease-out;
}

@keyframes playground-complete-pop {
  0% {
    transform: scale(1.015);
    box-shadow:
      0 0 16px rgba(16, 185, 129, 0.6),
      0 0 32px rgba(16, 185, 129, 0.3);
  }
  100% {
    transform: scale(1);
    box-shadow:
      0 0 6px rgba(16, 185, 129, 0.4),
      0 0 12px rgba(16, 185, 129, 0.2);
  }
}

/* Error = Shocking pink glow */
.cell-card.status-error .card-face {
  border-color: #ff006e;
  box-shadow:
    0 0 8px rgba(255, 0, 110, 0.4),
    0 0 16px rgba(255, 0, 110, 0.2);
}

/* =============================================================================
   Tilt to Reveal Actions
   ============================================================================= */

/* Tilt zone - clickable grip at bottom edge for peeking */
.card-tilt-zone {
  position: absolute;
  bottom: -4px;
  left: 50%;
  transform: translateX(-50%);
  width: 48px;
  height: 12px;
  z-index: 25;
  cursor: pointer;
}

.card-tilt-zone::after {
  content: '';
  position: absolute;
  bottom: 4px;
  left: 50%;
  transform: translateX(-50%);
  width: 28px;
  height: 4px;
  background: var(--frame-color);
  border-radius: 2px;
  opacity: 0.4;
  transition: opacity 0.2s ease, transform 0.2s ease;
}

.card-tilt-zone:hover::after {
  opacity: 0.8;
  transform: translateX(-50%) scaleX(1.2);
}

/* Brighten grip indicator when tilted */
.cell-card.is-tilted .card-tilt-zone::after {
  opacity: 0.9;
  background: var(--text-primary);
}

/* Tilt transform - bottom lifts toward viewer for peeking underneath */
.cell-card.is-tilted .card-scene {
  transform: rotateX(25deg);
  box-shadow: 0 -20px 40px -10px rgba(0, 0, 0, 0.5);
}

/* Stack edges tilt with the card */
.cell-card .stack-edge {
  transition: transform 0.35s cubic-bezier(0.4, 0.0, 0.2, 1);
  transform-origin: center top;
}

.cell-card.is-tilted .stack-edge-1 {
  transform: translate(4px, 4px) rotateX(25deg);
}

.cell-card.is-tilted .stack-edge-2 {
  transform: translate(8px, 8px) rotateX(25deg);
}

.cell-card.is-tilted .stack-edge-3 {
  transform: translate(12px, 12px) rotateX(25deg);
}

/* Actions tray - revealed at bottom when card tilts up */
.card-actions-tray {
  position: absolute;
  bottom: 8px;
  left: 0;
  right: 0;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
  z-index: 5;
  opacity: 0;
  transform: translateY(8px);
  transition: opacity 0.15s ease, transform 0.2s ease;
  pointer-events: none;
}

.cell-card.is-tilted .card-actions-tray {
  opacity: 1;
  transform: translateY(0);
  pointer-events: auto;
  transition-delay: 0.1s;
}

/* Action buttons */
.tray-action {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 28px;
  height: 28px;
  border-radius: 50%;
  border: none;
  cursor: pointer;
  transition: transform 0.15s ease, box-shadow 0.15s ease;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
}

.tray-action:hover {
  transform: scale(1.15);
}

.tray-action.action-delete {
  background: linear-gradient(135deg, #ef4444, #dc2626);
  color: white;
}

.tray-action.action-delete:hover {
  box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
}

.tray-action.action-run {
  background: linear-gradient(135deg, #10b981, #059669);
  color: white;
}

.tray-action.action-run:hover {
  box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
}

.tray-action.action-duplicate {
  background: linear-gradient(135deg, #6366f1, #4f46e5);
  color: white;
}

.tray-action.action-duplicate:hover {
  box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
}

/* Hide tilt zone and actions during flip */
.cell-card.is-flipping .card-tilt-zone,
.cell-card.is-flipping .card-actions-tray {
  opacity: 0 !important;
  pointer-events: none !important;
}

/* =============================================================================
   Spinning Animation
   ============================================================================= */

@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

.spinning {
  animation: spin 1s linear infinite;
}

/* =============================================================================
   Execution State: SOUNDINGS_RUNNING
   ============================================================================= */

/* Main card stays stable, yellow border indicates soundings active */
.cell-card.status-soundings_running .card-face {
  border-color: #fbbf24;
}

/* Running sounding cards lift slightly to show activity */
.stack-edge.is-running {
  animation: sounding-lift 1s ease-in-out infinite;
  border-color: #fbbf24 !important;
}

@keyframes sounding-lift {
  0%, 100% { margin-top: 0; }
  50% { margin-top: -4px; }
}

/* Just-updated cards slide out, hold, then slide back */
.stack-edge.sounding-card.just-updated {
  border-color: #10b981 !important;
  box-shadow:
    0 0 24px rgba(16, 185, 129, 0.7),
    0 15px 35px -5px rgba(0, 0, 0, 0.5);
  z-index: 100 !important;
  opacity: 1 !important;
}

.stack-edge.reforge-card.just-updated {
  border-color: #a78bfa !important;
  box-shadow:
    0 0 24px rgba(167, 139, 250, 0.7),
    0 15px 35px -5px rgba(0, 0, 0, 0.5);
  z-index: 100 !important;
  opacity: 1 !important;
}

/* Sounding cards slide RIGHT with 3D rotation - like drawing a card from deck */
/* Use CSS custom properties for dynamic positioning based on card width */
.sounding-card.stack-edge-1.just-updated  { animation: slide-s1 2s cubic-bezier(0.34, 1.2, 0.64, 1); }
.sounding-card.stack-edge-2.just-updated  { animation: slide-s2 2s cubic-bezier(0.34, 1.2, 0.64, 1); }
.sounding-card.stack-edge-3.just-updated  { animation: slide-s3 2s cubic-bezier(0.34, 1.2, 0.64, 1); }
.sounding-card.stack-edge-4.just-updated  { animation: slide-s4 2s cubic-bezier(0.34, 1.2, 0.64, 1); }
.sounding-card.stack-edge-5.just-updated  { animation: slide-s5 2s cubic-bezier(0.34, 1.2, 0.64, 1); }

/*
 * Playing card pop-out animation:
 * 0%: In deck position
 * 5%: Start lifting with slight tilt (preparing to draw)
 * 25%: Fully drawn out, rotated like being examined
 * 70%: Hold position for viewing
 * 100%: Slide back into deck with reverse rotation
 */
@keyframes slide-s1 {
  0%   { transform: translate(3px, 3px) rotateY(0deg) rotateZ(0deg); opacity: 0.7; }
  5%   { transform: translate(10px, -5px) rotateY(-8deg) rotateZ(2deg); opacity: 0.85; }
  25%  { transform: translate(calc(var(--card-width, 320px) * 0.35), -20px) rotateY(-15deg) rotateZ(8deg); opacity: 1; }
  70%  { transform: translate(calc(var(--card-width, 320px) * 0.35), -20px) rotateY(-12deg) rotateZ(6deg); opacity: 1; }
  90%  { transform: translate(15px, 0px) rotateY(-4deg) rotateZ(1deg); opacity: 0.8; }
  100% { transform: translate(3px, 3px) rotateY(0deg) rotateZ(0deg); opacity: 0.7; }
}
@keyframes slide-s2 {
  0%   { transform: translate(6px, 6px) rotateY(0deg) rotateZ(0deg); opacity: 0.6; }
  5%   { transform: translate(15px, -8px) rotateY(-10deg) rotateZ(3deg); opacity: 0.8; }
  25%  { transform: translate(calc(var(--card-width, 320px) * 0.5), -30px) rotateY(-18deg) rotateZ(12deg); opacity: 1; }
  70%  { transform: translate(calc(var(--card-width, 320px) * 0.5), -30px) rotateY(-15deg) rotateZ(10deg); opacity: 1; }
  90%  { transform: translate(20px, 0px) rotateY(-5deg) rotateZ(2deg); opacity: 0.7; }
  100% { transform: translate(6px, 6px) rotateY(0deg) rotateZ(0deg); opacity: 0.6; }
}
@keyframes slide-s3 {
  0%   { transform: translate(9px, 9px) rotateY(0deg) rotateZ(0deg); opacity: 0.5; }
  5%   { transform: translate(20px, -10px) rotateY(-12deg) rotateZ(4deg); opacity: 0.75; }
  25%  { transform: translate(calc(var(--card-width, 320px) * 0.65), -35px) rotateY(-20deg) rotateZ(15deg); opacity: 1; }
  70%  { transform: translate(calc(var(--card-width, 320px) * 0.65), -35px) rotateY(-17deg) rotateZ(13deg); opacity: 1; }
  90%  { transform: translate(25px, 0px) rotateY(-6deg) rotateZ(2deg); opacity: 0.6; }
  100% { transform: translate(9px, 9px) rotateY(0deg) rotateZ(0deg); opacity: 0.5; }
}
@keyframes slide-s4 {
  0%   { transform: translate(12px, 12px) rotateY(0deg) rotateZ(0deg); opacity: 0.4; }
  5%   { transform: translate(25px, -12px) rotateY(-14deg) rotateZ(5deg); opacity: 0.7; }
  25%  { transform: translate(calc(var(--card-width, 320px) * 0.8), -38px) rotateY(-22deg) rotateZ(18deg); opacity: 1; }
  70%  { transform: translate(calc(var(--card-width, 320px) * 0.8), -38px) rotateY(-19deg) rotateZ(15deg); opacity: 1; }
  90%  { transform: translate(28px, 0px) rotateY(-7deg) rotateZ(3deg); opacity: 0.5; }
  100% { transform: translate(12px, 12px) rotateY(0deg) rotateZ(0deg); opacity: 0.4; }
}
@keyframes slide-s5 {
  0%   { transform: translate(15px, 15px) rotateY(0deg) rotateZ(0deg); opacity: 0.35; }
  5%   { transform: translate(30px, -14px) rotateY(-15deg) rotateZ(6deg); opacity: 0.65; }
  25%  { transform: translate(calc(var(--card-width, 320px) * 0.95), -40px) rotateY(-24deg) rotateZ(20deg); opacity: 1; }
  70%  { transform: translate(calc(var(--card-width, 320px) * 0.95), -40px) rotateY(-21deg) rotateZ(17deg); opacity: 1; }
  90%  { transform: translate(32px, 0px) rotateY(-8deg) rotateZ(3deg); opacity: 0.45; }
  100% { transform: translate(15px, 15px) rotateY(0deg) rotateZ(0deg); opacity: 0.35; }
}

/* Reforge cards slide DOWN with 3D tilt - like dealing cards from above */
.reforge-card.stack-edge-1.just-updated  { animation: slide-r1 2s cubic-bezier(0.34, 1.2, 0.64, 1); }
.reforge-card.stack-edge-2.just-updated  { animation: slide-r2 2s cubic-bezier(0.34, 1.2, 0.64, 1); }
.reforge-card.stack-edge-3.just-updated  { animation: slide-r3 2s cubic-bezier(0.34, 1.2, 0.64, 1); }
.reforge-card.stack-edge-4.just-updated  { animation: slide-r4 2s cubic-bezier(0.34, 1.2, 0.64, 1); }
.reforge-card.stack-edge-5.just-updated  { animation: slide-r5 2s cubic-bezier(0.34, 1.2, 0.64, 1); }

@keyframes slide-r1 {
  0%   { transform: translate(3px, 3px) rotateX(0deg) rotateZ(0deg); opacity: 0.7; }
  5%   { transform: translate(-5px, 15px) rotateX(8deg) rotateZ(-2deg); opacity: 0.85; }
  25%  { transform: translate(-15px, calc(var(--card-height, 288px) * 0.25)) rotateX(15deg) rotateZ(-5deg); opacity: 1; }
  70%  { transform: translate(-15px, calc(var(--card-height, 288px) * 0.25)) rotateX(12deg) rotateZ(-4deg); opacity: 1; }
  90%  { transform: translate(-3px, 12px) rotateX(4deg) rotateZ(-1deg); opacity: 0.8; }
  100% { transform: translate(3px, 3px) rotateX(0deg) rotateZ(0deg); opacity: 0.7; }
}
@keyframes slide-r2 {
  0%   { transform: translate(6px, 6px) rotateX(0deg) rotateZ(0deg); opacity: 0.6; }
  5%   { transform: translate(-8px, 20px) rotateX(10deg) rotateZ(-3deg); opacity: 0.8; }
  25%  { transform: translate(-20px, calc(var(--card-height, 288px) * 0.45)) rotateX(18deg) rotateZ(-7deg); opacity: 1; }
  70%  { transform: translate(-20px, calc(var(--card-height, 288px) * 0.45)) rotateX(15deg) rotateZ(-5deg); opacity: 1; }
  90%  { transform: translate(-5px, 15px) rotateX(5deg) rotateZ(-1deg); opacity: 0.7; }
  100% { transform: translate(6px, 6px) rotateX(0deg) rotateZ(0deg); opacity: 0.6; }
}
@keyframes slide-r3 {
  0%   { transform: translate(9px, 9px) rotateX(0deg) rotateZ(0deg); opacity: 0.5; }
  5%   { transform: translate(-10px, 25px) rotateX(12deg) rotateZ(-4deg); opacity: 0.75; }
  25%  { transform: translate(-25px, calc(var(--card-height, 288px) * 0.65)) rotateX(20deg) rotateZ(-8deg); opacity: 1; }
  70%  { transform: translate(-25px, calc(var(--card-height, 288px) * 0.65)) rotateX(17deg) rotateZ(-6deg); opacity: 1; }
  90%  { transform: translate(-6px, 18px) rotateX(6deg) rotateZ(-2deg); opacity: 0.6; }
  100% { transform: translate(9px, 9px) rotateX(0deg) rotateZ(0deg); opacity: 0.5; }
}
@keyframes slide-r4 {
  0%   { transform: translate(12px, 12px) rotateX(0deg) rotateZ(0deg); opacity: 0.4; }
  5%   { transform: translate(-12px, 30px) rotateX(14deg) rotateZ(-5deg); opacity: 0.7; }
  25%  { transform: translate(-28px, calc(var(--card-height, 288px) * 0.85)) rotateX(22deg) rotateZ(-9deg); opacity: 1; }
  70%  { transform: translate(-28px, calc(var(--card-height, 288px) * 0.85)) rotateX(19deg) rotateZ(-7deg); opacity: 1; }
  90%  { transform: translate(-8px, 20px) rotateX(7deg) rotateZ(-2deg); opacity: 0.5; }
  100% { transform: translate(12px, 12px) rotateX(0deg) rotateZ(0deg); opacity: 0.4; }
}
@keyframes slide-r5 {
  0%   { transform: translate(15px, 15px) rotateX(0deg) rotateZ(0deg); opacity: 0.35; }
  5%   { transform: translate(-14px, 35px) rotateX(15deg) rotateZ(-6deg); opacity: 0.65; }
  25%  { transform: translate(-30px, calc(var(--card-height, 288px) * 1.0)) rotateX(24deg) rotateZ(-10deg); opacity: 1; }
  70%  { transform: translate(-30px, calc(var(--card-height, 288px) * 1.0)) rotateX(21deg) rotateZ(-8deg); opacity: 1; }
  90%  { transform: translate(-10px, 22px) rotateX(8deg) rotateZ(-3deg); opacity: 0.45; }
  100% { transform: translate(15px, 15px) rotateX(0deg) rotateZ(0deg); opacity: 0.35; }
}

/* Completed sounding cards get checkmark styling */
.stack-edge.is-complete .stack-card-header::after {
  content: ' ✓';
  color: #10b981;
}

/* Progress indicator on stacked cards */
.stack-card-progress {
  position: absolute;
  bottom: 6px;
  left: 50%;
  transform: translateX(-50%);
  width: 10px;
  height: 10px;
  border-radius: 50%;
  border: 2px solid rgba(251, 191, 36, 0.4);
  background: transparent;
}

.stack-card-progress.complete {
  background: #10b981;
  border-color: #10b981;
}

.stack-card-progress.running {
  border-color: #fbbf24;
  background: rgba(251, 191, 36, 0.3);
}

/* =============================================================================
   Execution State: EVALUATING
   ============================================================================= */

/* Evaluating = indigo border */
.cell-card.status-evaluating .card-face {
  border-color: #6366f1;
}

/* Evaluator indicator - small icon in corner, not center overlay */
.evaluator-indicator {
  position: absolute;
  top: -8px;
  left: 50%;
  transform: translateX(-50%);
  padding: 2px 8px;
  border-radius: 10px;
  background: #6366f1;
  color: white;
  font-size: 10px;
  z-index: 100;
  pointer-events: none;
  display: flex;
  align-items: center;
  gap: 4px;
}

/* =============================================================================
   Execution State: WINNER_SELECTED
   ============================================================================= */

/* Winner has green border */
.cell-card.status-winner_selected .card-face {
  border-color: #10b981;
}

/* Winner badge - simple pill */
.winner-badge {
  position: absolute;
  top: -8px;
  right: -8px;
  padding: 2px 6px;
  background: #10b981;
  border-radius: 8px;
  color: white;
  font-size: 10px;
  font-weight: 700;
  z-index: 50;
}

/* =============================================================================
   Execution State: REFORGE_RUNNING
   ============================================================================= */

/* Reforge = purple border */
.cell-card.status-reforge_running .card-face {
  border-color: #a78bfa;
}

/* =============================================================================
   Execution State: AGGREGATE_RUNNING (Fusion)
   ============================================================================= */

/* Aggregate = gold border */
.cell-card.status-aggregate_running .card-face {
  border-color: #FFD700;
}

/* Fusion symbol - small pill indicator */
.fusion-symbol {
  position: absolute;
  top: -8px;
  left: 50%;
  transform: translateX(-50%);
  padding: 2px 8px;
  border-radius: 10px;
  background: linear-gradient(135deg, #FFD700, #a78bfa);
  color: white;
  font-size: 12px;
  font-weight: 700;
  z-index: 100;
  pointer-events: none;
}
