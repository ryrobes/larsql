cascade_id: data_cascade_test
description: Test data cascade tools - sql_data and python_data
inputs_schema:
  threshold: Minimum value to filter (integer)
cells:
- name: generate
  tool: sql_data
  inputs:
    query: "SELECT * FROM (VALUES\n  (1, 'alice', 100),\n  (2, 'bob', 200),\n  (3, 'charlie', 300),\n  (4, 'diana', 400),\n\
      \  (5, 'eve', 500)\n) AS t(id, name, amount)\nWHERE id >= {{ input.threshold | int }}\n"
  handoffs:
  - transform
- name: transform
  tool: python_data
  inputs:
    code: "df = data.generate\n\n# Add a category column based on amount\ndf['category'] = df['amount'].apply(\n    lambda\
      \ x: 'high' if x >= 300 else 'low'\n)\n\n# Add double amount\ndf['double_amount'] = df['amount'] * 2\n\nresult = df\n"
  handoffs:
  - summary
- name: summary
  tool: sql_data
  inputs:
    query: "SELECT\n  category,\n  COUNT(*) as count,\n  SUM(amount) as total_amount,\n  AVG(double_amount) as avg_double\n\
      FROM _transform\nGROUP BY category\nORDER BY category\n"
  handoffs:
  - final
- name: final
  tool: python_data
  inputs:
    code: "summary_df = data.summary\ntransform_df = data.transform\n\nresult = {\n    \"total_records\": len(transform_df),\n\
      \    \"categories\": summary_df.to_dict('records'),\n    \"high_value_names\": transform_df[transform_df['category']\
      \ == 'high']['name'].tolist(),\n    \"grand_total\": int(transform_df['amount'].sum())\n}\n"
