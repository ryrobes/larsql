parameters:
  session_id:
    type: text
    default: ''
blocks:
- block_id: header
  type: panel
  x: 10
  y: 2
  width: 120
  height: 5
  content:
  - '[bold magenta]RVBBIT Cascade Monitor[/bold magenta]'
  - ''
  - 'Cascade: [cyan]multi_approach_problem_solver[/cyan]'
  - 'Session: [yellow]{{SESSION_ID}}[/yellow]'
  block_map:
    title: RVBBIT
    overlay_color: '#9b59b6'
    darken_factor: 0.5
    blend_opacity: 0.4
    border: false
    padding: 1
- block_id: cell_analyze
  type: panel
  x: 10
  y: 8
  width: 38
  height: 12
  content:
  - '[bold cyan]analyze[/bold cyan]'
  - '[dim]LLM[/dim]'
  - ''
  - 'Status: {{execution_state.cells | jq(''.[] | select(.cell_name=="analyze") |
    if .completed==1 then "[green]Complete[/green]" elif .started==1 then "[yellow]Running[/yellow]"
    else "[dim]Pending[/dim]" end'') | default(''[dim]Pending[/dim]'')}}'
  - ''
  - 'Cost: ${{execution_state.cells | jq(''.[] | select(.cell_name=="analyze") | .cost
    // 0'') | format(''.4f'') | default(''0.0000'')}}'
  - 'Tokens: {{execution_state.cells | jq(''.[] | select(.cell_name=="analyze") |
    .tokens // 0'') | default(''0'')}}'
  block_map:
    title: analyze
    overlay_color: '#2c3e50'
    darken_factor: 0.6
    blend_opacity: 0.3
    border: false
    padding: 1
  parent_of:
  - cell_solve
  connection_style:
    line_style: solid
    color: cyan
    opacity: 0.4
- block_id: cell_solve
  type: panel
  x: 56
  y: 8
  width: 38
  height: 12
  content:
  - '[bold cyan]solve[/bold cyan]'
  - '[dim]LLM[/dim]'
  - ''
  - 'Status: {{execution_state.cells | jq(''.[] | select(.cell_name=="solve") | if
    .completed==1 then "[green]Complete[/green]" elif .started==1 then "[yellow]Running[/yellow]"
    else "[dim]Pending[/dim]" end'') | default(''[dim]Pending[/dim]'')}}'
  - ''
  - 'Cost: ${{execution_state.cells | jq(''.[] | select(.cell_name=="solve") | .cost
    // 0'') | format(''.4f'') | default(''0.0000'')}}'
  - 'Tokens: {{execution_state.cells | jq(''.[] | select(.cell_name=="solve") | .tokens
    // 0'') | default(''0'')}}'
  block_map:
    title: solve
    overlay_color: '#2c3e50'
    darken_factor: 0.6
    blend_opacity: 0.3
    border: false
    padding: 1
  parent_of:
  - cell_validate
  connection_style:
    line_style: solid
    color: cyan
    opacity: 0.4
- block_id: cell_validate
  type: panel
  x: 102
  y: 8
  width: 38
  height: 12
  content:
  - '[bold cyan]validate[/bold cyan]'
  - '[dim]LLM[/dim]'
  - ''
  - 'Status: {{execution_state.cells | jq(''.[] | select(.cell_name=="validate") |
    if .completed==1 then "[green]Complete[/green]" elif .started==1 then "[yellow]Running[/yellow]"
    else "[dim]Pending[/dim]" end'') | default(''[dim]Pending[/dim]'')}}'
  - ''
  - 'Cost: ${{execution_state.cells | jq(''.[] | select(.cell_name=="validate") |
    .cost // 0'') | format(''.4f'') | default(''0.0000'')}}'
  - 'Tokens: {{execution_state.cells | jq(''.[] | select(.cell_name=="validate") |
    .tokens // 0'') | default(''0'')}}'
  block_map:
    title: validate
    overlay_color: '#2c3e50'
    darken_factor: 0.6
    blend_opacity: 0.3
    border: false
    padding: 1
- block_id: execution_state
  type: continuous
  visible: false
  command: while true; do rvbbit sql ' SELECT     cell_name,     MAX(CASE WHEN node_type='"'"'phase_complete'"'"'
    OR role='"'"'phase_complete'"'"' THEN 1 ELSE 0 END) as completed,     MAX(CASE
    WHEN node_type='"'"'phase_start'"'"' OR role='"'"'phase_start'"'"' THEN 1 ELSE
    0 END) as started,     COALESCE(SUM(cost), 0) as cost,     COALESCE(SUM(total_tokens),
    0) as tokens,     MAX(candidate_index) as max_candidate,     MAX(CASE WHEN is_winner=1
    THEN candidate_index END) as winner FROM all_data WHERE session_id = '"'"'{session_id}'"'"'
    GROUP BY cell_name ' --format json 2>/dev/null || echo '[]'; sleep 0.5; done
  x: 0
  y: 0
  width: 1
  height: 1
  data_extraction:
    patterns:
    - type: structured
      format: json
      path: $
      store_as: cells
- block_id: metrics_fetcher
  type: continuous
  visible: false
  command: while true; do rvbbit sql ' SELECT     COALESCE(SUM(cost), 0) as total_cost,     COALESCE(SUM(total_tokens),
    0) as total_tokens,     COUNT(DISTINCT cell_name) as cells_touched,     COUNT(DISTINCT
    trace_id) as total_messages FROM all_data WHERE session_id = '"'"'{session_id}'"'"'
    ' --format json 2>/dev/null || echo '[{}]'; sleep 1; done
  x: 0
  y: 0
  width: 1
  height: 1
  data_extraction:
    patterns:
    - type: structured
      format: json
      path: $[0]
      store_as: metrics
- block_id: metrics_panel
  type: panel
  x: 153
  y: 8
  width: 35
  height: 10
  content:
  - '[bold cyan]Execution Metrics[/bold cyan]'
  - ''
  - 'Total Cost:   ${{metrics_fetcher.metrics.total_cost | format(''.4f'') | default(''0.0000'')}}'
  - 'Total Tokens: {{metrics_fetcher.metrics.total_tokens | default(''0'')}}'
  - 'Cells:        {{metrics_fetcher.metrics.cells_touched | default(''0'')}}'
  - 'Messages:     {{metrics_fetcher.metrics.total_messages | default(''0'')}}'
  block_map:
    title: Metrics
    overlay_color: '#27ae60'
    darken_factor: 0.6
    blend_opacity: 0.3
    border: false
    padding: 1
- block_id: execution_log
  type: continuous
  command: while true; do rvbbit sql ' SELECT     formatDateTime(timestamp, '"'"'%H:%M:%S'"'"')
    as time,     cell_name,     role,     substring(content, 1, 80) as preview FROM
    all_data WHERE session_id = '"'"'{session_id}'"'"'   AND role IN ('"'"'phase_start'"'"',
    '"'"'phase_complete'"'"', '"'"'assistant'"'"', '"'"'tool'"'"') ORDER BY timestamp
    DESC LIMIT 15 ' --format table 2>/dev/null || echo 'Waiting for data...'; sleep
    0.5; done
  x: 10
  y: 25
  width: 120
  height: 18
  block_map:
    title: Execution Log
    overlay_color: '#1a1a2e'
    darken_factor: 0.7
    blend_opacity: 0.4
    border: false
    padding: 1
